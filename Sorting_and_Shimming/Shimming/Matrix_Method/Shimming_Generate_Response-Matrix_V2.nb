(* Content-type: application/vnd.wolfram.mathematica *)

(*** Wolfram Notebook File ***)
(* http://www.wolfram.com/nb *)

(* CreatedBy='Mathematica 12.0' *)

(*CacheID: 234*)
(* Internal cache information:
NotebookFileLineBreakTest
NotebookFileLineBreakTest
NotebookDataPosition[       158,          7]
NotebookDataLength[    261545,       5920]
NotebookOptionsPosition[    254866,       5800]
NotebookOutlinePosition[    255237,       5816]
CellTagsIndexPosition[    255194,       5813]
WindowFrame->Normal*)

(* Beginning of Notebook Content *)
Notebook[{
Cell["Ultima atualiza\[CCedilla]\[ATilde]o: 16/03/21 - 17h", "Text",
 CellChangeTimes->{{3.8245610108335533`*^9, 3.8245610365678215`*^9}, {
  3.8248026059986963`*^9, 3.8248026119394264`*^9}, {3.824883319650178*^9, 
  3.8248833233064055`*^9}},
 Background->RGBColor[
  1, 0.9, 0.8],ExpressionUUID->"f8d0a045-15f0-4510-91e4-999abbbff254"],

Cell[BoxData[
 RowBox[{"(*", " ", 
  RowBox[{
   RowBox[{"Conferir", ":"}], ";", "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"-", " ", "Parametro"}], " ", "K", " ", "calculado", " ", "com", 
    " ", "campo", " ", "total", " ", "no", " ", "Erro", " ", "de", " ", 
    "Fase"}], ";", "\[IndentingNewLine]", "\[IndentingNewLine]", 
   RowBox[{"Problemas", ":"}], ";", "\[IndentingNewLine]", 
   "\[IndentingNewLine]", "\[IndentingNewLine]", 
   RowBox[{"Adicionar", ":"}], ";"}], "\[IndentingNewLine]", 
  "\[IndentingNewLine]", "\[IndentingNewLine]", "*)"}]], "Input",
 CellChangeTimes->{{3.823166486951538*^9, 3.8231666990638304`*^9}, {
   3.823167164627806*^9, 3.8231671650817366`*^9}, {3.823178688548235*^9, 
   3.8231786893197064`*^9}, {3.8231818484502044`*^9, 3.823181872871388*^9}, {
   3.8231879577379665`*^9, 3.823187960683326*^9}, {3.8231905821388845`*^9, 
   3.823190635031934*^9}, {3.8231906706548457`*^9, 3.823190709961046*^9}, {
   3.8232505369550877`*^9, 3.823250556123083*^9}, {3.8235915037968445`*^9, 
   3.823591529002202*^9}, {3.823597053815319*^9, 3.8235970688817444`*^9}, {
   3.823600603459483*^9, 3.8236006166937575`*^9}, {3.8236771445488358`*^9, 
   3.8236771536000586`*^9}, {3.8236772018214083`*^9, 
   3.8236772116458035`*^9}, {3.8236938398954053`*^9, 3.823693844315502*^9}, {
   3.8236945142388697`*^9, 3.823694520715124*^9}, {3.8236946670653763`*^9, 
   3.82369466747803*^9}, {3.8236961658732233`*^9, 3.8236961786000633`*^9}, {
   3.8236992158455057`*^9, 3.8236992198838453`*^9}, {3.823701245517312*^9, 
   3.8237012506889353`*^9}, {3.823701294767122*^9, 3.8237013133791013`*^9}, {
   3.8237074678320417`*^9, 3.823707468292592*^9}, {3.8237079258660126`*^9, 
   3.823707926282319*^9}, {3.8238707107444534`*^9, 3.8238707845511785`*^9}, {
   3.8238730663141956`*^9, 3.823873096464222*^9}, {3.824219080294917*^9, 
   3.82421912548112*^9}, {3.8242790831417227`*^9, 3.8242790835742927`*^9}, {
   3.8242975641422815`*^9, 3.824297584017357*^9}, {3.8243714830514746`*^9, 
   3.8243714847543573`*^9}, {3.824378828446958*^9, 3.8243788563221025`*^9}, 
   3.8243936179523487`*^9, {3.824397076755496*^9, 3.824397079768444*^9}, {
   3.8244837324781475`*^9, 3.824483736188841*^9}, {3.824484167499387*^9, 
   3.8244841870771437`*^9}, {3.824546851469715*^9, 3.8245468520963836`*^9}, {
   3.8245488955831847`*^9, 3.8245489159705524`*^9}, {3.8245610014429674`*^9, 
   3.8245610075835743`*^9}, {3.824799925829488*^9, 3.824799943507265*^9}},
 CellLabel->"In[1]:=",ExpressionUUID->"49f7f3d7-297b-405a-8ba8-81d0394bc050"],

Cell[CellGroupData[{

Cell["Load Radia", "Section",
 CellChangeTimes->{{3.766397988602113*^9, 3.766398000439457*^9}, {
  3.784905891255539*^9, 3.7849058937557244`*^9}, {3.8244837953260765`*^9, 
  3.824483799507316*^9}, {3.824484206680256*^9, 
  3.8244842076301928`*^9}},ExpressionUUID->"73c12565-d3bf-4eca-8b69-\
c33d6bd4a5ec"],

Cell[CellGroupData[{

Cell[BoxData[{
 RowBox[{"ClearAll", "[", "\"\<Global`*\>\"", "]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"<<", "Radia`"}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"RadPlot3DOptions", "[", "]"}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"radUtiDelAll", "[", "]"}], ";"}], " ", 
  RowBox[{"(*", 
   RowBox[{"Erase", " ", "all", " ", "previous", " ", "elements"}], 
   "*)"}]}]}], "Input",
 CellChangeTimes->{{3.6818148953014574`*^9, 3.6818148962234063`*^9}, {
  3.8230135271584983`*^9, 3.8230135274597864`*^9}, {3.823013680470293*^9, 
  3.8230136807868514`*^9}, {3.823186043440482*^9, 3.8231860437259874`*^9}, {
  3.824544725241103*^9, 3.8245447263781257`*^9}, {3.8245490022725987`*^9, 
  3.824549002725765*^9}},
 Background->RGBColor[0.94, 0.91, 0.88],
 CellLabel->"In[1]:=",ExpressionUUID->"f7130747-96b6-4236-9be3-c9d4770809bc"],

Cell[CellGroupData[{

Cell[BoxData[
 InterpretationBox[
  RowBox[{"\<\"Radia Version: \"\>", "\[InvisibleSpace]", "4.31`", 
   "\[InvisibleSpace]", "\<\" is loaded\"\>"}],
  SequenceForm["Radia Version: ", 4.31, " is loaded"],
  Editable->False]], "Print",
 CellChangeTimes->{
  3.7849720143550973`*^9, 3.784972153825938*^9, 3.7849727578753653`*^9, 
   3.784974794460477*^9, 3.7849751016751738`*^9, 3.8230100459579625`*^9, 
   3.823010522927283*^9, 3.823011733387135*^9, 3.82301332505227*^9, 
   3.823017768089164*^9, 3.823076709709319*^9, 3.8230798744067*^9, 
   3.8230799155814037`*^9, {3.823081905225359*^9, 3.8230819302538395`*^9}, 
   3.823082274501047*^9, 3.823082329858588*^9, {3.8230869554616766`*^9, 
   3.8230869683953133`*^9}, 3.8231001209469833`*^9, 3.8231032113615956`*^9, 
   3.8231036866409025`*^9, 3.823163002415757*^9, 3.8231787362514443`*^9, 
   3.82318592649638*^9, 3.8231899911358886`*^9, 3.823245078305653*^9, 
   3.8232504049957695`*^9, 3.8232512614321675`*^9, 3.8233304625348377`*^9, 
   3.823339500187972*^9, 3.8235915666990623`*^9, 3.823612824133816*^9, 
   3.823677920022477*^9, 3.8236817217310505`*^9, 3.823699917482423*^9, {
   3.8237033595430727`*^9, 3.823703380225029*^9}, 3.8238664614664392`*^9, 
   3.8238724984899883`*^9, 3.823872790282493*^9, 3.8242185600166693`*^9, 
   3.824279135157658*^9, 3.8242886370467157`*^9, {3.824289279014082*^9, 
   3.824289284480223*^9}, {3.8242896755745106`*^9, 3.824289678266048*^9}, 
   3.824309164782019*^9, 3.824309750451126*^9, {3.8243103067627115`*^9, 
   3.8243103100415306`*^9}, 3.824310453290001*^9, 3.824310573955643*^9, 
   3.824371574020602*^9, {3.824378159341833*^9, 3.824378171460893*^9}, {
   3.824385769733347*^9, 3.8243857712991915`*^9}, 3.8244538341046867`*^9, 
   3.8244837656412144`*^9, 3.824541634296287*^9, 3.8245447343538895`*^9, 
   3.8245493950137653`*^9, 3.824802621613325*^9, 3.8248195546638985`*^9, 
   3.8248202477016444`*^9, 3.824821181557722*^9, 3.824821935962757*^9, 
   3.826965930751831*^9},
 CellLabel->
  "During evaluation of \
In[1]:=",ExpressionUUID->"4b9b3e38-8926-4d5c-93c9-31b1b9379baa"],

Cell[BoxData["\<\"Radia is copyright ESRF, France.\"\>"], "Print",
 CellChangeTimes->{
  3.7849720143550973`*^9, 3.784972153825938*^9, 3.7849727578753653`*^9, 
   3.784974794460477*^9, 3.7849751016751738`*^9, 3.8230100459579625`*^9, 
   3.823010522927283*^9, 3.823011733387135*^9, 3.82301332505227*^9, 
   3.823017768089164*^9, 3.823076709709319*^9, 3.8230798744067*^9, 
   3.8230799155814037`*^9, {3.823081905225359*^9, 3.8230819302538395`*^9}, 
   3.823082274501047*^9, 3.823082329858588*^9, {3.8230869554616766`*^9, 
   3.8230869683953133`*^9}, 3.8231001209469833`*^9, 3.8231032113615956`*^9, 
   3.8231036866409025`*^9, 3.823163002415757*^9, 3.8231787362514443`*^9, 
   3.82318592649638*^9, 3.8231899911358886`*^9, 3.823245078305653*^9, 
   3.8232504049957695`*^9, 3.8232512614321675`*^9, 3.8233304625348377`*^9, 
   3.823339500187972*^9, 3.8235915666990623`*^9, 3.823612824133816*^9, 
   3.823677920022477*^9, 3.8236817217310505`*^9, 3.823699917482423*^9, {
   3.8237033595430727`*^9, 3.823703380225029*^9}, 3.8238664614664392`*^9, 
   3.8238724984899883`*^9, 3.823872790282493*^9, 3.8242185600166693`*^9, 
   3.824279135157658*^9, 3.8242886370467157`*^9, {3.824289279014082*^9, 
   3.824289284480223*^9}, {3.8242896755745106`*^9, 3.824289678266048*^9}, 
   3.824309164782019*^9, 3.824309750451126*^9, {3.8243103067627115`*^9, 
   3.8243103100415306`*^9}, 3.824310453290001*^9, 3.824310573955643*^9, 
   3.824371574020602*^9, {3.824378159341833*^9, 3.824378171460893*^9}, {
   3.824385769733347*^9, 3.8243857712991915`*^9}, 3.8244538341046867`*^9, 
   3.8244837656412144`*^9, 3.824541634296287*^9, 3.8245447343538895`*^9, 
   3.8245493950137653`*^9, 3.824802621613325*^9, 3.8248195546638985`*^9, 
   3.8248202477016444`*^9, 3.824821181557722*^9, 3.824821935962757*^9, 
   3.8269659307689505`*^9},
 CellLabel->
  "During evaluation of \
In[1]:=",ExpressionUUID->"d01dbfd3-a3df-4ac4-9d26-3555aeeb1873"],

Cell[BoxData["\<\"Portions copyright Synchrotron SOLEIL, France.\"\>"], \
"Print",
 CellChangeTimes->{
  3.7849720143550973`*^9, 3.784972153825938*^9, 3.7849727578753653`*^9, 
   3.784974794460477*^9, 3.7849751016751738`*^9, 3.8230100459579625`*^9, 
   3.823010522927283*^9, 3.823011733387135*^9, 3.82301332505227*^9, 
   3.823017768089164*^9, 3.823076709709319*^9, 3.8230798744067*^9, 
   3.8230799155814037`*^9, {3.823081905225359*^9, 3.8230819302538395`*^9}, 
   3.823082274501047*^9, 3.823082329858588*^9, {3.8230869554616766`*^9, 
   3.8230869683953133`*^9}, 3.8231001209469833`*^9, 3.8231032113615956`*^9, 
   3.8231036866409025`*^9, 3.823163002415757*^9, 3.8231787362514443`*^9, 
   3.82318592649638*^9, 3.8231899911358886`*^9, 3.823245078305653*^9, 
   3.8232504049957695`*^9, 3.8232512614321675`*^9, 3.8233304625348377`*^9, 
   3.823339500187972*^9, 3.8235915666990623`*^9, 3.823612824133816*^9, 
   3.823677920022477*^9, 3.8236817217310505`*^9, 3.823699917482423*^9, {
   3.8237033595430727`*^9, 3.823703380225029*^9}, 3.8238664614664392`*^9, 
   3.8238724984899883`*^9, 3.823872790282493*^9, 3.8242185600166693`*^9, 
   3.824279135157658*^9, 3.8242886370467157`*^9, {3.824289279014082*^9, 
   3.824289284480223*^9}, {3.8242896755745106`*^9, 3.824289678266048*^9}, 
   3.824309164782019*^9, 3.824309750451126*^9, {3.8243103067627115`*^9, 
   3.8243103100415306`*^9}, 3.824310453290001*^9, 3.824310573955643*^9, 
   3.824371574020602*^9, {3.824378159341833*^9, 3.824378171460893*^9}, {
   3.824385769733347*^9, 3.8243857712991915`*^9}, 3.8244538341046867`*^9, 
   3.8244837656412144`*^9, 3.824541634296287*^9, 3.8245447343538895`*^9, 
   3.8245493950137653`*^9, 3.824802621613325*^9, 3.8248195546638985`*^9, 
   3.8248202477016444`*^9, 3.824821181557722*^9, 3.824821935962757*^9, 
   3.8269659307749577`*^9},
 CellLabel->
  "During evaluation of \
In[1]:=",ExpressionUUID->"df246e93-1332-4be9-b402-e92c28d9c39c"],

Cell[BoxData["\<\"Portions copyright Wolfram Research, Inc.\"\>"], "Print",
 CellChangeTimes->{
  3.7849720143550973`*^9, 3.784972153825938*^9, 3.7849727578753653`*^9, 
   3.784974794460477*^9, 3.7849751016751738`*^9, 3.8230100459579625`*^9, 
   3.823010522927283*^9, 3.823011733387135*^9, 3.82301332505227*^9, 
   3.823017768089164*^9, 3.823076709709319*^9, 3.8230798744067*^9, 
   3.8230799155814037`*^9, {3.823081905225359*^9, 3.8230819302538395`*^9}, 
   3.823082274501047*^9, 3.823082329858588*^9, {3.8230869554616766`*^9, 
   3.8230869683953133`*^9}, 3.8231001209469833`*^9, 3.8231032113615956`*^9, 
   3.8231036866409025`*^9, 3.823163002415757*^9, 3.8231787362514443`*^9, 
   3.82318592649638*^9, 3.8231899911358886`*^9, 3.823245078305653*^9, 
   3.8232504049957695`*^9, 3.8232512614321675`*^9, 3.8233304625348377`*^9, 
   3.823339500187972*^9, 3.8235915666990623`*^9, 3.823612824133816*^9, 
   3.823677920022477*^9, 3.8236817217310505`*^9, 3.823699917482423*^9, {
   3.8237033595430727`*^9, 3.823703380225029*^9}, 3.8238664614664392`*^9, 
   3.8238724984899883`*^9, 3.823872790282493*^9, 3.8242185600166693`*^9, 
   3.824279135157658*^9, 3.8242886370467157`*^9, {3.824289279014082*^9, 
   3.824289284480223*^9}, {3.8242896755745106`*^9, 3.824289678266048*^9}, 
   3.824309164782019*^9, 3.824309750451126*^9, {3.8243103067627115`*^9, 
   3.8243103100415306`*^9}, 3.824310453290001*^9, 3.824310573955643*^9, 
   3.824371574020602*^9, {3.824378159341833*^9, 3.824378171460893*^9}, {
   3.824385769733347*^9, 3.8243857712991915`*^9}, 3.8244538341046867`*^9, 
   3.8244837656412144`*^9, 3.824541634296287*^9, 3.8245447343538895`*^9, 
   3.8245493950137653`*^9, 3.824802621613325*^9, 3.8248195546638985`*^9, 
   3.8248202477016444`*^9, 3.824821181557722*^9, 3.824821935962757*^9, 
   3.8269659307769604`*^9},
 CellLabel->
  "During evaluation of \
In[1]:=",ExpressionUUID->"793d8ab8-4b57-4143-8ba4-1c15f1895ca3"]
}, Open  ]]
}, Open  ]]
}, Open  ]],

Cell[CellGroupData[{

Cell["Functions", "Section",
 CellChangeTimes->{{3.8254204660420375`*^9, 
  3.825420467050026*^9}},ExpressionUUID->"cfb3e124-01a4-4df8-bc8a-\
ebbf76cafe60"],

Cell[CellGroupData[{

Cell["BlockGeometry", "Subsection",
 CellChangeTimes->{{3.823006823806962*^9, 
  3.823006826765521*^9}},ExpressionUUID->"15713606-9118-4d54-955f-\
72574a6cced5"],

Cell[BoxData[
 RowBox[{
  RowBox[{"idBlockGeometry", "[", "checkgeo_", "]"}], ":=", 
  RowBox[{"(", "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"Module", "[", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{"geo1", ",", "geo2", ",", "geo3"}], "}"}], ",", 
      "\[IndentingNewLine]", "\[IndentingNewLine]", 
      RowBox[{"(*", 
       RowBox[{
        RowBox[{"Geo", " ", "A1"}], ",", " ", 
        RowBox[{"Delta", " ", "52.5"}]}], "*)"}], "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"If", "[", 
        RowBox[{
         RowBox[{"checkgeo", "\[Equal]", "1"}], ",", "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{"geo1", "=", 
           RowBox[{"{", 
            RowBox[{
             RowBox[{"{", 
              RowBox[{
               RowBox[{"-", "21.5"}], ",", 
               RowBox[{"-", "50"}]}], "}"}], ",", 
             RowBox[{"{", 
              RowBox[{"21.5", ",", 
               RowBox[{"-", "50"}]}], "}"}], ",", 
             RowBox[{"{", 
              RowBox[{"22.5", ",", 
               RowBox[{"-", "49"}]}], "}"}], ",", 
             RowBox[{"{", 
              RowBox[{"22.5", ",", 
               RowBox[{"-", "41.8"}]}], "}"}], ",", 
             RowBox[{"{", 
              RowBox[{"16.794", ",", 
               RowBox[{"-", "37.654"}]}], "}"}], ",", 
             RowBox[{"{", 
              RowBox[{
               RowBox[{"-", "16.794"}], ",", 
               RowBox[{"-", "37.654"}]}], "}"}], ",", 
             RowBox[{"{", 
              RowBox[{
               RowBox[{"-", "22.5"}], ",", 
               RowBox[{"-", "41.8"}]}], "}"}], ",", 
             RowBox[{"{", 
              RowBox[{
               RowBox[{"-", "22.5"}], ",", 
               RowBox[{"-", "49"}]}], "}"}]}], "}"}]}], ";", 
          "\[IndentingNewLine]", 
          RowBox[{"geo2", "=", 
           RowBox[{"{", 
            RowBox[{
             RowBox[{"{", 
              RowBox[{"16.794", ",", 
               RowBox[{"-", "37.654"}]}], "}"}], ",", 
             RowBox[{"{", 
              RowBox[{"16.794", ",", 
               RowBox[{"-", "33.946"}]}], "}"}], ",", 
             RowBox[{"{", 
              RowBox[{
               RowBox[{"-", "16.794"}], ",", 
               RowBox[{"-", "33.946"}]}], "}"}], ",", 
             RowBox[{"{", 
              RowBox[{
               RowBox[{"-", "16.794"}], ",", 
               RowBox[{"-", "37.654"}]}], "}"}]}], "}"}]}], ";", 
          "\[IndentingNewLine]", 
          RowBox[{"geo3", "=", 
           RowBox[{"{", 
            RowBox[{
             RowBox[{"{", 
              RowBox[{"16.794", ",", 
               RowBox[{"-", "33.946"}]}], "}"}], ",", 
             RowBox[{"{", 
              RowBox[{"22.5", ",", 
               RowBox[{"-", "29.8"}]}], "}"}], ",", 
             RowBox[{"{", 
              RowBox[{"22.5", ",", 
               RowBox[{"-", "19.3"}]}], "}"}], ",", 
             RowBox[{"{", 
              RowBox[{"5.25", ",", "0.0"}], "}"}], ",", 
             RowBox[{"{", 
              RowBox[{
               RowBox[{"-", "5.25"}], ",", "0.0"}], "}"}], ",", 
             RowBox[{"{", 
              RowBox[{
               RowBox[{"-", "22.5"}], ",", 
               RowBox[{"-", "19.3"}]}], "}"}], ",", 
             RowBox[{"{", 
              RowBox[{
               RowBox[{"-", "22.5"}], ",", 
               RowBox[{"-", "29.8"}]}], "}"}], ",", 
             RowBox[{"{", 
              RowBox[{
               RowBox[{"-", "16.794"}], ",", 
               RowBox[{"-", "33.946"}]}], "}"}]}], "}"}]}], ";"}]}], 
        "\[IndentingNewLine]", "]"}], ";", "\[IndentingNewLine]", 
       "\[IndentingNewLine]", 
       RowBox[{"If", "[", 
        RowBox[{
         RowBox[{"checkgeo", "\[Equal]", "2"}], ",", "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{"geo1", "=", 
           RowBox[{"{", 
            RowBox[{
             RowBox[{"{", 
              RowBox[{"16.794", ",", 
               RowBox[{"-", "37.654"}]}], "}"}], ",", 
             RowBox[{"{", 
              RowBox[{"16.794", ",", 
               RowBox[{"-", "33.946"}]}], "}"}], ",", 
             RowBox[{"{", 
              RowBox[{
               RowBox[{"-", "16.794"}], ",", 
               RowBox[{"-", "33.946"}]}], "}"}], ",", 
             RowBox[{"{", 
              RowBox[{
               RowBox[{"-", "16.794"}], ",", 
               RowBox[{"-", "37.654"}]}], "}"}]}], "}"}]}], ";", 
          "\[IndentingNewLine]", 
          RowBox[{"geo2", "=", 
           RowBox[{"{", 
            RowBox[{
             RowBox[{"{", 
              RowBox[{"16.794", ",", 
               RowBox[{"-", "33.946"}]}], "}"}], ",", 
             RowBox[{"{", 
              RowBox[{"22.5", ",", 
               RowBox[{"-", "29.8"}]}], "}"}], ",", 
             RowBox[{"{", 
              RowBox[{"22.5", ",", 
               RowBox[{"-", "19.3"}]}], "}"}], ",", 
             RowBox[{"{", 
              RowBox[{"5.25", ",", "0.0"}], "}"}], ",", 
             RowBox[{"{", 
              RowBox[{
               RowBox[{"-", "5.25"}], ",", "0.0"}], "}"}], ",", 
             RowBox[{"{", 
              RowBox[{
               RowBox[{"-", "22.5"}], ",", 
               RowBox[{"-", "19.3"}]}], "}"}], ",", 
             RowBox[{"{", 
              RowBox[{
               RowBox[{"-", "22.5"}], ",", 
               RowBox[{"-", "29.8"}]}], "}"}], ",", 
             RowBox[{"{", 
              RowBox[{
               RowBox[{"-", "16.794"}], ",", 
               RowBox[{"-", "33.946"}]}], "}"}]}], "}"}]}], ";"}]}], 
        "\[IndentingNewLine]", "]"}], ";", "\[IndentingNewLine]", 
       "\[IndentingNewLine]", 
       RowBox[{"Return", "[", 
        RowBox[{"{", 
         RowBox[{"geo1", ",", "geo2", ",", "geo3"}], "}"}], "]"}]}]}], 
     "\[IndentingNewLine]", "]"}], ";"}], "\[IndentingNewLine]", 
   ")"}]}]], "Input",
 CellChangeTimes->{{3.8229973334496083`*^9, 3.8229975357986193`*^9}, {
   3.82299756675494*^9, 3.8229975706368685`*^9}, {3.823006742030616*^9, 
   3.8230068053256755`*^9}, 3.8230101467535343`*^9, {3.8231011693095837`*^9, 
   3.8231011939352427`*^9}, {3.8236951137333775`*^9, 3.823695115555832*^9}, {
   3.8237008274433804`*^9, 3.8237008500952864`*^9}},
 Background->RGBColor[0.94, 0.91, 0.88],
 CellLabel->"In[5]:=",ExpressionUUID->"fa065e99-4543-4484-a80d-abb6becd9ea9"]
}, Closed]],

Cell[CellGroupData[{

Cell["cassetteDraw", "Subsection",
 CellChangeTimes->{{3.822996513974464*^9, 3.8229965257892003`*^9}, {
  3.8229965764562564`*^9, 
  3.8229965827147937`*^9}},ExpressionUUID->"e4fe6c6b-9cb4-45ff-8ec9-\
3e78befadfe2"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"cassetteDraw", "::", "usage"}], " ", "=", " ", 
    "\"\<magnetizations = Lista das magnetiza\[CCedilla]\[OTilde]es dos \
blocos de um cassete (lista de tamanho n); blockGeo = {geo1,geo2,geo3}; \n\
termination = {{lista de magnetizacoes na entrada}, {lista de espessuras na \
entrada}, {lista de espa\[CCedilla]amentos na entrada},{lista de \
magnetizacoes na sa\[IAcute]da}, {lista de espessuras na sa\[IAcute]da}, \
{lista de espa\[CCedilla]amentos na sa\[IAcute]da}}\>\""}], ";"}], " ", 
  "\[IndentingNewLine]", "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"idCassetteDraw", "[", 
   RowBox[{
   "magnetizations_", ",", "blockGeo_", ",", "posErrors_", ",", 
    "termination_", ",", "periodL_", ",", "blockThick_", ",", "gap_", ",", 
    "blockGap_", ",", "subdiv_"}], "]"}], ":=", 
  RowBox[{"(", "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"Module", "[", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{
       "cassette", ",", "block", ",", "obj", ",", "obj1", ",", "obj2", ",", 
        "obj3", ",", "blocknumber", ",", "vacodym745ap", ",", "termLength", 
        ",", "i", ",", "j", ",", "parts", ",", "randomErrorY", ",", 
        "randomErrorZ", ",", "longPos"}], "}"}], ",", "\[IndentingNewLine]", 
      "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"cassette", "=", 
        RowBox[{"radObjCnt", "[", 
         RowBox[{"{", "}"}], "]"}]}], ";", "\[IndentingNewLine]", 
       RowBox[{"parts", "=", 
        RowBox[{"Length", "[", "blockGeo", "]"}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"obj", "=", 
        RowBox[{"ConstantArray", "[", 
         RowBox[{
          RowBox[{"{", "}"}], ",", "parts"}], "]"}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"blocknumber", "=", 
        RowBox[{
         RowBox[{"Length", "[", "magnetizations", "]"}], "+", 
         RowBox[{"Length", "[", 
          RowBox[{"termination", "[", 
           RowBox[{"[", "1", "]"}], "]"}], "]"}], "+", 
         RowBox[{"Length", "[", 
          RowBox[{"termination", "[", 
           RowBox[{"[", "4", "]"}], "]"}], "]"}]}]}], ";", 
       "\[IndentingNewLine]", "\[IndentingNewLine]", 
       RowBox[{"(*", 
        RowBox[{"Position", " ", "Errors"}], "*)"}], "\[IndentingNewLine]", 
       RowBox[{"If", "[", 
        RowBox[{
         RowBox[{
          RowBox[{"posErrors", "[", 
           RowBox[{"[", "1", "]"}], "]"}], ">", "0"}], ",", 
         "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{"randomErrorY", "=", 
           RowBox[{
            RowBox[{"Table", "[", 
             RowBox[{
              RowBox[{"RandomVariate", "[", 
               RowBox[{"NormalDistribution", "[", 
                RowBox[{
                 RowBox[{
                  RowBox[{"posErrors", "[", 
                   RowBox[{"[", "1", "]"}], "]"}], "/", "2"}], ",", 
                 RowBox[{
                  RowBox[{"(", 
                   RowBox[{
                    RowBox[{"posErrors", "[", 
                    RowBox[{"[", "1", "]"}], "]"}], "/", "2"}], ")"}], "/", 
                  "3"}]}], "]"}], "]"}], ",", 
              RowBox[{"{", 
               RowBox[{"i", ",", "1", ",", "blocknumber"}], "}"}]}], "]"}], 
            "*", 
            RowBox[{"RandomChoice", "[", 
             RowBox[{
              RowBox[{"{", 
               RowBox[{
                RowBox[{"-", "1"}], ",", "1"}], "}"}], ",", "blocknumber"}], 
             "]"}]}]}], ";"}], "\[IndentingNewLine]", ",", 
         "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{"randomErrorY", "=", 
           RowBox[{"ConstantArray", "[", 
            RowBox[{"0", ",", "blocknumber"}], "]"}]}], ";"}]}], 
        "\[IndentingNewLine]", "]"}], ";", "\[IndentingNewLine]", 
       RowBox[{"If", "[", 
        RowBox[{
         RowBox[{
          RowBox[{"posErrors", "[", 
           RowBox[{"[", "2", "]"}], "]"}], ">", "0"}], ",", 
         "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{"randomErrorZ", "=", 
           RowBox[{
            RowBox[{"Table", "[", 
             RowBox[{
              RowBox[{"RandomVariate", "[", 
               RowBox[{"NormalDistribution", "[", 
                RowBox[{
                 RowBox[{
                  RowBox[{"posErrors", "[", 
                   RowBox[{"[", "2", "]"}], "]"}], "/", "2"}], ",", 
                 RowBox[{
                  RowBox[{"(", 
                   RowBox[{
                    RowBox[{"posErrors", "[", 
                    RowBox[{"[", "2", "]"}], "]"}], "/", "2"}], ")"}], "/", 
                  "3"}]}], "]"}], "]"}], ",", 
              RowBox[{"{", 
               RowBox[{"i", ",", "1", ",", "blocknumber"}], "}"}]}], "]"}], 
            "*", 
            RowBox[{"RandomChoice", "[", 
             RowBox[{
              RowBox[{"{", 
               RowBox[{
                RowBox[{"-", "1"}], ",", "1"}], "}"}], ",", "blocknumber"}], 
             "]"}]}]}], ";"}], "\[IndentingNewLine]", ",", 
         "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{"randomErrorZ", "=", 
           RowBox[{"ConstantArray", "[", 
            RowBox[{"0", ",", "blocknumber"}], "]"}]}], ";"}]}], 
        "\[IndentingNewLine]", "]"}], ";", "\[IndentingNewLine]", 
       "\[IndentingNewLine]", 
       RowBox[{"(*", 
        RowBox[{"===", 
         RowBox[{"==", " ", 
          RowBox[{"Termination", " ", "Front"}]}], " ", "===", "=="}], "*)"}],
        "\[IndentingNewLine]", 
       RowBox[{"block", "=", 
        RowBox[{"ConstantArray", "[", 
         RowBox[{
          RowBox[{"{", "}"}], ",", 
          RowBox[{"Length", "[", 
           RowBox[{"termination", "[", 
            RowBox[{"[", "1", "]"}], "]"}], "]"}]}], "]"}]}], ";", 
       "\[IndentingNewLine]", "\[IndentingNewLine]", 
       RowBox[{"For", "[", 
        RowBox[{
         RowBox[{"i", "=", "1"}], ",", 
         RowBox[{"i", "\[LessEqual]", " ", 
          RowBox[{"Length", "[", 
           RowBox[{"termination", "[", 
            RowBox[{"[", "1", "]"}], "]"}], "]"}]}], ",", 
         RowBox[{"i", "++"}], ",", "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{
           RowBox[{"block", "[", 
            RowBox[{"[", "i", "]"}], "]"}], "=", 
           RowBox[{"radObjCnt", "[", 
            RowBox[{"{", "}"}], "]"}]}], ";", "\[IndentingNewLine]", 
          "\[IndentingNewLine]", 
          RowBox[{"(*", 
           RowBox[{"Next", " ", "Block", " ", "Position"}], "*)"}], 
          "\[IndentingNewLine]", 
          RowBox[{"If", "[", 
           RowBox[{
            RowBox[{"i", "\[LessEqual]", "1"}], ",", "\[IndentingNewLine]", 
            RowBox[{"longPos", "=", "0"}], ",", "\[IndentingNewLine]", 
            RowBox[{
             RowBox[{"longPos", "=", 
              RowBox[{"longPos", "+", 
               RowBox[{"0.5", "*", 
                RowBox[{"termination", "[", 
                 RowBox[{"[", 
                  RowBox[{"2", ",", 
                   RowBox[{"i", "-", "1"}]}], "]"}], "]"}]}], "+", 
               RowBox[{"termination", "[", 
                RowBox[{"[", 
                 RowBox[{"3", ",", 
                  RowBox[{"i", "-", "1"}]}], "]"}], "]"}], "+", 
               RowBox[{"0.5", "*", 
                RowBox[{"termination", "[", 
                 RowBox[{"[", 
                  RowBox[{"2", ",", "i"}], "]"}], "]"}]}]}]}], ";"}]}], 
           "\[IndentingNewLine]", "]"}], ";", "\[IndentingNewLine]", 
          "\[IndentingNewLine]", 
          RowBox[{"(*", 
           RowBox[{"Create", " ", "the", " ", "Block", " ", "Object"}], 
           "*)"}], "\[IndentingNewLine]", 
          RowBox[{"For", "[", 
           RowBox[{
            RowBox[{"j", "=", "1"}], ",", 
            RowBox[{"j", "\[LessEqual]", " ", "parts"}], ",", 
            RowBox[{"j", "++"}], ",", "\[IndentingNewLine]", 
            RowBox[{"(*", 
             RowBox[{"Extrude", " ", "part"}], "*)"}], "\[IndentingNewLine]", 
            RowBox[{
             RowBox[{
              RowBox[{"obj", "[", 
               RowBox[{"[", "j", "]"}], "]"}], "=", 
              RowBox[{"radObjThckPgn", "[", 
               RowBox[{"longPos", ",", 
                RowBox[{"termination", "[", 
                 RowBox[{"[", 
                  RowBox[{"2", ",", "i"}], "]"}], "]"}], ",", 
                RowBox[{"blockGeo", "[", 
                 RowBox[{"[", "j", "]"}], "]"}], ",", 
                RowBox[{"termination", "[", 
                 RowBox[{"[", 
                  RowBox[{"1", ",", "i"}], "]"}], "]"}]}], "]"}]}], ";", 
             "\[IndentingNewLine]", 
             RowBox[{"(*", 
              RowBox[{"Part", " ", "Subdivision"}], "*)"}], 
             "\[IndentingNewLine]", 
             RowBox[{"radObjDivMag", "[", 
              RowBox[{
               RowBox[{"obj", "[", 
                RowBox[{"[", "j", "]"}], "]"}], ",", 
               RowBox[{"subdiv", "[", 
                RowBox[{"[", "j", "]"}], "]"}]}], "]"}], ";", 
             "\[IndentingNewLine]", 
             RowBox[{"(*", 
              RowBox[{"Add", " ", "Part", " ", "to", " ", "block"}], "*)"}], 
             "\[IndentingNewLine]", 
             RowBox[{"radObjAddToCnt", "[", 
              RowBox[{
               RowBox[{"block", "[", 
                RowBox[{"[", "i", "]"}], "]"}], ",", 
               RowBox[{"{", 
                RowBox[{"obj", "[", 
                 RowBox[{"[", "j", "]"}], "]"}], "}"}]}], "]"}], ";"}]}], 
           "\[IndentingNewLine]", "]"}], ";", "\[IndentingNewLine]", 
          "\[IndentingNewLine]", 
          RowBox[{"(*", 
           RowBox[{"Position", " ", "Error"}], "*)"}], "\[IndentingNewLine]", 
          RowBox[{"radTrfOrnt", "[", 
           RowBox[{
            RowBox[{"block", "[", 
             RowBox[{"[", "i", "]"}], "]"}], ",", 
            RowBox[{"radTrfTrsl", "[", 
             RowBox[{"{", 
              RowBox[{"0", ",", 
               RowBox[{"randomErrorY", "[", 
                RowBox[{"[", "i", "]"}], "]"}], ",", 
               RowBox[{"randomErrorZ", "[", 
                RowBox[{"[", "i", "]"}], "]"}]}], "}"}], "]"}]}], "]"}], ";", 
          "\[IndentingNewLine]", "\[IndentingNewLine]", 
          RowBox[{"(*", 
           RowBox[{
           "Apply", " ", "Material", " ", "and", " ", "Magnetization"}], 
           "*)"}], "\[IndentingNewLine]", 
          RowBox[{"vacodym745ap", "=", 
           RowBox[{"radMatLin", "[", 
            RowBox[{
             RowBox[{"{", 
              RowBox[{"0.06", ",", "0.17"}], "}"}], ",", 
             RowBox[{"termination", "[", 
              RowBox[{"[", 
               RowBox[{"1", ",", "i"}], "]"}], "]"}]}], "]"}]}], ";", 
          "\[IndentingNewLine]", 
          RowBox[{"radMatApl", "[", 
           RowBox[{
            RowBox[{"block", "[", 
             RowBox[{"[", "i", "]"}], "]"}], ",", "vacodym745ap"}], "]"}], 
          ";", "\[IndentingNewLine]", "\[IndentingNewLine]", 
          RowBox[{"(*", 
           RowBox[{"Add", " ", "to", " ", "Cassette"}], "*)"}], 
          "\[IndentingNewLine]", 
          RowBox[{"radObjAddToCnt", "[", 
           RowBox[{"cassette", ",", 
            RowBox[{"{", 
             RowBox[{"block", "[", 
              RowBox[{"[", "i", "]"}], "]"}], "}"}]}], "]"}], ";"}]}], 
        "\[IndentingNewLine]", "]"}], ";", "\[IndentingNewLine]", 
       "\[IndentingNewLine]", 
       RowBox[{"(*", 
        RowBox[{"===", 
         RowBox[{"==", " ", "Periods"}], " ", "===", "=="}], "*)"}], 
       "\[IndentingNewLine]", 
       RowBox[{"block", "=", 
        RowBox[{"ConstantArray", "[", 
         RowBox[{
          RowBox[{"{", "}"}], ",", 
          RowBox[{"Length", "[", "magnetizations", "]"}]}], "]"}]}], ";", 
       "\[IndentingNewLine]", "\[IndentingNewLine]", 
       RowBox[{"For", "[", 
        RowBox[{
         RowBox[{"i", "=", "1"}], ",", 
         RowBox[{"i", "\[LessEqual]", " ", 
          RowBox[{"Length", "[", "magnetizations", "]"}]}], ",", 
         RowBox[{"i", "++"}], ",", "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{
           RowBox[{"block", "[", 
            RowBox[{"[", "i", "]"}], "]"}], "=", 
           RowBox[{"radObjCnt", "[", 
            RowBox[{"{", "}"}], "]"}]}], ";", "\[IndentingNewLine]", 
          "\[IndentingNewLine]", 
          RowBox[{"(*", 
           RowBox[{"Block", " ", "Position"}], "*)"}], "\[IndentingNewLine]", 
          RowBox[{"If", "[", 
           RowBox[{
            RowBox[{"i", "\[LessEqual]", "1"}], ",", "\[IndentingNewLine]", 
            RowBox[{
             RowBox[{"longPos", "=", 
              RowBox[{"longPos", "+", 
               RowBox[{"0.5", "*", 
                RowBox[{"termination", "[", 
                 RowBox[{"[", 
                  RowBox[{"2", ",", 
                   RowBox[{"-", "1"}]}], "]"}], "]"}]}], "+", 
               RowBox[{"termination", "[", 
                RowBox[{"[", 
                 RowBox[{"3", ",", 
                  RowBox[{"-", "1"}]}], "]"}], "]"}], "+", 
               RowBox[{"0.5", "*", "blockThick"}]}]}], ";"}], 
            "\[IndentingNewLine]", ",", "\[IndentingNewLine]", 
            RowBox[{
             RowBox[{"longPos", "=", 
              RowBox[{"longPos", "+", "blockThick", "+", "blockGap"}]}], 
             ";"}]}], "\[IndentingNewLine]", "]"}], ";", 
          "\[IndentingNewLine]", "\[IndentingNewLine]", 
          RowBox[{"For", "[", 
           RowBox[{
            RowBox[{"j", "=", "1"}], ",", 
            RowBox[{"j", "\[LessEqual]", " ", "parts"}], ",", 
            RowBox[{"j", "++"}], ",", "\[IndentingNewLine]", 
            RowBox[{
             RowBox[{
              RowBox[{"obj", "[", 
               RowBox[{"[", "j", "]"}], "]"}], "=", 
              RowBox[{"radObjThckPgn", "[", 
               RowBox[{"longPos", ",", "blockThick", ",", 
                RowBox[{"blockGeo", "[", 
                 RowBox[{"[", "j", "]"}], "]"}], ",", 
                RowBox[{"magnetizations", "[", 
                 RowBox[{"[", "i", "]"}], "]"}]}], "]"}]}], ";", 
             "\[IndentingNewLine]", 
             RowBox[{"(*", 
              RowBox[{"Part", " ", "Subdivision"}], "*)"}], 
             "\[IndentingNewLine]", 
             RowBox[{"radObjDivMag", "[", 
              RowBox[{
               RowBox[{"obj", "[", 
                RowBox[{"[", "j", "]"}], "]"}], ",", 
               RowBox[{"subdiv", "[", 
                RowBox[{"[", "j", "]"}], "]"}]}], "]"}], ";", 
             "\[IndentingNewLine]", 
             RowBox[{"(*", 
              RowBox[{"Add", " ", "Part", " ", "to", " ", "block"}], "*)"}], 
             "\[IndentingNewLine]", 
             RowBox[{"radObjAddToCnt", "[", 
              RowBox[{
               RowBox[{"block", "[", 
                RowBox[{"[", "i", "]"}], "]"}], ",", 
               RowBox[{"{", 
                RowBox[{"obj", "[", 
                 RowBox[{"[", "j", "]"}], "]"}], "}"}]}], "]"}], ";"}]}], 
           "\[IndentingNewLine]", "]"}], ";", "\[IndentingNewLine]", 
          "\[IndentingNewLine]", 
          RowBox[{"(*", 
           RowBox[{"Position", " ", "Error"}], "*)"}], "\[IndentingNewLine]", 
          RowBox[{"radTrfOrnt", "[", 
           RowBox[{
            RowBox[{"block", "[", 
             RowBox[{"[", "i", "]"}], "]"}], ",", 
            RowBox[{"radTrfTrsl", "[", 
             RowBox[{"{", 
              RowBox[{"0", ",", 
               RowBox[{"randomErrorY", "[", 
                RowBox[{"[", "i", "]"}], "]"}], ",", 
               RowBox[{"randomErrorZ", "[", 
                RowBox[{"[", "i", "]"}], "]"}]}], "}"}], "]"}]}], "]"}], ";", 
          "\[IndentingNewLine]", "\[IndentingNewLine]", 
          RowBox[{"(*", 
           RowBox[{
           "Apply", " ", "Material", " ", "and", " ", "Magnetization"}], 
           "*)"}], "\[IndentingNewLine]", 
          RowBox[{"vacodym745ap", "=", 
           RowBox[{"radMatLin", "[", 
            RowBox[{
             RowBox[{"{", 
              RowBox[{"0.06", ",", "0.17"}], "}"}], ",", 
             RowBox[{"magnetizations", "[", 
              RowBox[{"[", "i", "]"}], "]"}]}], "]"}]}], ";", 
          "\[IndentingNewLine]", 
          RowBox[{"radMatApl", "[", 
           RowBox[{
            RowBox[{"block", "[", 
             RowBox[{"[", "i", "]"}], "]"}], ",", "vacodym745ap"}], "]"}], 
          ";", " ", "\[IndentingNewLine]", "\[IndentingNewLine]", 
          RowBox[{"(*", 
           RowBox[{"Add", " ", "to", " ", "Cassette"}], "*)"}], 
          "\[IndentingNewLine]", 
          RowBox[{"radObjAddToCnt", "[", 
           RowBox[{"cassette", ",", 
            RowBox[{"{", 
             RowBox[{"block", "[", 
              RowBox[{"[", "i", "]"}], "]"}], "}"}]}], "]"}], ";"}]}], 
        "\[IndentingNewLine]", "\[IndentingNewLine]", "]"}], ";", 
       "\[IndentingNewLine]", "\[IndentingNewLine]", 
       RowBox[{"(*", 
        RowBox[{"===", 
         RowBox[{"==", " ", 
          RowBox[{"Termination", " ", "Back"}]}], " ", "===", "=="}], "*)"}], 
       "\[IndentingNewLine]", 
       RowBox[{"block", "=", 
        RowBox[{"ConstantArray", "[", 
         RowBox[{
          RowBox[{"{", "}"}], ",", 
          RowBox[{"Length", "[", 
           RowBox[{"termination", "[", 
            RowBox[{"[", "1", "]"}], "]"}], "]"}]}], "]"}]}], ";", 
       "\[IndentingNewLine]", "\[IndentingNewLine]", 
       RowBox[{"For", "[", 
        RowBox[{
         RowBox[{"i", "=", "1"}], ",", 
         RowBox[{"i", "\[LessEqual]", " ", 
          RowBox[{"Length", "[", 
           RowBox[{"termination", "[", 
            RowBox[{"[", "4", "]"}], "]"}], "]"}]}], ",", 
         RowBox[{"i", "++"}], ",", "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{
           RowBox[{"block", "[", 
            RowBox[{"[", "i", "]"}], "]"}], "=", 
           RowBox[{"radObjCnt", "[", 
            RowBox[{"{", "}"}], "]"}]}], ";", "\[IndentingNewLine]", 
          "\[IndentingNewLine]", 
          RowBox[{"(*", 
           RowBox[{"Next", " ", "Block", " ", "Position"}], "*)"}], 
          "\[IndentingNewLine]", 
          RowBox[{"If", "[", 
           RowBox[{
            RowBox[{"i", "\[LessEqual]", " ", "1"}], ",", 
            "\[IndentingNewLine]", 
            RowBox[{
             RowBox[{"longPos", "=", 
              RowBox[{"longPos", "+", 
               RowBox[{"blockThick", "/", "2"}], "+", 
               RowBox[{"termination", "[", 
                RowBox[{"[", 
                 RowBox[{"6", ",", "1"}], "]"}], "]"}], "+", 
               RowBox[{
                RowBox[{"termination", "[", 
                 RowBox[{"[", 
                  RowBox[{"5", ",", "1"}], "]"}], "]"}], "/", "2"}]}]}], 
             ";"}], "\[IndentingNewLine]", ",", "\[IndentingNewLine]", 
            RowBox[{
             RowBox[{"longPos", "=", 
              RowBox[{"longPos", "+", 
               RowBox[{"0.5", "*", 
                RowBox[{"termination", "[", 
                 RowBox[{"[", 
                  RowBox[{"5", ",", 
                   RowBox[{"i", "-", "1"}]}], "]"}], "]"}]}], "+", 
               RowBox[{"termination", "[", 
                RowBox[{"[", 
                 RowBox[{"6", ",", "i"}], "]"}], "]"}], "+", 
               RowBox[{"0.5", "*", 
                RowBox[{"termination", "[", 
                 RowBox[{"[", 
                  RowBox[{"5", ",", "i"}], "]"}], "]"}]}]}]}], ";"}]}], 
           "\[IndentingNewLine]", "]"}], ";", "\[IndentingNewLine]", 
          "\[IndentingNewLine]", 
          RowBox[{"For", "[", 
           RowBox[{
            RowBox[{"j", "=", "1"}], ",", 
            RowBox[{"j", "\[LessEqual]", " ", "parts"}], ",", 
            RowBox[{"j", "++"}], ",", "\[IndentingNewLine]", 
            RowBox[{
             RowBox[{
              RowBox[{"obj", "[", 
               RowBox[{"[", "j", "]"}], "]"}], "=", 
              RowBox[{"radObjThckPgn", "[", 
               RowBox[{"longPos", ",", 
                RowBox[{"termination", "[", 
                 RowBox[{"[", 
                  RowBox[{"5", ",", "i"}], "]"}], "]"}], ",", 
                RowBox[{"blockGeo", "[", 
                 RowBox[{"[", "j", "]"}], "]"}], ",", 
                RowBox[{"termination", "[", 
                 RowBox[{"[", 
                  RowBox[{"4", ",", "i"}], "]"}], "]"}]}], "]"}]}], ";", 
             "\[IndentingNewLine]", 
             RowBox[{"(*", 
              RowBox[{"Part", " ", "Subdivision"}], "*)"}], 
             "\[IndentingNewLine]", 
             RowBox[{"radObjDivMag", "[", 
              RowBox[{
               RowBox[{"obj", "[", 
                RowBox[{"[", "j", "]"}], "]"}], ",", 
               RowBox[{"subdiv", "[", 
                RowBox[{"[", "j", "]"}], "]"}]}], "]"}], ";", 
             "\[IndentingNewLine]", 
             RowBox[{"(*", 
              RowBox[{"Add", " ", "Part", " ", "to", " ", "block"}], "*)"}], 
             "\[IndentingNewLine]", 
             RowBox[{"radObjAddToCnt", "[", 
              RowBox[{
               RowBox[{"block", "[", 
                RowBox[{"[", "i", "]"}], "]"}], ",", 
               RowBox[{"{", 
                RowBox[{"obj", "[", 
                 RowBox[{"[", "j", "]"}], "]"}], "}"}]}], "]"}], ";"}]}], 
           "\[IndentingNewLine]", "]"}], ";", "\[IndentingNewLine]", 
          "\[IndentingNewLine]", 
          RowBox[{"(*", 
           RowBox[{"Position", " ", "Error"}], "*)"}], "\[IndentingNewLine]", 
          RowBox[{"radTrfOrnt", "[", 
           RowBox[{
            RowBox[{"block", "[", 
             RowBox[{"[", "i", "]"}], "]"}], ",", 
            RowBox[{"radTrfTrsl", "[", 
             RowBox[{"{", 
              RowBox[{"0", ",", 
               RowBox[{"randomErrorY", "[", 
                RowBox[{"[", "i", "]"}], "]"}], ",", 
               RowBox[{"randomErrorZ", "[", 
                RowBox[{"[", "i", "]"}], "]"}]}], "}"}], "]"}]}], "]"}], ";", 
          "\[IndentingNewLine]", "\[IndentingNewLine]", 
          RowBox[{"(*", 
           RowBox[{
           "Apply", " ", "Material", " ", "and", " ", "Magnetization"}], 
           "*)"}], "\[IndentingNewLine]", 
          RowBox[{"vacodym745ap", "=", 
           RowBox[{"radMatLin", "[", 
            RowBox[{
             RowBox[{"{", 
              RowBox[{"0.06", ",", "0.17"}], "}"}], ",", 
             RowBox[{"termination", "[", 
              RowBox[{"[", 
               RowBox[{"4", ",", "i"}], "]"}], "]"}]}], "]"}]}], ";", 
          "\[IndentingNewLine]", 
          RowBox[{"radMatApl", "[", 
           RowBox[{
            RowBox[{"block", "[", 
             RowBox[{"[", "i", "]"}], "]"}], ",", "vacodym745ap"}], "]"}], 
          ";", " ", "\[IndentingNewLine]", "\[IndentingNewLine]", 
          RowBox[{"(*", 
           RowBox[{"Add", " ", "to", " ", "Cassette"}], "*)"}], 
          "\[IndentingNewLine]", 
          RowBox[{"radObjAddToCnt", "[", 
           RowBox[{"cassette", ",", 
            RowBox[{"{", 
             RowBox[{"block", "[", 
              RowBox[{"[", "i", "]"}], "]"}], "}"}]}], "]"}], ";"}]}], 
        "\[IndentingNewLine]", "\[IndentingNewLine]", "]"}], ";", 
       "\[IndentingNewLine]", "\[IndentingNewLine]", 
       RowBox[{"Return", "[", "cassette", "]"}]}]}], "\[IndentingNewLine]", 
     "]"}], ";"}], "\[IndentingNewLine]", ")"}]}]}], "Input",
 CellChangeTimes->{{3.822996642547748*^9, 3.8229966622053623`*^9}, {
   3.8229966999847193`*^9, 3.822996712607525*^9}, {3.822996866066005*^9, 
   3.822997007805232*^9}, {3.8229970886211834`*^9, 3.822997172861657*^9}, {
   3.8229972038423195`*^9, 3.8229972327467804`*^9}, {3.8229976128586516`*^9, 
   3.822997615581627*^9}, {3.8229977423096104`*^9, 3.8229979195374327`*^9}, {
   3.82299795068458*^9, 3.8229980492566676`*^9}, {3.8229981049572363`*^9, 
   3.822998135210442*^9}, {3.8229981887467437`*^9, 3.822998340346962*^9}, {
   3.8229983741706066`*^9, 3.8229984727502003`*^9}, {3.822998569425449*^9, 
   3.822999065586999*^9}, {3.8230016862031465`*^9, 3.8230016958932343`*^9}, {
   3.82300173329842*^9, 3.8230018618565197`*^9}, {3.8230018989871907`*^9, 
   3.8230019168120365`*^9}, 3.8230059047317824`*^9, {3.82300606412084*^9, 
   3.823006076465455*^9}, {3.8230061450248785`*^9, 3.8230061459811864`*^9}, {
   3.8230062004256153`*^9, 3.8230063181493616`*^9}, {3.8230064289977636`*^9, 
   3.8230065303095465`*^9}, {3.823006585873805*^9, 3.8230065883503504`*^9}, {
   3.82300661859441*^9, 3.8230066216896544`*^9}, {3.8230066631546993`*^9, 
   3.8230066998322268`*^9}, {3.823006918399409*^9, 3.82300691865304*^9}, {
   3.823007014024148*^9, 3.8230071885747604`*^9}, {3.8230072272774057`*^9, 
   3.8230072980440807`*^9}, {3.8230073454832535`*^9, 3.823007368184529*^9}, {
   3.823007417617037*^9, 3.823007431528256*^9}, {3.823007467409453*^9, 
   3.8230076108030863`*^9}, {3.8230076792257376`*^9, 
   3.8230077255548024`*^9}, {3.823007757155441*^9, 3.8230077683875284`*^9}, {
   3.823007865172476*^9, 3.823007941943116*^9}, {3.8230079756647186`*^9, 
   3.823008094077182*^9}, {3.8230081278690586`*^9, 3.823008130894298*^9}, {
   3.823008175277927*^9, 3.8230082141702065`*^9}, {3.8230082686879177`*^9, 
   3.823008274082326*^9}, 3.823008553616539*^9, {3.823010154173771*^9, 
   3.823010169655837*^9}, {3.823011269371171*^9, 3.823011514307005*^9}, {
   3.823011934197451*^9, 3.8230119375864625`*^9}, {3.823012442262043*^9, 
   3.823012447849208*^9}, {3.823013265967101*^9, 3.8230132706915827`*^9}, {
   3.8230133019855733`*^9, 3.823013308055996*^9}, {3.8230134137949634`*^9, 
   3.823013426172659*^9}, {3.8230145038129044`*^9, 3.8230146380798235`*^9}, {
   3.8230182516940327`*^9, 3.8230182519631915`*^9}, {3.8230729554520288`*^9, 
   3.82307298091088*^9}, {3.8230732793800507`*^9, 3.823073279897188*^9}, {
   3.8230936092727547`*^9, 3.8230936429576406`*^9}, {3.8230995686962013`*^9, 
   3.823099664377655*^9}, {3.8230998129285107`*^9, 3.8230999752067995`*^9}, {
   3.823100050687455*^9, 3.823100067923408*^9}, {3.82310043831323*^9, 
   3.8231006035879164`*^9}, {3.8231006441297226`*^9, 3.823100647584627*^9}, {
   3.82310071987878*^9, 3.823100728822584*^9}, {3.8231007907816315`*^9, 
   3.8231008049567423`*^9}, {3.8231008531344414`*^9, 
   3.8231008622813935`*^9}, {3.823100942333535*^9, 3.8231010641222153`*^9}, {
   3.823178841321891*^9, 3.823178853385052*^9}, {3.823179250142287*^9, 
   3.823179252435254*^9}, {3.8231793590117054`*^9, 3.823179406400276*^9}, {
   3.8231794642909203`*^9, 3.823179473841975*^9}, {3.82317958440681*^9, 
   3.8231796163688817`*^9}, 3.823179776189436*^9, {3.8231798157340665`*^9, 
   3.823179894878375*^9}, {3.8231801373786516`*^9, 3.823180178419283*^9}, {
   3.8231802160050154`*^9, 3.8231803251535625`*^9}, {3.823180367414541*^9, 
   3.823180407041745*^9}, 3.823180529654594*^9, {3.8231817771011024`*^9, 
   3.8231817798247414`*^9}, {3.8231823643199034`*^9, 
   3.8231823781096287`*^9}, {3.8232433076476307`*^9, 3.823243323146572*^9}, {
   3.823243353863224*^9, 3.823243383048979*^9}, {3.8232448398366985`*^9, 
   3.8232448492991066`*^9}, {3.8232449030106573`*^9, 
   3.8232449109512873`*^9}, {3.8232481335096703`*^9, 
   3.8232482068347907`*^9}, {3.8232483225305257`*^9, 
   3.8232483408156424`*^9}, {3.823248835367284*^9, 3.823248856708933*^9}, {
   3.8232488985954456`*^9, 3.8232489528591337`*^9}, {3.823248997395363*^9, 
   3.8232490529272823`*^9}, {3.823249125077532*^9, 3.823249132648445*^9}, {
   3.8232491736818924`*^9, 3.8232491866843896`*^9}, {3.8232493043465815`*^9, 
   3.8232493447309628`*^9}, 3.823249381232456*^9, {3.823359019239974*^9, 
   3.8233590197038856`*^9}, {3.823695203308715*^9, 3.8236952114882574`*^9}, {
   3.823695823901023*^9, 3.8236958251726217`*^9}, {3.8236993801965666`*^9, 
   3.823699463144787*^9}, {3.823699544456874*^9, 3.8236997071120033`*^9}, 
   3.8236997769442487`*^9, {3.823699869108048*^9, 3.8236998694458413`*^9}, {
   3.8237008062987347`*^9, 3.823700810389919*^9}, {3.8244580805471773`*^9, 
   3.8244581659114265`*^9}, 3.824458322095458*^9, {3.8244782019675813`*^9, 
   3.824478205881116*^9}, {3.8251666140019464`*^9, 3.825166625335941*^9}, 
   3.825166672387266*^9, 3.8251667131755247`*^9, {3.8254222940303717`*^9, 
   3.825422368357395*^9}, {3.825423803707179*^9, 3.8254238506464224`*^9}, {
   3.825423942023143*^9, 3.8254239923335004`*^9}, {3.82559422245827*^9, 
   3.825594243050849*^9}, {3.826029654265627*^9, 3.826029655206546*^9}},
 Background->RGBColor[0.94, 0.91, 0.88],
 CellLabel->"In[6]:=",ExpressionUUID->"78226229-f89d-4cc1-8ae6-49754eece200"]
}, Closed]],

Cell[CellGroupData[{

Cell["IDDraw", "Subsection",
 CellChangeTimes->{{3.8230144742625413`*^9, 
  3.823014483115279*^9}},ExpressionUUID->"e163474f-dc71-4b7e-966d-\
5c46baf483b6"],

Cell[BoxData[
 RowBox[{
  RowBox[{"idDraw", "[", 
   RowBox[{
   "typeID_", ",", "gap_", ",", "nPeriods_", ",", "periodL_", ",", 
    "blockGeo_", ",", "blockThick_", ",", "blockGap_", ",", "magnetizations_",
     ",", "terminations_", ",", "mode_", ",", "subdiv_", " ", ",", 
    RowBox[{"posErrors_", " ", ":", 
     RowBox[{"{", 
      RowBox[{"0", ",", "0"}], "}"}]}], ",", 
    RowBox[{"gap2_", " ", ":", "0"}]}], "]"}], ":=", 
  RowBox[{"(", "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"Module", "[", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{
       "device", ",", "cassette", ",", "mag", ",", "cassetteD", ",", 
        "modeslist", ",", "phase", ",", "i", ",", "displacement", ",", 
        "cassPos"}], "}"}], ",", "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"device", "=", 
        RowBox[{"radObjCnt", "[", 
         RowBox[{"{", "}"}], "]"}]}], ";", "\[IndentingNewLine]", 
       RowBox[{"cassette", "=", 
        RowBox[{"ConstantArray", "[", 
         RowBox[{
          RowBox[{"{", "}"}], ",", "4"}], "]"}]}], ";", "\[IndentingNewLine]",
        "\[IndentingNewLine]", 
       RowBox[{"(*", 
        RowBox[{"===", 
         RowBox[{"=", " ", 
          RowBox[{
           RowBox[{"Generate", " ", "Cassettes"}], " ", "===", "=="}]}]}], 
        "*)"}], "\[IndentingNewLine]", 
       RowBox[{"For", "[", 
        RowBox[{
         RowBox[{"i", "=", "1"}], ",", 
         RowBox[{"i", "\[LessEqual]", 
          RowBox[{"Length", "[", "magnetizations", "]"}]}], ",", 
         RowBox[{"i", "++"}], ",", "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{
           RowBox[{"cassette", "[", 
            RowBox[{"[", "i", "]"}], "]"}], "=", 
           RowBox[{"idCassetteDraw", "[", 
            RowBox[{
             RowBox[{"magnetizations", "[", 
              RowBox[{"[", "i", "]"}], "]"}], ",", "blockGeo", ",", 
             "posErrors", ",", 
             RowBox[{"terminations", "[", 
              RowBox[{"[", "i", "]"}], "]"}], ",", "periodL", ",", 
             "blockThick", ",", "gap", ",", "blockGap", ",", "subdiv"}], 
            "]"}]}], ";", "\[IndentingNewLine]", "\[IndentingNewLine]", 
          RowBox[{"(*", 
           RowBox[{"Apply", " ", "Gap"}], "*)"}], "\[IndentingNewLine]", 
          RowBox[{"radTrfOrnt", "[", 
           RowBox[{
            RowBox[{"cassette", "[", 
             RowBox[{"[", "i", "]"}], "]"}], ",", 
            RowBox[{"radTrfTrsl", "[", 
             RowBox[{"{", 
              RowBox[{"0", ",", "0", ",", 
               RowBox[{
                RowBox[{"-", "gap"}], "/", "2"}]}], "}"}], "]"}]}], "]"}], 
          ";", "\[IndentingNewLine]", "\[IndentingNewLine]", 
          RowBox[{"If", "[", 
           RowBox[{
            RowBox[{"typeID", "\[Equal]", "\"\<DeltaUndulator\>\""}], ",", 
            "\[IndentingNewLine]", 
            RowBox[{"(*", 
             RowBox[{"Apply", " ", "Phase"}], "*)"}], "\[IndentingNewLine]", 
            RowBox[{"(*", 
             RowBox[{
              RowBox[{"modeslist", "=", 
               RowBox[{
                RowBox[{"{", 
                 RowBox[{
                  RowBox[{"{", 
                   RowBox[{"0", ",", "0", ",", "0", ",", "0"}], "}"}], ",", 
                  RowBox[{"{", 
                   RowBox[{
                    RowBox[{
                    RowBox[{"-", "1"}], "/", "4"}], ",", "0", ",", 
                    RowBox[{
                    RowBox[{"-", "1"}], "/", "4"}], ",", "0"}], "}"}], ",", 
                  RowBox[{"{", 
                   RowBox[{
                    RowBox[{
                    RowBox[{"-", "1"}], "/", "2"}], ",", "0", ",", 
                    RowBox[{
                    RowBox[{"-", "1"}], "/", "2"}], ",", "0"}], "}"}], ",", 
                  RowBox[{"{", 
                   RowBox[{
                    RowBox[{
                    RowBox[{"-", "1"}], "/", "4"}], ",", "0", ",", 
                    RowBox[{"1", "/", "4"}], ",", "0"}], "}"}], ",", 
                  RowBox[{"{", 
                   RowBox[{
                    RowBox[{
                    RowBox[{"-", "1"}], "/", "4"}], ",", 
                    RowBox[{
                    RowBox[{"-", "1"}], "/", "4"}], ",", "0", ",", "0"}], 
                   "}"}], ",", 
                  RowBox[{"{", 
                   RowBox[{
                    RowBox[{
                    RowBox[{"-", "1"}], "/", "4"}], ",", "0", ",", "0", ",", 
                    RowBox[{
                    RowBox[{"-", "1"}], "/", "4"}]}], "}"}]}], "}"}], "*", 
                "periodL"}]}], ";"}], "*)"}], "\[IndentingNewLine]", 
            RowBox[{
             RowBox[{"modeslist", "=", 
              RowBox[{
               RowBox[{"{", 
                RowBox[{
                 RowBox[{"{", 
                  RowBox[{"0", ",", "0", ",", "0", ",", "0"}], "}"}], ",", 
                 RowBox[{"{", 
                  RowBox[{
                   RowBox[{"1", "/", "4"}], ",", "0", ",", 
                   RowBox[{"1", "/", "4"}], ",", "0"}], "}"}], ",", 
                 RowBox[{"{", 
                  RowBox[{
                   RowBox[{"1", "/", "2"}], ",", "0", ",", 
                   RowBox[{"1", "/", "2"}], ",", "0"}], "}"}], ",", 
                 RowBox[{"{", 
                  RowBox[{
                   RowBox[{"1", "/", "4"}], ",", "0", ",", 
                   RowBox[{
                    RowBox[{"-", "1"}], "/", "4"}], ",", "0"}], "}"}], ",", 
                 RowBox[{"{", 
                  RowBox[{
                   RowBox[{
                    RowBox[{"-", "1"}], "/", "4"}], ",", 
                   RowBox[{
                    RowBox[{"-", "1"}], "/", "4"}], ",", "0", ",", "0"}], 
                  "}"}], ",", 
                 RowBox[{"{", 
                  RowBox[{
                   RowBox[{
                    RowBox[{"-", "1"}], "/", "4"}], ",", "0", ",", "0", ",", 
                   RowBox[{
                    RowBox[{"-", "1"}], "/", "4"}]}], "}"}]}], "}"}], "*", 
               "periodL"}]}], ";", "\[IndentingNewLine]", 
             RowBox[{"phase", "=", 
              RowBox[{"modeslist", "[", 
               RowBox[{"[", "mode", "]"}], "]"}]}], ";", 
             "\[IndentingNewLine]", 
             RowBox[{"radTrfOrnt", "[", 
              RowBox[{
               RowBox[{"cassette", "[", 
                RowBox[{"[", "i", "]"}], "]"}], ",", 
               RowBox[{"radTrfTrsl", "[", 
                RowBox[{"{", 
                 RowBox[{
                  RowBox[{"phase", "[", 
                   RowBox[{"[", "i", "]"}], "]"}], ",", "0", ",", "0"}], 
                 "}"}], "]"}]}], "]"}], ";", "\[IndentingNewLine]", 
             "\[IndentingNewLine]", 
             RowBox[{"(*", 
              RowBox[{"Apply", " ", "Rotation"}], "*)"}], 
             "\[IndentingNewLine]", 
             RowBox[{"radTrfOrnt", "[", 
              RowBox[{
               RowBox[{"cassette", "[", 
                RowBox[{"[", "i", "]"}], "]"}], ",", 
               RowBox[{"radTrfRot", "[", 
                RowBox[{
                 RowBox[{"{", 
                  RowBox[{"0", ",", "0", ",", "0"}], "}"}], ",", 
                 RowBox[{"{", 
                  RowBox[{"1", ",", "0", ",", "0"}], "}"}], ",", 
                 RowBox[{
                  RowBox[{"(", 
                   RowBox[{"i", "-", "1"}], ")"}], "*", 
                  RowBox[{"Pi", "/", "2"}]}]}], "]"}]}], "]"}], ";"}]}], 
           "\[IndentingNewLine]", "]"}], ";", "\[IndentingNewLine]", 
          "\[IndentingNewLine]", 
          RowBox[{"If", "[", 
           RowBox[{
            RowBox[{"typeID", "\[Equal]", "\"\<PlanarUndulator\>\""}], ",", 
            "\[IndentingNewLine]", 
            RowBox[{"(*", 
             RowBox[{"Apply", " ", "Phase"}], "*)"}], "\[IndentingNewLine]", 
            RowBox[{
             RowBox[{"modeslist", "=", 
              RowBox[{
               RowBox[{"{", 
                RowBox[{
                 RowBox[{"{", 
                  RowBox[{"0", ",", "0"}], "}"}], ",", 
                 RowBox[{"{", 
                  RowBox[{"0", ",", 
                   RowBox[{
                    RowBox[{"-", "1"}], "/", "2"}]}], "}"}], ",", 
                 RowBox[{"{", 
                  RowBox[{"0", ",", 
                   RowBox[{
                    RowBox[{"-", "1"}], "/", "4"}]}], "}"}], ",", 
                 RowBox[{"{", 
                  RowBox[{"0", ",", 
                   RowBox[{"1", "/", "2"}]}], "}"}], ",", 
                 RowBox[{"{", 
                  RowBox[{"0", ",", 
                   RowBox[{"1", "/", "4"}]}], "}"}]}], "}"}], "*", 
               "periodL"}]}], ";", "\[IndentingNewLine]", 
             RowBox[{"phase", "=", 
              RowBox[{"modeslist", "[", 
               RowBox[{"[", "mode", "]"}], "]"}]}], ";", 
             "\[IndentingNewLine]", 
             RowBox[{"radTrfOrnt", "[", 
              RowBox[{
               RowBox[{"cassette", "[", 
                RowBox[{"[", "i", "]"}], "]"}], ",", 
               RowBox[{"radTrfTrsl", "[", 
                RowBox[{"{", 
                 RowBox[{
                  RowBox[{"phase", "[", 
                   RowBox[{"[", "i", "]"}], "]"}], ",", "0", ",", "0"}], 
                 "}"}], "]"}]}], "]"}], ";", "\[IndentingNewLine]", 
             "\[IndentingNewLine]", 
             RowBox[{"(*", 
              RowBox[{"Apply", " ", "Rotation"}], "*)"}], 
             "\[IndentingNewLine]", 
             RowBox[{"radTrfOrnt", "[", 
              RowBox[{
               RowBox[{"cassette", "[", 
                RowBox[{"[", "i", "]"}], "]"}], ",", 
               RowBox[{"radTrfRot", "[", 
                RowBox[{
                 RowBox[{"{", 
                  RowBox[{"0", ",", "0", ",", "0"}], "}"}], ",", 
                 RowBox[{"{", 
                  RowBox[{"1", ",", "0", ",", "0"}], "}"}], ",", 
                 RowBox[{
                  RowBox[{"(", 
                   RowBox[{"i", "-", "1"}], ")"}], "*", "Pi"}]}], "]"}]}], 
              "]"}], ";"}]}], "\[IndentingNewLine]", "]"}], ";", 
          "\[IndentingNewLine]", "\[IndentingNewLine]", 
          RowBox[{"If", "[", 
           RowBox[{
            RowBox[{"typeID", "\[Equal]", "\"\<EPU\>\""}], ",", 
            "\[IndentingNewLine]", 
            RowBox[{"(*", 
             RowBox[{"Apply", " ", "Phase"}], "*)"}], "\[IndentingNewLine]", 
            RowBox[{
             RowBox[{"modeslist", "=", 
              RowBox[{
               RowBox[{"{", 
                RowBox[{
                 RowBox[{"{", 
                  RowBox[{"0", ",", "0", ",", "0", ",", "0"}], "}"}], ",", 
                 RowBox[{"{", 
                  RowBox[{
                   RowBox[{
                    RowBox[{"-", "1"}], "/", "4"}], ",", "0", ",", 
                   RowBox[{
                    RowBox[{"-", "1"}], "/", "4"}], ",", "0"}], "}"}], ",", 
                 RowBox[{"{", 
                  RowBox[{
                   RowBox[{
                    RowBox[{"-", "1"}], "/", "2"}], ",", "0", ",", 
                   RowBox[{
                    RowBox[{"-", "1"}], "/", "2"}], ",", "0"}], "}"}], ",", 
                 RowBox[{"{", 
                  RowBox[{
                   RowBox[{
                    RowBox[{"-", "1"}], "/", "4"}], ",", "0", ",", 
                   RowBox[{"1", "/", "4"}], ",", "0"}], "}"}]}], "}"}], "*", 
               "periodL"}]}], ";", "\[IndentingNewLine]", 
             RowBox[{"phase", "=", 
              RowBox[{"modeslist", "[", 
               RowBox[{"[", "mode", "]"}], "]"}]}], ";", 
             "\[IndentingNewLine]", 
             RowBox[{"radTrfOrnt", "[", 
              RowBox[{
               RowBox[{"cassette", "[", 
                RowBox[{"[", "i", "]"}], "]"}], ",", 
               RowBox[{"radTrfTrsl", "[", 
                RowBox[{"{", 
                 RowBox[{
                  RowBox[{"phase", "[", 
                   RowBox[{"[", "i", "]"}], "]"}], ",", "0", ",", "0"}], 
                 "}"}], "]"}]}], "]"}], ";", "\[IndentingNewLine]", 
             "\[IndentingNewLine]", 
             RowBox[{"(*", 
              RowBox[{"Apply", " ", "Position"}], "*)"}], 
             "\[IndentingNewLine]", 
             RowBox[{"zdesloc", "=", 
              RowBox[{"gap", "+", 
               RowBox[{"50", "/", "2"}]}]}], ";", " ", 
             RowBox[{"ydesloc", "=", 
              RowBox[{"gap2", "+", "22"}]}], ";", " ", 
             RowBox[{"a", "=", 
              RowBox[{"Min", "[", 
               RowBox[{
                RowBox[{"Flatten", "[", 
                 RowBox[{"blockGeo", ",", "1"}], "]"}], "[", 
                RowBox[{"[", 
                 RowBox[{"All", ",", "2"}], "]"}], "]"}], "]"}]}], ";", 
             "\[IndentingNewLine]", 
             RowBox[{"cassPos", "=", 
              RowBox[{"{", 
               RowBox[{
                RowBox[{"{", 
                 RowBox[{"0", ",", 
                  RowBox[{"-", "ydesloc"}], ",", "0"}], "}"}], ",", 
                RowBox[{"{", 
                 RowBox[{"0", ",", "ydesloc", ",", "0"}], "}"}], ",", 
                RowBox[{"{", 
                 RowBox[{"0", ",", "ydesloc", ",", 
                  RowBox[{"2", "*", "zdesloc"}]}], "}"}], ",", 
                RowBox[{"{", 
                 RowBox[{"0", ",", 
                  RowBox[{"-", "ydesloc"}], ",", 
                  RowBox[{"2", "*", "zdesloc"}]}], "}"}]}], "}"}]}], ";", 
             "\[IndentingNewLine]", "\[IndentingNewLine]", 
             RowBox[{"radTrfOrnt", "[", 
              RowBox[{
               RowBox[{"cassette", "[", 
                RowBox[{"[", "i", "]"}], "]"}], ",", 
               RowBox[{"radTrfTrsl", "[", 
                RowBox[{"cassPos", "[", 
                 RowBox[{"[", "i", "]"}], "]"}], "]"}]}], "]"}], ";"}]}], 
           "\[IndentingNewLine]", "]"}], ";", "\[IndentingNewLine]", 
          "\[IndentingNewLine]", "\[IndentingNewLine]", 
          RowBox[{"radObjAddToCnt", "[", 
           RowBox[{"device", ",", 
            RowBox[{"{", 
             RowBox[{"cassette", "[", 
              RowBox[{"[", "i", "]"}], "]"}], "}"}]}], "]"}], ";"}]}], 
        "\[IndentingNewLine]", "]"}], ";", "\[IndentingNewLine]", 
       "\[IndentingNewLine]", 
       RowBox[{"If", "[", 
        RowBox[{
         RowBox[{"typeID", "\[Equal]", "\"\<DeltaUndulator\>\""}], ",", 
         "\[IndentingNewLine]", 
         RowBox[{"(*", 
          RowBox[{"Rotate", " ", "ID"}], "*)"}], "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{"radTrfOrnt", "[", 
           RowBox[{"device", ",", 
            RowBox[{"radTrfRot", "[", 
             RowBox[{
              RowBox[{"{", 
               RowBox[{"0", ",", "0", ",", "0"}], "}"}], ",", 
              RowBox[{"{", 
               RowBox[{"1", ",", "0", ",", "0"}], "}"}], ",", 
              RowBox[{
               RowBox[{"-", "Pi"}], "/", "4"}]}], "]"}]}], "]"}], ";"}]}], 
        "\[IndentingNewLine]", "]"}], ";", "\[IndentingNewLine]", 
       "\[IndentingNewLine]", 
       RowBox[{"(*", 
        RowBox[{"Adjust", " ", "Axis"}], "*)"}], "\[IndentingNewLine]", 
       RowBox[{"radTrfOrnt", "[", 
        RowBox[{"device", ",", 
         RowBox[{"radTrfRot", "[", 
          RowBox[{
           RowBox[{"{", 
            RowBox[{"0", ",", "0", ",", "0"}], "}"}], ",", 
           RowBox[{"{", 
            RowBox[{"0", ",", "1", ",", "0"}], "}"}], ",", 
           RowBox[{
            RowBox[{"-", "Pi"}], "/", "2"}]}], "]"}]}], "]"}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"radTrfOrnt", "[", 
        RowBox[{"device", ",", 
         RowBox[{"radTrfRot", "[", 
          RowBox[{
           RowBox[{"{", 
            RowBox[{"0", ",", "0", ",", "0"}], "}"}], ",", 
           RowBox[{"{", 
            RowBox[{"0", ",", "0", ",", "1"}], "}"}], ",", 
           RowBox[{"Pi", "/", "2"}]}], "]"}]}], "]"}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"(*", 
        RowBox[{
        "Ficou", " ", "faltando", " ", "rotacionar", " ", "180", "\[Degree]", 
         " ", "em", " ", "Z"}], "*)"}], "\[IndentingNewLine]", 
       RowBox[{"(*", 
        RowBox[{
         RowBox[{"radTrfOrnt", "[", 
          RowBox[{"device", ",", 
           RowBox[{"radTrfRot", "[", 
            RowBox[{
             RowBox[{"{", 
              RowBox[{"0", ",", "0", ",", "0"}], "}"}], ",", 
             RowBox[{"{", 
              RowBox[{"0", ",", "0", ",", "1"}], "}"}], ",", 
             RowBox[{"3", "*", 
              RowBox[{"Pi", "/", "2"}]}]}], "]"}]}], "]"}], ";"}], "*)"}], 
       "\[IndentingNewLine]", "\[IndentingNewLine]", 
       RowBox[{"Return", "[", "device", "]"}], ";"}]}], "\[IndentingNewLine]",
      "]"}], ";"}], "\[IndentingNewLine]", ")"}]}]], "Input",
 CellChangeTimes->{{3.823014490528303*^9, 3.823014495190384*^9}, 
   3.823014707120387*^9, {3.8230147394315567`*^9, 3.823014785859255*^9}, {
   3.823014818123419*^9, 3.8230148551524277`*^9}, {3.8230149320362606`*^9, 
   3.8230151595401454`*^9}, {3.82301523515401*^9, 3.82301523930616*^9}, {
   3.8230153011625757`*^9, 3.8230153145790586`*^9}, {3.823015346426852*^9, 
   3.823015440912756*^9}, {3.8230154952048936`*^9, 3.823015589046316*^9}, {
   3.8230156389647827`*^9, 3.8230157093066587`*^9}, {3.8230157950208683`*^9, 
   3.823015818196389*^9}, {3.8230158550310273`*^9, 3.823015856899197*^9}, {
   3.82301589655589*^9, 3.8230160287926226`*^9}, {3.8230160954748096`*^9, 
   3.8230161430772486`*^9}, {3.8230161801045313`*^9, 
   3.8230162482305756`*^9}, {3.823017155552719*^9, 3.8230172618963366`*^9}, {
   3.8230173103204737`*^9, 3.823017324386885*^9}, {3.8230173578961453`*^9, 
   3.8230173770036907`*^9}, {3.823017429167453*^9, 3.823017441546076*^9}, {
   3.823017483875223*^9, 3.82301752294746*^9}, {3.82301757528824*^9, 
   3.8230175797173977`*^9}, {3.8230177133598576`*^9, 
   3.8230177271661406`*^9}, {3.8230180977030983`*^9, 3.823018132647981*^9}, {
   3.8230181708706784`*^9, 3.823018175451013*^9}, {3.8230182431548653`*^9, 
   3.8230182896014776`*^9}, {3.8230183297746067`*^9, 
   3.8230183849770937`*^9}, {3.8230730107420397`*^9, 
   3.8230730172046647`*^9}, {3.8230732903664494`*^9, 
   3.8230732907830653`*^9}, {3.823073399916271*^9, 3.8230734317880983`*^9}, 
   3.82307641002911*^9, {3.8230790666214886`*^9, 3.823079157390439*^9}, {
   3.8230792483506145`*^9, 3.823079288653741*^9}, {3.823080036259123*^9, 
   3.8230800377466817`*^9}, {3.8230804430590997`*^9, 3.823080468732545*^9}, {
   3.8230805936560154`*^9, 3.8230806036822357`*^9}, 3.8230807563088036`*^9, {
   3.823081091620064*^9, 3.823081192747587*^9}, {3.823081249030183*^9, 
   3.823081251031911*^9}, {3.823081283186428*^9, 3.823081361560978*^9}, {
   3.823081422224709*^9, 3.8230814760419393`*^9}, {3.8230815214337473`*^9, 
   3.823081596012384*^9}, {3.8230816519042425`*^9, 3.8230816617535725`*^9}, {
   3.8230816960983267`*^9, 3.8230816963301363`*^9}, {3.823081748309551*^9, 
   3.8230817960507383`*^9}, {3.8230822982380047`*^9, 3.823082298886798*^9}, {
   3.823082501468274*^9, 3.8230825091576753`*^9}, {3.823082579775588*^9, 
   3.8230825817976885`*^9}, {3.8230845182345076`*^9, 3.823084523880671*^9}, {
   3.8230845885099297`*^9, 3.8230846169247503`*^9}, {3.823084775516531*^9, 
   3.8230848379621525`*^9}, {3.8230850106974773`*^9, 
   3.8230850110313435`*^9}, {3.8230854741424036`*^9, 3.82308549624289*^9}, {
   3.82308553454288*^9, 3.823085733791171*^9}, 3.8230857754642315`*^9, {
   3.823085942270505*^9, 3.8230859753670526`*^9}, {3.8230860569396567`*^9, 
   3.823086151936844*^9}, {3.8230861964494*^9, 3.823086220073099*^9}, {
   3.823086893731286*^9, 3.823086917140793*^9}, {3.823086986042081*^9, 
   3.8230869863271856`*^9}, {3.8230870601118565`*^9, 3.8230870980640497`*^9}, 
   3.8230872651509314`*^9, {3.8230872973277087`*^9, 3.823087298478788*^9}, {
   3.823087343849225*^9, 3.823087346920844*^9}, {3.8230873845062685`*^9, 
   3.8230874088892193`*^9}, {3.8230874455451107`*^9, 3.823087473723867*^9}, {
   3.823087644038024*^9, 3.823087652666995*^9}, {3.8231034321711636`*^9, 
   3.8231034421704855`*^9}, {3.823103481402172*^9, 3.823103481886513*^9}, {
   3.8231035368312464`*^9, 3.823103538503008*^9}, {3.8231036109116964`*^9, 
   3.823103619661087*^9}, {3.823103713682832*^9, 3.8231037713038635`*^9}, {
   3.823168861505064*^9, 3.8231689034284477`*^9}, {3.8231691962251987`*^9, 
   3.8231692084623184`*^9}, {3.8231823843128624`*^9, 
   3.8231824027705107`*^9}, {3.823244810978146*^9, 3.8232448126824713`*^9}, 
   3.8232503842222996`*^9, {3.82369579806024*^9, 3.8236958319185133`*^9}, {
   3.823699725112361*^9, 3.823699750229452*^9}, {3.8237002284251795`*^9, 
   3.823700259842938*^9}, {3.8237004123451843`*^9, 3.823700435842682*^9}, {
   3.823700502604678*^9, 3.8237005407020674`*^9}, {3.8237011231462526`*^9, 
   3.8237011364352756`*^9}, {3.8238695375441523`*^9, 3.823869623684075*^9}, {
   3.823869738790733*^9, 3.823869824804019*^9}, {3.823870282071589*^9, 
   3.8238702964543147`*^9}, {3.8242172745836697`*^9, 
   3.8242174546706605`*^9}, {3.8242979128342113`*^9, 3.824297926820832*^9}, {
   3.8242981713154306`*^9, 3.824298173668084*^9}, {3.8242982142912807`*^9, 
   3.8242984128209863`*^9}, {3.8243099003526206`*^9, 
   3.8243099031280775`*^9}, {3.824310262362854*^9, 3.82431026578313*^9}, 
   3.824310731425861*^9, {3.824310855324407*^9, 3.824310857346639*^9}, {
   3.8244781087101817`*^9, 3.8244781131225805`*^9}, {3.824478155107996*^9, 
   3.8244781555564613`*^9}, {3.8244784078094225`*^9, 3.824478408511223*^9}, {
   3.824478459389422*^9, 3.82447846433222*^9}, {3.8257587165526*^9, 
   3.825758729782813*^9}, {3.8280928769401064`*^9, 3.8280929366721754`*^9}, {
   3.8280930134566374`*^9, 3.828093015130679*^9}},
 Background->RGBColor[
  0.94, 0.91, 0.88],ExpressionUUID->"962dd326-4e25-44bf-bac2-e553ade2584e"]
}, Open  ]],

Cell[CellGroupData[{

Cell["Generate Block Mag", "Subsection",
 CellChangeTimes->{{3.82307344716663*^9, 3.823073449705731*^9}, {
  3.8244833140919976`*^9, 
  3.8244833161836033`*^9}},ExpressionUUID->"859df76e-5f9a-4412-8825-\
e5bfdc280412"],

Cell[BoxData[
 RowBox[{
  RowBox[{"idGenerateMag", "[", 
   RowBox[{
   "typeID_", ",", "nPeriods_", ",", "periodL_", ",", "blockThick_", ",", 
    "blockGap_", ",", "symmetry_", ",", "magnAmp_", ",", 
    RowBox[{"magError_", " ", ":", "0"}], ",", 
    RowBox[{"magAmpError_", " ", ":", "0.02"}], ",", 
    RowBox[{"magTheta_", " ", ":", "1"}]}], "]"}], ":=", 
  RowBox[{"(", "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"Module", "[", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{
       "mag", ",", "magnetization", ",", "j", ",", "i", ",", "termination", 
        ",", "phi", ",", "theta", ",", "dmag"}], "}"}], ",", 
      "\[IndentingNewLine]", "\[IndentingNewLine]", 
      RowBox[{"(*", 
       RowBox[{"===", 
        RowBox[{"==", " ", 
         RowBox[{"ID", " ", "Type"}]}], " ", "===", "=="}], "*)"}], 
      "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"If", "[", 
        RowBox[{
         RowBox[{"typeID", "\[Equal]", "\"\<DeltaUndulator\>\""}], ",", 
         "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{"mag", "=", 
           RowBox[{"{", 
            RowBox[{
             RowBox[{"{", 
              RowBox[{
               RowBox[{"{", 
                RowBox[{"magnAmp", ",", "0", ",", "0"}], "}"}], ",", 
               RowBox[{"{", 
                RowBox[{"0", ",", "0", ",", "magnAmp"}], "}"}], ",", 
               RowBox[{"{", 
                RowBox[{
                 RowBox[{"-", "magnAmp"}], ",", "0", ",", "0"}], "}"}], ",", 
               RowBox[{"{", 
                RowBox[{"0", ",", "0", ",", 
                 RowBox[{"-", "magnAmp"}]}], "}"}]}], "}"}], ",", 
             RowBox[{"{", 
              RowBox[{
               RowBox[{"{", 
                RowBox[{"magnAmp", ",", "0", ",", "0"}], "}"}], ",", 
               RowBox[{"{", 
                RowBox[{"0", ",", "0", ",", "magnAmp"}], "}"}], ",", 
               RowBox[{"{", 
                RowBox[{
                 RowBox[{"-", "magnAmp"}], ",", "0", ",", "0"}], "}"}], ",", 
               RowBox[{"{", 
                RowBox[{"0", ",", "0", ",", 
                 RowBox[{"-", "magnAmp"}]}], "}"}]}], "}"}], ",", 
             RowBox[{"{", 
              RowBox[{
               RowBox[{"{", 
                RowBox[{
                 RowBox[{"-", "magnAmp"}], ",", "0", ",", "0"}], "}"}], ",", 
               RowBox[{"{", 
                RowBox[{"0", ",", "0", ",", 
                 RowBox[{"-", "magnAmp"}]}], "}"}], ",", 
               RowBox[{"{", 
                RowBox[{"magnAmp", ",", "0", ",", "0"}], "}"}], ",", 
               RowBox[{"{", 
                RowBox[{"0", ",", "0", ",", "magnAmp"}], "}"}]}], "}"}], ",", 
             RowBox[{"{", 
              RowBox[{
               RowBox[{"{", 
                RowBox[{
                 RowBox[{"-", "magnAmp"}], ",", "0", ",", "0"}], "}"}], ",", 
               RowBox[{"{", 
                RowBox[{"0", ",", "0", ",", 
                 RowBox[{"-", "magnAmp"}]}], "}"}], ",", 
               RowBox[{"{", 
                RowBox[{"magnAmp", ",", "0", ",", "0"}], "}"}], ",", 
               RowBox[{"{", 
                RowBox[{"0", ",", "0", ",", "magnAmp"}], "}"}]}], "}"}]}], 
            "}"}]}], ";"}]}], "\[IndentingNewLine]", "]"}], ";", 
       "\[IndentingNewLine]", "\[IndentingNewLine]", 
       RowBox[{"If", "[", 
        RowBox[{
         RowBox[{"typeID", "\[Equal]", "\"\<PlanarUndulator\>\""}], ",", 
         "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{"mag", "=", 
           RowBox[{"{", 
            RowBox[{
             RowBox[{"{", 
              RowBox[{
               RowBox[{"{", 
                RowBox[{"magnAmp", ",", "0", ",", "0"}], "}"}], ",", 
               RowBox[{"{", 
                RowBox[{"0", ",", "0", ",", "magnAmp"}], "}"}], ",", 
               RowBox[{"{", 
                RowBox[{
                 RowBox[{"-", "magnAmp"}], ",", "0", ",", "0"}], "}"}], ",", 
               RowBox[{"{", 
                RowBox[{"0", ",", "0", ",", 
                 RowBox[{"-", "magnAmp"}]}], "}"}]}], "}"}], ",", 
             RowBox[{"{", 
              RowBox[{
               RowBox[{"{", 
                RowBox[{
                 RowBox[{"-", "magnAmp"}], ",", "0", ",", "0"}], "}"}], ",", 
               RowBox[{"{", 
                RowBox[{"0", ",", "0", ",", 
                 RowBox[{"-", "magnAmp"}]}], "}"}], ",", 
               RowBox[{"{", 
                RowBox[{"magnAmp", ",", "0", ",", "0"}], "}"}], ",", 
               RowBox[{"{", 
                RowBox[{"0", ",", "0", ",", "magnAmp"}], "}"}]}], "}"}]}], 
            "}"}]}], ";"}]}], "\[IndentingNewLine]", "]"}], ";", 
       "\[IndentingNewLine]", "\[IndentingNewLine]", 
       RowBox[{"If", "[", 
        RowBox[{
         RowBox[{"typeID", "\[Equal]", "\"\<EPU\>\""}], ",", 
         "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{"mag", "=", 
           RowBox[{"{", 
            RowBox[{
             RowBox[{"{", 
              RowBox[{
               RowBox[{"{", 
                RowBox[{
                 RowBox[{"-", "magnAmp"}], ",", "0", ",", "0"}], "}"}], ",", 
               RowBox[{"{", 
                RowBox[{"0", ",", "0", ",", 
                 RowBox[{"-", "magnAmp"}]}], "}"}], ",", 
               RowBox[{"{", 
                RowBox[{"magnAmp", ",", "0", ",", "0"}], "}"}], ",", 
               RowBox[{"{", 
                RowBox[{"0", ",", "0", ",", "magnAmp"}], "}"}]}], "}"}], ",", 
             RowBox[{"{", 
              RowBox[{
               RowBox[{"{", 
                RowBox[{
                 RowBox[{"-", "magnAmp"}], ",", "0", ",", "0"}], "}"}], ",", 
               RowBox[{"{", 
                RowBox[{"0", ",", "0", ",", 
                 RowBox[{"-", "magnAmp"}]}], "}"}], ",", 
               RowBox[{"{", 
                RowBox[{"magnAmp", ",", "0", ",", "0"}], "}"}], ",", 
               RowBox[{"{", 
                RowBox[{"0", ",", "0", ",", "magnAmp"}], "}"}]}], "}"}], ",", 
             RowBox[{"{", 
              RowBox[{
               RowBox[{"{", 
                RowBox[{"magnAmp", ",", "0", ",", "0"}], "}"}], ",", 
               RowBox[{"{", 
                RowBox[{"0", ",", "0", ",", 
                 RowBox[{"-", "magnAmp"}]}], "}"}], ",", 
               RowBox[{"{", 
                RowBox[{
                 RowBox[{"-", "magnAmp"}], ",", "0", ",", "0"}], "}"}], ",", 
               RowBox[{"{", 
                RowBox[{"0", ",", "0", ",", "magnAmp"}], "}"}]}], "}"}], ",", 
             RowBox[{"{", 
              RowBox[{
               RowBox[{"{", 
                RowBox[{"magnAmp", ",", "0", ",", "0"}], "}"}], ",", 
               RowBox[{"{", 
                RowBox[{"0", ",", "0", ",", 
                 RowBox[{"-", "magnAmp"}]}], "}"}], ",", 
               RowBox[{"{", 
                RowBox[{
                 RowBox[{"-", "magnAmp"}], ",", "0", ",", "0"}], "}"}], ",", 
               RowBox[{"{", 
                RowBox[{"0", ",", "0", ",", "magnAmp"}], "}"}]}], "}"}]}], 
            "}"}]}], ";"}]}], "\[IndentingNewLine]", "]"}], ";", 
       "\[IndentingNewLine]", "\[IndentingNewLine]", 
       RowBox[{"(*", 
        RowBox[{"===", 
         RowBox[{"==", " ", 
          RowBox[{"Create", " ", "Cassette", " ", "Magnetizations"}]}], " ", "===",
          "=="}], "*)"}], "\[IndentingNewLine]", 
       RowBox[{"magnetization", "=", 
        RowBox[{"ConstantArray", "[", 
         RowBox[{
          RowBox[{"{", "}"}], ",", 
          RowBox[{"Length", "[", "mag", "]"}]}], "]"}]}], ";", 
       "\[IndentingNewLine]", "\[IndentingNewLine]", 
       RowBox[{"For", "[", 
        RowBox[{
         RowBox[{"j", "=", "1"}], ",", 
         RowBox[{"j", "\[LessEqual]", " ", 
          RowBox[{"Length", "[", "mag", "]"}]}], ",", 
         RowBox[{"j", "++"}], ",", "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{
           RowBox[{"magnetization", "[", 
            RowBox[{"[", "j", "]"}], "]"}], "=", 
           RowBox[{"Nest", "[", 
            RowBox[{
             RowBox[{
              RowBox[{"Join", "[", 
               RowBox[{
                RowBox[{"mag", "[", 
                 RowBox[{"[", "j", "]"}], "]"}], ",", "#", ",", "1"}], "]"}], 
              "&"}], ",", 
             RowBox[{"mag", "[", 
              RowBox[{"[", "j", "]"}], "]"}], ",", 
             RowBox[{"(", 
              RowBox[{"nPeriods", "-", "1"}], ")"}]}], "]"}]}], ";", 
          "\[IndentingNewLine]", 
          RowBox[{"If", "[", 
           RowBox[{
            RowBox[{"symmetry", "\[Equal]", "\"\<symmetric\>\""}], ",", 
            "\[IndentingNewLine]", 
            RowBox[{
             RowBox[{
              RowBox[{"magnetization", "[", 
               RowBox[{"[", "j", "]"}], "]"}], "=", 
              RowBox[{"Delete", "[", 
               RowBox[{
                RowBox[{"magnetization", "[", 
                 RowBox[{"[", "j", "]"}], "]"}], ",", 
                RowBox[{"-", "1"}]}], "]"}]}], ";"}], "\[IndentingNewLine]", 
            ",", "\[IndentingNewLine]", 
            RowBox[{
             RowBox[{
              RowBox[{"magnetization", "[", 
               RowBox[{"[", "j", "]"}], "]"}], "=", 
              RowBox[{"Join", "[", 
               RowBox[{
                RowBox[{"magnetization", "[", 
                 RowBox[{"[", "j", "]"}], "]"}], ",", 
                RowBox[{"{", 
                 RowBox[{"magnetization", "[", 
                  RowBox[{"[", 
                   RowBox[{"j", ",", "1"}], "]"}], "]"}], "}"}]}], "]"}]}], 
             ";"}]}], "\[IndentingNewLine]", "]"}], ";"}]}], 
        "\[IndentingNewLine]", "]"}], ";", "\[IndentingNewLine]", 
       "\[IndentingNewLine]", 
       RowBox[{"(*", 
        RowBox[{"===", 
         RowBox[{"==", " ", 
          RowBox[{"Generate", " ", "Errors"}]}], " ", "===", "=="}], "*)"}], 
       "\[IndentingNewLine]", 
       RowBox[{"phi", "=", 
        RowBox[{"RandomReal", "[", 
         RowBox[{
          RowBox[{"{", 
           RowBox[{"0", ",", 
            RowBox[{"2", "*", "Pi"}]}], "}"}], ",", 
          RowBox[{"Length", "[", 
           RowBox[{"Flatten", "[", 
            RowBox[{"magnetization", ",", "1"}], "]"}], "]"}]}], "]"}]}], ";",
        "\[IndentingNewLine]", 
       RowBox[{"phi", "=", 
        RowBox[{"ArrayReshape", "[", 
         RowBox[{"phi", ",", 
          RowBox[{"{", 
           RowBox[{
            RowBox[{"Length", "[", "magnetization", "]"}], ",", 
            RowBox[{"Length", "[", 
             RowBox[{"magnetization", "[", 
              RowBox[{"[", "1", "]"}], "]"}], "]"}]}], "}"}]}], "]"}]}], ";", 
       "\[IndentingNewLine]", "\[IndentingNewLine]", 
       RowBox[{"theta", "=", 
        RowBox[{"Table", "[", 
         RowBox[{
          RowBox[{"RandomVariate", "[", 
           RowBox[{"NormalDistribution", "[", 
            RowBox[{"0", ",", 
             RowBox[{
              RowBox[{"(", 
               RowBox[{"magTheta", "*", 
                RowBox[{"Pi", "/", "180"}]}], ")"}], "/", "3"}]}], "]"}], 
           "]"}], ",", 
          RowBox[{"{", 
           RowBox[{"i", ",", "1", ",", 
            RowBox[{"Length", "[", 
             RowBox[{"Flatten", "[", 
              RowBox[{"magnetization", ",", "1"}], "]"}], "]"}]}], "}"}]}], 
         "]"}]}], ";", "\[IndentingNewLine]", 
       RowBox[{"theta", "=", 
        RowBox[{"ArrayReshape", "[", 
         RowBox[{"theta", ",", 
          RowBox[{"{", 
           RowBox[{
            RowBox[{"Length", "[", "magnetization", "]"}], ",", 
            RowBox[{"Length", "[", 
             RowBox[{"magnetization", "[", 
              RowBox[{"[", "1", "]"}], "]"}], "]"}]}], "}"}]}], "]"}]}], ";", 
       " ", "\[IndentingNewLine]", "\[IndentingNewLine]", 
       RowBox[{"If", "[", 
        RowBox[{
         RowBox[{"magError", "\[GreaterEqual]", "1"}], ",", 
         "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{"dmag", "=", 
           RowBox[{"1", "+", 
            RowBox[{"Table", "[", 
             RowBox[{
              RowBox[{"RandomVariate", "[", 
               RowBox[{"NormalDistribution", "[", 
                RowBox[{"0", ",", 
                 RowBox[{"magAmpError", "/", "3"}]}], "]"}], "]"}], ",", 
              RowBox[{"{", 
               RowBox[{"i", ",", "1", ",", 
                RowBox[{"Length", "[", 
                 RowBox[{"Flatten", "[", 
                  RowBox[{"magnetization", ",", "1"}], "]"}], "]"}]}], 
               "}"}]}], "]"}]}]}], ";", "\[IndentingNewLine]", 
          RowBox[{"dmag", "=", 
           RowBox[{"ArrayReshape", "[", 
            RowBox[{"dmag", ",", 
             RowBox[{"{", 
              RowBox[{
               RowBox[{"Length", "[", "magnetization", "]"}], ",", 
               RowBox[{"Length", "[", 
                RowBox[{"magnetization", "[", 
                 RowBox[{"[", "1", "]"}], "]"}], "]"}]}], "}"}]}], "]"}]}], 
          ";"}], " ", "\[IndentingNewLine]", ",", "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{"dmag", "=", 
           RowBox[{"ConstantArray", "[", 
            RowBox[{"1", ",", 
             RowBox[{"{", 
              RowBox[{
               RowBox[{"Length", "[", "magnetization", "]"}], ",", 
               RowBox[{"Length", "[", 
                RowBox[{"magnetization", "[", 
                 RowBox[{"[", "1", "]"}], "]"}], "]"}]}], "}"}]}], "]"}]}], 
          ";", "\[IndentingNewLine]", 
          RowBox[{"phi", "=", 
           RowBox[{"phi", "*", "0"}]}], ";", "\[IndentingNewLine]", 
          RowBox[{"theta", "=", 
           RowBox[{"theta", "*", "0"}]}], ";"}]}], "\[IndentingNewLine]", 
        "]"}], ";", "\[IndentingNewLine]", "\[IndentingNewLine]", 
       RowBox[{"(*", 
        RowBox[{"===", 
         RowBox[{"==", " ", 
          RowBox[{"Apply", " ", "Errors"}]}], " ", "===", "=="}], "*)"}], 
       "\[IndentingNewLine]", 
       RowBox[{"For", "[", 
        RowBox[{
         RowBox[{"i", "=", "1"}], ",", 
         RowBox[{"i", "\[LessEqual]", " ", 
          RowBox[{"Length", "[", "magnetization", "]"}]}], ",", 
         RowBox[{"i", "++"}], ",", "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{
           RowBox[{"magnetization", "[", 
            RowBox[{"[", "i", "]"}], "]"}], "=", 
           RowBox[{
            RowBox[{"magnetization", "[", 
             RowBox[{"[", "i", "]"}], "]"}], "*", 
            RowBox[{"dmag", "[", 
             RowBox[{"[", "i", "]"}], "]"}]}]}], ";", "\[IndentingNewLine]", 
          "\[IndentingNewLine]", 
          RowBox[{"For", "[", 
           RowBox[{
            RowBox[{"j", "=", "1"}], ",", 
            RowBox[{"j", "\[LessEqual]", " ", 
             RowBox[{"Length", "[", 
              RowBox[{"magnetization", "[", 
               RowBox[{"[", "1", "]"}], "]"}], "]"}]}], ",", 
            RowBox[{"j", "++"}], ",", "\[IndentingNewLine]", 
            RowBox[{
             RowBox[{"If", "[", 
              RowBox[{
               RowBox[{
                RowBox[{"Mod", "[", 
                 RowBox[{"j", ",", "2"}], "]"}], "\[LessEqual]", "0"}], ",", 
               "\[IndentingNewLine]", 
               RowBox[{
                RowBox[{
                 RowBox[{"magnetization", "[", 
                  RowBox[{"[", 
                   RowBox[{"i", ",", "j"}], "]"}], "]"}], "=", 
                 RowBox[{
                  RowBox[{"RotationMatrix", "[", 
                   RowBox[{
                    RowBox[{"phi", "[", 
                    RowBox[{"[", 
                    RowBox[{"i", ",", "j"}], "]"}], "]"}], ",", 
                    RowBox[{"{", 
                    RowBox[{"0", ",", "0", ",", "1"}], "}"}]}], "]"}], ".", 
                  RowBox[{"RotationMatrix", "[", 
                   RowBox[{
                    RowBox[{"theta", "[", 
                    RowBox[{"[", 
                    RowBox[{"i", ",", "j"}], "]"}], "]"}], ",", 
                    RowBox[{"{", 
                    RowBox[{"0", ",", "1", ",", "0"}], "}"}]}], "]"}], ".", 
                  RowBox[{"magnetization", "[", 
                   RowBox[{"[", 
                    RowBox[{"i", ",", "j"}], "]"}], "]"}]}]}], ";"}], 
               "\[IndentingNewLine]", ",", "\[IndentingNewLine]", 
               RowBox[{
                RowBox[{
                 RowBox[{"magnetization", "[", 
                  RowBox[{"[", 
                   RowBox[{"i", ",", "j"}], "]"}], "]"}], "=", 
                 RowBox[{
                  RowBox[{"RotationMatrix", "[", 
                   RowBox[{
                    RowBox[{"phi", "[", 
                    RowBox[{"[", 
                    RowBox[{"i", ",", "j"}], "]"}], "]"}], ",", 
                    RowBox[{"{", 
                    RowBox[{"1", ",", "0", ",", "0"}], "}"}]}], "]"}], ".", 
                  RowBox[{"RotationMatrix", "[", 
                   RowBox[{
                    RowBox[{"theta", "[", 
                    RowBox[{"[", 
                    RowBox[{"i", ",", "j"}], "]"}], "]"}], ",", 
                    RowBox[{"{", 
                    RowBox[{"0", ",", "1", ",", "0"}], "}"}]}], "]"}], ".", 
                  RowBox[{"magnetization", "[", 
                   RowBox[{"[", 
                    RowBox[{"i", ",", "j"}], "]"}], "]"}]}]}], ";"}]}], 
              "\[IndentingNewLine]", "]"}], ";"}]}], "\[IndentingNewLine]", 
           "]"}]}]}], "\[IndentingNewLine]", "\[IndentingNewLine]", "]"}], 
       ";", "\[IndentingNewLine]", 
       RowBox[{"Return", "[", "magnetization", "]"}]}]}], 
     "\[IndentingNewLine]", "]"}], ";"}], "\[IndentingNewLine]", 
   ")"}]}]], "Input",
 CellChangeTimes->{{3.8230734534311275`*^9, 3.823073498743161*^9}, {
   3.823075016818911*^9, 3.823075044652527*^9}, {3.8230751290188866`*^9, 
   3.8230752098574543`*^9}, {3.8230752693348317`*^9, 3.82307540483144*^9}, {
   3.8230757221025333`*^9, 3.823075756273844*^9}, {3.8230757939158564`*^9, 
   3.8230758700511312`*^9}, {3.82307590252705*^9, 3.823075933758606*^9}, {
   3.823076257369628*^9, 3.823076364633091*^9}, {3.823076453604336*^9, 
   3.8230765781781797`*^9}, {3.823076644979904*^9, 3.823076695274355*^9}, {
   3.8230770058948307`*^9, 3.8230770084077177`*^9}, {3.823077349822297*^9, 
   3.8230773514441357`*^9}, {3.8230820484647884`*^9, 
   3.8230820946947174`*^9}, {3.823082181483632*^9, 3.823082236344793*^9}, {
   3.8230824247981653`*^9, 3.823082486133391*^9}, {3.8230839381123133`*^9, 
   3.823083996799473*^9}, {3.823084274437377*^9, 3.8230842854884768`*^9}, {
   3.8230843243364267`*^9, 3.823084333174412*^9}, {3.8231634883441477`*^9, 
   3.8231634901329365`*^9}, {3.823164409635227*^9, 3.823164427347066*^9}, {
   3.823164887253832*^9, 3.823164994738323*^9}, {3.823165084312823*^9, 
   3.8231651458201084`*^9}, {3.823165264273618*^9, 3.8231653688733187`*^9}, {
   3.8231662766432533`*^9, 3.8231662976834583`*^9}, {3.823166331113245*^9, 
   3.8231663484899426`*^9}, {3.823166433319851*^9, 3.8231664587339535`*^9}, {
   3.823166808686659*^9, 3.8231668551448126`*^9}, {3.8231673321944437`*^9, 
   3.823167336637915*^9}, 3.823167507385802*^9, {3.8231676818278546`*^9, 
   3.8231679035181074`*^9}, {3.8231679338007607`*^9, 
   3.8231679505746174`*^9}, {3.823168014143445*^9, 3.823168021969261*^9}, {
   3.823168053681142*^9, 3.823168152061553*^9}, {3.823168198572253*^9, 
   3.8231682193498983`*^9}, {3.8231682608542705`*^9, 3.823168310397355*^9}, {
   3.823168397219083*^9, 3.8231684132232447`*^9}, {3.823168497846359*^9, 
   3.823168504014089*^9}, {3.823168535380496*^9, 3.8231685712377386`*^9}, {
   3.8231686370672607`*^9, 3.823168678721874*^9}, {3.8231694448479834`*^9, 
   3.823169455466977*^9}, {3.8231694887802706`*^9, 3.823169491706731*^9}, {
   3.8231702639630156`*^9, 3.823170274526148*^9}, {3.823170377886963*^9, 
   3.8231703870855613`*^9}, 3.823182407012419*^9, {3.823186139758232*^9, 
   3.8231861559214954`*^9}, {3.8231862021673145`*^9, 3.823186202486143*^9}, {
   3.8231867584713717`*^9, 3.8231867636927443`*^9}, {3.8236950985149264`*^9, 
   3.823695100003189*^9}, {3.8237002832307777`*^9, 3.8237002885744967`*^9}, {
   3.823700435858307*^9, 3.823700435889533*^9}, {3.823700744763332*^9, 
   3.823700773077844*^9}, {3.823703471995745*^9, 3.8237034728533893`*^9}, {
   3.824298734968963*^9, 3.824298874507926*^9}, {3.8242989265188913`*^9, 
   3.824298979826383*^9}, {3.82429901300655*^9, 3.824299013576806*^9}, {
   3.8243094972665167`*^9, 3.8243095009805183`*^9}, {3.824309581832575*^9, 
   3.824309583351427*^9}},
 Background->RGBColor[0.94, 0.91, 0.88],
 CellLabel->"In[9]:=",ExpressionUUID->"221d6026-871d-4dae-ac74-13f4f0e7499d"]
}, Closed]],

Cell[CellGroupData[{

Cell["GenerateTermination Mag", "Subsection",
 CellChangeTimes->{{3.823077365329194*^9, 3.823077385215308*^9}, {
  3.824483321113908*^9, 
  3.8244833238509316`*^9}},ExpressionUUID->"fcc3b1e2-bffe-48af-8e91-\
46088c1e2f8f"],

Cell[BoxData[
 RowBox[{
  RowBox[{"idGenerateTerm", "[", 
   RowBox[{
   "termType_", ",", "blockThick_", ",", "blockGap_", ",", "periodL_", ",", 
    "magnAmp_", ",", 
    RowBox[{"magFront_", " ", ":", 
     RowBox[{"{", 
      RowBox[{"{", "}"}], "}"}]}], ",", 
    RowBox[{"magBack_", " ", ":", 
     RowBox[{"{", 
      RowBox[{"{", "}"}], "}"}]}], ",", 
    RowBox[{"magError_", " ", ":", "0"}], ",", 
    RowBox[{"magAmpError_", " ", ":", "0.01"}], ",", 
    RowBox[{"magTheta_", " ", ":", "1"}]}], "]"}], ":=", 
  RowBox[{"(", "\n", 
   RowBox[{
    RowBox[{"Module", "[", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{
       "termination", ",", "termMagFront", ",", "termMagBack", ",", 
        "termBlockThick", ",", "termBlockGap", ",", "dmag", ",", "phi", ",", 
        "theta", ",", "size"}], "}"}], ",", "\[IndentingNewLine]", 
      RowBox[{"(*", 
       RowBox[{
        RowBox[{
         RowBox[{"--", 
          RowBox[{"--", 
           RowBox[{"-", " ", "ThreeBlocksAntiSym"}]}]}], " ", 
         RowBox[{
          RowBox[{"Termination", " ", "--"}], "--"}]}], "-"}], "*)"}], 
      "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"If", "[", 
        RowBox[{
         RowBox[{"termType", "\[Equal]", "\"\<ThreeBlocksAntiSym\>\""}], ",", 
         "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{"If", "[", 
           RowBox[{
            RowBox[{
             RowBox[{"Length", "[", 
              RowBox[{"magFront", "[", 
               RowBox[{"[", "1", "]"}], "]"}], "]"}], "\[GreaterEqual]", " ", 
             "3"}], ",", "\[IndentingNewLine]", 
            RowBox[{
             RowBox[{"termMagFront", "=", "magFront"}], ";"}], 
            "\[IndentingNewLine]", ",", "\[IndentingNewLine]", 
            RowBox[{
             RowBox[{"termMagFront", "=", 
              RowBox[{"{", 
               RowBox[{
                RowBox[{"{", 
                 RowBox[{
                  RowBox[{"{", 
                   RowBox[{"0", ",", "0", ",", "magnAmp"}], "}"}], ",", 
                  RowBox[{"{", 
                   RowBox[{
                    RowBox[{"-", "magnAmp"}], ",", "0", ",", "0"}], "}"}], 
                  ",", 
                  RowBox[{"{", 
                   RowBox[{"0", ",", "0", ",", 
                    RowBox[{"-", "magnAmp"}]}], "}"}]}], "}"}], ",", 
                RowBox[{"{", 
                 RowBox[{
                  RowBox[{"{", 
                   RowBox[{"0", ",", "0", ",", "magnAmp"}], "}"}], ",", 
                  RowBox[{"{", 
                   RowBox[{
                    RowBox[{"-", "magnAmp"}], ",", "0", ",", "0"}], "}"}], 
                  ",", 
                  RowBox[{"{", 
                   RowBox[{"0", ",", "0", ",", 
                    RowBox[{"-", "magnAmp"}]}], "}"}]}], "}"}], ",", 
                RowBox[{"{", 
                 RowBox[{
                  RowBox[{"{", 
                   RowBox[{"0", ",", "0", ",", 
                    RowBox[{"-", "magnAmp"}]}], "}"}], ",", 
                  RowBox[{"{", 
                   RowBox[{"magnAmp", ",", "0", ",", "0"}], "}"}], ",", 
                  RowBox[{"{", 
                   RowBox[{"0", ",", "0", ",", "magnAmp"}], "}"}]}], "}"}], 
                ",", 
                RowBox[{"{", 
                 RowBox[{
                  RowBox[{"{", 
                   RowBox[{"0", ",", "0", ",", 
                    RowBox[{"-", "magnAmp"}]}], "}"}], ",", 
                  RowBox[{"{", 
                   RowBox[{"magnAmp", ",", "0", ",", "0"}], "}"}], ",", 
                  RowBox[{"{", 
                   RowBox[{"0", ",", "0", ",", "magnAmp"}], "}"}]}], "}"}]}], 
               "}"}]}], ";"}]}], "\[IndentingNewLine]", "]"}], ";", 
          "\[IndentingNewLine]", "\[IndentingNewLine]", 
          RowBox[{"If", "[", 
           RowBox[{
            RowBox[{
             RowBox[{"Length", "[", 
              RowBox[{"magBack", "[", 
               RowBox[{"[", "1", "]"}], "]"}], "]"}], "\[GreaterEqual]", " ", 
             "3"}], ",", "\[IndentingNewLine]", 
            RowBox[{
             RowBox[{"termMagBack", "=", "magBack"}], ";"}], 
            "\[IndentingNewLine]", ",", "\[IndentingNewLine]", 
            RowBox[{
             RowBox[{"termMagBack", "=", 
              RowBox[{"{", 
               RowBox[{
                RowBox[{"{", 
                 RowBox[{
                  RowBox[{"{", 
                   RowBox[{"0", ",", "0", ",", "magnAmp"}], "}"}], ",", 
                  RowBox[{"{", 
                   RowBox[{
                    RowBox[{"-", "magnAmp"}], ",", "0", ",", "0"}], "}"}], 
                  ",", 
                  RowBox[{"{", 
                   RowBox[{"0", ",", "0", ",", 
                    RowBox[{"-", "magnAmp"}]}], "}"}]}], "}"}], ",", 
                RowBox[{"{", 
                 RowBox[{
                  RowBox[{"{", 
                   RowBox[{"0", ",", "0", ",", "magnAmp"}], "}"}], ",", 
                  RowBox[{"{", 
                   RowBox[{
                    RowBox[{"-", "magnAmp"}], ",", "0", ",", "0"}], "}"}], 
                  ",", 
                  RowBox[{"{", 
                   RowBox[{"0", ",", "0", ",", 
                    RowBox[{"-", "magnAmp"}]}], "}"}]}], "}"}], ",", 
                RowBox[{"{", 
                 RowBox[{
                  RowBox[{"{", 
                   RowBox[{"0", ",", "0", ",", 
                    RowBox[{"-", "magnAmp"}]}], "}"}], ",", 
                  RowBox[{"{", 
                   RowBox[{"magnAmp", ",", "0", ",", "0"}], "}"}], ",", 
                  RowBox[{"{", 
                   RowBox[{"0", ",", "0", ",", "magnAmp"}], "}"}]}], "}"}], 
                ",", 
                RowBox[{"{", 
                 RowBox[{
                  RowBox[{"{", 
                   RowBox[{"0", ",", "0", ",", 
                    RowBox[{"-", "magnAmp"}]}], "}"}], ",", 
                  RowBox[{"{", 
                   RowBox[{"magnAmp", ",", "0", ",", "0"}], "}"}], ",", 
                  RowBox[{"{", 
                   RowBox[{"0", ",", "0", ",", "magnAmp"}], "}"}]}], "}"}]}], 
               "}"}]}], ";"}]}], "\[IndentingNewLine]", "]"}], ";", 
          "\[IndentingNewLine]", "\[IndentingNewLine]", 
          RowBox[{"termBlockThick", "=", 
           RowBox[{
            RowBox[{"{", 
             RowBox[{
              RowBox[{"1", "/", "4"}], ",", 
              RowBox[{"1", "/", "2"}], ",", 
              RowBox[{"3", "/", "4"}]}], "}"}], "*", "blockThick"}]}], ";", 
          "\[IndentingNewLine]", 
          RowBox[{"termBlockGap", "=", 
           RowBox[{"{", 
            RowBox[{
             RowBox[{
              RowBox[{"0.875", "*", 
               RowBox[{"periodL", "/", "4"}]}], "-", 
              RowBox[{"(", 
               RowBox[{
                RowBox[{
                 RowBox[{"(", 
                  RowBox[{"0.25", "+", "0.5"}], ")"}], "/", "2"}], "*", 
                "blockThick"}], ")"}]}], ",", 
             RowBox[{
              RowBox[{"0.875", "*", 
               RowBox[{"periodL", "/", "4"}]}], "-", 
              RowBox[{"(", 
               RowBox[{
                RowBox[{
                 RowBox[{"(", 
                  RowBox[{"0.5", "+", "0.75"}], ")"}], "/", "2"}], "*", 
                "blockThick"}], ")"}]}], ",", 
             RowBox[{
              RowBox[{"0.875", "*", 
               RowBox[{"periodL", "/", "4"}]}], "-", 
              RowBox[{"(", 
               RowBox[{
                RowBox[{
                 RowBox[{"(", 
                  RowBox[{"0.75", "+", "1"}], ")"}], "/", "2"}], "*", 
                "blockThick"}], ")"}]}]}], "}"}]}], ";", 
          "\[IndentingNewLine]", "\[IndentingNewLine]", 
          RowBox[{"termination", "=", 
           RowBox[{"Table", "[", 
            RowBox[{
             RowBox[{"{", 
              RowBox[{
               RowBox[{"termMagFront", "[", 
                RowBox[{"[", "i", "]"}], "]"}], ",", "termBlockThick", ",", 
               "termBlockGap", ",", 
               RowBox[{"termMagBack", "[", 
                RowBox[{"[", "i", "]"}], "]"}], ",", 
               RowBox[{"Reverse", "[", "termBlockThick", "]"}], ",", 
               RowBox[{"Reverse", "[", "termBlockGap", "]"}]}], "}"}], ",", 
             RowBox[{"{", 
              RowBox[{"i", ",", "1", ",", 
               RowBox[{"Length", "[", "termMagFront", "]"}]}], "}"}]}], 
            "]"}]}], ";"}]}], "\[IndentingNewLine]", "]"}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"(*", 
        RowBox[{"--", 
         RowBox[{"--", 
          RowBox[{"--", 
           RowBox[{"--", 
            RowBox[{"--", 
             RowBox[{"--", 
              RowBox[{"--", 
               RowBox[{"--", 
                RowBox[{"--", 
                 RowBox[{"--", 
                  RowBox[{"--", 
                   RowBox[{"--", 
                    RowBox[{"--", 
                    RowBox[{"--", 
                    RowBox[{"--", 
                    RowBox[{"--", 
                    RowBox[{"--", 
                    RowBox[{"--", 
                    RowBox[{"--", 
                    RowBox[{"--", 
                    RowBox[{"--", 
                    RowBox[{"--", 
                    RowBox[{"--", 
                    RowBox[{"--", 
                    RowBox[{"--", 
                    RowBox[{"--", 
                    RowBox[{"--", 
                    RowBox[{"--", 
                    RowBox[{"--", 
                    RowBox[{
                    "--", "-"}]}]}]}]}]}]}]}]}]}]}]}]}]}]}]}]}]}]}]}]}]}]}]}]}\
]}]}]}]}]}], "*)"}], "\[IndentingNewLine]", 
       RowBox[{"(*", 
        RowBox[{
         RowBox[{
          RowBox[{"--", 
           RowBox[{"--", 
            RowBox[{"-", " ", "FourBlocksAntiSym"}]}]}], " ", 
          RowBox[{
           RowBox[{"Termination", " ", "--"}], "--"}]}], "-"}], "*)"}], 
       "\[IndentingNewLine]", 
       RowBox[{"If", "[", 
        RowBox[{
         RowBox[{"termType", "\[Equal]", "\"\<FourBlocksAntiSym\>\""}], ",", 
         "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{"If", "[", 
           RowBox[{
            RowBox[{
             RowBox[{"Length", "[", 
              RowBox[{"magFront", "[", 
               RowBox[{"[", "1", "]"}], "]"}], "]"}], "\[GreaterEqual]", " ", 
             "4"}], ",", "\[IndentingNewLine]", 
            RowBox[{
             RowBox[{"termMagFront", "=", "magFront"}], ";"}], 
            "\[IndentingNewLine]", ",", "\[IndentingNewLine]", 
            RowBox[{
             RowBox[{"termMagFront", "=", 
              RowBox[{"{", 
               RowBox[{
                RowBox[{"{", 
                 RowBox[{
                  RowBox[{"{", 
                   RowBox[{"magnAmp", ",", "0", ",", "0"}], "}"}], ",", 
                  RowBox[{"{", 
                   RowBox[{"0", ",", "0", ",", "magnAmp"}], "}"}], ",", 
                  RowBox[{"{", 
                   RowBox[{
                    RowBox[{"-", "magnAmp"}], ",", "0", ",", "0"}], "}"}], 
                  ",", 
                  RowBox[{"{", 
                   RowBox[{"0", ",", "0", ",", 
                    RowBox[{"-", "magnAmp"}]}], "}"}]}], "}"}], ",", 
                RowBox[{"{", 
                 RowBox[{
                  RowBox[{"{", 
                   RowBox[{"magnAmp", ",", "0", ",", "0"}], "}"}], ",", 
                  RowBox[{"{", 
                   RowBox[{"0", ",", "0", ",", "magnAmp"}], "}"}], ",", 
                  RowBox[{"{", 
                   RowBox[{
                    RowBox[{"-", "magnAmp"}], ",", "0", ",", "0"}], "}"}], 
                  ",", 
                  RowBox[{"{", 
                   RowBox[{"0", ",", "0", ",", 
                    RowBox[{"-", "magnAmp"}]}], "}"}]}], "}"}], ",", 
                RowBox[{"{", 
                 RowBox[{
                  RowBox[{"{", 
                   RowBox[{
                    RowBox[{"-", "magnAmp"}], ",", "0", ",", "0"}], "}"}], 
                  ",", 
                  RowBox[{"{", 
                   RowBox[{"0", ",", "0", ",", 
                    RowBox[{"-", "magnAmp"}]}], "}"}], ",", 
                  RowBox[{"{", 
                   RowBox[{"magnAmp", ",", "0", ",", "0"}], "}"}], ",", 
                  RowBox[{"{", 
                   RowBox[{"0", ",", "0", ",", "magnAmp"}], "}"}]}], "}"}], 
                ",", 
                RowBox[{"{", 
                 RowBox[{
                  RowBox[{"{", 
                   RowBox[{
                    RowBox[{"-", "magnAmp"}], ",", "0", ",", "0"}], "}"}], 
                  ",", 
                  RowBox[{"{", 
                   RowBox[{"0", ",", "0", ",", 
                    RowBox[{"-", "magnAmp"}]}], "}"}], ",", 
                  RowBox[{"{", 
                   RowBox[{"magnAmp", ",", "0", ",", "0"}], "}"}], ",", 
                  RowBox[{"{", 
                   RowBox[{"0", ",", "0", ",", "magnAmp"}], "}"}]}], "}"}]}], 
               "}"}]}], ";", "\[IndentingNewLine]", "\[IndentingNewLine]", 
             RowBox[{"(*", 
              RowBox[{"Apply", " ", "Errors"}], "*)"}], "\[IndentingNewLine]", 
             RowBox[{"If", "[", 
              RowBox[{
               RowBox[{"magError", "\[GreaterEqual]", "1"}], ",", 
               "\[IndentingNewLine]", 
               RowBox[{
                RowBox[{"size", "=", 
                 RowBox[{"Dimensions", "[", "termMagFront", "]"}]}], ";", 
                "\[IndentingNewLine]", 
                RowBox[{"dmag", "=", 
                 RowBox[{"1", "+", 
                  RowBox[{"Table", "[", 
                   RowBox[{
                    RowBox[{"RandomVariate", "[", 
                    RowBox[{"NormalDistribution", "[", 
                    RowBox[{"0", ",", 
                    RowBox[{"magAmpError", "/", "3"}]}], "]"}], "]"}], ",", 
                    RowBox[{"{", 
                    RowBox[{"i", ",", "1", ",", 
                    RowBox[{"Length", "[", 
                    RowBox[{"Flatten", "[", 
                    RowBox[{"termMagFront", ",", "1"}], "]"}], "]"}]}], 
                    "}"}]}], "]"}]}]}], ";", "\[IndentingNewLine]", 
                RowBox[{"termMagFront", "=", 
                 RowBox[{
                  RowBox[{"Flatten", "[", 
                   RowBox[{"termMagFront", ",", "1"}], "]"}], "*", "dmag"}]}],
                 ";", "\[IndentingNewLine]", "\[IndentingNewLine]", 
                RowBox[{"phi", "=", 
                 RowBox[{"RandomReal", "[", 
                  RowBox[{
                   RowBox[{"{", 
                    RowBox[{"0", ",", 
                    RowBox[{"2", "*", "Pi"}]}], "}"}], ",", 
                   RowBox[{"Length", "[", "termMagFront", "]"}]}], "]"}]}], 
                ";", "\[IndentingNewLine]", 
                RowBox[{"theta", "=", 
                 RowBox[{"Table", "[", 
                  RowBox[{
                   RowBox[{"RandomVariate", "[", 
                    RowBox[{"NormalDistribution", "[", 
                    RowBox[{"0", ",", 
                    RowBox[{
                    RowBox[{"(", 
                    RowBox[{"magTheta", "*", 
                    RowBox[{"Pi", "/", "180"}]}], ")"}], "/", "3"}]}], "]"}], 
                    "]"}], ",", 
                   RowBox[{"{", 
                    RowBox[{"i", ",", "1", ",", 
                    RowBox[{"Length", "[", "termMagFront", "]"}]}], "}"}]}], 
                  "]"}]}], ";", "\[IndentingNewLine]", "\[IndentingNewLine]", 
                RowBox[{"For", "[", 
                 RowBox[{
                  RowBox[{"i", "=", "1"}], ",", 
                  RowBox[{"i", "\[LessEqual]", " ", 
                   RowBox[{"Length", "[", "termMagFront", "]"}]}], ",", 
                  RowBox[{"i", "++"}], ",", "\[IndentingNewLine]", 
                  RowBox[{"If", "[", 
                   RowBox[{
                    RowBox[{
                    RowBox[{"Mod", "[", 
                    RowBox[{"i", ",", "2"}], "]"}], "\[LessEqual]", "0"}], 
                    ",", "\[IndentingNewLine]", 
                    RowBox[{
                    RowBox[{
                    RowBox[{"termMagFront", "[", 
                    RowBox[{"[", "i", "]"}], "]"}], "=", 
                    RowBox[{
                    RowBox[{"RotationMatrix", "[", 
                    RowBox[{
                    RowBox[{"phi", "[", 
                    RowBox[{"[", "i", "]"}], "]"}], ",", 
                    RowBox[{"{", 
                    RowBox[{"0", ",", "0", ",", "1"}], "}"}]}], "]"}], ".", 
                    RowBox[{"RotationMatrix", "[", 
                    RowBox[{
                    RowBox[{"theta", "[", 
                    RowBox[{"[", "i", "]"}], "]"}], ",", 
                    RowBox[{"{", 
                    RowBox[{"0", ",", "1", ",", "0"}], "}"}]}], "]"}], ".", 
                    RowBox[{"termMagFront", "[", 
                    RowBox[{"[", "i", "]"}], "]"}]}]}], ";"}], 
                    "\[IndentingNewLine]", ",", "\[IndentingNewLine]", 
                    RowBox[{
                    RowBox[{
                    RowBox[{"termMagFront", "[", 
                    RowBox[{"[", "i", "]"}], "]"}], "=", 
                    RowBox[{
                    RowBox[{"RotationMatrix", "[", 
                    RowBox[{
                    RowBox[{"phi", "[", 
                    RowBox[{"[", "i", "]"}], "]"}], ",", 
                    RowBox[{"{", 
                    RowBox[{"1", ",", "0", ",", "0"}], "}"}]}], "]"}], ".", 
                    RowBox[{"RotationMatrix", "[", 
                    RowBox[{
                    RowBox[{"theta", "[", 
                    RowBox[{"[", "i", "]"}], "]"}], ",", 
                    RowBox[{"{", 
                    RowBox[{"0", ",", "1", ",", "0"}], "}"}]}], "]"}], ".", 
                    RowBox[{"termMagFront", "[", 
                    RowBox[{"[", "i", "]"}], "]"}]}]}], ";"}]}], 
                   "\[IndentingNewLine]", "]"}]}], "]"}], ";", 
                "\[IndentingNewLine]", 
                RowBox[{"termMagFront", "=", 
                 RowBox[{"ArrayReshape", "[", 
                  RowBox[{"termMagFront", ",", "size"}], "]"}]}], ";"}]}], 
              "\[IndentingNewLine]", "]"}]}]}], "\[IndentingNewLine]", "]"}], 
          ";", "\[IndentingNewLine]", "\[IndentingNewLine]", 
          RowBox[{"If", "[", 
           RowBox[{
            RowBox[{
             RowBox[{"Length", "[", 
              RowBox[{"magBack", "[", 
               RowBox[{"[", "1", "]"}], "]"}], "]"}], "\[GreaterEqual]", " ", 
             "4"}], ",", "\[IndentingNewLine]", 
            RowBox[{
             RowBox[{"termMagBack", "=", "magBack"}], ";"}], 
            "\[IndentingNewLine]", ",", "\[IndentingNewLine]", 
            RowBox[{
             RowBox[{"termMagBack", "=", 
              RowBox[{"{", 
               RowBox[{
                RowBox[{"{", 
                 RowBox[{
                  RowBox[{"{", 
                   RowBox[{"0", ",", "0", ",", "magnAmp"}], "}"}], ",", 
                  RowBox[{"{", 
                   RowBox[{
                    RowBox[{"-", "magnAmp"}], ",", "0", ",", "0"}], "}"}], 
                  ",", 
                  RowBox[{"{", 
                   RowBox[{"0", ",", "0", ",", 
                    RowBox[{"-", "magnAmp"}]}], "}"}], ",", 
                  RowBox[{"{", 
                   RowBox[{"magnAmp", ",", "0", ",", "0"}], "}"}]}], "}"}], 
                ",", 
                RowBox[{"{", 
                 RowBox[{
                  RowBox[{"{", 
                   RowBox[{"0", ",", "0", ",", "magnAmp"}], "}"}], ",", 
                  RowBox[{"{", 
                   RowBox[{
                    RowBox[{"-", "magnAmp"}], ",", "0", ",", "0"}], "}"}], 
                  ",", 
                  RowBox[{"{", 
                   RowBox[{"0", ",", "0", ",", 
                    RowBox[{"-", "magnAmp"}]}], "}"}], ",", 
                  RowBox[{"{", 
                   RowBox[{"magnAmp", ",", "0", ",", "0"}], "}"}]}], "}"}], 
                ",", 
                RowBox[{"{", 
                 RowBox[{
                  RowBox[{"{", 
                   RowBox[{"0", ",", "0", ",", 
                    RowBox[{"-", "magnAmp"}]}], "}"}], ",", 
                  RowBox[{"{", 
                   RowBox[{"magnAmp", ",", "0", ",", "0"}], "}"}], ",", 
                  RowBox[{"{", 
                   RowBox[{"0", ",", "0", ",", "magnAmp"}], "}"}], ",", 
                  RowBox[{"{", 
                   RowBox[{
                    RowBox[{"-", "magnAmp"}], ",", "0", ",", "0"}], "}"}]}], 
                 "}"}], ",", 
                RowBox[{"{", 
                 RowBox[{
                  RowBox[{"{", 
                   RowBox[{"0", ",", "0", ",", 
                    RowBox[{"-", "magnAmp"}]}], "}"}], ",", 
                  RowBox[{"{", 
                   RowBox[{"magnAmp", ",", "0", ",", "0"}], "}"}], ",", 
                  RowBox[{"{", 
                   RowBox[{"0", ",", "0", ",", "magnAmp"}], "}"}], ",", 
                  RowBox[{"{", 
                   RowBox[{
                    RowBox[{"-", "magnAmp"}], ",", "0", ",", "0"}], "}"}]}], 
                 "}"}]}], "}"}]}], ";", "\[IndentingNewLine]", 
             "\[IndentingNewLine]", 
             RowBox[{"(*", 
              RowBox[{"Apply", " ", "Errors"}], "*)"}], "\[IndentingNewLine]", 
             RowBox[{"If", "[", 
              RowBox[{
               RowBox[{"magError", "\[GreaterEqual]", "1"}], ",", 
               "\[IndentingNewLine]", 
               RowBox[{
                RowBox[{"size", "=", 
                 RowBox[{"Dimensions", "[", "termMagBack", "]"}]}], ";", 
                "\[IndentingNewLine]", 
                RowBox[{"dmag", "=", 
                 RowBox[{"1", "+", 
                  RowBox[{"Table", "[", 
                   RowBox[{
                    RowBox[{"RandomVariate", "[", 
                    RowBox[{"NormalDistribution", "[", 
                    RowBox[{"0", ",", 
                    RowBox[{"magAmpError", "/", "3"}]}], "]"}], "]"}], ",", 
                    RowBox[{"{", 
                    RowBox[{"i", ",", "1", ",", 
                    RowBox[{"Length", "[", 
                    RowBox[{"Flatten", "[", 
                    RowBox[{"termMagBack", ",", "1"}], "]"}], "]"}]}], 
                    "}"}]}], "]"}]}]}], ";", "\[IndentingNewLine]", 
                RowBox[{"termMagBack", "=", 
                 RowBox[{
                  RowBox[{"Flatten", "[", 
                   RowBox[{"termMagBack", ",", "1"}], "]"}], "*", "dmag"}]}], 
                ";", "\[IndentingNewLine]", "\[IndentingNewLine]", 
                RowBox[{"phi", "=", 
                 RowBox[{"RandomReal", "[", 
                  RowBox[{
                   RowBox[{"{", 
                    RowBox[{"0", ",", 
                    RowBox[{"2", "*", "Pi"}]}], "}"}], ",", 
                   RowBox[{"Length", "[", "termMagBack", "]"}]}], "]"}]}], 
                ";", "\[IndentingNewLine]", 
                RowBox[{"theta", "=", 
                 RowBox[{"Table", "[", 
                  RowBox[{
                   RowBox[{"RandomVariate", "[", 
                    RowBox[{"NormalDistribution", "[", 
                    RowBox[{"0", ",", 
                    RowBox[{
                    RowBox[{"(", 
                    RowBox[{"magTheta", "*", 
                    RowBox[{"Pi", "/", "180"}]}], ")"}], "/", "3"}]}], "]"}], 
                    "]"}], ",", 
                   RowBox[{"{", 
                    RowBox[{"i", ",", "1", ",", 
                    RowBox[{"Length", "[", "termMagBack", "]"}]}], "}"}]}], 
                  "]"}]}], ";", "\[IndentingNewLine]", "\[IndentingNewLine]", 
                RowBox[{"For", "[", 
                 RowBox[{
                  RowBox[{"i", "=", "1"}], ",", 
                  RowBox[{"i", "\[LessEqual]", " ", 
                   RowBox[{"Length", "[", "termMagBack", "]"}]}], ",", 
                  RowBox[{"i", "++"}], ",", "\[IndentingNewLine]", 
                  RowBox[{"If", "[", 
                   RowBox[{
                    RowBox[{
                    RowBox[{"Mod", "[", 
                    RowBox[{"i", ",", "2"}], "]"}], ">", "0"}], ",", 
                    "\[IndentingNewLine]", 
                    RowBox[{
                    RowBox[{
                    RowBox[{"termMagBack", "[", 
                    RowBox[{"[", "i", "]"}], "]"}], "=", 
                    RowBox[{
                    RowBox[{"RotationMatrix", "[", 
                    RowBox[{
                    RowBox[{"phi", "[", 
                    RowBox[{"[", "i", "]"}], "]"}], ",", 
                    RowBox[{"{", 
                    RowBox[{"0", ",", "0", ",", "1"}], "}"}]}], "]"}], ".", 
                    RowBox[{"RotationMatrix", "[", 
                    RowBox[{
                    RowBox[{"theta", "[", 
                    RowBox[{"[", "i", "]"}], "]"}], ",", 
                    RowBox[{"{", 
                    RowBox[{"0", ",", "1", ",", "0"}], "}"}]}], "]"}], ".", 
                    RowBox[{"termMagBack", "[", 
                    RowBox[{"[", "i", "]"}], "]"}]}]}], ";"}], 
                    "\[IndentingNewLine]", ",", "\[IndentingNewLine]", 
                    RowBox[{
                    RowBox[{
                    RowBox[{"termMagBack", "[", 
                    RowBox[{"[", "i", "]"}], "]"}], "=", 
                    RowBox[{
                    RowBox[{"RotationMatrix", "[", 
                    RowBox[{
                    RowBox[{"phi", "[", 
                    RowBox[{"[", "i", "]"}], "]"}], ",", 
                    RowBox[{"{", 
                    RowBox[{"1", ",", "0", ",", "0"}], "}"}]}], "]"}], ".", 
                    RowBox[{"RotationMatrix", "[", 
                    RowBox[{
                    RowBox[{"theta", "[", 
                    RowBox[{"[", "i", "]"}], "]"}], ",", 
                    RowBox[{"{", 
                    RowBox[{"0", ",", "1", ",", "0"}], "}"}]}], "]"}], ".", 
                    RowBox[{"termMagBack", "[", 
                    RowBox[{"[", "i", "]"}], "]"}]}]}], ";"}]}], 
                   "\[IndentingNewLine]", "]"}]}], "]"}], ";", 
                "\[IndentingNewLine]", 
                RowBox[{"termMagBack", "=", 
                 RowBox[{"ArrayReshape", "[", 
                  RowBox[{"termMagBack", ",", "size"}], "]"}]}], ";"}]}], 
              "\[IndentingNewLine]", "]"}]}]}], "\[IndentingNewLine]", "]"}], 
          ";", "\[IndentingNewLine]", "\[IndentingNewLine]", 
          RowBox[{"termBlockThick", "=", 
           RowBox[{"{", 
            RowBox[{"3.25", ",", "3.25", ",", "9.75", ",", "9.75"}], "}"}]}], 
          ";", "\[IndentingNewLine]", 
          RowBox[{"termBlockGap", "=", 
           RowBox[{"{", 
            RowBox[{"8.7", ",", "2.0", ",", "3.3", ",", "1.0"}], "}"}]}], ";",
           "\[IndentingNewLine]", "\[IndentingNewLine]", 
          RowBox[{"termination", "=", 
           RowBox[{"Table", "[", 
            RowBox[{
             RowBox[{"{", 
              RowBox[{
               RowBox[{"termMagFront", "[", 
                RowBox[{"[", "i", "]"}], "]"}], ",", "termBlockThick", ",", 
               "termBlockGap", ",", 
               RowBox[{"termMagBack", "[", 
                RowBox[{"[", "i", "]"}], "]"}], ",", 
               RowBox[{"Reverse", "[", "termBlockThick", "]"}], ",", 
               RowBox[{"Reverse", "[", "termBlockGap", "]"}]}], "}"}], ",", 
             RowBox[{"{", 
              RowBox[{"i", ",", "1", ",", 
               RowBox[{"Length", "[", "termMagFront", "]"}]}], "}"}]}], 
            "]"}]}], ";"}]}], "\[IndentingNewLine]", "]"}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"(*", 
        RowBox[{"--", 
         RowBox[{"--", 
          RowBox[{"--", 
           RowBox[{"--", 
            RowBox[{"--", 
             RowBox[{"--", 
              RowBox[{"--", 
               RowBox[{"--", 
                RowBox[{"--", 
                 RowBox[{"--", 
                  RowBox[{"--", 
                   RowBox[{"--", 
                    RowBox[{"--", 
                    RowBox[{"--", 
                    RowBox[{"--", 
                    RowBox[{"--", 
                    RowBox[{"--", 
                    RowBox[{"--", 
                    RowBox[{"--", 
                    RowBox[{"--", 
                    RowBox[{"--", 
                    RowBox[{"--", 
                    RowBox[{"--", 
                    RowBox[{"--", 
                    RowBox[{"--", 
                    RowBox[{"--", 
                    RowBox[{"--", 
                    RowBox[{"--", 
                    RowBox[{"--", 
                    RowBox[{
                    "--", "-"}]}]}]}]}]}]}]}]}]}]}]}]}]}]}]}]}]}]}]}]}]}]}]}]}\
]}]}]}]}]}], "*)"}], "\[IndentingNewLine]", "\[IndentingNewLine]", 
       RowBox[{"Return", "[", "termination", "]"}]}]}], "\[IndentingNewLine]",
      "]"}], ";"}], "\[IndentingNewLine]", ")"}]}]], "Input",
 CellChangeTimes->{{3.823077388324053*^9, 3.8230775391130724`*^9}, {
   3.8230777224241376`*^9, 3.82307772312562*^9}, {3.8230777539262333`*^9, 
   3.8230777676816993`*^9}, {3.8230778168795457`*^9, 3.823077821286316*^9}, {
   3.823077882487821*^9, 3.8230780000171394`*^9}, {3.8230780734814634`*^9, 
   3.823078115911222*^9}, {3.823078161927266*^9, 3.823078215057619*^9}, {
   3.823078459139248*^9, 3.8230784675215654`*^9}, 3.823078961415109*^9, 
   3.8230790019678316`*^9, {3.8230825164479275`*^9, 3.8230825600754433`*^9}, {
   3.823182410528599*^9, 3.82318242401606*^9}, 3.823182492143036*^9, {
   3.8231891579553156`*^9, 3.823189183599577*^9}, {3.8231895867537727`*^9, 
   3.8231896174089127`*^9}, {3.8231896778652077`*^9, 3.823189688726184*^9}, {
   3.823189737114155*^9, 3.823189791330197*^9}, {3.8232430751026955`*^9, 
   3.823243171912265*^9}, {3.823243769112008*^9, 3.8232437720961933`*^9}, {
   3.823243820686617*^9, 3.823243966423137*^9}, {3.8232440100296216`*^9, 
   3.8232441953904905`*^9}, {3.8232442827027864`*^9, 
   3.8232442874681225`*^9}, {3.8232444097488794`*^9, 3.82324443945625*^9}, {
   3.823244570602457*^9, 3.823244574569581*^9}, {3.823244657773608*^9, 
   3.8232446668667994`*^9}, {3.8232447237219286`*^9, 3.823244768820605*^9}, {
   3.8232459233613625`*^9, 3.8232459491328554`*^9}, {3.8232512039111924`*^9, 
   3.823251249200403*^9}, {3.823254204920805*^9, 3.823254217787286*^9}, {
   3.823254398026204*^9, 3.8232544561325765`*^9}, {3.8236950906935635`*^9, 
   3.82369509228386*^9}, {3.824456494012184*^9, 3.8244565016029377`*^9}, {
   3.8244565440917025`*^9, 3.8244566121689973`*^9}, {3.8244566453900905`*^9, 
   3.8244567855934877`*^9}, {3.8244568546066084`*^9, 
   3.8244568881108236`*^9}, {3.824457284128724*^9, 3.8244573137597127`*^9}, {
   3.824474927357209*^9, 3.824475172172876*^9}, {3.824475216200239*^9, 
   3.8244753413548307`*^9}, {3.824475385717245*^9, 3.824475425665414*^9}, {
   3.8244755599814577`*^9, 3.8244755758302746`*^9}, {3.8244756849089127`*^9, 
   3.824475788955386*^9}, {3.8244763523070498`*^9, 3.8244764033822184`*^9}, {
   3.824802838384699*^9, 3.824802866770113*^9}, {3.8248028991659417`*^9, 
   3.8248029019898343`*^9}, {3.8248030619498158`*^9, 
   3.8248030704558992`*^9}, {3.825771966742889*^9, 3.8257720165028906`*^9}, {
   3.8257720646630945`*^9, 3.825772096563193*^9}, {3.825772176223249*^9, 
   3.825772198173386*^9}, {3.825772250818224*^9, 3.8257723326135*^9}, {
   3.825772380753512*^9, 3.825772423963274*^9}, {3.825772471573537*^9, 
   3.8257725979232645`*^9}, {3.8257727050282226`*^9, 3.825772755893883*^9}, {
   3.825772839368497*^9, 3.8257728398364677`*^9}, {3.8257732859140153`*^9, 
   3.825773290654166*^9}, {3.8257735203440695`*^9, 3.8257735352441573`*^9}, {
   3.8267950426263885`*^9, 3.826795043376338*^9}, {3.826797114214205*^9, 
   3.8267971636771173`*^9}, {3.826797218811521*^9, 3.8267972218660135`*^9}, {
   3.8267972801211185`*^9, 3.8267974852157164`*^9}, {3.82679796423184*^9, 
   3.82679796810795*^9}, {3.826798030416317*^9, 3.826798032427948*^9}, {
   3.8267980876243987`*^9, 3.8267981382221518`*^9}, {3.826798183151971*^9, 
   3.826798234500963*^9}, {3.826798406143292*^9, 3.826798407174467*^9}, {
   3.826963946306717*^9, 3.826963946536043*^9}},
 Background->RGBColor[0.94, 0.91, 0.88],
 CellLabel->"In[10]:=",ExpressionUUID->"2bf5306c-8532-48e1-9bed-913a207530de"]
}, Closed]],

Cell[CellGroupData[{

Cell["Solve", "Subsection",
 CellChangeTimes->{{3.823101241444908*^9, 
  3.823101241946697*^9}},ExpressionUUID->"e187a7c1-fb56-49b7-8b08-\
95d6df6c3033"],

Cell[BoxData[
 RowBox[{
  RowBox[{"idSolve", "[", 
   RowBox[{"device_", ",", 
    RowBox[{"randomization_", " ", ":", 
     RowBox[{"{", 
      RowBox[{"1*^-10", ",", "1*^-10", ",", "1*^-10"}], "}"}]}]}], "]"}], ":=", 
  RowBox[{"(", "\[IndentingNewLine]", 
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
      "abs", ",", "rel", ",", "zero", ",", "re", ",", "t0", ",", "t1"}], 
      "}"}], ",", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"t0", "=", 
       RowBox[{"AbsoluteTime", "[", "]"}]}], ";", "\[IndentingNewLine]", 
      "\[IndentingNewLine]", 
      RowBox[{"radFldLenTol", "[", 
       RowBox[{
        RowBox[{"randomization", "[", 
         RowBox[{"[", "1", "]"}], "]"}], ",", 
        RowBox[{"randomization", "[", 
         RowBox[{"[", "2", "]"}], "]"}], ",", 
        RowBox[{"randomization", "[", 
         RowBox[{"[", "3", "]"}], "]"}]}], "]"}], ";", "\[IndentingNewLine]", 
      "\[IndentingNewLine]", 
      RowBox[{"re", "=", 
       RowBox[{"RadSolve", "[", 
        RowBox[{"device", ",", "1*^-10", ",", "100000"}], "]"}]}], ";"}]}], 
    "\[IndentingNewLine]", 
    RowBox[{"(*", 
     RowBox[{
      RowBox[{"t1", "=", 
       RowBox[{"AbsoluteTime", "[", "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"Print", "[", 
       RowBox[{"\"\<> Insertion Device solved: (Elapsed Time: \>\"", ",", 
        RowBox[{"t1", "-", "t0"}], ",", "\"\<[s])\>\""}], "]"}]}], "*)"}], 
    "\[IndentingNewLine]", "]"}], "\[IndentingNewLine]", ")"}]}]], "Input",
 CellChangeTimes->{{3.8231012542546206`*^9, 3.823101475857891*^9}, {
   3.8231015672653685`*^9, 3.8231015836798697`*^9}, {3.823101804028384*^9, 
   3.8231018202029514`*^9}, {3.823101852520878*^9, 3.823101890771188*^9}, {
   3.8236947126690063`*^9, 3.823694713433855*^9}, {3.8236950828901577`*^9, 
   3.8236950831981707`*^9}, {3.8236992735182495`*^9, 
   3.8236992747378654`*^9}, {3.82369995944013*^9, 3.823699960073349*^9}, {
   3.823700548099455*^9, 3.8237005735050817`*^9}, {3.823700729427281*^9, 
   3.8237007325052023`*^9}, {3.8242895354587684`*^9, 3.8242895408484125`*^9}, 
   3.8243780423600035`*^9, {3.8255846021399536`*^9, 3.8255846378394585`*^9}},
 Background->RGBColor[0.94, 0.91, 0.88],
 CellLabel->"In[11]:=",ExpressionUUID->"ad359459-226c-4ccc-ba37-9220ecd108ae"]
}, Closed]],

Cell[CellGroupData[{

Cell["Field Calc", "Subsection",
 CellChangeTimes->{{3.8070274156221814`*^9, 
  3.80702741715819*^9}},ExpressionUUID->"456dd76c-e2a4-4ef8-86e4-\
6176cd841332"],

Cell[BoxData[
 RowBox[{
  RowBox[{"idField", "[", 
   RowBox[{"undulator_", ",", "li_", ",", "lf_", ",", "lNpts_", ",", 
    RowBox[{"{", 
     RowBox[{"posV_", ",", "posH_"}], "}"}], ",", "display_", ",", 
    "oneplot_"}], "]"}], ":=", 
  RowBox[{"(", "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"Module", "[", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{
       "lstep", ",", "t0", ",", "t1", ",", "baxis", ",", "btotal", ",", 
        "axispoints", ",", "plot"}], "}"}], ",", "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"lstep", "=", 
        RowBox[{
         RowBox[{"(", 
          RowBox[{"lf", "-", "li"}], ")"}], "/", "lNpts"}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"t0", "=", 
        RowBox[{"AbsoluteTime", "[", "]"}]}], ";", "\[IndentingNewLine]", 
       "\[IndentingNewLine]", 
       RowBox[{"(*", 
        RowBox[{
         RowBox[{
          RowBox[{"--", 
           RowBox[{"--", 
            RowBox[{"-", " ", "Axis"}]}]}], " ", "Field", " ", 
          RowBox[{
           RowBox[{"Calc", " ", "--"}], "--"}]}], "-"}], "*)"}], 
       "\[IndentingNewLine]", 
       RowBox[{"baxis", "=", 
        RowBox[{"Table", "[", 
         RowBox[{
          RowBox[{"radFld", "[", 
           RowBox[{"undulator", ",", "\"\<b\>\"", ",", 
            RowBox[{"{", 
             RowBox[{"posH", ",", "posV", ",", "z"}], "}"}]}], "]"}], ",", 
          RowBox[{"{", 
           RowBox[{"z", ",", "li", ",", 
            RowBox[{"lf", "-", "lstep"}], ",", "lstep"}], "}"}]}], "]"}]}], 
       ";", "\[IndentingNewLine]", "\[IndentingNewLine]", 
       RowBox[{"t1", "=", 
        RowBox[{"AbsoluteTime", "[", "]"}]}], ";", "\[IndentingNewLine]", 
       RowBox[{"(*", 
        RowBox[{
         RowBox[{"Print", "[", 
          RowBox[{"\"\<> Field Components: (elapsed time: \>\"", ",", 
           RowBox[{"t1", "-", "t0"}], " ", ",", "\"\<[s])\>\""}], "]"}], 
         ";"}], "*)"}], "\[IndentingNewLine]", "\[IndentingNewLine]", 
       RowBox[{"(*", 
        RowBox[{
         RowBox[{"--", 
          RowBox[{"--", 
           RowBox[{"-", " ", 
            RowBox[{
             RowBox[{"Plots", " ", "--"}], "--"}]}]}]}], "-"}], "*)"}], 
       "\[IndentingNewLine]", 
       RowBox[{"If", "[", 
        RowBox[{
         RowBox[{"display", "\[GreaterEqual]", " ", "1"}], ",", 
         "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{"plot", "=", 
           RowBox[{"ConstantArray", "[", 
            RowBox[{
             RowBox[{"{", "}"}], ",", "3"}], "]"}]}], ";", 
          "\[IndentingNewLine]", 
          RowBox[{"(*", 
           RowBox[{"Axis", " ", "Plot"}], "*)"}], "\[IndentingNewLine]", 
          RowBox[{"axispoints", "=", 
           RowBox[{"Table", "[", 
            RowBox[{
             RowBox[{"li", "+", 
              RowBox[{
               RowBox[{"(", 
                RowBox[{"n", "-", "1"}], ")"}], "*", "lstep"}]}], ",", 
             RowBox[{"{", 
              RowBox[{"n", ",", "1", ",", "lNpts"}], "}"}]}], "]"}]}], ";", 
          "\[IndentingNewLine]", 
          RowBox[{
           RowBox[{"plot", "[", 
            RowBox[{"[", "1", "]"}], "]"}], "=", 
           RowBox[{"ListLinePlot", "[", 
            RowBox[{
             RowBox[{"Table", "[", 
              RowBox[{
               RowBox[{"{", 
                RowBox[{
                 RowBox[{"axispoints", "[", 
                  RowBox[{"[", "i", "]"}], "]"}], ",", 
                 RowBox[{"baxis", "[", 
                  RowBox[{"[", 
                   RowBox[{"i", ",", "1"}], "]"}], "]"}]}], "}"}], ",", 
               RowBox[{"{", 
                RowBox[{"i", ",", "1", ",", "lNpts"}], "}"}]}], "]"}], ",", 
             RowBox[{"Frame", "\[Rule]", "True"}], ",", 
             RowBox[{"FrameLabel", "\[Rule]", 
              RowBox[{"{", 
               RowBox[{
                RowBox[{"Style", "[", 
                 RowBox[{"\"\<Z [mm]\>\"", ",", "12"}], "]"}], ",", 
                RowBox[{"Style", "[", 
                 RowBox[{"\"\<Magnetic Field [T]\>\"", ",", "12"}], "]"}]}], 
               "}"}]}], ",", 
             RowBox[{"PlotTheme", "\[Rule]", "\"\<Detailed\>\""}], ",", 
             RowBox[{"ImageSize", "\[Rule]", "Medium"}], ",", 
             RowBox[{"PlotRange", "\[Rule]", "All"}], ",", 
             RowBox[{"PlotLegends", "\[Rule]", 
              RowBox[{"Placed", "[", 
               RowBox[{
                RowBox[{"{", "\"\<Bx\>\"", "}"}], ",", "Above"}], "]"}]}]}], 
            "]"}]}], ";", "\[IndentingNewLine]", 
          RowBox[{
           RowBox[{"plot", "[", 
            RowBox[{"[", "2", "]"}], "]"}], "=", 
           RowBox[{"ListLinePlot", "[", 
            RowBox[{
             RowBox[{"Table", "[", 
              RowBox[{
               RowBox[{"{", 
                RowBox[{
                 RowBox[{"axispoints", "[", 
                  RowBox[{"[", "i", "]"}], "]"}], ",", 
                 RowBox[{"baxis", "[", 
                  RowBox[{"[", 
                   RowBox[{"i", ",", "2"}], "]"}], "]"}]}], "}"}], ",", 
               RowBox[{"{", 
                RowBox[{"i", ",", "1", ",", "lNpts"}], "}"}]}], "]"}], ",", 
             RowBox[{"Frame", "\[Rule]", "True"}], ",", 
             RowBox[{"FrameLabel", "\[Rule]", 
              RowBox[{"{", 
               RowBox[{
                RowBox[{"Style", "[", 
                 RowBox[{"\"\<Z [mm]\>\"", ",", "12"}], "]"}], ",", 
                RowBox[{"Style", "[", 
                 RowBox[{"\"\<Magnetic Field [T]\>\"", ",", "12"}], "]"}]}], 
               "}"}]}], ",", 
             RowBox[{"PlotTheme", "\[Rule]", "\"\<Detailed\>\""}], ",", 
             RowBox[{"PlotStyle", "\[Rule]", 
              RowBox[{"{", "Orange", "}"}]}], ",", 
             RowBox[{"ImageSize", "\[Rule]", "Medium"}], ",", 
             RowBox[{"PlotRange", "\[Rule]", "All"}], ",", 
             RowBox[{"PlotLegends", "\[Rule]", 
              RowBox[{"Placed", "[", 
               RowBox[{
                RowBox[{"{", "\"\<By\>\"", "}"}], ",", "Above"}], "]"}]}]}], 
            "]"}]}], ";", "\[IndentingNewLine]", 
          RowBox[{
           RowBox[{"plot", "[", 
            RowBox[{"[", "3", "]"}], "]"}], "=", 
           RowBox[{"ListLinePlot", "[", 
            RowBox[{
             RowBox[{"Table", "[", 
              RowBox[{
               RowBox[{"{", 
                RowBox[{
                 RowBox[{"axispoints", "[", 
                  RowBox[{"[", "i", "]"}], "]"}], ",", 
                 RowBox[{"baxis", "[", 
                  RowBox[{"[", 
                   RowBox[{"i", ",", "3"}], "]"}], "]"}]}], "}"}], ",", 
               RowBox[{"{", 
                RowBox[{"i", ",", "1", ",", "lNpts"}], "}"}]}], "]"}], ",", 
             RowBox[{"Frame", "\[Rule]", "True"}], ",", 
             RowBox[{"FrameLabel", "\[Rule]", 
              RowBox[{"{", 
               RowBox[{
                RowBox[{"Style", "[", 
                 RowBox[{"\"\<Z [mm]\>\"", ",", "12"}], "]"}], ",", 
                RowBox[{"Style", "[", 
                 RowBox[{"\"\<Magnetic Field [T]\>\"", ",", "12"}], "]"}]}], 
               "}"}]}], ",", 
             RowBox[{"PlotTheme", "\[Rule]", "\"\<Detailed\>\""}], ",", 
             RowBox[{"PlotStyle", "\[Rule]", 
              RowBox[{"{", "Green", "}"}]}], ",", 
             RowBox[{"ImageSize", "\[Rule]", "Medium"}], ",", 
             RowBox[{"PlotRange", "\[Rule]", "All"}], ",", 
             RowBox[{"PlotLegends", "\[Rule]", 
              RowBox[{"Placed", "[", 
               RowBox[{
                RowBox[{"{", "\"\<Bz\>\"", "}"}], ",", "Above"}], "]"}]}]}], 
            "]"}]}], ";", "\[IndentingNewLine]", "\[IndentingNewLine]", 
          RowBox[{"If", "[", 
           RowBox[{
            RowBox[{"oneplot", "\[GreaterEqual]", "1"}], ",", 
            "\[IndentingNewLine]", 
            RowBox[{
             RowBox[{"maxims", "=", 
              RowBox[{"Table", "[", 
               RowBox[{
                RowBox[{"{", 
                 RowBox[{"i", ",", 
                  RowBox[{"Max", "[", 
                   RowBox[{"baxis", "[", 
                    RowBox[{"[", 
                    RowBox[{"All", ",", "i"}], "]"}], "]"}], "]"}]}], "}"}], 
                ",", 
                RowBox[{"{", 
                 RowBox[{"i", ",", "1", ",", "3"}], "}"}]}], "]"}]}], ";", 
             "\[IndentingNewLine]", 
             RowBox[{"plotOrder", "=", 
              RowBox[{"SortBy", "[", 
               RowBox[{"maxims", ",", "Last"}], "]"}]}], ";", 
             "\[IndentingNewLine]", 
             RowBox[{"Print", "[", 
              RowBox[{"Show", "[", 
               RowBox[{"Table", "[", 
                RowBox[{
                 RowBox[{"plot", "[", 
                  RowBox[{"[", 
                   RowBox[{"plotOrder", "[", 
                    RowBox[{"[", 
                    RowBox[{
                    RowBox[{"-", "i"}], ",", "1"}], "]"}], "]"}], "]"}], 
                  "]"}], ",", 
                 RowBox[{"{", 
                  RowBox[{"i", ",", "1", ",", "3"}], "}"}]}], "]"}], "]"}], 
              "]"}], ";"}], "\[IndentingNewLine]", ",", "\[IndentingNewLine]", 
            RowBox[{
             RowBox[{"Print", "[", 
              RowBox[{"GraphicsRow", "[", 
               RowBox[{
                RowBox[{"{", 
                 RowBox[{
                  RowBox[{"plot", "[", 
                   RowBox[{"[", "1", "]"}], "]"}], ",", 
                  RowBox[{"plot", "[", 
                   RowBox[{"[", "2", "]"}], "]"}], ",", 
                  RowBox[{"plot", "[", 
                   RowBox[{"[", "3", "]"}], "]"}]}], "}"}], ",", 
                RowBox[{"Spacings", "\[Rule]", 
                 RowBox[{"{", 
                  RowBox[{"0", ",", "10"}], "}"}]}], ",", 
                RowBox[{"ImageSize", "\[Rule]", 
                 RowBox[{"{", 
                  RowBox[{"1200", ",", "300"}], "}"}]}], ",", 
                RowBox[{"AspectRatio", "\[Rule]", "Full"}]}], "]"}], "]"}], 
             ";"}]}], "\[IndentingNewLine]", "]"}], ";"}]}], 
        "\[IndentingNewLine]", "]"}], ";", "\[IndentingNewLine]", 
       "\[IndentingNewLine]", 
       RowBox[{"Return", "[", "baxis", "]"}]}]}], "\[IndentingNewLine]", 
     "]"}], ";"}], "\[IndentingNewLine]", ")"}]}]], "Input",
 CellChangeTimes->{{3.807021601830374*^9, 3.8070216773569517`*^9}, {
   3.807021740669018*^9, 3.8070217427074785`*^9}, {3.8070219464604225`*^9, 
   3.8070219686498995`*^9}, {3.807027460652296*^9, 3.807027544157159*^9}, {
   3.8070276421693325`*^9, 3.8070276425165777`*^9}, {3.8070276912558517`*^9, 
   3.807027704213709*^9}, {3.8070323107786245`*^9, 3.807032375602537*^9}, 
   3.8070327114498105`*^9, {3.807032863171875*^9, 3.8070328649457016`*^9}, {
   3.8070328976293025`*^9, 3.8070328977452354`*^9}, {3.807033015423561*^9, 
   3.807033015762494*^9}, {3.8070333677594614`*^9, 3.807033370758465*^9}, {
   3.8070341000936403`*^9, 3.8070341100237904`*^9}, {3.807034177639553*^9, 
   3.8070341787814217`*^9}, {3.8194469942722526`*^9, 3.819446994522252*^9}, {
   3.8194470278451247`*^9, 3.8194470523151627`*^9}, {3.8194674188594513`*^9, 
   3.8194674192906275`*^9}, {3.8195394042588143`*^9, 3.819539434664993*^9}, {
   3.8231870748067555`*^9, 3.8231870801366234`*^9}, {3.823187314238055*^9, 
   3.8231873210731883`*^9}, {3.8231873536805687`*^9, 
   3.8231873840152335`*^9}, {3.823187417400039*^9, 3.823187517278927*^9}, {
   3.823187552114496*^9, 3.823187563147745*^9}, {3.82318760058611*^9, 
   3.8231876260825243`*^9}, {3.8231877078144464`*^9, 3.823187725129961*^9}, {
   3.8231879045592556`*^9, 3.823187931896818*^9}, {3.8232513833748417`*^9, 
   3.8232514195547705`*^9}, {3.823251497810341*^9, 3.8232514994936705`*^9}, {
   3.8232515364914045`*^9, 3.823251597789898*^9}, 3.823591182639825*^9, {
   3.8236878454585176`*^9, 3.823687854520048*^9}, 3.823694762646657*^9, 
   3.8236962514318132`*^9, {3.823696360981367*^9, 3.823696480996597*^9}, {
   3.8236965553748913`*^9, 3.8236965670363555`*^9}, 3.8236966216015263`*^9, {
   3.8237043866839724`*^9, 3.823704437544327*^9}, {3.8237045083803515`*^9, 
   3.8237045826236615`*^9}, {3.8237046303449583`*^9, 3.8237046307197495`*^9}, 
   3.8237046806966157`*^9, {3.8237047552280135`*^9, 3.8237048088535647`*^9}, {
   3.8237049077224045`*^9, 3.823704942624758*^9}, {3.8237049756552896`*^9, 
   3.823705086703352*^9}, {3.823705206613536*^9, 3.823705263296739*^9}, {
   3.823705347657188*^9, 3.823705353686869*^9}, {3.8237053977027655`*^9, 
   3.8237053995608683`*^9}, {3.823705438733055*^9, 3.823705520061475*^9}, {
   3.8237056668621016`*^9, 3.823705739843643*^9}, {3.8237062931455593`*^9, 
   3.8237063045510206`*^9}, 3.8243780575048585`*^9, {3.824560310124625*^9, 
   3.8245603368090415`*^9}},
 Background->RGBColor[0.94, 0.91, 0.88],
 CellLabel->"In[12]:=",ExpressionUUID->"a77a965c-239d-42f0-a8bc-503da44027b9"]
}, Closed]],

Cell[CellGroupData[{

Cell["Field Integral", "Subsection",
 CellChangeTimes->{{3.814026445667639*^9, 3.814026469231636*^9}, {
  3.8233349297908735`*^9, 3.823334930948099*^9}, {3.823340078829421*^9, 
  3.823340079713853*^9}},ExpressionUUID->"153839d6-64df-4378-ac05-\
c78dbe1ab363"],

Cell[BoxData[
 RowBox[{
  RowBox[{"idFieldInt", "[", 
   RowBox[{
   "undulator_", ",", "li_", ",", "lf_", ",", "lstep_", ",", "baxis_", ",", 
    "display_", ",", "oneplot_"}], "]"}], ":=", 
  RowBox[{"(", "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"Module", "[", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{
       "i", ",", "dz", ",", "area", ",", "area2", ",", "integral", ",", 
        "integral2", ",", "firstInt", ",", "secondInt", ",", "axispoints", 
        ",", "plot", ",", "t0", ",", "t1"}], "}"}], ",", 
      "\[IndentingNewLine]", 
      RowBox[{"(*", 
       RowBox[{
        RowBox[{
         RowBox[{"--", 
          RowBox[{"--", 
           RowBox[{"-", " ", "First"}]}]}], " ", 
         RowBox[{
          RowBox[{"Integral", " ", "--"}], "--"}]}], "-"}], "*)"}], 
      "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"t0", "=", 
        RowBox[{"AbsoluteTime", "[", "]"}]}], ";", "\[IndentingNewLine]", 
       RowBox[{"dz", "=", "lstep"}], ";", "\[IndentingNewLine]", 
       "\[IndentingNewLine]", 
       RowBox[{"area", "=", 
        RowBox[{"Table", "[", 
         RowBox[{
          RowBox[{"{", 
           RowBox[{
            RowBox[{
             RowBox[{
              RowBox[{"(", 
               RowBox[{
                RowBox[{"baxis", "[", 
                 RowBox[{"[", 
                  RowBox[{"i", ",", "1"}], "]"}], "]"}], "+", 
                RowBox[{"baxis", "[", 
                 RowBox[{"[", 
                  RowBox[{
                   RowBox[{"i", "+", "1"}], ",", "1"}], "]"}], "]"}]}], ")"}],
               "/", "2"}], "*", "dz"}], ",", 
            RowBox[{
             RowBox[{
              RowBox[{"(", 
               RowBox[{
                RowBox[{"baxis", "[", 
                 RowBox[{"[", 
                  RowBox[{"i", ",", "2"}], "]"}], "]"}], "+", 
                RowBox[{"baxis", "[", 
                 RowBox[{"[", 
                  RowBox[{
                   RowBox[{"i", "+", "1"}], ",", "2"}], "]"}], "]"}]}], ")"}],
               "/", "2"}], "*", "dz"}], ",", 
            RowBox[{
             RowBox[{
              RowBox[{"(", 
               RowBox[{
                RowBox[{"baxis", "[", 
                 RowBox[{"[", 
                  RowBox[{"i", ",", "3"}], "]"}], "]"}], "+", 
                RowBox[{"baxis", "[", 
                 RowBox[{"[", 
                  RowBox[{
                   RowBox[{"i", "+", "1"}], ",", "3"}], "]"}], "]"}]}], ")"}],
               "/", "2"}], "*", "dz"}]}], "}"}], ",", 
          RowBox[{"{", 
           RowBox[{"i", ",", "1", ",", 
            RowBox[{
             RowBox[{"Length", "[", "baxis", "]"}], "-", "1"}]}], "}"}]}], 
         "]"}]}], ";", "\[IndentingNewLine]", 
       RowBox[{"integral", "=", 
        RowBox[{"Accumulate", "[", "area", "]"}]}], ";", " ", 
       RowBox[{"(*", 
        RowBox[{"T", ".", "mm"}], "*)"}], "\[IndentingNewLine]", 
       RowBox[{"firstInt", "=", 
        RowBox[{"integral", "*", 
         RowBox[{
          RowBox[{"10", "^", "4"}], "/", "10"}]}]}], " ", ";", 
       RowBox[{"(*", 
        RowBox[{"G", ".", "cm"}], "*)"}], "\[IndentingNewLine]", 
       "\[IndentingNewLine]", 
       RowBox[{"(*", 
        RowBox[{
         RowBox[{
          RowBox[{"--", 
           RowBox[{"--", 
            RowBox[{"-", " ", "Second"}]}]}], " ", 
          RowBox[{
           RowBox[{"Integral", " ", "--"}], "--"}]}], "-"}], "*)"}], 
       "\[IndentingNewLine]", 
       RowBox[{"area2", "=", 
        RowBox[{"Table", "[", 
         RowBox[{
          RowBox[{"{", 
           RowBox[{
            RowBox[{
             RowBox[{
              RowBox[{"(", 
               RowBox[{
                RowBox[{"integral", "[", 
                 RowBox[{"[", 
                  RowBox[{"i", ",", "1"}], "]"}], "]"}], "+", 
                RowBox[{"integral", "[", 
                 RowBox[{"[", 
                  RowBox[{
                   RowBox[{"i", "+", "1"}], ",", "1"}], "]"}], "]"}]}], ")"}],
               "/", "2"}], "*", "dz"}], ",", 
            RowBox[{
             RowBox[{
              RowBox[{"(", 
               RowBox[{
                RowBox[{"integral", "[", 
                 RowBox[{"[", 
                  RowBox[{"i", ",", "2"}], "]"}], "]"}], "+", 
                RowBox[{"integral", "[", 
                 RowBox[{"[", 
                  RowBox[{
                   RowBox[{"i", "+", "1"}], ",", "2"}], "]"}], "]"}]}], ")"}],
               "/", "2"}], "*", "dz"}], ",", 
            RowBox[{
             RowBox[{
              RowBox[{"(", 
               RowBox[{
                RowBox[{"integral", "[", 
                 RowBox[{"[", 
                  RowBox[{"i", ",", "3"}], "]"}], "]"}], "+", 
                RowBox[{"integral", "[", 
                 RowBox[{"[", 
                  RowBox[{
                   RowBox[{"i", "+", "1"}], ",", "3"}], "]"}], "]"}]}], ")"}],
               "/", "2"}], "*", "dz"}]}], "}"}], ",", 
          RowBox[{"{", 
           RowBox[{"i", ",", "1", ",", 
            RowBox[{
             RowBox[{"Length", "[", "integral", "]"}], "-", "1"}]}], "}"}]}], 
         "]"}]}], ";", "\[IndentingNewLine]", 
       RowBox[{"integral2", "=", 
        RowBox[{"Accumulate", "[", "area2", "]"}]}], ";", 
       RowBox[{"(*", 
        RowBox[{"T", ".", "mm\.b2"}], "*)"}], "\[IndentingNewLine]", 
       RowBox[{"secondInt", "=", 
        RowBox[{
         RowBox[{"(", 
          RowBox[{"integral2", "*", 
           RowBox[{
            RowBox[{"10", "^", "4"}], "/", "100"}]}], ")"}], "/", "1000"}]}], 
       ";", " ", 
       RowBox[{"(*", 
        RowBox[{"kG", ".", "cm\.b2"}], "*)"}], "\[IndentingNewLine]", 
       "\[IndentingNewLine]", 
       RowBox[{"t1", "=", 
        RowBox[{"AbsoluteTime", "[", "]"}]}], ";", "\[IndentingNewLine]", 
       "\[IndentingNewLine]", 
       RowBox[{"(*", 
        RowBox[{
         RowBox[{"Print", "[", 
          RowBox[{"\"\<> Field Integrals: elapsed time = \>\"", ",", 
           RowBox[{"(", 
            RowBox[{"t1", "-", "t0"}], ")"}], ",", "\"\< [s]\>\""}], "]"}], 
         ";"}], "*)"}], "\[IndentingNewLine]", "\[IndentingNewLine]", 
       RowBox[{"(*", 
        RowBox[{
         RowBox[{"Print", "[", 
          RowBox[{"\"\<First integrals : \>\"", ",", " ", 
           RowBox[{"firstInt", "[", 
            RowBox[{"[", 
             RowBox[{"-", "1"}], "]"}], "]"}], ",", "\"\< [G.cm]\>\""}], 
          "]"}], ";", "\[IndentingNewLine]", 
         RowBox[{"Print", "[", 
          RowBox[{"\"\<Second integrals : \>\"", ",", " ", 
           RowBox[{"secondInt", "[", 
            RowBox[{"[", 
             RowBox[{"-", "1"}], "]"}], "]"}], ",", "\"\< [kG.cm\.b2]\>\""}], 
          "]"}], ";"}], "*)"}], "\[IndentingNewLine]", "\[IndentingNewLine]", 
       RowBox[{"(*", 
        RowBox[{
         RowBox[{"--", 
          RowBox[{"--", 
           RowBox[{"-", " ", 
            RowBox[{
             RowBox[{"Plots", " ", "--"}], "--"}]}]}]}], "-"}], "*)"}], 
       "\[IndentingNewLine]", 
       RowBox[{"If", "[", 
        RowBox[{
         RowBox[{"display", "\[GreaterEqual]", " ", "1"}], ",", 
         "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{"plot", "=", 
           RowBox[{"ConstantArray", "[", 
            RowBox[{
             RowBox[{"{", "}"}], ",", "3"}], "]"}]}], ";", 
          "\[IndentingNewLine]", 
          RowBox[{"axispoints", "=", 
           RowBox[{"Table", "[", 
            RowBox[{
             RowBox[{
              RowBox[{"(", 
               RowBox[{"li", "+", 
                RowBox[{"lstep", "/", "2"}]}], ")"}], "+", 
              RowBox[{
               RowBox[{"(", 
                RowBox[{"n", "-", "1"}], ")"}], "*", "lstep"}]}], ",", 
             RowBox[{"{", 
              RowBox[{"n", ",", "1", ",", 
               RowBox[{
                RowBox[{"Length", "[", "baxis", "]"}], "-", "1"}]}], "}"}]}], 
            "]"}]}], ";", "\[IndentingNewLine]", "\[IndentingNewLine]", 
          RowBox[{
           RowBox[{"plot", "[", 
            RowBox[{"[", "1", "]"}], "]"}], "=", 
           RowBox[{"ListLinePlot", "[", 
            RowBox[{
             RowBox[{"Table", "[", 
              RowBox[{
               RowBox[{"{", 
                RowBox[{
                 RowBox[{"axispoints", "[", 
                  RowBox[{"[", "i", "]"}], "]"}], ",", 
                 RowBox[{"firstInt", "[", 
                  RowBox[{"[", 
                   RowBox[{"i", ",", "1"}], "]"}], "]"}]}], "}"}], ",", 
               RowBox[{"{", 
                RowBox[{"i", ",", "1", ",", 
                 RowBox[{"Length", "[", "firstInt", "]"}]}], "}"}]}], "]"}], 
             ",", 
             RowBox[{"Frame", "\[Rule]", "True"}], ",", 
             RowBox[{"FrameLabel", "\[Rule]", 
              RowBox[{"{", 
               RowBox[{
                RowBox[{"Style", "[", 
                 RowBox[{"\"\<Z [mm]\>\"", ",", "12"}], "]"}], ",", 
                RowBox[{"Style", "[", 
                 RowBox[{"\"\<Field Integral [G.cm]\>\"", ",", "12"}], 
                 "]"}]}], "}"}]}], ",", 
             RowBox[{"PlotTheme", "\[Rule]", "\"\<Detailed\>\""}], ",", 
             RowBox[{"ImageSize", "\[Rule]", "Medium"}], ",", 
             RowBox[{"PlotLegends", "\[Rule]", 
              RowBox[{"Placed", "[", 
               RowBox[{
                RowBox[{"{", "\"\<Bx\>\"", "}"}], ",", "Above"}], "]"}]}]}], 
            "]"}]}], ";", "\[IndentingNewLine]", 
          RowBox[{
           RowBox[{"plot", "[", 
            RowBox[{"[", "2", "]"}], "]"}], "=", 
           RowBox[{"ListLinePlot", "[", 
            RowBox[{
             RowBox[{"Table", "[", 
              RowBox[{
               RowBox[{"{", 
                RowBox[{
                 RowBox[{"axispoints", "[", 
                  RowBox[{"[", "i", "]"}], "]"}], ",", 
                 RowBox[{"firstInt", "[", 
                  RowBox[{"[", 
                   RowBox[{"i", ",", "2"}], "]"}], "]"}]}], "}"}], ",", 
               RowBox[{"{", 
                RowBox[{"i", ",", "1", ",", 
                 RowBox[{"Length", "[", "firstInt", "]"}]}], "}"}]}], "]"}], 
             ",", 
             RowBox[{"Frame", "\[Rule]", "True"}], ",", 
             RowBox[{"FrameLabel", "\[Rule]", 
              RowBox[{"{", 
               RowBox[{
                RowBox[{"Style", "[", 
                 RowBox[{"\"\<Z [mm]\>\"", ",", "12"}], "]"}], ",", 
                RowBox[{"Style", "[", 
                 RowBox[{"\"\<Field integral [G.cm]\>\"", ",", "12"}], 
                 "]"}]}], "}"}]}], ",", 
             RowBox[{"PlotTheme", "\[Rule]", "\"\<Detailed\>\""}], ",", 
             RowBox[{"PlotStyle", "\[Rule]", 
              RowBox[{"{", "Orange", "}"}]}], ",", 
             RowBox[{"ImageSize", "\[Rule]", "Medium"}], ",", 
             RowBox[{"PlotLegends", "\[Rule]", 
              RowBox[{"Placed", "[", 
               RowBox[{
                RowBox[{"{", "\"\<By\>\"", "}"}], ",", "Above"}], "]"}]}]}], 
            "]"}]}], ";", "\[IndentingNewLine]", 
          RowBox[{
           RowBox[{"plot", "[", 
            RowBox[{"[", "3", "]"}], "]"}], "=", 
           RowBox[{"ListLinePlot", "[", 
            RowBox[{
             RowBox[{"Table", "[", 
              RowBox[{
               RowBox[{"{", 
                RowBox[{
                 RowBox[{"axispoints", "[", 
                  RowBox[{"[", "i", "]"}], "]"}], ",", 
                 RowBox[{"firstInt", "[", 
                  RowBox[{"[", 
                   RowBox[{"i", ",", "3"}], "]"}], "]"}]}], "}"}], ",", 
               RowBox[{"{", 
                RowBox[{"i", ",", "1", ",", 
                 RowBox[{"Length", "[", "firstInt", "]"}]}], "}"}]}], "]"}], 
             ",", 
             RowBox[{"Frame", "\[Rule]", "True"}], ",", 
             RowBox[{"FrameLabel", "\[Rule]", 
              RowBox[{"{", 
               RowBox[{
                RowBox[{"Style", "[", 
                 RowBox[{"\"\<Z [mm]\>\"", ",", "12"}], "]"}], ",", 
                RowBox[{"Style", "[", 
                 RowBox[{"\"\<Field integral [G.cm]\>\"", ",", "12"}], 
                 "]"}]}], "}"}]}], ",", 
             RowBox[{"PlotTheme", "\[Rule]", "\"\<Detailed\>\""}], ",", 
             RowBox[{"PlotStyle", "\[Rule]", 
              RowBox[{"{", "Green", "}"}]}], ",", 
             RowBox[{"ImageSize", "\[Rule]", "Medium"}], ",", 
             RowBox[{"PlotLegends", "\[Rule]", 
              RowBox[{"Placed", "[", 
               RowBox[{
                RowBox[{"{", "\"\<Bz\>\"", "}"}], ",", "Above"}], "]"}]}]}], 
            "]"}]}], ";", "\[IndentingNewLine]", "\[IndentingNewLine]", 
          RowBox[{"If", "[", 
           RowBox[{
            RowBox[{"oneplot", "\[GreaterEqual]", "1"}], ",", 
            "\[IndentingNewLine]", 
            RowBox[{
             RowBox[{"maxims", "=", 
              RowBox[{"Table", "[", 
               RowBox[{
                RowBox[{"{", 
                 RowBox[{"i", ",", 
                  RowBox[{"Max", "[", 
                   RowBox[{"firstInt", "[", 
                    RowBox[{"[", 
                    RowBox[{"All", ",", "i"}], "]"}], "]"}], "]"}]}], "}"}], 
                ",", 
                RowBox[{"{", 
                 RowBox[{"i", ",", "1", ",", "3"}], "}"}]}], "]"}]}], ";", 
             "\[IndentingNewLine]", 
             RowBox[{"plotOrder", "=", 
              RowBox[{"SortBy", "[", 
               RowBox[{"maxims", ",", "Last"}], "]"}]}], ";", 
             "\[IndentingNewLine]", 
             RowBox[{"Print", "[", 
              RowBox[{"Show", "[", 
               RowBox[{"Table", "[", 
                RowBox[{
                 RowBox[{"plot", "[", 
                  RowBox[{"[", 
                   RowBox[{"plotOrder", "[", 
                    RowBox[{"[", 
                    RowBox[{
                    RowBox[{"-", "i"}], ",", "1"}], "]"}], "]"}], "]"}], 
                  "]"}], ",", 
                 RowBox[{"{", 
                  RowBox[{"i", ",", "1", ",", "3"}], "}"}]}], "]"}], "]"}], 
              "]"}], ";"}], "\[IndentingNewLine]", ",", "\[IndentingNewLine]", 
            RowBox[{
             RowBox[{"Print", "[", 
              RowBox[{"GraphicsRow", "[", 
               RowBox[{"plot", ",", 
                RowBox[{"Spacings", "\[Rule]", 
                 RowBox[{"{", 
                  RowBox[{"0", ",", "10"}], "}"}]}], ",", 
                RowBox[{"ImageSize", "\[Rule]", 
                 RowBox[{"{", 
                  RowBox[{"1200", ",", "300"}], "}"}]}], ",", 
                RowBox[{"AspectRatio", "\[Rule]", "Full"}]}], "]"}], "]"}], 
             ";"}]}], "\[IndentingNewLine]", "]"}], ";"}]}], 
        "\[IndentingNewLine]", "]"}], ";", "\[IndentingNewLine]", 
       "\[IndentingNewLine]", 
       RowBox[{"Return", "[", 
        RowBox[{"{", 
         RowBox[{"firstInt", ",", "secondInt"}], "}"}], "]"}]}]}], 
     "\[IndentingNewLine]", "]"}], ";"}], "\[IndentingNewLine]", 
   ")"}]}]], "Input",
 CellChangeTimes->{{3.8140831822358985`*^9, 3.8140831876421633`*^9}, {
   3.814086465640315*^9, 3.8140865066842995`*^9}, {3.8140865964970884`*^9, 
   3.8140865981532955`*^9}, {3.814086641081032*^9, 3.814086745326576*^9}, {
   3.814091940740308*^9, 3.81409216828543*^9}, {3.8140922070042057`*^9, 
   3.814092211910432*^9}, {3.8140922845491157`*^9, 3.81409229812846*^9}, {
   3.8140923644442186`*^9, 3.814092402186119*^9}, {3.814092442050935*^9, 
   3.8140925391396513`*^9}, {3.8140925886417274`*^9, 3.814092786016214*^9}, {
   3.814092830172215*^9, 3.814092831750367*^9}, {3.8140989604331417`*^9, 
   3.8140990283194375`*^9}, {3.8141904990742135`*^9, 
   3.8141905074645224`*^9}, {3.8141905462993636`*^9, 3.814190576361436*^9}, {
   3.818847692695892*^9, 3.818847728759572*^9}, {3.818847799042203*^9, 
   3.818847821133772*^9}, {3.81955032845391*^9, 3.8195503504551272`*^9}, 
   3.8195504519073086`*^9, {3.819550526202839*^9, 3.819550526890369*^9}, 
   3.820662992112262*^9, {3.8232580185147114`*^9, 3.8232580213808613`*^9}, {
   3.8233345165429583`*^9, 3.8233345209211493`*^9}, {3.823334659889905*^9, 
   3.823334733835789*^9}, {3.82333476894271*^9, 3.823334801012831*^9}, {
   3.823334869528743*^9, 3.8233349144518986`*^9}, {3.82333494728961*^9, 
   3.8233349479068537`*^9}, {3.8233349789943514`*^9, 3.823335018022991*^9}, {
   3.8233350527305984`*^9, 3.823335090140766*^9}, {3.823335165354349*^9, 
   3.823335166820796*^9}, {3.8233352039459114`*^9, 3.823335258897461*^9}, {
   3.823335300779319*^9, 3.8233353011492014`*^9}, 3.8233361506222687`*^9, {
   3.8233363710789537`*^9, 3.8233363736177607`*^9}, {3.823338572724375*^9, 
   3.8233387668264074`*^9}, {3.823340224739589*^9, 3.823340231024663*^9}, {
   3.8233431300198727`*^9, 3.823343132608755*^9}, {3.8233437850270348`*^9, 
   3.8233437857604227`*^9}, {3.82334389459583*^9, 3.823343937511688*^9}, {
   3.8233440492960243`*^9, 3.8233440594352922`*^9}, 3.823678669078288*^9, {
   3.82368779374298*^9, 3.823687804359678*^9}, 3.823694798563027*^9, {
   3.8236949090853324`*^9, 3.8236949097027383`*^9}, 3.823696675945222*^9, {
   3.8236967476201906`*^9, 3.8236967643927984`*^9}, 3.8237022017126327`*^9, {
   3.8237023062168875`*^9, 3.823702307791808*^9}, {3.8237027123281775`*^9, 
   3.823702847650258*^9}, {3.8237028995525503`*^9, 3.823702980286729*^9}, {
   3.823703014403739*^9, 3.82370313180005*^9}, {3.8237031629721427`*^9, 
   3.8237032327293696`*^9}, {3.8237048869268303`*^9, 
   3.8237048872965193`*^9}, {3.823705908630597*^9, 3.823705922049883*^9}, {
   3.823705953270815*^9, 3.8237061057848186`*^9}, {3.8237061415715723`*^9, 
   3.8237061899482*^9}, {3.8237062408564777`*^9, 3.8237062757072315`*^9}, {
   3.8237065148813705`*^9, 3.8237065187673683`*^9}, {3.8237066527201214`*^9, 
   3.823706661287065*^9}, {3.823707024443328*^9, 3.823707026124913*^9}, {
   3.8237072395921*^9, 3.8237073522592216`*^9}, 3.8242895932247677`*^9, 
   3.824378065819078*^9},
 Background->RGBColor[0.94, 0.91, 0.88],
 CellLabel->"In[13]:=",ExpressionUUID->"e6616d7c-5b5d-459b-a0bf-0a282548b342"]
}, Closed]],

Cell[CellGroupData[{

Cell["Trajectory - RungeKutta4", "Subsection",
 CellChangeTimes->{{3.822492471052125*^9, 3.822492484522397*^9}, {
  3.823354560814218*^9, 
  3.8233545659300737`*^9}},ExpressionUUID->"9387d8cc-8345-48fd-a555-\
31005097a6da"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"idTrajectory", "::", "usage"}], " ", "=", " ", 
    "\"\<IDRungeKuttaTrajectory[device, energy, r0, smax, rkstep]: Calculates \
the particle trajectory using the Runge-Kutta algorithm. The particle energy \
must be in GeV, r0 is the initial position and normalized momentum vector \
{x0, y0, z0, dx0ds, dy0ds, dz0ds}, smax and rkstep are the final longitudinal \
position and the Runge-Kutta step. All positions are in millimeters.\>\""}], 
   ";"}], "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"idTrajectory", "[", 
    RowBox[{
    "device_", ",", " ", "energy_", ",", "r0_", ",", "smax_", ",", "rkstep_", 
     ",", "display_"}], "]"}], " ", ":=", " ", 
   RowBox[{"Module", "[", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
      "trajectory", ",", " ", "ElectronRestEnergy", ",", " ", "LightSpeed", 
       ",", " ", "beta", ",", " ", "brho", ",", " ", "a", ",", " ", "b", ",", 
       " ", "b1", ",", " ", "b2", ",", " ", "b3", ",", " ", "r", ",", "rp", 
       ",", " ", "r1", ",", " ", "r2", ",", " ", "r3", ",", " ", "drds1", ",",
        " ", "drds2", ",", " ", "drds3", ",", " ", "drds4", ",", " ", "i", 
       ",", " ", "sm", ",", " ", "step", ",", " ", "t0", ",", " ", "t1", ",", 
       "p1", ",", "p2"}], "}"}], ",", "\n", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"t0", "=", 
       RowBox[{"AbsoluteTime", "[", "]"}]}], ";", "\[IndentingNewLine]", 
      "\[IndentingNewLine]", 
      RowBox[{"ElectronRestEnergy", "=", "510998.92811"}], ";", " ", 
      RowBox[{"(*", 
       RowBox[{"[", "eV", "]"}], "*)"}], "\[IndentingNewLine]", 
      RowBox[{"LightSpeed", "=", "299792458"}], ";", 
      RowBox[{"(*", 
       RowBox[{"[", 
        RowBox[{"m", "/", "s"}], "]"}], "*)"}], "\[IndentingNewLine]", 
      "\[IndentingNewLine]", 
      RowBox[{"beta", "=", 
       RowBox[{"Sqrt", "[", 
        RowBox[{"1.0", "-", 
         RowBox[{"(", 
          RowBox[{"1.0", "/", 
           RowBox[{"(", 
            RowBox[{
             RowBox[{"(", 
              RowBox[{"energy", "*", 
               RowBox[{"1000000000", "/", "ElectronRestEnergy"}]}], ")"}], 
             "^", "2"}], ")"}]}], ")"}]}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"brho", "=", 
       RowBox[{"(", 
        RowBox[{"beta", "*", "energy", "*", 
         RowBox[{"1000000000", "/", "LightSpeed"}]}], ")"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"a", "=", 
       RowBox[{"1.0", "/", "brho"}]}], ";", "\[IndentingNewLine]", 
      "\[IndentingNewLine]", 
      RowBox[{"r1", " ", "=", " ", 
       RowBox[{"{", 
        RowBox[{"0", ",", "0", ",", "0", ",", "0", ",", "0", ",", "0"}], 
        "}"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"r2", " ", "=", " ", 
       RowBox[{"{", 
        RowBox[{"0", ",", "0", ",", "0", ",", "0", ",", "0", ",", "0"}], 
        "}"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"r3", " ", "=", " ", 
       RowBox[{"{", 
        RowBox[{"0", ",", "0", ",", "0", ",", "0", ",", "0", ",", "0"}], 
        "}"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"r", "=", " ", "r0"}], ";", "\[IndentingNewLine]", 
      "\[IndentingNewLine]", 
      RowBox[{"(*", 
       RowBox[{"from", " ", "mm", " ", "to", " ", "m"}], "*)"}], 
      "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"r", "[", 
        RowBox[{"[", "1", "]"}], "]"}], "=", " ", 
       RowBox[{
        RowBox[{"r", "[", 
         RowBox[{"[", "1", "]"}], "]"}], "/", "1000"}]}], ";", " ", 
      RowBox[{
       RowBox[{"r", "[", 
        RowBox[{"[", "2", "]"}], "]"}], "=", " ", 
       RowBox[{
        RowBox[{"r", "[", 
         RowBox[{"[", "2", "]"}], "]"}], "/", "1000"}]}], ";", " ", 
      RowBox[{
       RowBox[{"r", "[", 
        RowBox[{"[", "3", "]"}], "]"}], "=", " ", 
       RowBox[{
        RowBox[{"r", "[", 
         RowBox[{"[", "3", "]"}], "]"}], "/", "1000"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"sm", " ", "=", " ", 
       RowBox[{"smax", "/", "1000"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"step", " ", "=", " ", 
       RowBox[{"rkstep", "/", "1000"}]}], ";", "\[IndentingNewLine]", 
      "\[IndentingNewLine]", 
      RowBox[{"trajectory", "=", 
       RowBox[{"{", "}"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"AppendTo", "[", 
       RowBox[{"trajectory", ",", " ", 
        RowBox[{"{", 
         RowBox[{
          RowBox[{
           RowBox[{"r", "[", 
            RowBox[{"[", "1", "]"}], "]"}], "*", "1000"}], ",", " ", 
          RowBox[{
           RowBox[{"r", "[", 
            RowBox[{"[", "2", "]"}], "]"}], "*", "1000"}], ",", " ", 
          RowBox[{
           RowBox[{"r", "[", 
            RowBox[{"[", "3", "]"}], "]"}], "*", "1000"}], ",", " ", 
          RowBox[{"r", "[", 
           RowBox[{"[", "4", "]"}], "]"}], ",", " ", 
          RowBox[{"r", "[", 
           RowBox[{"[", "5", "]"}], "]"}], ",", " ", 
          RowBox[{"r", "[", 
           RowBox[{"[", "6", "]"}], "]"}]}], "}"}]}], "]"}], ";", 
      "\[IndentingNewLine]", "\[IndentingNewLine]", 
      RowBox[{"While", " ", "[", 
       RowBox[{
        RowBox[{
         RowBox[{"r", "[", 
          RowBox[{"[", "3", "]"}], "]"}], "<", "sm"}], ",", 
        "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"rp", " ", "=", "r"}], ";", "\[IndentingNewLine]", 
         RowBox[{"b", "=", 
          RowBox[{"radFld", "[", 
           RowBox[{"device", ",", " ", "\"\<BxByBz\>\"", ",", " ", 
            RowBox[{"1000", "*", 
             RowBox[{"rp", "[", 
              RowBox[{"[", 
               RowBox[{";;", "3"}], "]"}], "]"}]}]}], "]"}]}], ";", "\n", 
         "\t", 
         RowBox[{"drds1", "=", 
          RowBox[{"auxIDNewtonLorentzEquation", "[", 
           RowBox[{"a", ",", "r", ",", "b"}], "]"}]}], ";", 
         "\[IndentingNewLine]", 
         RowBox[{"r1", "=", 
          RowBox[{"rp", "+", 
           RowBox[{
            RowBox[{"(", 
             RowBox[{"step", "/", "2.0"}], ")"}], "*", "drds1"}]}]}], ";", 
         "\[IndentingNewLine]", "\[IndentingNewLine]", 
         RowBox[{"b1", "=", 
          RowBox[{"radFld", "[", 
           RowBox[{"device", ",", " ", "\"\<BxByBz\>\"", ",", " ", 
            RowBox[{"1000", "*", 
             RowBox[{"r1", "[", 
              RowBox[{"[", 
               RowBox[{";;", "3"}], "]"}], "]"}]}]}], "]"}]}], ";", "\n", 
         "\t", 
         RowBox[{"drds2", "=", 
          RowBox[{"auxIDNewtonLorentzEquation", "[", 
           RowBox[{"a", ",", "r1", ",", "b1"}], "]"}]}], ";", 
         "\[IndentingNewLine]", 
         RowBox[{"r2", "=", 
          RowBox[{"rp", "+", 
           RowBox[{
            RowBox[{"(", 
             RowBox[{"step", "/", "2.0"}], ")"}], "*", "drds2"}]}]}], ";", 
         "\[IndentingNewLine]", "\[IndentingNewLine]", 
         RowBox[{"b2", "=", 
          RowBox[{"radFld", "[", 
           RowBox[{"device", ",", " ", "\"\<BxByBz\>\"", ",", " ", 
            RowBox[{"1000", "*", 
             RowBox[{"r2", "[", 
              RowBox[{"[", 
               RowBox[{";;", "3"}], "]"}], "]"}]}]}], "]"}]}], ";", 
         "\[IndentingNewLine]", 
         RowBox[{"drds3", "=", 
          RowBox[{"auxIDNewtonLorentzEquation", "[", 
           RowBox[{"a", ",", "r2", ",", "b2"}], "]"}]}], ";", 
         "\[IndentingNewLine]", 
         RowBox[{"r3", "=", 
          RowBox[{"rp", "+", 
           RowBox[{"step", "*", "drds3"}]}]}], ";", "\[IndentingNewLine]", 
         "\[IndentingNewLine]", 
         RowBox[{"b3", "=", 
          RowBox[{"radFld", "[", 
           RowBox[{"device", ",", " ", "\"\<BxByBz\>\"", ",", " ", 
            RowBox[{"1000", "*", 
             RowBox[{"r3", "[", 
              RowBox[{"[", 
               RowBox[{";;", "3"}], "]"}], "]"}]}]}], "]"}]}], ";", 
         "\[IndentingNewLine]", 
         RowBox[{"drds4", "=", 
          RowBox[{"auxIDNewtonLorentzEquation", "[", 
           RowBox[{"a", ",", "r3", ",", "b3"}], "]"}]}], ";", 
         "\[IndentingNewLine]", 
         RowBox[{"r", "=", 
          RowBox[{"rp", "+", 
           RowBox[{
            RowBox[{"(", 
             RowBox[{"step", "/", "6.0"}], ")"}], "*", 
            RowBox[{"(", 
             RowBox[{"drds1", "+", 
              RowBox[{"2.0", "*", "drds2"}], "+", 
              RowBox[{"2.0", "*", "drds3"}], "+", "drds4"}], ")"}]}]}]}], ";",
          "\[IndentingNewLine]", "\[IndentingNewLine]", 
         RowBox[{"AppendTo", "[", 
          RowBox[{"trajectory", ",", " ", 
           RowBox[{"{", 
            RowBox[{
             RowBox[{
              RowBox[{"r", "[", 
               RowBox[{"[", "1", "]"}], "]"}], "*", "1000"}], ",", " ", 
             RowBox[{
              RowBox[{"r", "[", 
               RowBox[{"[", "2", "]"}], "]"}], "*", "1000"}], ",", " ", 
             RowBox[{
              RowBox[{"r", "[", 
               RowBox[{"[", "3", "]"}], "]"}], "*", "1000"}], ",", " ", 
             RowBox[{"r", "[", 
              RowBox[{"[", "4", "]"}], "]"}], ",", " ", 
             RowBox[{"r", "[", 
              RowBox[{"[", "5", "]"}], "]"}], ",", " ", 
             RowBox[{"r", "[", 
              RowBox[{"[", "6", "]"}], "]"}]}], "}"}]}], "]"}], ";"}]}], 
       "\[IndentingNewLine]", "]"}], ";", "\[IndentingNewLine]", 
      "\[IndentingNewLine]", 
      RowBox[{"t1", "=", 
       RowBox[{"AbsoluteTime", "[", "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"(*", 
       RowBox[{
        RowBox[{"Print", "[", 
         RowBox[{"\"\<> IDRungeKuttaTrajectory: elapsed time = \>\"", ",", 
          RowBox[{"(", 
           RowBox[{"t1", "-", "t0"}], ")"}], ",", "\"\< s\>\""}], "]"}], 
        ";"}], "*)"}], "\[IndentingNewLine]", "\[IndentingNewLine]", 
      RowBox[{"If", "[", 
       RowBox[{
        RowBox[{"display", "\[GreaterEqual]", " ", "1"}], ",", 
        "\[IndentingNewLine]", 
        RowBox[{"(*", "Plots", "*)"}], "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"p1", "=", 
          RowBox[{"ListLinePlot", "[", 
           RowBox[{
            RowBox[{"Table", "[", 
             RowBox[{
              RowBox[{"{", 
               RowBox[{
                RowBox[{"trajectory", "[", 
                 RowBox[{"[", 
                  RowBox[{"i", ",", "3"}], "]"}], "]"}], ",", 
                RowBox[{"trajectory", "[", 
                 RowBox[{"[", 
                  RowBox[{"i", ",", "1"}], "]"}], "]"}]}], "}"}], ",", 
              RowBox[{"{", 
               RowBox[{"i", ",", "1", ",", 
                RowBox[{"Length", "[", "trajectory", "]"}]}], "}"}]}], "]"}], 
            ",", 
            RowBox[{"Frame", "\[Rule]", "True"}], ",", 
            RowBox[{"FrameLabel", "\[Rule]", 
             RowBox[{"{", 
              RowBox[{
               RowBox[{"Style", "[", 
                RowBox[{"\"\<Z [mm]\>\"", ",", "12"}], "]"}], ",", 
               RowBox[{"Style", "[", 
                RowBox[{"\"\<X [mm]\>\"", ",", "12"}], "]"}]}], "}"}]}], ",", 
            RowBox[{"PlotLabel", "\[Rule]", 
             RowBox[{"Style", "[", 
              RowBox[{
              "\"\<X Direction Trajectory\>\"", ",", "Bold", ",", "12"}], 
              "]"}]}], ",", 
            RowBox[{"PlotTheme", "\[Rule]", "\"\<Detailed\>\""}], ",", 
            RowBox[{"ImageSize", "\[Rule]", "Medium"}]}], "]"}]}], ";", 
         "\[IndentingNewLine]", 
         RowBox[{"p2", "=", 
          RowBox[{"ListLinePlot", "[", 
           RowBox[{
            RowBox[{"Table", "[", 
             RowBox[{
              RowBox[{"{", 
               RowBox[{
                RowBox[{"trajectory", "[", 
                 RowBox[{"[", 
                  RowBox[{"i", ",", "3"}], "]"}], "]"}], ",", 
                RowBox[{"trajectory", "[", 
                 RowBox[{"[", 
                  RowBox[{"i", ",", "2"}], "]"}], "]"}]}], "}"}], ",", 
              RowBox[{"{", 
               RowBox[{"i", ",", "1", ",", 
                RowBox[{"Length", "[", "trajectory", "]"}]}], "}"}]}], "]"}], 
            ",", 
            RowBox[{"Frame", "\[Rule]", "True"}], ",", 
            RowBox[{"FrameLabel", "\[Rule]", 
             RowBox[{"{", 
              RowBox[{
               RowBox[{"Style", "[", 
                RowBox[{"\"\<Z [mm]\>\"", ",", "12"}], "]"}], ",", 
               RowBox[{"Style", "[", 
                RowBox[{"\"\<Y [mm]\>\"", ",", "12"}], "]"}]}], "}"}]}], ",", 
            RowBox[{"PlotLabel", "\[Rule]", 
             RowBox[{"Style", "[", 
              RowBox[{
              "\"\<Y Direction Trajectory\>\"", ",", "Bold", ",", "12"}], 
              "]"}]}], ",", 
            RowBox[{"PlotTheme", "\[Rule]", "\"\<Detailed\>\""}], ",", 
            RowBox[{"ImageSize", "\[Rule]", "Medium"}]}], "]"}]}], ";", 
         "\[IndentingNewLine]", "\[IndentingNewLine]", 
         RowBox[{"Print", "[", 
          RowBox[{"Row", "[", 
           RowBox[{
            RowBox[{"{", 
             RowBox[{"p1", ",", "p2"}], "}"}], ",", "\"\<\\t\\t\>\""}], "]"}],
           "]"}], ";"}]}], "\[IndentingNewLine]", "]"}], ";", 
      "\[IndentingNewLine]", "\[IndentingNewLine]", 
      RowBox[{"Return", "[", "trajectory", "]"}], ";"}]}], 
    "\[IndentingNewLine]", "]"}]}], ";"}]}], "Input",
 CellChangeTimes->{{3.76744770185725*^9, 3.767447715061404*^9}, {
   3.7674478894725156`*^9, 3.7674478930665445`*^9}, {3.782655720566373*^9, 
   3.782655720941368*^9}, 3.821198370332193*^9, {3.8211989209357195`*^9, 
   3.821198946853913*^9}, {3.8211990277470274`*^9, 3.8211991616885953`*^9}, {
   3.8218660850976667`*^9, 3.8218660880108*^9}, {3.821970797130686*^9, 
   3.8219708160740128`*^9}, {3.8219712921125784`*^9, 3.8219713017398825`*^9}, 
   3.821971381322256*^9, {3.821972769605554*^9, 3.821972770044639*^9}, {
   3.8219730908819094`*^9, 3.8219731497491355`*^9}, {3.821973223683874*^9, 
   3.8219732453369694`*^9}, {3.8220407771958113`*^9, 
   3.8220407850000906`*^9}, {3.8223838530702477`*^9, 3.822383854027481*^9}, 
   3.8224918463941603`*^9, {3.82335466103051*^9, 3.823354663051179*^9}, {
   3.8233547381085415`*^9, 3.82335473837449*^9}, {3.823354933768151*^9, 
   3.823354976219185*^9}, {3.823355034146756*^9, 3.823355036629574*^9}, {
   3.8233577978428044`*^9, 3.8233579030437803`*^9}, {3.823357950633753*^9, 
   3.823357977032151*^9}, {3.823358048140832*^9, 3.823358058318604*^9}, {
   3.8233582164042816`*^9, 3.8233582224374027`*^9}, {3.8233583481937137`*^9, 
   3.8233583686849365`*^9}, {3.8233584079316053`*^9, 
   3.8233584091356525`*^9}, {3.823687657134842*^9, 3.823687657388418*^9}, {
   3.823694951227759*^9, 3.823694989889847*^9}, {3.8237006005087557`*^9, 
   3.8237006215187845`*^9}, {3.823701655968274*^9, 3.823701671759482*^9}, 
   3.8243780907471137`*^9},
 Background->RGBColor[0.94, 0.91, 0.88],
 CellLabel->"In[14]:=",ExpressionUUID->"af59c49e-ea82-4f8f-8005-aabefc0f8aa4"]
}, Closed]],

Cell[CellGroupData[{

Cell["AuxRungeKutta", "Subsection",
 CellChangeTimes->{{3.8224924968846164`*^9, 
  3.8224925096046734`*^9}},ExpressionUUID->"cf47b52e-46af-452e-bab2-\
03f2ddb826ba"],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"auxIDNewtonLorentzEquation", "[", 
     RowBox[{"a_", ",", "r_", ",", "b_"}], "]"}], ":=", 
    RowBox[{"Module", "[", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"{", "drds", "}"}], ",", "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"drds", " ", "=", " ", 
        RowBox[{"{", 
         RowBox[{"0", ",", "0", ",", "0", ",", "0", ",", "0", ",", "0"}], 
         "}"}]}], ";", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"drds", "[", 
         RowBox[{"[", "1", "]"}], "]"}], "=", 
        RowBox[{"r", "[", 
         RowBox[{"[", "4", "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"drds", "[", 
         RowBox[{"[", "2", "]"}], "]"}], "=", 
        RowBox[{"r", "[", 
         RowBox[{"[", "5", "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"drds", "[", 
         RowBox[{"[", "3", "]"}], "]"}], "=", 
        RowBox[{"r", "[", 
         RowBox[{"[", "6", "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"drds", "[", 
         RowBox[{"[", "4", "]"}], "]"}], "=", 
        RowBox[{
         RowBox[{"-", "a"}], "*", 
         RowBox[{"(", 
          RowBox[{
           RowBox[{
            RowBox[{"r", "[", 
             RowBox[{"[", "5", "]"}], "]"}], "*", 
            RowBox[{"b", "[", 
             RowBox[{"[", "3", "]"}], "]"}]}], "-", 
           RowBox[{
            RowBox[{"r", "[", 
             RowBox[{"[", "6", "]"}], "]"}], "*", 
            RowBox[{"b", "[", 
             RowBox[{"[", "2", "]"}], "]"}]}]}], ")"}]}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"drds", "[", 
         RowBox[{"[", "5", "]"}], "]"}], "=", 
        RowBox[{
         RowBox[{"-", "a"}], "*", 
         RowBox[{"(", 
          RowBox[{
           RowBox[{
            RowBox[{"r", "[", 
             RowBox[{"[", "6", "]"}], "]"}], "*", 
            RowBox[{"b", "[", 
             RowBox[{"[", "1", "]"}], "]"}]}], "-", 
           RowBox[{
            RowBox[{"r", "[", 
             RowBox[{"[", "4", "]"}], "]"}], "*", 
            RowBox[{"b", "[", 
             RowBox[{"[", "3", "]"}], "]"}]}]}], ")"}]}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"drds", "[", 
         RowBox[{"[", "6", "]"}], "]"}], "=", 
        RowBox[{
         RowBox[{"-", "a"}], "*", 
         RowBox[{"(", 
          RowBox[{
           RowBox[{
            RowBox[{"r", "[", 
             RowBox[{"[", "4", "]"}], "]"}], "*", 
            RowBox[{"b", "[", 
             RowBox[{"[", "2", "]"}], "]"}]}], "-", 
           RowBox[{
            RowBox[{"r", "[", 
             RowBox[{"[", "5", "]"}], "]"}], "*", 
            RowBox[{"b", "[", 
             RowBox[{"[", "1", "]"}], "]"}]}]}], ")"}]}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"Return", "[", "drds", "]"}], ";"}]}], "\[IndentingNewLine]", 
     "]"}]}], ";"}], "\[IndentingNewLine]"}]], "Input",
 CellChangeTimes->{{3.76744770185725*^9, 3.767447715061404*^9}, {
   3.7674478894725156`*^9, 3.7674478930665445`*^9}, {3.782655720566373*^9, 
   3.782655720941368*^9}, 3.821198370332193*^9, {3.8211989209357195`*^9, 
   3.821198946853913*^9}, {3.8211990277470274`*^9, 3.8211991616885953`*^9}, {
   3.8218660850976667`*^9, 3.8218660880108*^9}, {3.821970797130686*^9, 
   3.8219708160740128`*^9}, {3.8219712921125784`*^9, 3.8219713017398825`*^9}, 
   3.821971381322256*^9},
 Background->RGBColor[0.94, 0.91, 0.88],
 CellLabel->"In[16]:=",ExpressionUUID->"33a6aa70-4f70-41d1-a0a5-f2bc5db0e2b3"]
}, Closed]],

Cell[CellGroupData[{

Cell["PhaseError - RungeKutta", "Subsection",
 CellChangeTimes->{{3.822554809301333*^9, 3.8225548221540318`*^9}, {
  3.822579285924861*^9, 3.822579286074135*^9}, {3.823354572888997*^9, 
  3.823354575941679*^9}},ExpressionUUID->"818c7509-e39b-412e-ba61-\
88130f28220a"],

Cell[BoxData[
 RowBox[{
  RowBox[{"idPhaseError", "[", 
   RowBox[{
   "baxis_", ",", "xo_", ",", "xf_", ",", "nx_", ",", "Trajetoria_", ",", 
    "eEnergy_"}], "]"}], ":=", 
  RowBox[{"(", "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"Module", "[", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{
       "eletron", ",", "mo", ",", "eRestEnergy", ",", "bfield", ",", 
        "bfieldT", ",", "longAxis", ",", "ampX", ",", "ampY", ",", "ampZ", 
        ",", "ampT", ",", "peakX", ",", "peakY", ",", "peakZ", ",", "peakT", 
        ",", "longPeak", ",", "longPeakX", ",", "longPeakY", ",", "longPeakZ",
         ",", "longPeakT", ",", "periods", ",", "nperiods", ",", "periodL", 
        ",", "kparam", ",", "gamma", ",", "lambda", ",", "intField0", ",", 
        "intField", ",", "drop", ",", "phaseError", ",", "phase", ",", "j", 
        ",", "jmin", ",", "rmsError", ",", "fitData", ",", "fitLin", ",", 
        "linearFit", ",", "linearizedPhase", ",", "p3", ",", "a", ",", "b", 
        ",", "I00", ",", "I0", ",", "p0", ",", "btotal", ",", "dx", ",", "c", 
        ",", "s", ",", "errorP", ",", "t0", ",", "t1"}], "}"}], ",", 
      "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"t0", "=", 
        RowBox[{"AbsoluteTime", "[", "]"}]}], ";", "\[IndentingNewLine]", 
       "\[IndentingNewLine]", 
       RowBox[{"(*", 
        RowBox[{"Check", " ", "Inputs"}], "*)"}], "\[IndentingNewLine]", 
       RowBox[{"If", "[", 
        RowBox[{
         RowBox[{"Length", "[", 
          RowBox[{"baxis", "\[NotEqual]", " ", 
           RowBox[{"Length", "[", "Trajetoria", "]"}]}], "]"}], ",", 
         RowBox[{
         "Return", "[", 
          "\"\<[ERROR] : Field vector and Trajectory Vector have not the same \
lenght.\>\"", "]"}]}], "]"}], ";", "\[IndentingNewLine]", 
       RowBox[{"If", "[", 
        RowBox[{
         RowBox[{"eEnergy", ">", "100"}], ",", 
         RowBox[{
         "Return", "[", 
          "\"\<[ERROR] : Electron beam energy to high. Check if the input \
energy is in Gev.\>\"", "]"}]}], "]"}], ";", "\[IndentingNewLine]", 
       "\[IndentingNewLine]", 
       RowBox[{"(*", 
        RowBox[{"Total", " ", "Field"}], "*)"}], "\[IndentingNewLine]", 
       RowBox[{"btotal", "=", 
        RowBox[{"Sqrt", "[", 
         RowBox[{
          RowBox[{
           RowBox[{"baxis", "[", 
            RowBox[{"[", 
             RowBox[{"All", ",", "1"}], "]"}], "]"}], "^", "2"}], "+", 
          RowBox[{
           RowBox[{"baxis", "[", 
            RowBox[{"[", 
             RowBox[{"All", ",", "2"}], "]"}], "]"}], "^", "2"}], "+", 
          RowBox[{
           RowBox[{"baxis", "[", 
            RowBox[{"[", 
             RowBox[{"All", ",", "3"}], "]"}], "]"}], "^", "2"}]}], "]"}]}], 
       ";", "\[IndentingNewLine]", "\[IndentingNewLine]", 
       RowBox[{"(*", 
        RowBox[{"===", 
         RowBox[{"==", " ", "Parameters"}], " ", "===", "=="}], "*)"}], 
       "\[IndentingNewLine]", 
       RowBox[{"eletron", "=", "1.60217662*^-19"}], ";", " ", 
       RowBox[{"mo", "=", "9.10938356*^-31"}], ";", "\[IndentingNewLine]", 
       RowBox[{"eRestEnergy", "=", "510998.92811"}], ";", " ", 
       RowBox[{"(*", 
        RowBox[{"[", "eV", "]"}], "*)"}], " ", 
       RowBox[{"(*", " ", 
        RowBox[{"==", " ", 
         RowBox[{"mo", "*", 
          RowBox[{"c", "^", 
           RowBox[{"2", "[", "J", "]"}]}]}]}], "*)"}], "\[IndentingNewLine]", 
       RowBox[{"c", "=", "299792458"}], ";", " ", 
       RowBox[{"(*", 
        RowBox[{"m", "/", "s"}], "*)"}], "\[IndentingNewLine]", 
       "\[IndentingNewLine]", 
       RowBox[{"bfield", "=", "baxis"}], ";", "\[IndentingNewLine]", 
       RowBox[{"bfieldT", "=", "btotal"}], ";", "\[IndentingNewLine]", 
       "\[IndentingNewLine]", 
       RowBox[{"(*", 
        RowBox[{"Principal", " ", "Longitudinal", " ", "Axis"}], "*)"}], 
       "\[IndentingNewLine]", 
       RowBox[{"dx", "=", 
        RowBox[{
         RowBox[{"(", 
          RowBox[{"xf", "-", "xo"}], ")"}], "/", "nx"}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"longAxis", "=", 
        RowBox[{"Table", "[", 
         RowBox[{
          RowBox[{"xo", "+", 
           RowBox[{
            RowBox[{"(", 
             RowBox[{"n", "-", "1"}], ")"}], "*", "dx"}]}], ",", 
          RowBox[{"{", 
           RowBox[{"n", ",", "1", ",", "nx"}], "}"}]}], "]"}]}], ";", 
       "\[IndentingNewLine]", "\[IndentingNewLine]", 
       RowBox[{"(*", " ", 
        RowBox[{"Longitudinal", " ", "Axis", " ", "from", " ", "0"}], " ", 
        "*)"}], "\[IndentingNewLine]", 
       RowBox[{"s", "=", 
        RowBox[{
         RowBox[{"(", 
          RowBox[{"longAxis", "-", 
           RowBox[{"longAxis", "[", 
            RowBox[{"[", "1", "]"}], "]"}]}], ")"}], "/", "1000"}]}], ";", 
       "  ", 
       RowBox[{"(*", 
        RowBox[{"[", "m", "]"}], "*)"}], "\[IndentingNewLine]", 
       "\[IndentingNewLine]", 
       RowBox[{"(*", 
        RowBox[{"===", 
         RowBox[{"==", " ", 
          RowBox[{"Find", " ", "Peaks"}]}], " ", "===", "=="}], "*)"}], 
       "\[IndentingNewLine]", 
       RowBox[{"ampT", "=", 
        RowBox[{"0.1", "*", 
         RowBox[{"Max", "[", "bfieldT", "]"}]}]}], ";", "\[IndentingNewLine]", 
       RowBox[{"ampX", "=", 
        RowBox[{"ampY", "=", 
         RowBox[{"ampZ", "=", "ampT"}]}]}], ";", "\[IndentingNewLine]", 
       RowBox[{"(*", 
        RowBox[{"Find", " ", "Peaks"}], "*)"}], "\[IndentingNewLine]", 
       RowBox[{"peakX", "=", 
        RowBox[{"FindPeaks", "[", 
         RowBox[{
          RowBox[{"bfield", "[", 
           RowBox[{"[", 
            RowBox[{"All", ",", "1"}], "]"}], "]"}], ",", "0", " ", ",", "0", 
          ",", " ", "ampX"}], "]"}]}], ";", "\[IndentingNewLine]", 
       RowBox[{"peakY", "=", 
        RowBox[{"FindPeaks", "[", 
         RowBox[{
          RowBox[{"bfield", "[", 
           RowBox[{"[", 
            RowBox[{"All", ",", "2"}], "]"}], "]"}], ",", "0", " ", ",", "0", 
          ",", " ", "ampY"}], "]"}]}], ";", "\[IndentingNewLine]", 
       RowBox[{"peakZ", "=", 
        RowBox[{"FindPeaks", "[", 
         RowBox[{
          RowBox[{"bfield", "[", 
           RowBox[{"[", 
            RowBox[{"All", ",", "3"}], "]"}], "]"}], ",", "0", " ", ",", "0", 
          ",", " ", "ampZ"}], "]"}]}], ";", "\[IndentingNewLine]", 
       RowBox[{"peakT", "=", 
        RowBox[{"FindPeaks", "[", 
         RowBox[{"bfieldT", ",", "0", " ", ",", "0", " ", ",", " ", "ampT"}], 
         "]"}]}], ";", "\[IndentingNewLine]", "\[IndentingNewLine]", 
       RowBox[{"(*", 
        RowBox[{"===", 
         RowBox[{"==", " ", 
          RowBox[{
          "Remove", " ", "extremities", " ", "from", " ", "Total", " ", 
           "Field"}]}], " ", "===", "=="}], "*)"}], "\[IndentingNewLine]", 
       RowBox[{"drop", "=", "4"}], ";", " ", 
       RowBox[{"(*", 
        RowBox[{
        "how", " ", "many", " ", "peaks", " ", "to", " ", "drop", " ", "each",
          " ", "side"}], "*)"}], "\[IndentingNewLine]", 
       RowBox[{"peakT", "=", 
        RowBox[{"Drop", "[", 
         RowBox[{"peakT", ",", 
          RowBox[{"{", 
           RowBox[{"1", ",", "drop"}], "}"}]}], "]"}]}], ";", 
       RowBox[{"peakT", "=", 
        RowBox[{"Drop", "[", 
         RowBox[{"peakT", ",", 
          RowBox[{"{", 
           RowBox[{
            RowBox[{"-", "drop"}], ",", 
            RowBox[{"-", "1"}]}], "}"}]}], "]"}]}], ";", " ", 
       RowBox[{"(*", 
        RowBox[{"Drop", " ", "extremity", " ", "peaks"}], "*)"}], 
       "\[IndentingNewLine]", 
       RowBox[{"longPeakT", "=", 
        RowBox[{"Table", "[", 
         RowBox[{
          RowBox[{"s", "[", 
           RowBox[{"[", 
            RowBox[{"peakT", "[", 
             RowBox[{"[", 
              RowBox[{"i", ",", "1"}], "]"}], "]"}], "]"}], "]"}], ",", 
          RowBox[{"{", 
           RowBox[{"i", ",", "1", ",", 
            RowBox[{"Length", "[", "peakT", "]"}]}], "}"}]}], "]"}]}], ";", 
       " ", 
       RowBox[{"(*", 
        RowBox[{
        "Crate", " ", "longitudinal", " ", "axis", " ", "based", " ", "on", 
         " ", "total", " ", "field"}], "*)"}], "\[IndentingNewLine]", 
       "\[IndentingNewLine]", 
       RowBox[{"(*", 
        RowBox[{"===", 
         RowBox[{"==", " ", 
          RowBox[{
          "Remove", " ", "extremities", " ", "from", " ", "Field", " ", 
           "Components"}]}], " ", "===", "=="}], "*)"}], 
       "\[IndentingNewLine]", 
       RowBox[{"drop", "=", "3"}], ";", " ", 
       RowBox[{"(*", 
        RowBox[{
        "how", " ", "many", " ", "peaks", " ", "to", " ", "drop", " ", "each",
          " ", "side"}], "*)"}], "\[IndentingNewLine]", 
       RowBox[{"(*", 
        RowBox[{"Z", " ", "axis"}], "*)"}], "\[IndentingNewLine]", 
       RowBox[{"If", "[", 
        RowBox[{
         RowBox[{
          RowBox[{"Length", "[", "peakZ", "]"}], ">", 
          RowBox[{"2", "*", "drop"}]}], ",", "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{"peakZ", "=", 
           RowBox[{"Drop", "[", 
            RowBox[{"peakZ", ",", 
             RowBox[{"{", 
              RowBox[{"1", ",", "drop"}], "}"}]}], "]"}]}], ";", 
          RowBox[{"peakZ", "=", 
           RowBox[{"Drop", "[", 
            RowBox[{"peakZ", ",", 
             RowBox[{"{", 
              RowBox[{
               RowBox[{"-", "drop"}], ",", 
               RowBox[{"-", "1"}]}], "}"}]}], "]"}]}], ";", 
          "\[IndentingNewLine]", 
          RowBox[{"longPeakZ", "=", 
           RowBox[{"Table", "[", 
            RowBox[{
             RowBox[{"longAxis", "[", 
              RowBox[{"[", 
               RowBox[{"peakZ", "[", 
                RowBox[{"[", 
                 RowBox[{"i", ",", "1"}], "]"}], "]"}], "]"}], "]"}], ",", 
             RowBox[{"{", 
              RowBox[{"i", ",", "1", ",", 
               RowBox[{"Length", "[", "peakZ", "]"}]}], "}"}]}], "]"}]}], 
          ";"}], "\[IndentingNewLine]", ",", "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{"peakZ", "=", 
           RowBox[{"ConstantArray", "[", 
            RowBox[{
             RowBox[{"10", "^", 
              RowBox[{"-", "5"}]}], ",", 
             RowBox[{"{", 
              RowBox[{"1", ",", "2"}], "}"}]}], "]"}]}], ";"}]}], 
        "\[IndentingNewLine]", "]"}], ";", "\[IndentingNewLine]", 
       RowBox[{"(*", 
        RowBox[{"Y", " ", "axis"}], "*)"}], "\[IndentingNewLine]", 
       RowBox[{"If", "[", 
        RowBox[{
         RowBox[{
          RowBox[{"Length", "[", "peakY", "]"}], ">", 
          RowBox[{"2", "*", "drop"}]}], ",", "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{"peakY", "=", 
           RowBox[{"Drop", "[", 
            RowBox[{"peakY", ",", 
             RowBox[{"{", 
              RowBox[{"1", ",", "drop"}], "}"}]}], "]"}]}], ";", 
          RowBox[{"peakY", "=", 
           RowBox[{"Drop", "[", 
            RowBox[{"peakY", ",", 
             RowBox[{"{", 
              RowBox[{
               RowBox[{"-", "drop"}], ",", 
               RowBox[{"-", "1"}]}], "}"}]}], "]"}]}], ";", 
          "\[IndentingNewLine]", 
          RowBox[{"longPeakY", "=", 
           RowBox[{"Table", "[", 
            RowBox[{
             RowBox[{"longAxis", "[", 
              RowBox[{"[", 
               RowBox[{"peakY", "[", 
                RowBox[{"[", 
                 RowBox[{"i", ",", "1"}], "]"}], "]"}], "]"}], "]"}], ",", 
             RowBox[{"{", 
              RowBox[{"i", ",", "1", ",", 
               RowBox[{"Length", "[", "peakY", "]"}]}], "}"}]}], "]"}]}], 
          ";"}], "\[IndentingNewLine]", ",", "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{"peakY", "=", 
           RowBox[{"ConstantArray", "[", 
            RowBox[{
             RowBox[{"10", "^", 
              RowBox[{"-", "5"}]}], ",", 
             RowBox[{"{", 
              RowBox[{"1", ",", "2"}], "}"}]}], "]"}]}], ";"}]}], 
        "\[IndentingNewLine]", "]"}], ";", "\[IndentingNewLine]", 
       RowBox[{"(*", 
        RowBox[{"X", " ", "axis"}], "*)"}], "\[IndentingNewLine]", 
       RowBox[{"If", "[", 
        RowBox[{
         RowBox[{
          RowBox[{"Length", "[", "peakX", "]"}], ">", 
          RowBox[{"2", "*", "drop"}]}], ",", "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{"peakX", "=", 
           RowBox[{"Drop", "[", 
            RowBox[{"peakX", ",", 
             RowBox[{"{", 
              RowBox[{"1", ",", "drop"}], "}"}]}], "]"}]}], ";", 
          RowBox[{"peakX", "=", 
           RowBox[{"Drop", "[", 
            RowBox[{"peakX", ",", 
             RowBox[{"{", 
              RowBox[{
               RowBox[{"-", "drop"}], ",", 
               RowBox[{"-", "1"}]}], "}"}]}], "]"}]}], ";", 
          "\[IndentingNewLine]", 
          RowBox[{"longPeakX", "=", 
           RowBox[{"Table", "[", 
            RowBox[{
             RowBox[{"longAxis", "[", 
              RowBox[{"[", 
               RowBox[{"peakX", "[", 
                RowBox[{"[", 
                 RowBox[{"i", ",", "1"}], "]"}], "]"}], "]"}], "]"}], ",", 
             RowBox[{"{", 
              RowBox[{"i", ",", "1", ",", 
               RowBox[{"Length", "[", "peakX", "]"}]}], "}"}]}], "]"}]}], 
          ";"}], "\[IndentingNewLine]", ",", "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{"peakX", "=", 
           RowBox[{"ConstantArray", "[", 
            RowBox[{
             RowBox[{"10", "^", 
              RowBox[{"-", "5"}]}], ",", 
             RowBox[{"{", 
              RowBox[{"1", ",", "2"}], "}"}]}], "]"}]}], ";"}]}], 
        "\[IndentingNewLine]", "]"}], ";", "\[IndentingNewLine]", 
       "\[IndentingNewLine]", 
       RowBox[{"(*", 
        RowBox[{"===", 
         RowBox[{"==", " ", 
          RowBox[{
          "Find", " ", "the", " ", "Principal", " ", "Field", " ", "Axis"}]}],
          " ", "===", "=="}], "*)"}], "\[IndentingNewLine]", 
       RowBox[{"If", "[", 
        RowBox[{
         RowBox[{
          RowBox[{"Mean", "[", 
           RowBox[{"peakX", "[", 
            RowBox[{"[", 
             RowBox[{"All", ",", "2"}], "]"}], "]"}], "]"}], ">", 
          RowBox[{"Mean", "[", 
           RowBox[{"peakY", "[", 
            RowBox[{"[", 
             RowBox[{"All", ",", "2"}], "]"}], "]"}], "]"}]}], ",", 
         "\[IndentingNewLine]", 
         RowBox[{"If", "[", 
          RowBox[{
           RowBox[{
            RowBox[{"Mean", "[", 
             RowBox[{"peakX", "[", 
              RowBox[{"[", 
               RowBox[{"All", ",", "2"}], "]"}], "]"}], "]"}], ">", 
            RowBox[{"Mean", "[", 
             RowBox[{"peakZ", "[", 
              RowBox[{"[", 
               RowBox[{"All", ",", "2"}], "]"}], "]"}], "]"}]}], ",", 
           "\[IndentingNewLine]", 
           RowBox[{
            RowBox[{"longPeak", "=", "longPeakX"}], ";"}], 
           "\[IndentingNewLine]", ",", "\[IndentingNewLine]", 
           RowBox[{
            RowBox[{"longPeak", "=", "longPeakZ"}], ";"}]}], 
          "\[IndentingNewLine]", "]"}], "\[IndentingNewLine]", ",", 
         "\[IndentingNewLine]", 
         RowBox[{"If", "[", 
          RowBox[{
           RowBox[{
            RowBox[{"Mean", "[", 
             RowBox[{"peakY", "[", 
              RowBox[{"[", 
               RowBox[{"All", ",", "2"}], "]"}], "]"}], "]"}], ">", 
            RowBox[{"Mean", "[", 
             RowBox[{"peakZ", "[", 
              RowBox[{"[", 
               RowBox[{"All", ",", "2"}], "]"}], "]"}], "]"}]}], ",", 
           "\[IndentingNewLine]", 
           RowBox[{
            RowBox[{"longPeak", "=", "longPeakY"}], ";"}], 
           "\[IndentingNewLine]", ",", "\[IndentingNewLine]", 
           RowBox[{
            RowBox[{"longPeak", "=", "longPeakZ"}], ";"}]}], 
          "\[IndentingNewLine]", "]"}]}], "\[IndentingNewLine]", "]"}], ";", 
       "\[IndentingNewLine]", "\[IndentingNewLine]", 
       RowBox[{"periods", "=", 
        RowBox[{"Table", "[", 
         RowBox[{
          RowBox[{
           RowBox[{"longPeak", "[", 
            RowBox[{"[", 
             RowBox[{"i", "+", "1"}], "]"}], "]"}], "-", 
           RowBox[{"longPeak", "[", 
            RowBox[{"[", "i", "]"}], "]"}]}], ",", 
          RowBox[{"{", 
           RowBox[{"i", ",", "1", ",", 
            RowBox[{
             RowBox[{"Length", "[", "longPeak", "]"}], "-", "1"}]}], "}"}]}], 
         "]"}]}], ";", "\[IndentingNewLine]", "\[IndentingNewLine]", 
       RowBox[{"(*", 
        RowBox[{"===", "===", "===", " ", 
         RowBox[{"Magnet", " ", "design"}], " ", "===", "===", "==="}], 
        "*)"}], "\[IndentingNewLine]", 
       RowBox[{"nperiods", "=", 
        RowBox[{"Length", "[", "periods", "]"}]}], ";", "\[IndentingNewLine]", 
       RowBox[{"periodL", "=", 
        RowBox[{"Mean", "[", "periods", "]"}]}], ";", " ", 
       RowBox[{"(*", "mm", "*)"}], "\[IndentingNewLine]", 
       RowBox[{"gamma", "=", 
        RowBox[{"eEnergy", "*", 
         RowBox[{
          RowBox[{"10", "^", "9"}], "/", "eRestEnergy"}]}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"kparam", "=", 
        RowBox[{"0.0934", "*", "periodL", "*", 
         RowBox[{"Mean", "[", 
          RowBox[{"peakT", "[", 
           RowBox[{"[", 
            RowBox[{"All", ",", "2"}], "]"}], "]"}], "]"}]}]}], ";", "  ", 
       RowBox[{"(*", 
        RowBox[{"!!", 
         RowBox[{"!!", 
          RowBox[{"!!", 
           RowBox[{"!!", 
            RowBox[{"!!", 
             RowBox[{"!!", 
              RowBox[{"!", " ", 
               RowBox[{
               "Todas", " ", "componentes", " ", "ou", " ", "s\[OAcute]", " ", 
                RowBox[{"1", "?"}]}]}]}]}]}]}]}]}], " ", "*)"}], 
       "\[IndentingNewLine]", 
       RowBox[{"lambda", "=", 
        RowBox[{
         RowBox[{"(", 
          RowBox[{
           RowBox[{"(", 
            RowBox[{
             RowBox[{"Mean", "[", "periods", "]"}], "/", "1000"}], ")"}], "/", 
           RowBox[{"(", 
            RowBox[{"2", "*", 
             RowBox[{"(", 
              RowBox[{"gamma", "^", "2"}], ")"}]}], ")"}]}], ")"}], "*", 
         RowBox[{"(", 
          RowBox[{"1", " ", "+", " ", 
           RowBox[{
            RowBox[{"(", 
             RowBox[{"kparam", "^", "2"}], ")"}], "/", "2"}]}], ")"}]}]}], 
       ";", " ", 
       RowBox[{"(*", "m", "*)"}], "\[IndentingNewLine]", 
       "\[IndentingNewLine]", 
       RowBox[{"(*", 
        RowBox[{"===", "===", "===", " ", 
         RowBox[{"Phase", " ", "Function"}], " ", "===", "===", "==="}], 
        "*)"}], "\[IndentingNewLine]", 
       RowBox[{"jmin", "=", 
        RowBox[{"peakT", "[", 
         RowBox[{"[", 
          RowBox[{"1", ",", "1"}], "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
       RowBox[{"phase", "=", 
        RowBox[{"{", "}"}]}], ";", "\[IndentingNewLine]", 
       "\[IndentingNewLine]", 
       RowBox[{"I0", "=", 
        RowBox[{"Table", "[", 
         RowBox[{
          RowBox[{
           RowBox[{"(", 
            RowBox[{
             RowBox[{"(", 
              RowBox[{
               RowBox[{"(", 
                RowBox[{
                 RowBox[{
                  RowBox[{"Trajetoria", "[", 
                   RowBox[{"[", 
                    RowBox[{"i", ",", "4"}], "]"}], "]"}], "^", "2"}], "+", 
                 RowBox[{
                  RowBox[{"Trajetoria", "[", 
                   RowBox[{"[", 
                    RowBox[{
                    RowBox[{"i", "+", "1"}], ",", "4"}], "]"}], "]"}], "^", 
                  "2"}]}], ")"}], "/", "2"}], ")"}], "+", 
             RowBox[{"(", 
              RowBox[{
               RowBox[{"(", 
                RowBox[{
                 RowBox[{
                  RowBox[{"Trajetoria", "[", 
                   RowBox[{"[", 
                    RowBox[{"i", ",", "5"}], "]"}], "]"}], "^", "2"}], "+", 
                 RowBox[{
                  RowBox[{"Trajetoria", "[", 
                   RowBox[{"[", 
                    RowBox[{
                    RowBox[{"i", "+", "1"}], ",", "5"}], "]"}], "]"}], "^", 
                  "2"}]}], ")"}], "/", "2"}], ")"}]}], ")"}], "*", 
           RowBox[{"(", 
            RowBox[{
             RowBox[{"s", "[", 
              RowBox[{"[", 
               RowBox[{"i", "+", "1"}], "]"}], "]"}], "-", 
             RowBox[{"s", "[", 
              RowBox[{"[", "i", "]"}], "]"}]}], ")"}]}], ",", 
          RowBox[{"{", 
           RowBox[{"i", ",", "1", ",", "jmin"}], "}"}]}], "]"}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"p0", "=", 
        RowBox[{
         RowBox[{"Pi", "/", "lambda"}], "*", 
         RowBox[{"(", 
          RowBox[{
           RowBox[{
            RowBox[{"s", "[", 
             RowBox[{"[", "jmin", "]"}], "]"}], "/", 
            RowBox[{"gamma", "^", "2"}]}], "+", 
           RowBox[{"Sum", "[", 
            RowBox[{
             RowBox[{"I0", "[", 
              RowBox[{"[", "i", "]"}], "]"}], ",", 
             RowBox[{"{", 
              RowBox[{"i", ",", "1", ",", 
               RowBox[{"Length", "[", "I0", "]"}]}], "}"}]}], "]"}]}], 
          ")"}]}]}], ";", "\[IndentingNewLine]", 
       RowBox[{"AppendTo", "[", 
        RowBox[{"phase", ",", "p0"}], "]"}], ";", "\[IndentingNewLine]", 
       "\[IndentingNewLine]", 
       RowBox[{"For", "[", 
        RowBox[{
         RowBox[{"j", "=", 
          RowBox[{"jmin", "+", "1"}]}], ",", 
         RowBox[{"j", "\[LessEqual]", 
          RowBox[{"(", 
           RowBox[{
            RowBox[{"peakT", "[", 
             RowBox[{"[", 
              RowBox[{
               RowBox[{"Length", "[", "peakT", "]"}], ",", "1"}], "]"}], 
             "]"}], "-", "2"}], ")"}]}], ",", 
         RowBox[{"j", "++"}], ",", "\[IndentingNewLine]", 
         "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{"I00", "=", 
           RowBox[{
            RowBox[{"(", 
             RowBox[{
              RowBox[{"(", 
               RowBox[{
                RowBox[{"(", 
                 RowBox[{
                  RowBox[{
                   RowBox[{"Trajetoria", "[", 
                    RowBox[{"[", 
                    RowBox[{"j", ",", "4"}], "]"}], "]"}], "^", "2"}], "+", 
                  RowBox[{
                   RowBox[{"Trajetoria", "[", 
                    RowBox[{"[", 
                    RowBox[{
                    RowBox[{"j", "+", "1"}], ",", "4"}], "]"}], "]"}], "^", 
                   "2"}]}], ")"}], "/", "2"}], ")"}], "+", 
              RowBox[{"(", 
               RowBox[{
                RowBox[{"(", 
                 RowBox[{
                  RowBox[{
                   RowBox[{"Trajetoria", "[", 
                    RowBox[{"[", 
                    RowBox[{"j", ",", "5"}], "]"}], "]"}], "^", "2"}], "+", 
                  RowBox[{
                   RowBox[{"Trajetoria", "[", 
                    RowBox[{"[", 
                    RowBox[{
                    RowBox[{"j", "+", "1"}], ",", "5"}], "]"}], "]"}], "^", 
                   "2"}]}], ")"}], "/", "2"}], ")"}]}], ")"}], "*", 
            RowBox[{"(", 
             RowBox[{
              RowBox[{"s", "[", 
               RowBox[{"[", 
                RowBox[{"j", "+", "1"}], "]"}], "]"}], "-", 
              RowBox[{"s", "[", 
               RowBox[{"[", "j", "]"}], "]"}]}], ")"}]}]}], ";", 
          "\[IndentingNewLine]", 
          RowBox[{"AppendTo", "[", 
           RowBox[{"I0", ",", "I00"}], "]"}], ";", "\[IndentingNewLine]", 
          RowBox[{"p0", "=", 
           RowBox[{
            RowBox[{"Pi", "/", "lambda"}], "*", 
            RowBox[{"(", 
             RowBox[{
              RowBox[{
               RowBox[{"s", "[", 
                RowBox[{"[", "j", "]"}], "]"}], "/", 
               RowBox[{"gamma", "^", "2"}]}], "+", 
              RowBox[{"Sum", "[", 
               RowBox[{
                RowBox[{"I0", "[", 
                 RowBox[{"[", "i", "]"}], "]"}], ",", 
                RowBox[{"{", 
                 RowBox[{"i", ",", "1", ",", 
                  RowBox[{"Length", "[", "I0", "]"}]}], "}"}]}], "]"}]}], 
             ")"}]}]}], ";", "\[IndentingNewLine]", "\[IndentingNewLine]", 
          RowBox[{"AppendTo", "[", 
           RowBox[{"phase", ",", "p0"}], "]"}], ";"}]}], 
        "\[IndentingNewLine]", "]"}], ";", "\[IndentingNewLine]", 
       "\[IndentingNewLine]", 
       RowBox[{"(*", 
        RowBox[{
        "===", "===", "===", " ", "Fitting", " ", "===", "===", "==="}], " ", 
        "*)"}], "\[IndentingNewLine]", 
       RowBox[{"fitData", "=", 
        RowBox[{"Table", "[", 
         RowBox[{
          RowBox[{"{", 
           RowBox[{
            RowBox[{
             RowBox[{"s", "[", 
              RowBox[{"[", "i", "]"}], "]"}], "+", 
             RowBox[{"longPeakT", "[", 
              RowBox[{"[", "1", "]"}], "]"}]}], ",", 
            RowBox[{"phase", "[", 
             RowBox[{"[", "i", "]"}], "]"}]}], "}"}], ",", 
          RowBox[{"{", 
           RowBox[{"i", ",", "1", ",", 
            RowBox[{"Length", "[", "phase", "]"}]}], "}"}]}], "]"}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"fitLin", "=", 
        RowBox[{"NonlinearModelFit", "[", 
         RowBox[{"fitData", ",", 
          RowBox[{
           RowBox[{"a", "*", "x"}], "+", "b"}], ",", 
          RowBox[{"{", 
           RowBox[{"a", ",", "b"}], "}"}], ",", "x"}], "]"}]}], ";", 
       "\[IndentingNewLine]", "\[IndentingNewLine]", 
       RowBox[{"linearFit", "=", 
        RowBox[{"Table", "[", 
         RowBox[{
          RowBox[{"{", 
           RowBox[{
            RowBox[{
             RowBox[{"s", "[", 
              RowBox[{"[", "i", "]"}], "]"}], "+", 
             RowBox[{"longPeakT", "[", 
              RowBox[{"[", "1", "]"}], "]"}]}], ",", 
            RowBox[{"fitLin", "[", 
             RowBox[{
              RowBox[{"s", "[", 
               RowBox[{"[", "i", "]"}], "]"}], "+", 
              RowBox[{"longPeakT", "[", 
               RowBox[{"[", "1", "]"}], "]"}]}], "]"}]}], "}"}], ",", 
          RowBox[{"{", 
           RowBox[{"i", ",", "1", ",", 
            RowBox[{"Length", "[", "phase", "]"}]}], "}"}]}], "]"}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"linearizedPhase", "=", 
        RowBox[{"phase", "-", 
         RowBox[{"linearFit", "[", 
          RowBox[{"[", 
           RowBox[{"All", ",", "2"}], "]"}], "]"}]}]}], ";", 
       "\[IndentingNewLine]", "\[IndentingNewLine]", 
       RowBox[{"p3", "=", 
        RowBox[{"ListLinePlot", "[", 
         RowBox[{
          RowBox[{"linearizedPhase", "*", 
           RowBox[{"180", "/", "Pi"}]}], ",", 
          RowBox[{"PlotLabel", "\[Rule]", "\"\<Linearized Phase\>\""}], ",", 
          RowBox[{"ImageSize", "\[Rule]", 
           RowBox[{"{", 
            RowBox[{"300", ",", "200"}], "}"}]}], ",", 
          RowBox[{"Frame", "\[Rule]", "True"}], ",", 
          RowBox[{"FrameLabel", "\[Rule]", 
           RowBox[{"{", 
            RowBox[{"\"\< \>\"", ",", "\"\<[deg]\>\""}], "}"}]}]}], "]"}]}], 
       ";", "\[IndentingNewLine]", "\[IndentingNewLine]", 
       RowBox[{"errorP", "=", 
        RowBox[{
         RowBox[{"Table", "[", 
          RowBox[{
           RowBox[{"Mean", "[", 
            RowBox[{"linearizedPhase", "[", 
             RowBox[{"[", 
              RowBox[{
               RowBox[{
                RowBox[{"peakT", "[", 
                 RowBox[{"[", 
                  RowBox[{"i", ",", "1"}], "]"}], "]"}], "-", 
                RowBox[{"peakT", "[", 
                 RowBox[{"[", 
                  RowBox[{"1", ",", "1"}], "]"}], "]"}], "+", "1"}], ";;", 
               RowBox[{
                RowBox[{"peakT", "[", 
                 RowBox[{"[", 
                  RowBox[{
                   RowBox[{"i", "+", "1"}], ",", "1"}], "]"}], "]"}], "-", 
                RowBox[{"peakT", "[", 
                 RowBox[{"[", 
                  RowBox[{"1", ",", "1"}], "]"}], "]"}], "-", "1"}]}], "]"}], 
             "]"}], "]"}], ",", 
           RowBox[{"{", 
            RowBox[{"i", ",", "1", ",", 
             RowBox[{
              RowBox[{"Length", "[", "peakT", "]"}], "-", "1"}]}], "}"}]}], 
          "]"}], "*", 
         RowBox[{"180", "/", "Pi"}]}]}], ";", "\[IndentingNewLine]", 
       "\[IndentingNewLine]", 
       RowBox[{"t1", "=", 
        RowBox[{"AbsoluteTime", "[", "]"}]}], ";", "\[IndentingNewLine]", 
       RowBox[{"(*", 
        RowBox[{
         RowBox[{"Print", "[", 
          RowBox[{"\"\<> Phase solved: elapsed time = \>\"", ",", 
           RowBox[{"t1", "-", "t0"}], ",", "\"\<[s]\>\""}], "]"}], ";"}], 
        "*)"}], "\[IndentingNewLine]", "\[IndentingNewLine]", 
       RowBox[{"Return", "[", "errorP", "]"}]}]}], "\[IndentingNewLine]", 
     "]"}], ";"}], "\[IndentingNewLine]", ")"}]}]], "Input",
 CellChangeTimes->{
  3.822492878602187*^9, {3.8224930058589163`*^9, 3.822493006645373*^9}, 
   3.8224931499238806`*^9, {3.8224932709041376`*^9, 3.822493273550139*^9}, {
   3.822493393889518*^9, 3.8224934241633096`*^9}, {3.822493658862978*^9, 
   3.822493715139911*^9}, {3.8224937959188914`*^9, 3.8224938292100077`*^9}, {
   3.822494067978244*^9, 3.8224940903923903`*^9}, {3.8224942311685205`*^9, 
   3.8224942448412*^9}, {3.8224943487069073`*^9, 3.822494416549449*^9}, {
   3.8224944663065987`*^9, 3.8224944666923013`*^9}, 3.822494618506987*^9, {
   3.8224948072681203`*^9, 3.8224948133060055`*^9}, {3.822554294814774*^9, 
   3.822554295949778*^9}, {3.822562743046319*^9, 3.8225627567715144`*^9}, {
   3.8225640500135937`*^9, 3.822564069603611*^9}, {3.8225641104411306`*^9, 
   3.8225641147016373`*^9}, {3.822579290119934*^9, 3.8225792902671766`*^9}, {
   3.8225795705124936`*^9, 3.8225797061936975`*^9}, {3.822579862484825*^9, 
   3.8225799177198734`*^9}, {3.82257998360664*^9, 3.8225800320515375`*^9}, {
   3.822580223157029*^9, 3.822580251401943*^9}, {3.822580367301899*^9, 
   3.822580372200272*^9}, {3.82258092787403*^9, 3.822580964173089*^9}, {
   3.8225809999787884`*^9, 3.822581033047849*^9}, {3.822581199123309*^9, 
   3.8225812002266455`*^9}, {3.8225812356899796`*^9, 
   3.8225812430822277`*^9}, {3.8225815973017206`*^9, 3.822581650579686*^9}, {
   3.8225816922731586`*^9, 3.8225817463103495`*^9}, {3.822581988682259*^9, 
   3.82258199305827*^9}, {3.8225821513124104`*^9, 3.822582272507353*^9}, {
   3.822582498389442*^9, 3.8225825011803017`*^9}, {3.8225829894426737`*^9, 
   3.8225830090647397`*^9}, {3.822583073372199*^9, 3.822583073795903*^9}, {
   3.8225831444470987`*^9, 3.822583145913085*^9}, {3.822583228897163*^9, 
   3.8225832405599875`*^9}, {3.822583323428615*^9, 3.822583323698162*^9}, 
   3.8233545805077934`*^9, {3.823354685901331*^9, 3.823354693856892*^9}, {
   3.823358857459176*^9, 3.823358869167984*^9}, {3.823596979461104*^9, 
   3.8235969875166793`*^9}, {3.823598524453189*^9, 3.823598639899991*^9}, {
   3.8235986982823*^9, 3.8235988327271934`*^9}, {3.823598929304826*^9, 
   3.8235989522734785`*^9}, {3.823599641906768*^9, 3.823599659431821*^9}, {
   3.823599733062941*^9, 3.823599745971265*^9}, {3.8236008180558214`*^9, 
   3.823600882347562*^9}, {3.8236136081340604`*^9, 3.82361361296128*^9}, {
   3.823681707257349*^9, 3.823681708994249*^9}, {3.823686918814213*^9, 
   3.823686938422887*^9}, {3.823687016844222*^9, 3.823687224626627*^9}, {
   3.823687303126145*^9, 3.8236873549926453`*^9}, {3.8236873892866344`*^9, 
   3.823687472849032*^9}, {3.8236875352302847`*^9, 3.8236875838014793`*^9}, {
   3.823687620059818*^9, 3.8236876287413497`*^9}, {3.8236876660438004`*^9, 
   3.82368766627575*^9}, {3.8236958816471524`*^9, 3.823695908488454*^9}, {
   3.8237017448030853`*^9, 3.823701750591502*^9}, {3.8237076438214817`*^9, 
   3.8237076631608815`*^9}, {3.8237077399448967`*^9, 3.8237077550061064`*^9}, 
   3.824378105726492*^9},
 Background->RGBColor[0.94, 0.91, 0.88],
 CellLabel->"In[17]:=",ExpressionUUID->"9d145e8b-5dc3-4f93-88e3-ed74660a6918"]
}, Closed]],

Cell[CellGroupData[{

Cell["BlocksPosition", "Subsection",
 CellChangeTimes->{{3.8266384496746454`*^9, 
  3.8266384547726736`*^9}},ExpressionUUID->"9018ec1e-3a35-4c7b-8128-\
2b944a1cb80b"],

Cell[BoxData[
 RowBox[{
  RowBox[{"idBlocksPosition", "[", 
   RowBox[{
   "magnetizations_", ",", "terminations_", ",", "blockThick_", ",", 
    "blockGap_"}], "]"}], ":=", 
  RowBox[{"(", "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"Module", "[", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{
       "longPos", ",", "nTotalBl", ",", "nCasseteBl", ",", "blockidx"}], 
       "}"}], ",", "\[IndentingNewLine]", "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"nTotalBl", "=", 
        RowBox[{
         RowBox[{"(", 
          RowBox[{
           RowBox[{"Length", "[", 
            RowBox[{"magnetizations", "[", 
             RowBox[{"[", "1", "]"}], "]"}], "]"}], "+", 
           RowBox[{"Length", "[", 
            RowBox[{"terminations", "[", 
             RowBox[{"[", 
              RowBox[{"1", ",", "1"}], "]"}], "]"}], "]"}], "+", 
           RowBox[{"Length", "[", 
            RowBox[{"terminations", "[", 
             RowBox[{"[", 
              RowBox[{"1", ",", "4"}], "]"}], "]"}], "]"}]}], ")"}], "*", 
         "4"}]}], ";", "\[IndentingNewLine]", 
       RowBox[{"nCasseteBl", "=", 
        RowBox[{"nTotalBl", "/", "4"}]}], ";", "\[IndentingNewLine]", 
       "\[IndentingNewLine]", 
       RowBox[{"longPos", "=", 
        RowBox[{"ConstantArray", "[", 
         RowBox[{"0", ",", "nCasseteBl"}], "]"}]}], ";", " ", 
       "\[IndentingNewLine]", 
       RowBox[{"blockidx", "=", "1"}], ";", "\[IndentingNewLine]", 
       "\[IndentingNewLine]", 
       RowBox[{"For", "[", 
        RowBox[{
         RowBox[{"i", "=", "2"}], ",", 
         RowBox[{"i", "\[LessEqual]", " ", 
          RowBox[{"Length", "[", 
           RowBox[{"terminations", "[", 
            RowBox[{"[", 
             RowBox[{"1", ",", "1"}], "]"}], "]"}], "]"}]}], ",", 
         RowBox[{"i", "++"}], ",", "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{
           RowBox[{"longPos", "[", 
            RowBox[{"[", "i", "]"}], "]"}], "=", 
           RowBox[{
            RowBox[{"longPos", "[", 
             RowBox[{"[", 
              RowBox[{"i", "-", "1"}], "]"}], "]"}], "+", 
            RowBox[{"0.5", "*", 
             RowBox[{"terminations", "[", 
              RowBox[{"[", 
               RowBox[{"1", ",", "2", ",", 
                RowBox[{"i", "-", "1"}]}], "]"}], "]"}]}], "+", 
            RowBox[{"terminations", "[", 
             RowBox[{"[", 
              RowBox[{"1", ",", "3", ",", 
               RowBox[{"i", "-", "1"}]}], "]"}], "]"}], "+", 
            RowBox[{"0.5", "*", 
             RowBox[{"terminations", "[", 
              RowBox[{"[", 
               RowBox[{"1", ",", "2", ",", "i"}], "]"}], "]"}]}]}]}], ";", 
          "\[IndentingNewLine]", 
          RowBox[{"blockidx", "+=", "1"}], ";"}]}], "\[IndentingNewLine]", 
        "]"}], ";", "\[IndentingNewLine]", "\n", "\t", 
       RowBox[{"blockidx", "+=", "1"}], ";", 
       RowBox[{
        RowBox[{"longPos", "[", 
         RowBox[{"[", "blockidx", "]"}], "]"}], "=", 
        RowBox[{
         RowBox[{"longPos", "[", 
          RowBox[{"[", 
           RowBox[{"blockidx", "-", "1"}], "]"}], "]"}], "+", 
         RowBox[{"0.5", "*", 
          RowBox[{"terminations", "[", 
           RowBox[{"[", 
            RowBox[{"1", ",", "2", ",", 
             RowBox[{"-", "1"}]}], "]"}], "]"}]}], "+", 
         RowBox[{"terminations", "[", 
          RowBox[{"[", 
           RowBox[{"1", ",", "3", ",", 
            RowBox[{"-", "1"}]}], "]"}], "]"}], "+", 
         RowBox[{"0.5", "*", "blockThick"}]}]}], ";", "\[IndentingNewLine]", 
       "\n", "\t", 
       RowBox[{"For", "[", 
        RowBox[{
         RowBox[{"i", "=", "2"}], ",", 
         RowBox[{"i", "\[LessEqual]", " ", 
          RowBox[{"Length", "[", 
           RowBox[{"magnetizations", "[", 
            RowBox[{"[", "1", "]"}], "]"}], "]"}]}], ",", 
         RowBox[{"i", "++"}], ",", "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{"blockidx", "+=", "1"}], ";", "\[IndentingNewLine]", 
          RowBox[{
           RowBox[{"longPos", "[", 
            RowBox[{"[", "blockidx", "]"}], "]"}], "=", 
           RowBox[{
            RowBox[{"longPos", "[", 
             RowBox[{"[", 
              RowBox[{"blockidx", "-", "1"}], "]"}], "]"}], "+", "blockThick",
             "+", "blockGap"}]}], ";"}]}], "\[IndentingNewLine]", "]"}], ";", 
       "\[IndentingNewLine]", "\n", "\t", 
       RowBox[{"blockidx", "+=", "1"}], ";", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"longPos", "[", 
         RowBox[{"[", "blockidx", "]"}], "]"}], "=", 
        RowBox[{
         RowBox[{"longPos", "[", 
          RowBox[{"[", 
           RowBox[{"blockidx", "-", "1"}], "]"}], "]"}], "+", 
         RowBox[{"blockThick", "/", "2"}], "+", 
         RowBox[{"terminations", "[", 
          RowBox[{"[", 
           RowBox[{"1", ",", "6", ",", "1"}], "]"}], "]"}], "+", 
         RowBox[{
          RowBox[{"terminations", "[", 
           RowBox[{"[", 
            RowBox[{"1", ",", "5", ",", "1"}], "]"}], "]"}], "/", "2"}]}]}], 
       ";", "\[IndentingNewLine]", "\[IndentingNewLine]", 
       RowBox[{"For", "[", 
        RowBox[{
         RowBox[{"i", "=", "2"}], ",", 
         RowBox[{"i", "\[LessEqual]", " ", 
          RowBox[{"Length", "[", 
           RowBox[{"terminations", "[", 
            RowBox[{"[", 
             RowBox[{"1", ",", "4"}], "]"}], "]"}], "]"}]}], ",", 
         RowBox[{"i", "++"}], ",", "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{"blockidx", "+=", "1"}], ";", "\[IndentingNewLine]", 
          RowBox[{
           RowBox[{"longPos", "[", 
            RowBox[{"[", "blockidx", "]"}], "]"}], "=", 
           RowBox[{
            RowBox[{"longPos", "[", 
             RowBox[{"[", 
              RowBox[{"blockidx", "-", "1"}], "]"}], "]"}], "+", 
            RowBox[{"0.5", "*", 
             RowBox[{"terminations", "[", 
              RowBox[{"[", 
               RowBox[{"1", ",", "5", ",", 
                RowBox[{"i", "-", "1"}]}], "]"}], "]"}]}], "+", 
            RowBox[{"terminations", "[", 
             RowBox[{"[", 
              RowBox[{"1", ",", "6", ",", "i"}], "]"}], "]"}], "+", 
            RowBox[{"0.5", "*", 
             RowBox[{"terminations", "[", 
              RowBox[{"[", 
               RowBox[{"1", ",", "5", ",", "i"}], "]"}], "]"}]}]}]}], ";"}]}],
         "\[IndentingNewLine]", "]"}], ";", "\[IndentingNewLine]", 
       "\[IndentingNewLine]", 
       RowBox[{"Return", "[", "longPos", "]"}]}]}], "\[IndentingNewLine]", 
     "]"}], ";"}], "\[IndentingNewLine]", ")"}]}]], "Input",
 CellChangeTimes->{{3.826638208705908*^9, 3.826638366801129*^9}},
 Background->RGBColor[0.94, 0.91, 0.88],
 CellLabel->"In[18]:=",ExpressionUUID->"357e58d5-d111-4a17-9bf6-24c22e06f92a"]
}, Closed]]
}, Open  ]],

Cell[CellGroupData[{

Cell["Calculo", "Section",
 CellChangeTimes->{{3.8242161122278366`*^9, 
  3.824216127589432*^9}},ExpressionUUID->"9fe615ce-df8d-457e-a323-\
9c629d49e6a7"],

Cell[CellGroupData[{

Cell["Parameters", "Subsection",
 CellChangeTimes->{{3.8233405764015217`*^9, 
  3.8233405780702906`*^9}},ExpressionUUID->"747ea528-ca9f-41bd-95bd-\
1b1fc9cdf4e8"],

Cell[BoxData[
 RowBox[{
  RowBox[{"(*", 
   RowBox[{"===", 
    RowBox[{"==", " ", 
     RowBox[{"Magnetic", " ", "Design"}]}], " ", "===", "=="}], "*)"}], 
  "\[IndentingNewLine]", 
  RowBox[{
   RowBox[{
    RowBox[{"periodL", "=", "52.5"}], ";"}], " ", 
   RowBox[{"(*", 
    RowBox[{"Period", " ", 
     RowBox[{"Length", " ", "[", "mm", "]"}]}], "*)"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"gap", "=", "13.6"}], ";"}], " ", 
   RowBox[{"(*", 
    RowBox[{"Minimum", " ", "ID", " ", 
     RowBox[{"gap", " ", "[", "mm", "]"}]}], "*)"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"nPeriods", "=", "21"}], ";", " ", 
    RowBox[{"(*", 
     RowBox[{
     "number", " ", "of", " ", "periods", " ", "without", " ", 
      "terminations"}], "*)"}], "\[IndentingNewLine]", 
    RowBox[{"blockGap", "=", "0.125"}], ";", " ", 
    RowBox[{"(*", 
     RowBox[{"space", " ", "between", " ", 
      RowBox[{"blocks", " ", "[", "mm", "]"}]}], "*)"}], 
    "\[IndentingNewLine]", 
    RowBox[{"eEnergy", " ", "=", " ", "3"}], ";", " ", 
    RowBox[{"(*", 
     RowBox[{"Particle", " ", 
      RowBox[{"energy", " ", "[", "GeV", "]"}]}], "*)"}], 
    "\[IndentingNewLine]", "\[IndentingNewLine]", 
    RowBox[{"(*", 
     RowBox[{"===", 
      RowBox[{"=", " ", 
       RowBox[{
        RowBox[{"Magnetic", " ", "Blocks"}], " ", "===", "=="}]}]}], "*)"}], 
    "\[IndentingNewLine]", 
    RowBox[{"blockGeo", "=", 
     RowBox[{"idBlockGeometry", "[", "1", "]"}]}], ";", " ", 
    RowBox[{"(*", 
     RowBox[{
      RowBox[{"Blocks", " ", 
       RowBox[{"Geometry", ":", " ", "1"}]}], "=", "A1"}], "*)"}], 
    "\[IndentingNewLine]", 
    RowBox[{"blockThick", "=", "13"}], ";", " ", 
    RowBox[{"(*", 
     RowBox[{"Block", " ", 
      RowBox[{"Thickness", " ", "[", "mm", "]"}]}], "*)"}], 
    "\[IndentingNewLine]", 
    RowBox[{"magInput", "=", "2"}], ";", " ", 
    RowBox[{"(*", 
     RowBox[{
      RowBox[{
       RowBox[{
        RowBox[{"Type", " ", "of", " ", "input", " ", "for", " ", 
         RowBox[{"Magnetizations", ":", " ", 
          RowBox[{
           RowBox[{"[", "1", "]"}], "Import", " ", "from", " ", "File"}]}]}], 
        " ", ";"}], " ", "[", "2", "]"}], "Aleatory", " ", "Generation"}], 
     "*)"}], "\[IndentingNewLine]", "\[IndentingNewLine]", 
    RowBox[{"fileNameB", "=", "\"\<Magnetizations.xlsx\>\""}], ";", " ", 
    RowBox[{"(*", 
     RowBox[{"Magnetizations", " ", "File", " ", "name", " ", 
      RowBox[{"(", 
       RowBox[{"with", " ", "extension"}], ")"}]}], "*)"}], 
    "\[IndentingNewLine]", 
    RowBox[{"headLineB", "=", "0"}], ";", " ", 
    RowBox[{"(*", 
     RowBox[{
     "Number", " ", "of", " ", "Head", " ", "Lines", " ", "on", " ", "the", 
      " ", "File"}], "*)"}], "\[IndentingNewLine]", 
    RowBox[{"fileNameT", "=", "\"\<Magnetizations_Term.xlsx\>\""}], ";", " ", 
    RowBox[{"(*", 
     RowBox[{"Magnetizations", " ", "File", " ", "name", " ", 
      RowBox[{"(", 
       RowBox[{"with", " ", "extension"}], ")"}]}], "*)"}], 
    "\[IndentingNewLine]", 
    RowBox[{"headLineT", "=", "0"}], ";", " ", 
    RowBox[{"(*", 
     RowBox[{
     "Number", " ", "of", " ", "Head", " ", "Lines", " ", "on", " ", "the", 
      " ", "File"}], "*)"}], "\[IndentingNewLine]", "\[IndentingNewLine]", 
    RowBox[{"magnAmp", "=", "1.37"}], ";", " ", 
    RowBox[{"(*", 
     RowBox[{"Remanent", " ", "Block", " ", 
      RowBox[{"Magnetization", " ", "[", "T", "]"}]}], "*)"}], 
    "\[IndentingNewLine]", 
    RowBox[{"magError", "=", "1"}], ";", " ", 
    RowBox[{"(*", 
     RowBox[{"Include", 
      RowBox[{"(", "1", ")"}], " ", "or", " ", "not", 
      RowBox[{"(", "0", ")"}], " ", "magnetization", " ", "errors"}], "*)"}], 
    "\[IndentingNewLine]", 
    RowBox[{"magAmpError", "=", 
     RowBox[{"0.01", "*", "magnAmp"}]}], ";", " ", 
    RowBox[{"(*", 
     RowBox[{"Magnetization", " ", "Amplitude", " ", 
      RowBox[{"Error", " ", "[", "T", "]"}]}], "*)"}], "\[IndentingNewLine]", 
    RowBox[{"magTheta", "=", "1"}], ";", " ", 
    RowBox[{"(*", 
     RowBox[{"Magnetization", " ", "Angle", " ", 
      RowBox[{"Error", " ", "[", "deg", "]"}]}], "*)"}], 
    "\[IndentingNewLine]", 
    RowBox[{"posErrors", "=", 
     RowBox[{"{", 
      RowBox[{"0", ",", "0"}], "}"}]}], ";", " ", 
    RowBox[{"(*", 
     RowBox[{
      RowBox[{"Position", " ", "Error", " ", "Limit", " ", 
       RowBox[{"{", 
        RowBox[{"x", ",", "y"}], "}"}]}], "+", 
      RowBox[{"-", 
       RowBox[{"[", "mm", "]"}]}]}], " ", "*)"}], "\[IndentingNewLine]", 
    "\[IndentingNewLine]", 
    RowBox[{"(*", 
     RowBox[{"===", 
      RowBox[{"==", " ", 
       RowBox[{"Other", " ", "Parameters"}]}], " ", "===", "=="}], "*)"}], 
    "\[IndentingNewLine]", 
    RowBox[{"mode", "=", "1"}], ";", " ", 
    RowBox[{"(*", 
     RowBox[{
      RowBox[{"Phase", ":", " ", "1"}], "=", 
      RowBox[{
       RowBox[{
        RowBox[{"Linear", " ", 
         RowBox[{"Hor", "."}]}], " ", "|", " ", "2"}], "=", "?"}]}], "*)"}], 
    "\[IndentingNewLine]", 
    RowBox[{"symmetry", "=", "\"\<antisymmetric\>\""}], ";", " ", 
    RowBox[{"(*", 
     RowBox[{"ID", " ", 
      RowBox[{"symmetry", ":", " ", 
       RowBox[{
       "\"\<symmetric\>\"", " ", "or", " ", "\"\<antisymmetric\>\""}]}]}], 
     "*)"}], "\[IndentingNewLine]", 
    RowBox[{"termType", "=", "\"\<FourBlocksAntiSym\>\""}], ";", " ", 
    RowBox[{"(*", 
     RowBox[{"Termination", " ", 
      RowBox[{"Type", ":", " ", 
       RowBox[{
       "\"\<FourBlocksAntiSym\>\"", " ", "|", " ", 
        "\"\<ThreeBlocksAntiSym\>\"", " ", "|", " ", 
        "\"\<ThreeBlocksAntiSymReal\>\"", " ", "|", " ", 
        "\"\<ThreeBlockSym\>\"", " ", "|", " ", 
        RowBox[{"?", 
         RowBox[{"\"\<Simple-Half\>\"", "?"}]}]}]}]}], " ", "*)"}], 
    "\[IndentingNewLine]", 
    RowBox[{"typeID", "=", "\"\<DeltaUndulator\>\""}], ";", " ", 
    RowBox[{"(*", 
     RowBox[{
     "\"\<DeltaUndulator\>\"", " ", "|", " ", "\"\<PlanarUndulator\>\"", " ", 
      "|", " ", "\"\<EPU\>\""}], "*)"}], "\[IndentingNewLine]", 
    RowBox[{"gap2", "=", "0"}], ";", " ", 
    RowBox[{"(*", 
     RowBox[{
     "Horizontal", " ", "gap", " ", "in", " ", "case", " ", "of", " ", "EPU", 
      " ", 
      RowBox[{"undulator", " ", "[", "mm", "]"}]}], "*)"}], 
    "\[IndentingNewLine]", "\[IndentingNewLine]", 
    RowBox[{"(*", 
     RowBox[{"===", 
      RowBox[{"==", " ", 
       RowBox[{"Calculation", " ", "Parameters"}]}], " ", "===", "=="}], 
     "*)"}], "\[IndentingNewLine]", 
    RowBox[{"subdiv", "=", 
     RowBox[{"{", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"2", ",", "1", ",", "1"}], "}"}], ",", 
       RowBox[{"{", 
        RowBox[{"1", ",", "1", ",", "1"}], "}"}], ",", 
       RowBox[{"{", 
        RowBox[{"1", ",", "2", ",", "2"}], "}"}]}], "}"}]}], ";", " ", 
    RowBox[{"(*", 
     RowBox[{
      RowBox[{
      "subdivisons", " ", "on", " ", "each", " ", "part", " ", "of", " ", 
       "the", " ", "block", " ", "geometry"}], ",", " ", 
      RowBox[{
       RowBox[{"for", " ", "each", " ", "direction", " ", 
        RowBox[{"(", 
         RowBox[{"nx", ",", "ny", ",", "nz"}], ")"}]}], ":", " ", 
       RowBox[{"{", 
        RowBox[{
         RowBox[{"{", 
          RowBox[{"nx", ",", "ny", ",", "nz"}], "}"}], ",", 
         RowBox[{"{", 
          RowBox[{"nx", ",", "ny", ",", "nz"}], "}"}], ",", 
         RowBox[{"{", 
          RowBox[{"nx", ",", "ny", ",", "nz"}], "}"}]}], "}"}]}]}], "*)"}], 
    "\[IndentingNewLine]", "\[IndentingNewLine]", 
    RowBox[{"(*", 
     RowBox[{"Longitudinal", " ", 
      RowBox[{"Range", " ", "[", "mm", "]"}]}], "*)"}], "\[IndentingNewLine]", 
    RowBox[{"lstep", " ", "=", "1"}], ";", " ", 
    RowBox[{"(*", 
     RowBox[{"Longitudinal", " ", 
      RowBox[{"Step", " ", "[", "mm", "]"}]}], "*)"}], "\[IndentingNewLine]", 
    RowBox[{"oversize", "=", "200"}], ";", " ", 
    RowBox[{"(*", 
     RowBox[{
     "Excess", " ", "on", " ", "each", " ", "side", " ", "to", " ", "start", 
      " ", "and", " ", "finish", " ", "the", " ", 
      RowBox[{"computations", " ", "[", "mm", "]"}]}], "*)"}], 
    "\[IndentingNewLine]", 
    RowBox[{"li", " ", "=", " ", 
     RowBox[{"-", "oversize"}]}], ";"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"lf", " ", "=", 
     RowBox[{
      RowBox[{
       RowBox[{"(", 
        RowBox[{"nPeriods", "+", "2"}], ")"}], "*", "periodL"}], "+", 
      "oversize"}]}], ";"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"lNpts", " ", "=", 
     RowBox[{
      RowBox[{"Round", "[", 
       RowBox[{
        RowBox[{"(", 
         RowBox[{"lf", " ", "-", "li"}], ")"}], "/", "lstep"}], " ", "]"}], 
      "+", " ", "1"}]}], ";"}], " ", "\[IndentingNewLine]", 
   "\[IndentingNewLine]", 
   RowBox[{"(*", 
    RowBox[{"===", 
     RowBox[{"==", " ", 
      RowBox[{"Sorting", " ", "Parameters"}]}], " ", "===", "=="}], "*)"}], 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"nphase", "=", "3"}], ";", " ", 
    RowBox[{"(*", 
     RowBox[{
     "number", " ", "of", " ", "phases", " ", "to", " ", "consider", " ", 
      "on", " ", 
      RowBox[{"Otimization", ":", " ", 
       RowBox[{"{", 
        RowBox[{
        "LinearHoriz", ",", " ", "LinearCirc", ",", " ", "LinearVert"}], 
        "}"}]}]}], "*)"}], "\[IndentingNewLine]", 
    RowBox[{"genNumber", "=", "1"}], ";", " ", 
    RowBox[{"(*", 
     RowBox[{"number", " ", "of", " ", "Generations"}], "*)"}], 
    "\[IndentingNewLine]", 
    RowBox[{"genSize", "=", "10"}], ";", " ", 
    RowBox[{"(*", 
     RowBox[{
     "size", " ", "of", " ", "each", " ", "generation", " ", "from", " ", "2",
       "nd"}], "*)"}], "\[IndentingNewLine]", 
    RowBox[{"firstGenSize", "=", "50"}], ";", " ", 
    RowBox[{"(*", 
     RowBox[{
     "size", " ", "of", " ", "the", " ", "1", "st", " ", "generation"}], 
     "*)"}], "\[IndentingNewLine]"}]}]}]], "Input",
 CellChangeTimes->{{3.823006846322488*^9, 3.8230069060026283`*^9}, {
   3.823006941388849*^9, 3.8230069449799857`*^9}, {3.8230082923411474`*^9, 
   3.823008314869647*^9}, {3.8230083450346365`*^9, 3.8230085448784738`*^9}, {
   3.8230086058259954`*^9, 3.8230086213355737`*^9}, {3.8230087795682364`*^9, 
   3.823008785430538*^9}, {3.823008965891283*^9, 3.8230089992300415`*^9}, {
   3.8230094345273604`*^9, 3.82300949823573*^9}, {3.8230095512221775`*^9, 
   3.8230095520246325`*^9}, {3.8230095880543385`*^9, 3.823009601378403*^9}, {
   3.8230097311227455`*^9, 3.8230097578939714`*^9}, {3.823009807584254*^9, 
   3.8230098079696226`*^9}, {3.8230098428570642`*^9, 
   3.8230098468359966`*^9}, {3.823010010032849*^9, 3.8230100110343122`*^9}, {
   3.823010068984992*^9, 3.8230100879384785`*^9}, 3.8230102456885505`*^9, {
   3.8230104537277174`*^9, 3.823010454861856*^9}, {3.8230115432182617`*^9, 
   3.823011544168775*^9}, {3.8230116950258036`*^9, 3.8230117275651274`*^9}, {
   3.8230121502150497`*^9, 3.8230121680581884`*^9}, {3.8230126556711683`*^9, 
   3.823012658354679*^9}, {3.8230127168048267`*^9, 3.823012720145299*^9}, {
   3.8230128898960905`*^9, 3.8230129139649982`*^9}, {3.823013340726514*^9, 
   3.8230133465499244`*^9}, {3.823014861839714*^9, 3.823014887224802*^9}, 
   3.823014924421611*^9, 3.823015041881649*^9, {3.8230161642488713`*^9, 
   3.8230161743607426`*^9}, {3.823069516343995*^9, 3.82306969735824*^9}, {
   3.8230750570907884`*^9, 3.823075066587857*^9}, {3.8230751138885283`*^9, 
   3.823075121688725*^9}, {3.82307638514458*^9, 3.8230763913553643`*^9}, {
   3.8230767561550055`*^9, 3.8230767799497075`*^9}, {3.823076972005566*^9, 
   3.8230769726897955`*^9}, {3.823077093492547*^9, 3.823077123329562*^9}, {
   3.8230782723367176`*^9, 3.823078326605771*^9}, {3.8230812564981112`*^9, 
   3.8230812763505397`*^9}, {3.823081878241911*^9, 3.823081893386614*^9}, {
   3.823081924242709*^9, 3.823081955419917*^9}, {3.823082348054599*^9, 
   3.823082350590667*^9}, {3.82308381754845*^9, 3.8230838203767347`*^9}, {
   3.8230844145254054`*^9, 3.823084415041471*^9}, {3.8230848960481567`*^9, 
   3.8230849457792377`*^9}, {3.8230849781146765`*^9, 3.823085002122597*^9}, {
   3.823086962379418*^9, 3.823086962965016*^9}, {3.8230871113184395`*^9, 
   3.8230871139724236`*^9}, {3.823087144121188*^9, 3.8230871442528434`*^9}, {
   3.823087536933833*^9, 3.8230875403277884`*^9}, {3.8231010904696217`*^9, 
   3.8231011029430857`*^9}, {3.8231012026900797`*^9, 
   3.8231012215897465`*^9}, {3.8231031700030828`*^9, 
   3.8231031708937235`*^9}, {3.8231036474560947`*^9, 3.823103656580575*^9}, {
   3.823103805598419*^9, 3.823103815425969*^9}, {3.823103849234745*^9, 
   3.823103849609619*^9}, {3.823155572024024*^9, 3.823155576936425*^9}, {
   3.823169264835227*^9, 3.8231692710026717`*^9}, {3.8231693036017895`*^9, 
   3.823169340798465*^9}, {3.823169512809606*^9, 3.8231696333324413`*^9}, {
   3.823169677220273*^9, 3.823169765590374*^9}, {3.8231698277417507`*^9, 
   3.8231698878781633`*^9}, {3.8231699587880535`*^9, 
   3.8231700621037383`*^9}, {3.8231792859140596`*^9, 3.823179322539444*^9}, {
   3.8231819841366043`*^9, 3.8231821287743945`*^9}, {3.8231822857761173`*^9, 
   3.8231823344137163`*^9}, {3.8231824770813413`*^9, 
   3.8231824822671156`*^9}, {3.8231825228968573`*^9, 3.823182599333346*^9}, {
   3.8231826857036486`*^9, 3.8231827034896803`*^9}, {3.82318281990605*^9, 
   3.823182829500688*^9}, {3.8231829231504393`*^9, 3.8231830064309025`*^9}, {
   3.82318305488713*^9, 3.8231830765853043`*^9}, {3.823183112287979*^9, 
   3.823183147433326*^9}, {3.8231832040936003`*^9, 3.823183204664452*^9}, {
   3.8231852755965004`*^9, 3.823185278712427*^9}, {3.8231853893563633`*^9, 
   3.823185399354042*^9}, {3.8231857889341755`*^9, 3.823185790138307*^9}, {
   3.8231858580869827`*^9, 3.823185886365016*^9}, {3.8231859551904635`*^9, 
   3.823185967509987*^9}, {3.823186868199523*^9, 3.823186870173813*^9}, {
   3.823189511216112*^9, 3.823189516886362*^9}, 3.8232510714137216`*^9, {
   3.8232544917746634`*^9, 3.8232545094261303`*^9}, 3.8236774137198853`*^9, {
   3.8236774662021503`*^9, 3.8236774750625668`*^9}, {3.823677531087967*^9, 
   3.8236775527372704`*^9}, {3.82369999214837*^9, 3.823700004607412*^9}, {
   3.823700043710389*^9, 3.823700133937516*^9}, 3.8237002156291656`*^9, {
   3.823700392424648*^9, 3.82370039260953*^9}, 3.823700435905157*^9, {
   3.823703508507747*^9, 3.8237035106662517`*^9}, {3.8238664376058016`*^9, 
   3.8238664428184543`*^9}, {3.8238694120178137`*^9, 3.823869439996934*^9}, {
   3.823869634716196*^9, 3.823869681495384*^9}, {3.823872538179695*^9, 
   3.823872582563346*^9}, {3.8238726238316603`*^9, 3.8238726850192604`*^9}, {
   3.8242163670488667`*^9, 3.824216380910941*^9}, {3.824216440433897*^9, 
   3.824216463273857*^9}, {3.824216562877821*^9, 3.8242165897804356`*^9}, {
   3.824216621755506*^9, 3.824216626650219*^9}, {3.8242167192384005`*^9, 
   3.824216752347666*^9}, {3.8242175298929205`*^9, 3.824217589618078*^9}, {
   3.8242191570413933`*^9, 3.8242191903356256`*^9}, {3.8242901811746426`*^9, 
   3.824290183744201*^9}, {3.824298697135277*^9, 3.824298703184602*^9}, 
   3.824309094007413*^9, {3.8243779103701487`*^9, 3.824377917289545*^9}, {
   3.824385296570845*^9, 3.8243853424770327`*^9}, {3.82438573272908*^9, 
   3.8243857330449786`*^9}, {3.824457473878018*^9, 3.824457481148875*^9}, {
   3.8244592080639653`*^9, 3.824459210823598*^9}, {3.824478991219679*^9, 
   3.824479063525276*^9}, {3.8245443612090173`*^9, 3.824544363490386*^9}, {
   3.824548984555977*^9, 3.824548992277047*^9}, {3.8248026495402594`*^9, 
   3.8248026499569693`*^9}, {3.8248027067619467`*^9, 3.82480272124552*^9}, {
   3.8248032571046653`*^9, 3.8248032580819783`*^9}, {3.824817547810011*^9, 
   3.8248175514366903`*^9}, {3.8248208942728615`*^9, 3.824820898083444*^9}, {
   3.824821111628151*^9, 3.824821111728433*^9}, {3.826121790656189*^9, 
   3.8261218964795527`*^9}, {3.8261219267998643`*^9, 
   3.8261219413291993`*^9}, {3.82612208871947*^9, 3.826122106380374*^9}, {
   3.826963267081662*^9, 3.8269632687835217`*^9}, {3.826963628960849*^9, 
   3.826963629261148*^9}, {3.8269636889388447`*^9, 3.826963689794486*^9}, {
   3.8269659727212334`*^9, 3.826965973840597*^9}},
 Background->RGBColor[0.94, 0.91, 0.88],
 CellLabel->"In[51]:=",ExpressionUUID->"ada88c0b-1a57-49ae-b2d7-4b7cf9688ce4"]
}, Closed]],

Cell[CellGroupData[{

Cell["Define Magnetizations", "Subsection",
 CellChangeTimes->{{3.8242244020246735`*^9, 3.8242244024774337`*^9}, {
  3.8242986154580708`*^9, 3.824298625107431*^9}, {3.8244791036056485`*^9, 
  3.8244791066862116`*^9}},ExpressionUUID->"042a8b57-d111-4652-b3ed-\
94f3db3c2c3a"],

Cell[BoxData[{
 RowBox[{
  RowBox[{"dir", "=", 
   RowBox[{"NotebookDirectory", "[", "]"}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"DumpGet", "[", 
   RowBox[{"StringJoin", "[", 
    RowBox[{"dir", ",", "\"\<magnetizations2.mx\>\""}], "]"}], "]"}], ";", 
  RowBox[{"magnetizations", "=", "magnetizations2"}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"DumpGet", "[", 
   RowBox[{"StringJoin", "[", 
    RowBox[{"dir", ",", "\"\<terminations2.mx\>\""}], "]"}], "]"}], ";", " ", 
  RowBox[{"terminations", "=", "terminations2"}], 
  ";"}], "\[IndentingNewLine]"}], "Input",
 CellChangeTimes->{{3.826965558475614*^9, 3.8269655941039314`*^9}},
 Background->RGBColor[0.87, 0.94, 1],
 CellLabel->"In[57]:=",ExpressionUUID->"2523fd89-b4f6-4581-afbd-c457252a8410"],

Cell[BoxData[
 RowBox[{
  RowBox[{"(*", 
   RowBox[{"Blocks", " ", "Magnetizations"}], "*)"}], "\[IndentingNewLine]", 
  RowBox[{
   RowBox[{"magnetizations", "=", 
    RowBox[{"idGenerateMag", "[", 
     RowBox[{
     "typeID", ",", "nPeriods", ",", "periodL", ",", "blockThick", ",", 
      "blockGap", ",", "symmetry", ",", "magnAmp", ",", 
      RowBox[{"magError", "=", "1"}], ",", "magAmpError", ",", "magTheta"}], 
     "]"}]}], ";"}]}]], "Input",
 CellChangeTimes->{
  3.8242986050968504`*^9, {3.824298687363118*^9, 3.8242986892119884`*^9}, {
   3.824299032428837*^9, 3.8242990787314177`*^9}, {3.824299117483268*^9, 
   3.824299143961217*^9}, {3.82430923678754*^9, 3.8243092371783924`*^9}, {
   3.8243094888105216`*^9, 3.8243094919801598`*^9}, 3.824309783867967*^9, {
   3.8243098237692204`*^9, 3.824309824419037*^9}, {3.824385232213934*^9, 
   3.8243852593340683`*^9}, {3.824385431803382*^9, 3.8243854608426037`*^9}, {
   3.8243854993192606`*^9, 3.8243855040742593`*^9}, {3.824457537565977*^9, 
   3.8244575388317585`*^9}, {3.8244789810434885`*^9, 
   3.8244789847039557`*^9}, {3.8244790756077385`*^9, 
   3.8244790961339407`*^9}, {3.8244791796839685`*^9, 
   3.8244792042078857`*^9}, {3.82448240959396*^9, 3.8244824117634206`*^9}, {
   3.8244824756059856`*^9, 3.824482482324168*^9}, {3.82480201125506*^9, 
   3.8248021750472975`*^9}, {3.8248027515316753`*^9, 3.824802754247108*^9}, {
   3.8269645227396545`*^9, 3.8269645232723083`*^9}},
 Background->RGBColor[
  0.94, 0.91, 0.88],ExpressionUUID->"f925d434-7d0f-4872-83e5-0cc60d0bfd6c"],

Cell[BoxData[
 RowBox[{
  RowBox[{"(*", 
   RowBox[{"Termination", " ", "Magnetizations"}], "*)"}], 
  "\[IndentingNewLine]", 
  RowBox[{
   RowBox[{"terminations", "=", 
    RowBox[{"idGenerateTerm", "[", 
     RowBox[{
     "termType", ",", "blockThick", ",", "blockGap", ",", "periodL", ",", 
      "magnAmp", ",", 
      RowBox[{"{", 
       RowBox[{"{", "}"}], "}"}], ",", 
      RowBox[{"{", 
       RowBox[{"{", "}"}], "}"}], ",", 
      RowBox[{"magError", "=", "1"}], ",", "magAmpError", ",", "magTheta"}], 
     "]"}]}], ";"}]}]], "Input",
 CellChangeTimes->{
  3.8242986050968504`*^9, {3.824298687363118*^9, 3.8242986892119884`*^9}, {
   3.824299032428837*^9, 3.8242990787314177`*^9}, {3.824299117483268*^9, 
   3.824299143961217*^9}, {3.82430923678754*^9, 3.8243092371783924`*^9}, {
   3.8243094888105216`*^9, 3.8243094919801598`*^9}, 3.824309783867967*^9, {
   3.8243098237692204`*^9, 3.824309824419037*^9}, {3.824385232213934*^9, 
   3.8243852593340683`*^9}, {3.824385431803382*^9, 3.8243854608426037`*^9}, {
   3.8243854993192606`*^9, 3.8243855040742593`*^9}, {3.824457537565977*^9, 
   3.8244575388317585`*^9}, {3.8244789810434885`*^9, 
   3.8244789847039557`*^9}, {3.8244790756077385`*^9, 
   3.8244790961339407`*^9}, {3.8244791796839685`*^9, 
   3.8244792042078857`*^9}, {3.82448240959396*^9, 3.8244824117634206`*^9}, {
   3.8244824756059856`*^9, 3.824482482324168*^9}, {3.82480201125506*^9, 
   3.8248021750472975`*^9}, {3.8248027515316753`*^9, 3.824802754247108*^9}, 
   3.8248175992742643`*^9, {3.82696378159613*^9, 3.8269637819349823`*^9}},
 Background->RGBColor[
  0.94, 0.91, 0.88],ExpressionUUID->"1e517efd-ef7a-4aa0-bf50-eb65a2529643"],

Cell[BoxData[{
 RowBox[{
  RowBox[{"dir", "=", 
   RowBox[{"NotebookDirectory", "[", "]"}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"DumpSave", "[", 
   RowBox[{
    RowBox[{"StringJoin", "[", 
     RowBox[{"dir", ",", "\"\<magnetizations.mx\>\""}], "]"}], ",", 
    "magnetizations"}], "]"}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"DumpSave", "[", 
   RowBox[{
    RowBox[{"StringJoin", "[", 
     RowBox[{"dir", ",", "\"\<terminations.mx\>\""}], "]"}], ",", 
    "terminations"}], "]"}], ";"}]}], "Input",
 CellChangeTimes->{{3.824807777654072*^9, 3.824807804042656*^9}, {
  3.824808431208134*^9, 3.824808435166544*^9}, {3.824817644462973*^9, 
  3.824817661104368*^9}, {3.8248177873517995`*^9, 3.824817790230742*^9}, {
  3.8248182408496475`*^9, 3.824818269400705*^9}, {3.8248894307645555`*^9, 
  3.824889465156864*^9}, {3.8269639048712683`*^9, 3.826963907373578*^9}},
 Background->RGBColor[
  0.94, 0.91, 0.88],ExpressionUUID->"d9997d84-4afa-484c-a237-61d1356129ba"],

Cell[BoxData[
 RowBox[{
  RowBox[{"(*", 
   RowBox[{
    RowBox[{"magM0", "=", 
     RowBox[{"Import", "[", 
      RowBox[{
       RowBox[{"StringJoin", "[", 
        RowBox[{"dir", ",", "\"\<Shim_Magnetizations.txt\>\""}], "]"}], ",", 
       "\"\<Table\>\""}], "]"}]}], ";", "\[IndentingNewLine]", 
    RowBox[{"magM", "=", 
     RowBox[{"ArrayReshape", "[", 
      RowBox[{"magM0", ",", 
       RowBox[{"Dimensions", "[", "magnetizations", "]"}]}], "]"}]}], ";", 
    "\[IndentingNewLine]", "\[IndentingNewLine]", 
    RowBox[{"termM", "=", 
     RowBox[{"Import", "[", 
      RowBox[{
       RowBox[{"StringJoin", "[", 
        RowBox[{"dir", ",", "\"\<Shim_TerminationsMag.txt\>\""}], "]"}], ",", 
       "\"\<List\>\""}], "]"}]}], ";"}], "\[IndentingNewLine]", "*)"}], 
  "\[IndentingNewLine]", "\[IndentingNewLine]", 
  RowBox[{"(*", 
   RowBox[{
    RowBox[{"DumpGet", "[", 
     RowBox[{"StringJoin", "[", 
      RowBox[{"dir", ",", "\"\<magnetizations.mx\>\""}], "]"}], "]"}], 
    "\[IndentingNewLine]", 
    RowBox[{"DumpGet", "[", 
     RowBox[{"StringJoin", "[", 
      RowBox[{"dir", ",", "\"\<terminations.mx\>\""}], "]"}], "]"}]}], 
   "*)"}]}]], "Input",
 CellChangeTimes->{
  3.8248079068295736`*^9, {3.8248083071068664`*^9, 3.8248083073381257`*^9}, {
   3.8248085172502475`*^9, 3.824808561174867*^9}, {3.8248182775767984`*^9, 
   3.824818293084476*^9}, {3.8248894769553585`*^9, 3.824889508028494*^9}},
 Background->RGBColor[
  0.94, 0.91, 0.88],ExpressionUUID->"1bfd2940-4360-49b2-bbd8-d13bf7d37d79"]
}, Closed]],

Cell[CellGroupData[{

Cell["Reference Ondulator", "Subsection",
 CellChangeTimes->{{3.8248085959951057`*^9, 3.8248085993883896`*^9}, {
  3.8269645615422053`*^9, 
  3.8269645627399235`*^9}},ExpressionUUID->"f857426b-9c51-47a4-add8-\
415f2f770899"],

Cell[BoxData[
 RowBox[{
  RowBox[{"(*", "Draw", "*)"}], "\[IndentingNewLine]", 
  RowBox[{
   RowBox[{"device", "=", 
    RowBox[{"idDraw", "[", 
     RowBox[{
      RowBox[{"typeID", "=", "\"\<DeltaUndulator\>\""}], ",", "gap", ",", 
      "nPeriods", ",", "periodL", ",", "blockGeo", ",", "blockThick", ",", 
      "blockGap", ",", "magnetizations", ",", "terminations", ",", "mode", 
      ",", "subdiv"}], " ", "]"}]}], ";"}]}]], "Input",
 CellChangeTimes->{{3.824802346035345*^9, 3.824802350185668*^9}, {
  3.8248030966686926`*^9, 3.824803109818341*^9}},
 Background->RGBColor[0.94, 0.91, 0.88],
 CellLabel->"In[60]:=",ExpressionUUID->"a6dc1a42-8b91-4f57-9ab2-9ee67ae48bae"],

Cell[BoxData[
 RowBox[{
  RowBox[{"(*", "Solve", "*)"}], "\[IndentingNewLine]", 
  RowBox[{
   RowBox[{"idSolve", "[", "device", "]"}], ";"}]}]], "Input",
 CellChangeTimes->{{3.824802346035345*^9, 3.824802350185668*^9}, {
  3.8248030966686926`*^9, 3.8248031224551735`*^9}},
 Background->RGBColor[0.94, 0.91, 0.88],
 CellLabel->"In[61]:=",ExpressionUUID->"1d758678-ae4a-4ae9-a1a3-33ed812a0b5b"],

Cell[BoxData[
 RowBox[{
  RowBox[{"(*", "Trajectory", "*)"}], "\[IndentingNewLine]", 
  RowBox[{
   RowBox[{"trajectory1", "=", 
    RowBox[{"idTrajectory", "[", 
     RowBox[{"device", ",", " ", "eEnergy", ",", 
      RowBox[{"r0", "=", 
       RowBox[{"{", 
        RowBox[{"0", ",", "0", ",", "li", ",", "0", ",", "0", ",", "1"}], 
        "}"}]}], ",", "lf", ",", "lstep", ",", 
      RowBox[{"display", "=", "0"}]}], "]"}]}], ";"}]}]], "Input",
 CellChangeTimes->{{3.824802346035345*^9, 3.824802350185668*^9}, {
   3.8248030966686926`*^9, 3.8248031224551735`*^9}, {3.8248031538253565`*^9, 
   3.8248031591437225`*^9}, {3.8248086818090315`*^9, 3.824808683897382*^9}, 
   3.8248165715193048`*^9, {3.8261220480092506`*^9, 3.8261220548737164`*^9}, {
   3.8269646407369895`*^9, 3.826964653628522*^9}, {3.82696497467295*^9, 
   3.826964989394376*^9}},
 Background->RGBColor[0.94, 0.91, 0.88],
 CellLabel->"In[62]:=",ExpressionUUID->"ebbd5454-4ef5-41c8-b26e-ac7a5895eb61"]
}, Closed]],

Cell[CellGroupData[{

Cell["Loop", "Subsection",
 CellChangeTimes->{{3.8248827166531763`*^9, 
  3.8248827241388326`*^9}},ExpressionUUID->"7ab45b19-2cde-4057-a6bc-\
db0337ac1452"],

Cell[CellGroupData[{

Cell[BoxData[{
 RowBox[{
  RowBox[{"nTotalBl", "=", 
   RowBox[{
    RowBox[{"(", 
     RowBox[{
      RowBox[{"Length", "[", 
       RowBox[{"magnetizations", "[", 
        RowBox[{"[", "1", "]"}], "]"}], "]"}], "+", 
      RowBox[{"Length", "[", 
       RowBox[{"terminations", "[", 
        RowBox[{"[", 
         RowBox[{"1", ",", "1"}], "]"}], "]"}], "]"}], "+", 
      RowBox[{"Length", "[", 
       RowBox[{"terminations", "[", 
        RowBox[{"[", 
         RowBox[{"1", ",", "4"}], "]"}], "]"}], "]"}]}], ")"}], "*", "4"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"nCasseteBl", "=", 
    RowBox[{"nTotalBl", "/", "4"}]}], ";"}], 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"listShim", "=", 
   RowBox[{"ConstantArray", "[", 
    RowBox[{"0.2", ",", 
     RowBox[{"{", 
      RowBox[{
       RowBox[{"Length", "[", "magnetizations", "]"}], ",", "nCasseteBl"}], 
      "}"}]}], "]"}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"responseMatrix", "=", 
   RowBox[{"ConstantArray", "[", 
    RowBox[{"0", ",", 
     RowBox[{"{", 
      RowBox[{
       RowBox[{"3", "*", "lNpts"}], ",", "nTotalBl"}], "}"}]}], "]"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"blockID", "=", "0"}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"status", "=", "\"\< \>\""}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"estTime", "=", "\"\<?\>\""}], ";"}], "\[IndentingNewLine]", 
  "\[IndentingNewLine]", 
  RowBox[{"(*", 
   RowBox[{"===", 
    RowBox[{"\[Equal]", " ", 
     RowBox[{"Create", " ", "Response", " ", "Matrix"}]}], " ", "===", "=="}],
    "*)"}]}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"elapsedT", "=", "0"}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"Monitor", "[", "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"For", "[", 
      RowBox[{
       RowBox[{"j", "=", "1"}], ",", 
       RowBox[{"j", "\[LessEqual]", " ", 
        RowBox[{"Length", "[", "magnetizations", "]"}]}], ",", 
       RowBox[{"j", "++"}], ",", " ", 
       RowBox[{"(*", 
        RowBox[{"j", " ", "=", " ", 
         RowBox[{"cassette", " ", "number"}]}], "*)"}], "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"For", "[", 
         RowBox[{
          RowBox[{"i", "=", "1"}], ",", 
          RowBox[{"i", "\[LessEqual]", "nCasseteBl"}], ",", 
          RowBox[{"i", "++"}], ",", " ", 
          RowBox[{"(*", 
           RowBox[{"i", " ", "=", " ", 
            RowBox[{"block", " ", "number"}]}], "*)"}], "\[IndentingNewLine]", 
          RowBox[{
           RowBox[{"blockID", "+=", "1"}], ";", "\[IndentingNewLine]", 
           RowBox[{"t00", "=", 
            RowBox[{"AbsoluteTime", "[", "]"}]}], ";", "\[IndentingNewLine]", 
           "\[IndentingNewLine]", 
           RowBox[{"status", "=", "\"\<Drawing...\>\""}], ";", 
           "\[IndentingNewLine]", 
           RowBox[{"(*", 
            RowBox[{"Draw", " ", "undulator"}], "*)"}], "\[IndentingNewLine]", 
           RowBox[{"device2", "=", 
            RowBox[{"idDraw", "[", 
             RowBox[{
              RowBox[{"typeID", "=", "\"\<DeltaUndulator\>\""}], ",", "gap", 
              ",", "nPeriods", ",", "periodL", ",", "blockGeo", ",", 
              "blockThick", ",", "blockGap", ",", "magnetizations", ",", 
              "terminations", ",", "mode", ",", "subdiv"}], " ", "]"}]}], ";",
            "\[IndentingNewLine]", "\[IndentingNewLine]", 
           RowBox[{"(*", 
            RowBox[{
             RowBox[{"Get", " ", "Cassette", " ", "Radia"}], "-", "Index"}], 
            "*)"}], "\[IndentingNewLine]", 
           RowBox[{"cassetteID", "=", 
            RowBox[{
             RowBox[{"radObjCntStuf", "[", "device2", "]"}], "[", 
             RowBox[{"[", "j", "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
           RowBox[{"(*", 
            RowBox[{"Apply", " ", "Shimming"}], "*)"}], "\[IndentingNewLine]", 
           RowBox[{"radTrfOrnt", "[", 
            RowBox[{
             RowBox[{
              RowBox[{"radObjCntStuf", "[", "cassetteID", "]"}], "[", 
              RowBox[{"[", "i", "]"}], "]"}], ",", 
             RowBox[{"radTrfTrsl", "[", 
              RowBox[{"{", 
               RowBox[{"0", ",", "0", ",", 
                RowBox[{"listShim", "[", 
                 RowBox[{"[", 
                  RowBox[{"j", ",", "i"}], "]"}], "]"}]}], "}"}], "]"}]}], 
            "]"}], ";", "\[IndentingNewLine]", "\[IndentingNewLine]", 
           RowBox[{"status", "=", "\"\<Solving...\>\""}], ";", 
           "\[IndentingNewLine]", 
           RowBox[{"(*", 
            RowBox[{"Solve", " ", "the", " ", "Model"}], "*)"}], 
           "\[IndentingNewLine]", 
           RowBox[{"idSolve", "[", "device2", "]"}], ";", 
           "\[IndentingNewLine]", "\[IndentingNewLine]", 
           RowBox[{"status", "=", "\"\<Calculating Trajectory...\>\""}], ";", 
           "\[IndentingNewLine]", 
           RowBox[{"(*", "Trajectory", "*)"}], "\[IndentingNewLine]", 
           RowBox[{"trajectory2", "=", 
            RowBox[{"idTrajectory", "[", 
             RowBox[{"device2", ",", " ", "eEnergy", ",", 
              RowBox[{"r0", "=", 
               RowBox[{"{", 
                RowBox[{
                "0", ",", "0", ",", "li", ",", "0", ",", "0", ",", "1"}], 
                "}"}]}], ",", "lf", ",", "lstep", ",", 
              RowBox[{"display", "=", "0"}]}], "]"}]}], ";", 
           "\[IndentingNewLine]", "\[IndentingNewLine]", 
           RowBox[{
            RowBox[{"responseMatrix", "[", 
             RowBox[{"[", 
              RowBox[{"All", ",", "blockID"}], "]"}], "]"}], "=", 
            RowBox[{"Join", "[", 
             RowBox[{
              RowBox[{
               RowBox[{"(", 
                RowBox[{
                 RowBox[{"trajectory2", "[", 
                  RowBox[{"[", 
                   RowBox[{"All", ",", "1"}], "]"}], "]"}], "-", 
                 RowBox[{"trajectory1", "[", 
                  RowBox[{"[", 
                   RowBox[{"All", ",", "1"}], "]"}], "]"}]}], ")"}], "/", 
               RowBox[{"listShim", "[", 
                RowBox[{"[", 
                 RowBox[{"j", ",", "i"}], "]"}], "]"}]}], ",", 
              RowBox[{
               RowBox[{"(", 
                RowBox[{
                 RowBox[{"trajectory2", "[", 
                  RowBox[{"[", 
                   RowBox[{"All", ",", "2"}], "]"}], "]"}], "-", 
                 RowBox[{"trajectory1", "[", 
                  RowBox[{"[", 
                   RowBox[{"All", ",", "2"}], "]"}], "]"}]}], ")"}], "/", 
               RowBox[{"listShim", "[", 
                RowBox[{"[", 
                 RowBox[{"j", ",", "i"}], "]"}], "]"}]}], ",", 
              RowBox[{
               RowBox[{"(", 
                RowBox[{
                 RowBox[{"trajectory2", "[", 
                  RowBox[{"[", 
                   RowBox[{"All", ",", "3"}], "]"}], "]"}], "-", 
                 RowBox[{"trajectory1", "[", 
                  RowBox[{"[", 
                   RowBox[{"All", ",", "3"}], "]"}], "]"}]}], ")"}], "/", 
               RowBox[{"listShim", "[", 
                RowBox[{"[", 
                 RowBox[{"j", ",", "i"}], "]"}], "]"}]}], ",", "1"}], "]"}]}],
            ";", "\[IndentingNewLine]", "\[IndentingNewLine]", 
           RowBox[{"(*", 
            RowBox[{"Time", " ", "Estimation"}], "*)"}], 
           "\[IndentingNewLine]", 
           RowBox[{"elapsedt", "=", 
            RowBox[{
             RowBox[{"(", 
              RowBox[{
               RowBox[{"AbsoluteTime", "[", "]"}], "-", "t00"}], ")"}], "/", 
             "60"}]}], ";", 
           RowBox[{"(*", 
            RowBox[{"[", "min", "]"}], "*)"}], "\[IndentingNewLine]", 
           RowBox[{"elapsedT", "+=", "elapsedt"}], ";", "\[IndentingNewLine]", 
           RowBox[{"meanTime", "=", 
            RowBox[{"elapsedT", "/", "blockID"}]}], ";", 
           "\[IndentingNewLine]", 
           RowBox[{"estTime", "=", 
            RowBox[{
             RowBox[{"(", 
              RowBox[{"nTotalBl", "-", "blockID"}], ")"}], "*", 
             "meanTime"}]}], ";"}]}], "\[IndentingNewLine]", 
         "\[IndentingNewLine]", "]"}], ";"}]}], "\[IndentingNewLine]", "]"}], 
     ";"}], "\[IndentingNewLine]", ",", "\[IndentingNewLine]", 
    RowBox[{"Row", "[", 
     RowBox[{"{", 
      RowBox[{
       RowBox[{"ProgressIndicator", "[", 
        RowBox[{"blockID", ",", 
         RowBox[{"{", 
          RowBox[{"1", ",", "nTotalBl"}], "}"}]}], "]"}], ",", "\"\< \>\"", 
       ",", 
       RowBox[{
        RowBox[{"blockID", "/", 
         RowBox[{"(", "nTotalBl", ")"}]}], "*", "100.0"}], ",", 
       "\"\<[%] [\>\"", ",", "blockID", ",", "\"\</\>\"", ",", "nTotalBl", 
       ",", "\"\<] (\>\"", ",", "status", ",", "\"\<) [Elapsed Time:\>\"", 
       " ", ",", "elapsedT", ",", "\"\<min | Estimated Time:\>\"", ",", 
       "estTime", ",", "\"\< min]\>\""}], "}"}], "]"}]}], 
   "\[IndentingNewLine]", "]"}], 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"DumpSave", "[", 
   RowBox[{
    RowBox[{"StringJoin", "[", 
     RowBox[{"dir", ",", "\"\<responseMatrix.mx\>\""}], "]"}], ",", 
    "responseMatrix"}], "]"}], ";"}], "\[IndentingNewLine]", 
 RowBox[{"Dimensions", "[", "responseMatrix", "]"}]}], "Input",
 CellChangeTimes->{{3.8248087694085546`*^9, 3.824808798079613*^9}, {
   3.8248090695802546`*^9, 3.824809073571542*^9}, {3.824815386373774*^9, 
   3.824815387398862*^9}, {3.8248158817544594`*^9, 3.8248158933641977`*^9}, {
   3.8248159972424407`*^9, 3.8248160308525753`*^9}, {3.8248162348070545`*^9, 
   3.8248164355097713`*^9}, {3.824816479597432*^9, 3.8248164853535924`*^9}, {
   3.824816601102254*^9, 3.8248167165010834`*^9}, {3.824816759055457*^9, 
   3.8248167759736137`*^9}, {3.824816832392289*^9, 3.8248169795847273`*^9}, {
   3.824817291275502*^9, 3.8248173720570183`*^9}, {3.824817402826792*^9, 
   3.8248174200032363`*^9}, {3.824818394710388*^9, 3.824818470713569*^9}, {
   3.82481975655564*^9, 3.8248197593097873`*^9}, {3.8248197946773005`*^9, 
   3.824820230752124*^9}, {3.824820631179012*^9, 3.8248207580304585`*^9}, {
   3.82482098532316*^9, 3.824821004224025*^9}, {3.826122167240957*^9, 
   3.826122170947091*^9}, {3.8261230807936783`*^9, 3.8261230832370405`*^9}, {
   3.8261231643515844`*^9, 3.8261231667472725`*^9}, {3.82612320478417*^9, 
   3.8261232159336147`*^9}, {3.826123267410884*^9, 3.826123284443204*^9}, {
   3.8261233189777465`*^9, 3.82612337104642*^9}, {3.8269648252359314`*^9, 
   3.826964959542305*^9}, {3.8269650694702563`*^9, 3.8269650981889267`*^9}, {
   3.8269651878192043`*^9, 3.8269652591481733`*^9}, {3.8269653016538095`*^9, 
   3.826965304016679*^9}, 3.826965350146612*^9, {3.826965402164795*^9, 
   3.8269654113449273`*^9}},
 Background->RGBColor[0.94, 0.91, 0.88],
 CellLabel->"In[68]:=",ExpressionUUID->"8ef5bbcd-4da3-44c1-be0f-64264ee34f9b"],

Cell[BoxData[
 TemplateBox[{
  "Radia","Warning015",
   "\"The specified accuracy was not reached. This may indicate diverging or \
incomplete relaxation.\"",2,76,1,20928978658978040555,"Local","Global`Radia"},
  "MessageTemplate2"]], "Message", "MSG",
 CellChangeTimes->{3.826977280521782*^9},
 CellLabel->
  "During evaluation of \
In[68]:=",ExpressionUUID->"77a77a37-aaef-46d7-970b-28780cb313d1"],

Cell[BoxData[
 RowBox[{"{", 
  RowBox[{"4827", ",", "372"}], "}"}]], "Output",
 CellChangeTimes->{3.8270062016052666`*^9},
 CellLabel->"Out[78]=",ExpressionUUID->"64792fb4-5f13-4143-8f5b-d377384f1aa0"]
}, Open  ]]
}, Open  ]],

Cell[CellGroupData[{

Cell["Export", "Subsection",
 CellChangeTimes->{{3.8248827800812335`*^9, 
  3.8248827808312283`*^9}},ExpressionUUID->"5a71b6ab-dda3-4318-bac2-\
f23db96be686"],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{"(*", 
  RowBox[{
   RowBox[{"dir", "=", 
    RowBox[{"NotebookDirectory", "[", "]"}]}], ";", "\[IndentingNewLine]", 
   RowBox[{"Export", "[", 
    RowBox[{
     RowBox[{"StringJoin", "[", 
      RowBox[{"dir", ",", "\"\<Response_Matrix.txt\>\""}], "]"}], ",", 
     "responseMatrix", ",", "\"\<Table\>\""}], "]"}]}], "*)"}]], "Input",
 CellChangeTimes->{{3.824883230074647*^9, 3.8248832369808574`*^9}, {
   3.8248832939844804`*^9, 3.824883358410629*^9}, {3.8249762320685225`*^9, 
   3.824976232774037*^9}, 3.82696539769141*^9},
 Background->RGBColor[
  0.94, 0.91, 0.88],ExpressionUUID->"50549d50-a412-4f83-a3b7-43ce0603c6ca"],

Cell[BoxData["\<\"C:\\\\Pedro\\\\Geral\\\\Response_Matrix.txt\"\>"], "Output",
 CellChangeTimes->{3.824883393625024*^9},
 CellLabel->"Out[74]=",ExpressionUUID->"5421b05d-459d-4e5e-b35a-7989d7c67ca2"]
}, Open  ]],

Cell[BoxData[
 RowBox[{"(*", 
  RowBox[{
   RowBox[{"DumpSave", "[", 
    RowBox[{
     RowBox[{"StringJoin", "[", 
      RowBox[{"dir", ",", "\"\<responseMatrix.mx\>\""}], "]"}], ",", 
     "responseMatrix"}], "]"}], ";"}], "*)"}]], "Input",
 CellChangeTimes->{{3.8249762750501966`*^9, 3.8249762760946836`*^9}, 
   3.8269654228058476`*^9},
 Background->RGBColor[
  0.94, 0.91, 0.88],ExpressionUUID->"73afd7a1-5906-44cc-9f78-ac1d0c439ef4"],

Cell[BoxData[
 RowBox[{"DumpGet", "[", 
  RowBox[{"StringJoin", "[", 
   RowBox[{"dir", ",", "\"\<responseMatrix.mx\>\""}], "]"}], "]"}]], "Input",
 CellChangeTimes->{{3.8272402525667815`*^9, 3.8272402695211134`*^9}},
 CellLabel->"In[79]:=",ExpressionUUID->"d7554348-be15-44aa-8789-643730cd113d"],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{"Dimensions", "[", "responseMatrix", "]"}]], "Input",
 CellChangeTimes->{{3.827240282700964*^9, 3.8272402852557693`*^9}},
 CellLabel->"In[80]:=",ExpressionUUID->"86fd2da0-5245-4fd6-9d8d-3d8b96d0d8d1"],

Cell[BoxData[
 RowBox[{"{", 
  RowBox[{"4827", ",", "372"}], "}"}]], "Output",
 CellChangeTimes->{3.827240285855914*^9},
 CellLabel->"Out[80]=",ExpressionUUID->"2857c434-8934-4e3b-b7dc-16f38f1ee926"]
}, Open  ]]
}, Open  ]]
}, Open  ]]
},
WindowSize->{681, 716},
WindowMargins->{{-7, Automatic}, {Automatic, 0}},
Magnification:>1.1 Inherited,
FrontEndVersion->"12.0 for Microsoft Windows (64-bit) (April 8, 2019)",
StyleDefinitions->"Default.nb"
]
(* End of Notebook Content *)

(* Internal cache information *)
(*CellTagsOutline
CellTagsIndex->{}
*)
(*CellTagsIndex
CellTagsIndex->{}
*)
(*NotebookFileOutline
Notebook[{
Cell[558, 20, 336, 5, 57, "Text",ExpressionUUID->"f8d0a045-15f0-4510-91e4-999abbbff254"],
Cell[897, 27, 2527, 37, 231, "Input",ExpressionUUID->"49f7f3d7-297b-405a-8ba8-81d0394bc050"],
Cell[CellGroupData[{
Cell[3449, 68, 305, 5, 73, "Section",ExpressionUUID->"73c12565-d3bf-4eca-8b69-c33d6bd4a5ec"],
Cell[CellGroupData[{
Cell[3779, 77, 869, 18, 117, "Input",ExpressionUUID->"f7130747-96b6-4236-9be3-c9d4770809bc"],
Cell[CellGroupData[{
Cell[4673, 99, 2071, 33, 23, "Print",ExpressionUUID->"4b9b3e38-8926-4d5c-93c9-31b1b9379baa"],
Cell[6747, 134, 1905, 28, 23, "Print",ExpressionUUID->"d01dbfd3-a3df-4ac4-9d26-3555aeeb1873"],
Cell[8655, 164, 1921, 29, 23, "Print",ExpressionUUID->"df246e93-1332-4be9-b402-e92c28d9c39c"],
Cell[10579, 195, 1914, 28, 23, "Print",ExpressionUUID->"793d8ab8-4b57-4143-8ba4-1c15f1895ca3"]
}, Open  ]]
}, Open  ]]
}, Open  ]],
Cell[CellGroupData[{
Cell[12554, 230, 156, 3, 73, "Section",ExpressionUUID->"cfb3e124-01a4-4df8-bc8a-ebbf76cafe60"],
Cell[CellGroupData[{
Cell[12735, 237, 161, 3, 59, "Subsection",ExpressionUUID->"15713606-9118-4d54-955f-72574a6cced5"],
Cell[12899, 242, 6329, 164, 425, "Input",ExpressionUUID->"fa065e99-4543-4484-a80d-abb6becd9ea9"]
}, Closed]],
Cell[CellGroupData[{
Cell[19265, 411, 215, 4, 41, "Subsection",ExpressionUUID->"e4fe6c6b-9cb4-45ff-8ec9-3e78befadfe2"],
Cell[19483, 417, 28455, 617, 2867, "Input",ExpressionUUID->"78226229-f89d-4cc1-8ae6-49754eece200"]
}, Closed]],
Cell[CellGroupData[{
Cell[47975, 1039, 156, 3, 41, "Subsection",ExpressionUUID->"e163474f-dc71-4b7e-966d-5c46baf483b6"],
Cell[48134, 1044, 21764, 464, 1767, "Input",ExpressionUUID->"962dd326-4e25-44bf-bac2-e553ade2584e"]
}, Open  ]],
Cell[CellGroupData[{
Cell[69935, 1513, 218, 4, 59, "Subsection",ExpressionUUID->"859df76e-5f9a-4412-8825-e5bfdc280412"],
Cell[70156, 1519, 20570, 463, 2075, "Input",ExpressionUUID->"221d6026-871d-4dae-ac74-13f4f0e7499d"]
}, Closed]],
Cell[CellGroupData[{
Cell[90763, 1987, 222, 4, 41, "Subsection",ExpressionUUID->"fcc3b1e2-bffe-48af-8e91-46088c1e2f8f"],
Cell[90988, 1993, 32346, 718, 2933, "Input",ExpressionUUID->"2bf5306c-8532-48e1-9bed-913a207530de"]
}, Closed]],
Cell[CellGroupData[{
Cell[123371, 2716, 153, 3, 41, "Subsection",ExpressionUUID->"e187a7c1-fb56-49b7-8b08-95d6df6c3033"],
Cell[123527, 2721, 2294, 49, 258, "Input",ExpressionUUID->"ad359459-226c-4ccc-ba37-9220ecd108ae"]
}, Closed]],
Cell[CellGroupData[{
Cell[125858, 2775, 159, 3, 41, "Subsection",ExpressionUUID->"456dd76c-e2a4-4ef8-86e4-6176cd841332"],
Cell[126020, 2780, 12866, 279, 760, "Input",ExpressionUUID->"a77a965c-239d-42f0-a8bc-503da44027b9"]
}, Closed]],
Cell[CellGroupData[{
Cell[138923, 3064, 259, 4, 41, "Subsection",ExpressionUUID->"153839d6-64df-4378-ac05-c78dbe1ab363"],
Cell[139185, 3070, 18042, 415, 1052, "Input",ExpressionUUID->"e6616d7c-5b5d-459b-a0bf-0a282548b342"]
}, Closed]],
Cell[CellGroupData[{
Cell[157264, 3490, 223, 4, 41, "Subsection",ExpressionUUID->"9387d8cc-8345-48fd-a555-31005097a6da"],
Cell[157490, 3496, 14842, 338, 1547, "Input",ExpressionUUID->"af59c49e-ea82-4f8f-8005-aabefc0f8aa4"]
}, Closed]],
Cell[CellGroupData[{
Cell[172369, 3839, 165, 3, 41, "Subsection",ExpressionUUID->"cf47b52e-46af-452e-bab2-03f2ddb826ba"],
Cell[172537, 3844, 3587, 93, 293, "Input",ExpressionUUID->"33a6aa70-4f70-41d1-a0a5-f2bc5db0e2b3"]
}, Closed]],
Cell[CellGroupData[{
Cell[176161, 3942, 268, 4, 41, "Subsection",ExpressionUUID->"818c7509-e39b-412e-ba61-88130f28220a"],
Cell[176432, 3948, 31739, 762, 2620, "Input",ExpressionUUID->"9d145e8b-5dc3-4f93-88e3-ed74660a6918"]
}, Closed]],
Cell[CellGroupData[{
Cell[208208, 4715, 166, 3, 41, "Subsection",ExpressionUUID->"9018ec1e-3a35-4c7b-8128-2b944a1cb80b"],
Cell[208377, 4720, 6757, 164, 755, "Input",ExpressionUUID->"357e58d5-d111-4a17-9bf6-24c22e06f92a"]
}, Closed]]
}, Open  ]],
Cell[CellGroupData[{
Cell[215183, 4890, 154, 3, 73, "Section",ExpressionUUID->"9fe615ce-df8d-457e-a323-9c629d49e6a7"],
Cell[CellGroupData[{
Cell[215362, 4897, 162, 3, 59, "Subsection",ExpressionUUID->"747ea528-ca9f-41bd-95bd-1b1fc9cdf4e8"],
Cell[215527, 4902, 16167, 341, 1088, "Input",ExpressionUUID->"ada88c0b-1a57-49ae-b2d7-4b7cf9688ce4"]
}, Closed]],
Cell[CellGroupData[{
Cell[231731, 5248, 274, 4, 41, "Subsection",ExpressionUUID->"042a8b57-d111-4652-b3ed-94f3db3c2c3a"],
Cell[232008, 5254, 782, 18, 161, "Input",ExpressionUUID->"2523fd89-b4f6-4581-afbd-c457252a8410"],
Cell[232793, 5274, 1545, 28, 117, "Input",ExpressionUUID->"f925d434-7d0f-4872-83e5-0cc60d0bfd6c"],
Cell[234341, 5304, 1661, 33, 117, "Input",ExpressionUUID->"1e517efd-ef7a-4aa0-bf50-eb65a2529643"],
Cell[236005, 5339, 994, 22, 95, "Input",ExpressionUUID->"d9997d84-4afa-484c-a237-61d1356129ba"],
Cell[237002, 5363, 1520, 37, 227, "Input",ExpressionUUID->"1bfd2940-4360-49b2-bbd8-d13bf7d37d79"]
}, Closed]],
Cell[CellGroupData[{
Cell[238559, 5405, 224, 4, 41, "Subsection",ExpressionUUID->"f857426b-9c51-47a4-add8-415f2f770899"],
Cell[238786, 5411, 679, 14, 117, "Input",ExpressionUUID->"a6dc1a42-8b91-4f57-9ab2-9ee67ae48bae"],
Cell[239468, 5427, 393, 8, 73, "Input",ExpressionUUID->"1d758678-ae4a-4ae9-a1a3-33ed812a0b5b"],
Cell[239864, 5437, 970, 19, 95, "Input",ExpressionUUID->"ebbd5454-4ef5-41c8-b26e-ac7a5895eb61"]
}, Closed]],
Cell[CellGroupData[{
Cell[240871, 5461, 156, 3, 41, "Subsection",ExpressionUUID->"7ab45b19-2cde-4057-a6bc-db0337ac1452"],
Cell[CellGroupData[{
Cell[241052, 5468, 10880, 245, 1503, "Input",ExpressionUUID->"8ef5bbcd-4da3-44c1-be0f-64264ee34f9b"],
Cell[251935, 5715, 399, 9, 23, "Message",ExpressionUUID->"77a77a37-aaef-46d7-970b-28780cb313d1"],
Cell[252337, 5726, 201, 4, 36, "Output",ExpressionUUID->"64792fb4-5f13-4143-8f5b-d377384f1aa0"]
}, Open  ]]
}, Open  ]],
Cell[CellGroupData[{
Cell[252587, 5736, 158, 3, 59, "Subsection",ExpressionUUID->"5a71b6ab-dda3-4318-bac2-f23db96be686"],
Cell[CellGroupData[{
Cell[252770, 5743, 651, 14, 73, "Input",ExpressionUUID->"50549d50-a412-4f83-a3b7-43ce0603c6ca"],
Cell[253424, 5759, 199, 2, 36, "Output",ExpressionUUID->"5421b05d-459d-4e5e-b35a-7989d7c67ca2"]
}, Open  ]],
Cell[253638, 5764, 439, 11, 50, "Input",ExpressionUUID->"73afd7a1-5906-44cc-9f78-ac1d0c439ef4"],
Cell[254080, 5777, 296, 5, 32, "Input",ExpressionUUID->"d7554348-be15-44aa-8789-643730cd113d"],
Cell[CellGroupData[{
Cell[254401, 5786, 223, 3, 32, "Input",ExpressionUUID->"86fd2da0-5245-4fd6-9d8d-3d8b96d0d8d1"],
Cell[254627, 5791, 199, 4, 36, "Output",ExpressionUUID->"2857c434-8934-4e3b-b7dc-16f38f1ee926"]
}, Open  ]]
}, Open  ]]
}, Open  ]]
}
]
*)

