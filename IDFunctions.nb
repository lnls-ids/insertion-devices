(* Content-type: application/vnd.wolfram.mathematica *)

(*** Wolfram Notebook File ***)
(* http://www.wolfram.com/nb *)

(* CreatedBy='Mathematica 10.1' *)

(*CacheID: 234*)
(* Internal cache information:
NotebookFileLineBreakTest
NotebookFileLineBreakTest
NotebookDataPosition[       158,          7]
NotebookDataLength[    358289,       8314]
NotebookOptionsPosition[    353627,       8152]
NotebookOutlinePosition[    353975,       8167]
CellTagsIndexPosition[    353932,       8164]
WindowFrame->Normal*)

(* Beginning of Notebook Content *)
Notebook[{

Cell[CellGroupData[{
Cell["Load Radia", "Chapter",
 CellChangeTimes->{{3.682081047237886*^9, 3.682081055127327*^9}, 
   3.682089312128213*^9, {3.7076452366584544`*^9, 3.7076452418104725`*^9}}],

Cell[BoxData[{
 RowBox[{
  RowBox[{"<<", "Radia`"}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"RadPlot3DOptions", "[", "]"}], ";"}]}], "Input",
 CellChangeTimes->{{3.6818148953014574`*^9, 3.6818148962234063`*^9}},
 Background->RGBColor[0.87, 0.94, 1]]
}, Open  ]],

Cell[CellGroupData[{

Cell["Set Current Working Directory", "Chapter",
 CellChangeTimes->{{3.682081047237886*^9, 3.682081055127327*^9}, 
   3.682089312128213*^9, {3.7076452366584544`*^9, 3.7076452418104725`*^9}, {
   3.767520344511547*^9, 3.7675203660393763`*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{
  "SetDirectory", "[", "\"\<C:\\\\Users\\\\luana.vilela\\\\Desktop\>\"", 
   "]"}], ";"}]], "Input",
 Background->RGBColor[0.87, 0.94, 1]]
}, Open  ]],

Cell[CellGroupData[{

Cell["Insertion Device Functions (last update: 22/05/19)", "Chapter",
 CellChangeTimes->{{3.681300194179221*^9, 3.6813002033832407`*^9}, {
   3.681305983976405*^9, 3.6813059853359213`*^9}, {3.6813176225703306`*^9, 
   3.6813176235079107`*^9}, {3.6813177175941257`*^9, 3.68131771915676*^9}, {
   3.708272177122472*^9, 3.708272189394394*^9}, {3.708272239370994*^9, 
   3.708272253185425*^9}, {3.7247626663439655`*^9, 3.724762668594143*^9}, 
   3.724763762181196*^9, {3.725974849294973*^9, 3.725974857279992*^9}, {
   3.7316800228814087`*^9, 3.7316800249126425`*^9}, {3.731761928333893*^9, 
   3.731761928740137*^9}, {3.7377345647344294`*^9, 3.7377345664687967`*^9}, {
   3.737994165253688*^9, 3.7379941653786864`*^9}, {3.7489625392900763`*^9, 
   3.7489625531505637`*^9}, {3.749318816981333*^9, 3.749318817559469*^9}, {
   3.7656382216793394`*^9, 3.7656382261328287`*^9}, {3.7662401432029853`*^9, 
   3.766240154985159*^9}, {3.7663282678653297`*^9, 3.766328270484855*^9}, {
   3.766331146283388*^9, 3.7663311568355923`*^9}, {3.7663982782306576`*^9, 
   3.7663982795028768`*^9}, {3.7664037488989267`*^9, 
   3.7664037535714073`*^9}, {3.76675425955847*^9, 3.766754260902328*^9}, {
   3.767446029232342*^9, 3.7674460297011285`*^9}, {3.7675176217294626`*^9, 
   3.767517621841589*^9}}],

Cell[CellGroupData[{

Cell["APU", "Section",
 CellChangeTimes->{{3.766397988602113*^9, 3.766398000439457*^9}}],

Cell[CellGroupData[{

Cell["IDAPU", "Subsection",
 CellChangeTimes->{{3.7667543560660515`*^9, 3.7667543696296263`*^9}}],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"IDAPU", "::", "usage"}], "=", 
    "\"\<IDAPU[\[Lambda]u, Np, Br, Gap, \\\"\[Delta]P\\\":0, \
\\\"BlockGap\\\":0, \\\"Termination\\\":\\\"None\\\", \\\"PosMagErrorsB\\\"\
\[Rule] {}, \\\"PosMagErrorsU\\\"\[Rule] {}]: Returns the ID model. \
\\n\\nArgs: \\n\[Lambda]u [mm] is the ID period, \\nNp is the number of \
periods, \\nBr[T] is the remanent magnetization of the permanent magnet \
blocks, \\nGap [mm] is the length of the minimum gap between the cassettes. \
\\n\\nOptional args: \\n\[Delta]P [mm] is the phase adjustement, \\nBlockGap \
[mm] is the longitudinal gap between the blocks, \\nTermination is the \
termination type (one of the following: None, OneBlockSym, OneBlockAntiSym, \
ThreeBlocksSym, ThreeBlocksAntiSym), \\nPosMagErrorsB is a list of positions \
and magnetization errors for the cassette B, \\nPosMagErrorsU is a list of \
positions and magnetization errors for the cassette U. \\n\\nPosition and \
magnetization errors: \\nThe list of position and magnetization errors must \
be empty or have a number of elements igual to the number of blocks on each \
cassette. Each element is a list itself with the following format: \
\\n{horizontal position error[mm], vertical position error[mm], horizontal \
magnetization error[T], longitudinal magnetization error[T], vertical \
magnetization error[T]}. \\nThe errors will be add to the default values of \
position and magnetization of the blocks.\>\""}], ";"}], 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"IDAPU", "[", 
    RowBox[{
    "\[Lambda]u_", ",", " ", "Np_", ",", " ", "Br_", ",", " ", "Gap_", ",", 
     " ", 
     RowBox[{"OptionsPattern", "[", 
      RowBox[{"{", 
       RowBox[{
        RowBox[{"\"\<\[Delta]P\>\"", "\[Rule]", " ", "0"}], ",", " ", 
        RowBox[{"\"\<BlockGap\>\"", "->", "0"}], ",", " ", 
        RowBox[{"\"\<Termination\>\"", "\[Rule]", " ", "\"\<None\>\""}], ",", 
        "  ", 
        RowBox[{"\"\<PosMagErrorsB\>\"", "\[Rule]", " ", 
         RowBox[{"{", "}"}]}], ",", " ", 
        RowBox[{"\"\<PosMagErrorsU\>\"", "\[Rule]", " ", 
         RowBox[{"{", "}"}]}]}], "}"}], "]"}]}], "]"}], " ", ":=", " ", 
   RowBox[{"Module", "[", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
      "f", ",", " ", "bg", ",", "  ", "BBlockList", ",", "UBlockList", ",", 
       " ", "BlockGap", ",", "\[Delta]P", ",", " ", "Termination", ",", " ", 
       "PosMagErrorsB", " ", ",", " ", "PosMagErrorsU", ",", " ", "\[Delta]B",
        ",", " ", "B", ",", " ", "\[Delta]U", ",", " ", "U", ",", " ", "APU", 
       ",", " ", "t0", ",", " ", "t1"}], "}"}], ",", "\[IndentingNewLine]", 
     "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"t0", "=", 
       RowBox[{"AbsoluteTime", "[", "]"}]}], ";", "\[IndentingNewLine]", 
      "\[IndentingNewLine]", 
      RowBox[{"(*", 
       RowBox[{"Delete", " ", "previous", " ", "Radia", " ", "objects"}], 
       "*)"}], "\[IndentingNewLine]", 
      RowBox[{"radUtiDelAll", "[", "]"}], ";", "\[IndentingNewLine]", 
      "\[IndentingNewLine]", 
      RowBox[{"(*", 
       RowBox[{"Check", " ", "arguments"}], "*)"}], "\[IndentingNewLine]", 
      RowBox[{"If", " ", "[", 
       RowBox[{
        RowBox[{"\[Lambda]u", " ", "\[LessEqual]", " ", "0"}], ",", " ", 
        RowBox[{"Return", "[", "]"}]}], "]"}], ";", "\[IndentingNewLine]", 
      RowBox[{"If", " ", "[", 
       RowBox[{
        RowBox[{"Np", " ", "\[LessEqual]", " ", "0"}], ",", " ", 
        RowBox[{"Return", "[", "]"}]}], "]"}], ";", "\[IndentingNewLine]", 
      RowBox[{"If", " ", "[", 
       RowBox[{
        RowBox[{"Br", " ", "\[LessEqual]", " ", "0"}], ",", " ", 
        RowBox[{"Return", "[", "]"}]}], "]"}], ";", "\[IndentingNewLine]", 
      RowBox[{"If", " ", "[", 
       RowBox[{
        RowBox[{"Gap", " ", "\[LessEqual]", " ", "0"}], ",", " ", 
        RowBox[{"Return", "[", "]"}]}], "]"}], ";", "\[IndentingNewLine]", 
      "\[IndentingNewLine]", 
      RowBox[{"(*", 
       RowBox[{"Gap", " ", "between", " ", "blocks"}], "*)"}], 
      "\[IndentingNewLine]", 
      RowBox[{"BlockGap", " ", "=", "  ", 
       RowBox[{"OptionValue", "[", "\"\<BlockGap\>\"", "]"}]}], ";", 
      "\[IndentingNewLine]", "\[IndentingNewLine]", 
      RowBox[{"(*", 
       RowBox[{"Cassettes", " ", "longitudinal", " ", 
        RowBox[{"displacement", " ", "[", "mm", "]"}]}], "*)"}], 
      "\[IndentingNewLine]", 
      RowBox[{"\[Delta]P", " ", "=", " ", 
       RowBox[{"OptionValue", "[", "\"\<\[Delta]P\>\"", "]"}]}], ";", " ", 
      RowBox[{"(*", 
       RowBox[{"Phase", " ", "adjustment"}], "*)"}], "\[IndentingNewLine]", 
      "\[IndentingNewLine]", 
      RowBox[{"(*", 
       RowBox[{"Termination", " ", "Type"}], "*)"}], "\[IndentingNewLine]", 
      RowBox[{"Termination", " ", "=", " ", 
       RowBox[{"OptionValue", "[", "\"\<Termination\>\"", "]"}]}], ";", 
      "\[IndentingNewLine]", "\[IndentingNewLine]", 
      RowBox[{"(*", 
       RowBox[{"Position", " ", "and", " ", "magnetization", " ", "errors"}], 
       "*)"}], "\[IndentingNewLine]", 
      RowBox[{"PosMagErrorsU", " ", "=", " ", 
       RowBox[{"OptionValue", "[", "\"\<PosMagErrorsU\>\"", "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"PosMagErrorsB", " ", "=", " ", 
       RowBox[{"OptionValue", "[", "\"\<PosMagErrorsB\>\"", "]"}]}], ";", 
      "\[IndentingNewLine]", "\[IndentingNewLine]", 
      RowBox[{"(*", 
       RowBox[{
       "Block", " ", "vertices", " ", "for", " ", "each", " ", "cassette"}], 
       "*)"}], "\[IndentingNewLine]", 
      RowBox[{"BBlockList", "=", 
       RowBox[{"{", 
        RowBox[{"{", 
         RowBox[{
          RowBox[{"{", " ", 
           RowBox[{"15", ",", " ", 
            RowBox[{"Gap", "/", "2"}]}], "}"}], ",", 
          RowBox[{"{", 
           RowBox[{"18", ",", " ", 
            RowBox[{
             RowBox[{"Gap", "/", "2"}], " ", "+", " ", "3"}]}], "}"}], ",", 
          RowBox[{"{", " ", 
           RowBox[{"18", ",", " ", 
            RowBox[{
             RowBox[{"Gap", "/", "2"}], " ", "+", " ", "17"}]}], "}"}], ",", 
          RowBox[{"{", 
           RowBox[{"15", ",", 
            RowBox[{
             RowBox[{"Gap", "/", "2"}], " ", "+", " ", "20"}]}], "}"}], ",", 
          " ", 
          RowBox[{"{", 
           RowBox[{
            RowBox[{"-", "15"}], ",", " ", 
            RowBox[{
             RowBox[{"Gap", "/", "2"}], " ", "+", " ", "20"}]}], "}"}], ",", 
          " ", 
          RowBox[{"{", 
           RowBox[{
            RowBox[{"-", "18"}], ",", " ", 
            RowBox[{
             RowBox[{"Gap", "/", "2"}], " ", "+", " ", "17"}]}], "}"}], ",", 
          " ", 
          RowBox[{"{", 
           RowBox[{
            RowBox[{"-", "18"}], ",", " ", 
            RowBox[{
             RowBox[{"Gap", "/", "2"}], " ", "+", " ", "3"}]}], "}"}], ",", 
          " ", 
          RowBox[{"{", 
           RowBox[{
            RowBox[{"-", "15"}], ",", " ", 
            RowBox[{"Gap", "/", "2"}]}], " ", "}"}]}], "}"}], "}"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"UBlockList", "=", 
       RowBox[{"{", 
        RowBox[{"{", 
         RowBox[{
          RowBox[{"{", " ", 
           RowBox[{"15", ",", " ", 
            RowBox[{
             RowBox[{"-", "Gap"}], "/", "2"}]}], "}"}], ",", 
          RowBox[{"{", 
           RowBox[{"18", ",", " ", 
            RowBox[{
             RowBox[{
              RowBox[{"-", "Gap"}], "/", "2"}], "-", "3"}]}], "}"}], ",", 
          RowBox[{"{", " ", 
           RowBox[{"18", ",", " ", 
            RowBox[{
             RowBox[{
              RowBox[{"-", "Gap"}], "/", "2"}], "-", "17"}]}], "}"}], ",", 
          RowBox[{"{", 
           RowBox[{"15", ",", 
            RowBox[{
             RowBox[{
              RowBox[{"-", "Gap"}], "/", "2"}], "-", "20"}]}], "}"}], ",", 
          " ", 
          RowBox[{"{", 
           RowBox[{
            RowBox[{"-", "15"}], ",", " ", 
            RowBox[{
             RowBox[{
              RowBox[{"-", "Gap"}], "/", "2"}], "-", "20"}]}], "}"}], ",", 
          " ", 
          RowBox[{"{", 
           RowBox[{
            RowBox[{"-", "18"}], ",", " ", 
            RowBox[{
             RowBox[{
              RowBox[{"-", "Gap"}], "/", "2"}], "-", "17"}]}], "}"}], ",", 
          " ", 
          RowBox[{"{", 
           RowBox[{
            RowBox[{"-", "18"}], ",", " ", 
            RowBox[{
             RowBox[{
              RowBox[{"-", "Gap"}], "/", "2"}], "-", "3"}]}], "}"}], ",", " ", 
          RowBox[{"{", 
           RowBox[{
            RowBox[{"-", "15"}], ",", " ", 
            RowBox[{
             RowBox[{"-", "Gap"}], "/", "2"}]}], "}"}]}], "}"}], "}"}]}], ";",
       "\[IndentingNewLine]", "\[IndentingNewLine]", 
      RowBox[{"(*", "Cassettes", "*)"}], "\[IndentingNewLine]", 
      RowBox[{"\[Delta]U", " ", "=", " ", "0"}], ";", "\[IndentingNewLine]", 
      RowBox[{"U", "=", " ", 
       RowBox[{"auxIDCassette", "[", 
        RowBox[{
        "\[Lambda]u", ",", " ", "Np", ",", " ", "Br", ",", "\[Delta]U", ",", 
         " ", "UBlockList", ",", " ", "BlockGap", ",", " ", 
         RowBox[{"\"\<PointingUp\>\"", "\[Rule]", " ", "True"}], ",", "  ", 
         RowBox[{"\"\<FirstBlock\>\"", "\[Rule]", " ", "\"\<Down\>\""}], ",", 
         " ", 
         RowBox[{"\"\<Termination\>\"", "\[Rule]", " ", "Termination"}], ",", 
         "  ", 
         RowBox[{"\"\<PosMagErrors\>\"", "\[Rule]", " ", "PosMagErrorsU"}]}], 
        "]"}]}], ";", "\[IndentingNewLine]", "\[IndentingNewLine]", 
      RowBox[{"\[Delta]B", " ", "=", "\[Delta]P"}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"B", " ", "=", " ", 
       RowBox[{"auxIDCassette", "[", 
        RowBox[{
        "\[Lambda]u", ",", " ", "Np", ",", " ", "Br", ",", "\[Delta]B", ",", 
         " ", "BBlockList", ",", " ", "BlockGap", ",", " ", 
         RowBox[{"\"\<PointingUp\>\"", "\[Rule]", " ", "False"}], ",", "  ", 
         RowBox[{"\"\<FirstBlock\>\"", "\[Rule]", " ", "\"\<Down\>\""}], ",", 
         " ", 
         RowBox[{"\"\<Termination\>\"", "\[Rule]", " ", "Termination"}], ",", 
         "  ", 
         RowBox[{"\"\<PosMagErrors\>\"", "\[Rule]", " ", "PosMagErrorsB"}]}], 
        "]"}]}], " ", ";", "\[IndentingNewLine]", "\[IndentingNewLine]", 
      RowBox[{"(*", 
       RowBox[{"Insertion", " ", "device"}], "*)"}], "\[IndentingNewLine]", 
      RowBox[{"APU", " ", "=", " ", 
       RowBox[{"radObjCnt", "[", 
        RowBox[{"{", 
         RowBox[{"B", ",", " ", "U"}], "}"}], "]"}]}], ";", 
      "\[IndentingNewLine]", "\[IndentingNewLine]", 
      RowBox[{"t1", "=", 
       RowBox[{"AbsoluteTime", "[", "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"Print", "[", 
       RowBox[{"\"\<IDAPU: elapsed time = \>\"", ",", 
        RowBox[{"(", 
         RowBox[{"t1", "-", "t0"}], ")"}], ",", "\"\< s\>\""}], "]"}], ";", 
      "\[IndentingNewLine]", "\[IndentingNewLine]", 
      RowBox[{"Return", "[", "APU", "]"}], ";"}]}], "\[IndentingNewLine]", 
    "]"}]}], ";"}]}], "Input",
 CellChangeTimes->{{3.7663983120600963`*^9, 3.76639855854331*^9}, {
   3.766398611686247*^9, 3.7663990369387765`*^9}, {3.766399079212285*^9, 
   3.766399172321517*^9}, {3.766399309380847*^9, 3.7663993210570555`*^9}, {
   3.76640186623358*^9, 3.7664019074883833`*^9}, {3.766401991325385*^9, 
   3.7664020438052173`*^9}, {3.7664021236634097`*^9, 3.766402213899864*^9}, {
   3.7667537638923035`*^9, 3.766753965004061*^9}, {3.7667540021007276`*^9, 
   3.7667540157424326`*^9}, {3.7667540532922564`*^9, 
   3.7667540546204815`*^9}, {3.766754108859125*^9, 3.766754117625434*^9}, 
   3.7667541489091444`*^9, {3.7667544150238113`*^9, 3.7667544162426586`*^9}, {
   3.766755230010453*^9, 3.7667552349795885`*^9}, {3.76675674188527*^9, 
   3.7667568130783677`*^9}, {3.76675820960935*^9, 3.766758213328399*^9}, {
   3.7674431338586464`*^9, 3.76744316257965*^9}, {3.767443201442074*^9, 
   3.767443327889514*^9}, {3.767445672062233*^9, 3.767445685000744*^9}, {
   3.7674457212223516`*^9, 3.767445756789692*^9}, {3.767447936616846*^9, 
   3.767447957524736*^9}, {3.7675160835712852`*^9, 3.767516153160976*^9}, {
   3.767516304349866*^9, 3.767516309590888*^9}},
 Background->RGBColor[0.87, 0.94, 1]]
}, Closed]],

Cell[CellGroupData[{

Cell["IDRectangularAPU", "Subsection",
 CellChangeTimes->{{3.7667543560660515`*^9, 3.7667543696296263`*^9}, 
   3.7667544088670793`*^9}],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"IDRectangularAPU", "::", "usage"}], "=", 
    "\"\<IDRectangularAPU[\[Lambda]u, Np, Br, Gap, \\\"\[Delta]P\\\":0, \
\\\"BlockGap\\\":0, \\\"BlockWidth\\\":gap, \\\"BlockHeight\\\":gap, \
\\\"Termination\\\":\\\"None\\\", \\\"PosMagErrorsB\\\"\[Rule] {}, \
\\\"PosMagErrorsU\\\"\[Rule] {}]: Returns the ID model. \\n\\nArgs: \\n\
\[Lambda]u [mm] is the ID period, \\nNp is the number of periods, \\nBr [T] \
is the remanent magnetization of the permanent magnet blocks, \\nGap [mm] is \
the length of the minimum gap between the cassettes. \\n\\nOptional args: \\n\
\[Delta]P [mm] is the phase adjustement, \\nBlockGap [mm] is the longitudinal \
gap between the blocks, \\nBlockWidth [mm] is the block width, \\nBlockHeight \
[mm] is the block height, \\nTermination is the termination type (one of the \
following: None, OneBlockSym, OneBlockAntiSym, ThreeBlocksSym, \
ThreeBlocksAntiSym), \\nPosMagErrorsB is a list of positions and \
magnetization errors for the cassette B, \\nPosMagErrorsU is a list of \
positions and magnetization errors for the cassette U. \\n\\nPosition and \
magnetization errors: \\nThe list of position and magnetization errors must \
be empty or have a number of elements igual to the number of blocks on each \
cassette. Each element is a list itself with the following format: \
\\n{horizontal position error[mm], vertical position error[mm], horizontal \
magnetization error[T], longitudinal magnetization error[T], vertical \
magnetization error[T]}. \\nThe errors will be add to the default values of \
position and magnetization of the blocks.\>\""}], ";"}], 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"IDRectangularAPU", "[", 
    RowBox[{
    "\[Lambda]u_", ",", " ", "Np_", ",", " ", "Br_", ",", " ", "Gap_", ",", 
     " ", 
     RowBox[{"OptionsPattern", "[", 
      RowBox[{"{", 
       RowBox[{
        RowBox[{"\"\<\[Delta]P\>\"", "\[Rule]", " ", "0"}], ",", " ", 
        RowBox[{"\"\<BlockGap\>\"", "->", "0"}], ",", " ", 
        RowBox[{"\"\<BlockWidth\>\"", "\[Rule]", " ", "\"\<default\>\""}], 
        ",", " ", 
        RowBox[{"\"\<BlockHeight\>\"", "\[Rule]", " ", "\"\<default\>\""}], 
        ",", " ", 
        RowBox[{"\"\<Termination\>\"", "\[Rule]", " ", "\"\<None\>\""}], ",", 
        " ", 
        RowBox[{"\"\<PosMagErrorsB\>\"", "\[Rule]", " ", 
         RowBox[{"{", "}"}]}], ",", " ", 
        RowBox[{"\"\<PosMagErrorsU\>\"", "\[Rule]", " ", 
         RowBox[{"{", "}"}]}]}], "}"}], "]"}]}], "]"}], " ", ":=", " ", 
   RowBox[{"Module", "[", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
      "Width", ",", "Height", ",", " ", "BBlockList", ",", "UBlockList", ",", 
       " ", "BlockGap", ",", "\[Delta]P", ",", " ", "Termination", ",", 
       "PosMagErrorsB", " ", ",", " ", "PosMagErrorsU", ",", " ", "\[Delta]B",
        ",", " ", "B", ",", " ", "\[Delta]U", ",", " ", "U", ",", " ", "APU", 
       " ", ",", " ", "t0", ",", " ", "t1"}], "}"}], ",", 
     "\[IndentingNewLine]", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"t0", "=", 
       RowBox[{"AbsoluteTime", "[", "]"}]}], ";", "\[IndentingNewLine]", 
      "\[IndentingNewLine]", 
      RowBox[{"(*", 
       RowBox[{"Delete", " ", "previous", " ", "Radia", " ", "objects"}], 
       "*)"}], "\[IndentingNewLine]", 
      RowBox[{"radUtiDelAll", "[", "]"}], ";", "\[IndentingNewLine]", 
      "\[IndentingNewLine]", 
      RowBox[{"(*", 
       RowBox[{"Check", " ", "arguments"}], "*)"}], "\[IndentingNewLine]", 
      RowBox[{"If", " ", "[", 
       RowBox[{
        RowBox[{"\[Lambda]u", " ", "\[LessEqual]", " ", "0"}], ",", " ", 
        RowBox[{"Return", "[", "]"}]}], "]"}], ";", "\[IndentingNewLine]", 
      RowBox[{"If", " ", "[", 
       RowBox[{
        RowBox[{"Np", " ", "\[LessEqual]", " ", "0"}], ",", " ", 
        RowBox[{"Return", "[", "]"}]}], "]"}], ";", "\[IndentingNewLine]", 
      RowBox[{"If", " ", "[", 
       RowBox[{
        RowBox[{"Br", " ", "\[LessEqual]", " ", "0"}], ",", " ", 
        RowBox[{"Return", "[", "]"}]}], "]"}], ";", "\[IndentingNewLine]", 
      RowBox[{"If", " ", "[", 
       RowBox[{
        RowBox[{"Gap", " ", "\[LessEqual]", " ", "0"}], ",", " ", 
        RowBox[{"Return", "[", "]"}]}], "]"}], ";", "\[IndentingNewLine]", 
      "\[IndentingNewLine]", 
      RowBox[{"(*", 
       RowBox[{"Gap", " ", "between", " ", "blocks"}], "*)"}], 
      "\[IndentingNewLine]", 
      RowBox[{"BlockGap", " ", "=", "  ", 
       RowBox[{"OptionValue", "[", "\"\<BlockGap\>\"", "]"}]}], ";", 
      "\[IndentingNewLine]", "\[IndentingNewLine]", 
      RowBox[{"(*", 
       RowBox[{"Block", " ", "size"}], "*)"}], "\[IndentingNewLine]", 
      RowBox[{"Height", " ", "=", 
       RowBox[{"If", "[", 
        RowBox[{
         RowBox[{
          RowBox[{"OptionValue", "[", "\"\<BlockHeight\>\"", "]"}], " ", 
          "\[Equal]", " ", "\"\<default\>\""}], ",", " ", "Gap", ",", 
         RowBox[{"OptionValue", "[", "\"\<BlockHeight\>\"", "]"}]}], " ", 
        "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"Width", " ", "=", "  ", 
       RowBox[{"If", "[", 
        RowBox[{
         RowBox[{
          RowBox[{"OptionValue", "[", "\"\<BlockWidth\>\"", "]"}], 
          "\[Equal]", "\"\<default\>\""}], ",", " ", "Gap", ",", 
         RowBox[{"OptionValue", "[", "\"\<BlockWidth\>\"", "]"}]}], "]"}]}], 
      " ", ";", "\[IndentingNewLine]", 
      RowBox[{"If", "[", 
       RowBox[{
        RowBox[{
         RowBox[{"Height", "\[LessEqual]", "0"}], " ", "||", " ", 
         RowBox[{"Width", " ", "\[LessEqual]", "0"}]}], ",", " ", 
        RowBox[{"Return", "[", "]"}]}], "]"}], ";", "\[IndentingNewLine]", 
      "\[IndentingNewLine]", 
      RowBox[{"(*", 
       RowBox[{"Cassettes", " ", "longitudinal", " ", 
        RowBox[{"displacement", " ", "[", "mm", "]"}]}], "*)"}], 
      "\[IndentingNewLine]", 
      RowBox[{"\[Delta]P", " ", "=", " ", 
       RowBox[{"OptionValue", "[", "\"\<\[Delta]P\>\"", "]"}]}], ";", " ", 
      RowBox[{"(*", 
       RowBox[{"Phase", " ", "adjustment"}], "*)"}], "\[IndentingNewLine]", 
      "\[IndentingNewLine]", 
      RowBox[{"(*", 
       RowBox[{"Termination", " ", "Type"}], "*)"}], "\[IndentingNewLine]", 
      RowBox[{"Termination", " ", "=", " ", 
       RowBox[{"OptionValue", "[", "\"\<Termination\>\"", "]"}]}], ";", 
      "\[IndentingNewLine]", "\[IndentingNewLine]", 
      RowBox[{"(*", 
       RowBox[{"Position", " ", "and", " ", "magnetization", " ", "errors"}], 
       "*)"}], "\[IndentingNewLine]", 
      RowBox[{"PosMagErrorsB", " ", "=", " ", 
       RowBox[{"OptionValue", "[", "\"\<PosMagErrorsB\>\"", "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"PosMagErrorsU", " ", "=", " ", 
       RowBox[{"OptionValue", "[", "\"\<PosMagErrorsU\>\"", "]"}]}], ";", 
      "\[IndentingNewLine]", "\[IndentingNewLine]", 
      RowBox[{"(*", 
       RowBox[{
       "Block", " ", "vertices", " ", "for", " ", "each", " ", "cassette", 
        " ", 
        RowBox[{"(", 
         RowBox[{
         "cross", " ", "section", " ", "in", " ", "the", " ", "xz", " ", 
          "plane"}], ")"}]}], "*)"}], "\[IndentingNewLine]", 
      RowBox[{"BBlockList", "=", 
       RowBox[{"{", 
        RowBox[{
         RowBox[{"{", " ", 
          RowBox[{
           RowBox[{
            RowBox[{"-", "Width"}], "/", "2"}], ",", " ", 
           RowBox[{"Gap", "/", "2"}]}], "}"}], ",", 
         RowBox[{"{", 
          RowBox[{
           RowBox[{
            RowBox[{"-", "Width"}], "/", "2"}], ",", " ", 
           RowBox[{
            RowBox[{"Gap", "/", "2"}], " ", "+", "Height"}]}], "}"}], ",", 
         RowBox[{"{", " ", 
          RowBox[{
           RowBox[{"Width", "/", "2"}], ",", " ", 
           RowBox[{
            RowBox[{"Gap", "/", "2"}], "+", "Height"}]}], "}"}], ",", 
         RowBox[{"{", " ", 
          RowBox[{
           RowBox[{"Width", "/", "2"}], ",", 
           RowBox[{"Gap", "/", "2"}]}], "}"}]}], "}"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"UBlockList", "=", 
       RowBox[{"{", 
        RowBox[{
         RowBox[{"{", " ", 
          RowBox[{
           RowBox[{"Width", "/", "2"}], ",", 
           RowBox[{
            RowBox[{"-", "Gap"}], "/", "2"}]}], "}"}], ",", 
         RowBox[{"{", 
          RowBox[{
           RowBox[{"Width", "/", "2"}], ",", 
           RowBox[{
            RowBox[{
             RowBox[{"-", "Gap"}], "/", "2"}], " ", "-", "Height"}]}], "}"}], 
         ",", 
         RowBox[{"{", 
          RowBox[{
           RowBox[{
            RowBox[{"-", "Width"}], "/", "2"}], ",", 
           RowBox[{
            RowBox[{
             RowBox[{"-", "Gap"}], "/", "2"}], "-", "Height"}]}], "}"}], ",", 
         
         RowBox[{"{", 
          RowBox[{
           RowBox[{
            RowBox[{"-", "Width"}], "/", "2"}], ",", 
           RowBox[{
            RowBox[{"-", "Gap"}], "/", "2"}]}], "}"}]}], "}"}]}], ";", 
      "\[IndentingNewLine]", "\[IndentingNewLine]", 
      RowBox[{"(*", "Cassettes", "*)"}], "\[IndentingNewLine]", 
      RowBox[{"\[Delta]U", " ", "=", " ", "0"}], ";", "\[IndentingNewLine]", 
      RowBox[{"U", " ", "=", " ", 
       RowBox[{"auxIDRectangularCassette", "[", 
        RowBox[{
        "\[Lambda]u", ",", " ", "Np", ",", "Br", ",", "Width", ",", "Height", 
         ",", "\[Delta]U", ",", " ", "UBlockList", ",", "BlockGap", ",", " ", 
         
         RowBox[{"\"\<PointingUp\>\"", "\[Rule]", " ", "True"}], ",", "   ", 
         RowBox[{"\"\<FirstBlock\>\"", "\[Rule]", " ", "\"\<Down\>\""}], ",", 
         " ", 
         RowBox[{"\"\<Termination\>\"", "\[Rule]", " ", "Termination"}], ",", 
         " ", 
         RowBox[{"\"\<PosMagErrors\>\"", "\[Rule]", " ", "PosMagErrorsU"}]}], 
        "]"}]}], ";", "\[IndentingNewLine]", "\[IndentingNewLine]", 
      RowBox[{"\[Delta]B", " ", "=", "\[Delta]P"}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"B", " ", "=", " ", 
       RowBox[{"auxIDRectangularCassette", "[", 
        RowBox[{
        "\[Lambda]u", ",", " ", "Np", ",", "Br", ",", "Width", ",", "Height", 
         ",", "\[Delta]B", ",", " ", "BBlockList", ",", " ", "BlockGap", ",", 
         " ", 
         RowBox[{"\"\<PointingUp\>\"", "\[Rule]", "False"}], ",", "  ", 
         RowBox[{"\"\<FirstBlock\>\"", "\[Rule]", " ", "\"\<Down\>\""}], ",", 
         " ", 
         RowBox[{"\"\<Termination\>\"", "\[Rule]", " ", "Termination"}], ",", 
         " ", 
         RowBox[{"\"\<PosMagErrors\>\"", "\[Rule]", " ", "PosMagErrorsB"}]}], 
        "]"}]}], ";", "\[IndentingNewLine]", "\[IndentingNewLine]", 
      RowBox[{"(*", 
       RowBox[{"Insertion", " ", "device"}], "*)"}], "\[IndentingNewLine]", 
      RowBox[{"APU", " ", "=", " ", 
       RowBox[{"radObjCnt", "[", 
        RowBox[{"{", 
         RowBox[{"B", ",", " ", "U"}], "}"}], "]"}]}], ";", 
      "\[IndentingNewLine]", "\[IndentingNewLine]", 
      RowBox[{"t1", "=", 
       RowBox[{"AbsoluteTime", "[", "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"Print", "[", 
       RowBox[{"\"\<IDRectangularAPU: elapsed time = \>\"", ",", 
        RowBox[{"(", 
         RowBox[{"t1", "-", "t0"}], ")"}], ",", "\"\< s\>\""}], "]"}], ";", 
      "\[IndentingNewLine]", "\[IndentingNewLine]", 
      RowBox[{"Return", "[", "APU", "]"}], ";"}]}], "\[IndentingNewLine]", 
    "]"}]}], ";"}]}], "Input",
 CellChangeTimes->{{3.766755241589485*^9, 3.7667552459335747`*^9}, {
  3.76675682573561*^9, 3.7667569075389185`*^9}, {3.7667582055777817`*^9, 
  3.7667582558178897`*^9}, {3.767445863079317*^9, 3.7674458937866373`*^9}, {
  3.7674479659941387`*^9, 3.767447992431658*^9}, {3.767516329005494*^9, 
  3.7675163349141564`*^9}},
 Background->RGBColor[0.87, 0.94, 1]]
}, Closed]]
}, Open  ]],

Cell[CellGroupData[{

Cell["Delta", "Section",
 CellChangeTimes->{{3.7663980194296393`*^9, 3.7663980316884046`*^9}}],

Cell[CellGroupData[{

Cell["IDDelta", "Subsection",
 CellChangeTimes->{{3.766754518453103*^9, 3.766754525359883*^9}, {
  3.767535210522156*^9, 3.7675352108346806`*^9}, {3.7675366603372955`*^9, 
  3.7675366604779315`*^9}, {3.7675367242998896`*^9, 3.7675367254405985`*^9}}],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"IDDelta", "::", "usage"}], "=", 
    "\"\<IDDelta[\[Lambda]u, Np, Br, Gap, \\\"\[Delta]P\\\":0, \\\"\[Delta]GV\
\\\":0, \\\"\[Delta]GH\\\":0, \\\"\[Delta]CP\\\":0, \\\"BlockGap\\\":0, \
\\\"Termination\\\":\\\"None\\\", \\\"PosMagErrorsBRC\\\"\[Rule] {}, \
\\\"PosMagErrorsBLC\\\"\[Rule] {}, \\\"PosMagErrorsULC\\\"\[Rule] {}, \
\\\"PosMagErrorsURC\\\"\[Rule] {}]: Returns the ID model. \\n\\nArgs: \\n\
\[Lambda]u [mm] is the ID period, \\nNp is the number of periods, \\nBr [T] \
is the remanent magnetization of the permanent magnet blocks, \\nGap [mm] is \
the length of the minimum gap between the cassettes. \\n\\nOptional args: \\n\
\[Delta]P [mm], \[Delta]GV [mm], \[Delta]GH [mm] and \[Delta]CP [mm] are four \
types of longitudinal movements between the cassettes, \[Delta]P is the phase \
adjustement, \[Delta]GV and \[Delta]GH control the amplitude of the \
longitudinal field component and \[Delta]CP is the inclined-polarization \
adjustment, \\nBlockGap [mm] is the longitudinal gap between the blocks, \
\\nTermination is the termination type (one of the following: None, \
OneBlockSym, OneBlockAntiSym, ThreeBlocksSym, ThreeBlocksAntiSym), \
\\nPosMagErrorsBRC is a list of positions and magnetization errors for the BR \
cassette, \\nPosMagErrorsBLC is a list of positions and magnetization errors \
for the BL cassette, \\nPosMagErrorsULC is a list of positions and \
magnetization errors for the UL cassette, \\nPosMagErrorsURC is a list of \
positions and magnetization errors for the UR cassette. \\n\\nPosition and \
magnetization errors: \\nThe list of position and magnetization errors must \
be empty or have a number of elements igual to the number of blocks on each \
cassette. Each element is a list itself with the following format: \
\\n{horizontal position error[mm], vertical position error[mm], horizontal \
magnetization error[T], longitudinal magnetization error[T], vertical \
magnetization error[T]}. \\nThe errors will be add to the default values of \
position and magnetization of the blocks.\>\""}], ";"}], 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"IDDelta", " ", "=", " ", "IDDeltaV1"}], ";"}]}], "Input",
 CellChangeTimes->{{3.767536639038783*^9, 3.767536653055511*^9}},
 Background->RGBColor[0.87, 0.94, 1]]
}, Closed]],

Cell[CellGroupData[{

Cell["IDDeltaV1", "Subsection",
 CellChangeTimes->{{3.766754518453103*^9, 3.766754525359883*^9}, {
  3.767535210522156*^9, 3.7675352108346806`*^9}}],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"IDDeltaV1", "::", "usage"}], "=", 
    "\"\<IDDeltaV1[\[Lambda]u, Np, Br, Gap, \\\"\[Delta]P\\\":0, \
\\\"\[Delta]GV\\\":0, \\\"\[Delta]GH\\\":0, \\\"\[Delta]CP\\\":0, \
\\\"BlockGap\\\":0, \\\"Termination\\\":\\\"None\\\", \\\"PosMagErrorsBRC\\\"\
\[Rule] {}, \\\"PosMagErrorsBLC\\\"\[Rule] {}, \\\"PosMagErrorsULC\\\"\[Rule] \
{}, \\\"PosMagErrorsURC\\\"\[Rule] {}]: Returns the ID model. \\n\\nArgs: \\n\
\[Lambda]u [mm] is the ID period, \\nNp is the number of periods, \\nBr [T] \
is the remanent magnetization of the permanent magnet blocks, \\nGap [mm] is \
the length of the minimum gap between the cassettes. \\n\\nOptional args: \\n\
\[Delta]P [mm], \[Delta]GV [mm], \[Delta]GH [mm] and \[Delta]CP [mm] are four \
types of longitudinal movements between the cassettes, \[Delta]P is the phase \
adjustement, \[Delta]GV and \[Delta]GH control the amplitude of the \
longitudinal field component and \[Delta]CP is the inclined-polarization \
adjustment, \\nBlockGap [mm] is the longitudinal gap between the blocks, \
\\nTermination is the termination type (one of the following: None, \
OneBlockSym, OneBlockAntiSym, ThreeBlocksSym, ThreeBlocksAntiSym), \
\\nPosMagErrorsBRC is a list of positions and magnetization errors for the BR \
cassette, \\nPosMagErrorsBLC is a list of positions and magnetization errors \
for the BL cassette, \\nPosMagErrorsULC is a list of positions and \
magnetization errors for the UL cassette, \\nPosMagErrorsURC is a list of \
positions and magnetization errors for the UR cassette. \\n\\nPosition and \
magnetization errors: \\nThe list of position and magnetization errors must \
be empty or have a number of elements igual to the number of blocks on each \
cassette. Each element is a list itself with the following format: \
\\n{horizontal position error[mm], vertical position error[mm], horizontal \
magnetization error[T], longitudinal magnetization error[T], vertical \
magnetization error[T]}. \\nThe errors will be add to the default values of \
position and magnetization of the blocks.\>\""}], ";"}], 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"IDDeltaV1", "[", 
    RowBox[{
    "\[Lambda]u_", ",", " ", "Np_", ",", " ", "Br_", ",", " ", "Gap_", ",", 
     " ", 
     RowBox[{"OptionsPattern", "[", 
      RowBox[{"{", 
       RowBox[{
        RowBox[{"\"\<\[Delta]P\>\"", "\[Rule]", " ", "0"}], ",", " ", 
        RowBox[{"\"\<\[Delta]GV\>\"", "\[Rule]", " ", "0"}], ",", " ", 
        RowBox[{"\"\<\[Delta]GH\>\"", "\[Rule]", " ", "0"}], ",", " ", 
        RowBox[{"\"\<\[Delta]CP\>\"", "\[Rule]", " ", "0"}], ",", " ", 
        RowBox[{"\"\<BlockGap\>\"", "->", "0"}], ",", "  ", 
        RowBox[{"\"\<Termination\>\"", "\[Rule]", " ", "\"\<None\>\""}], ",", 
        " ", 
        RowBox[{"\"\<PosMagErrorsBRC\>\"", "\[Rule]", " ", 
         RowBox[{"{", "}"}]}], ",", " ", 
        RowBox[{"\"\<PosMagErrorsBLC\>\"", "\[Rule]", " ", 
         RowBox[{"{", "}"}]}], ",", " ", 
        RowBox[{"\"\<PosMagErrorsULC\>\"", "\[Rule]", " ", 
         RowBox[{"{", "}"}]}], ",", " ", 
        RowBox[{"\"\<PosMagErrorsURC\>\"", "\[Rule]", " ", 
         RowBox[{"{", "}"}]}]}], "}"}], "]"}]}], "]"}], " ", ":=", " ", 
   RowBox[{"Module", "[", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
      "f", ",", " ", "Blocka", " ", ",", " ", "Blockb", ",", "Blocks", ",", 
       " ", "BRCBlockList", ",", " ", "BLCBlockList", ",", " ", 
       "ULCBlockList", ",", " ", "URCBlockList", ",", " ", 
       "\[IndentingNewLine]", "PosMagErrorsBRC", " ", ",", " ", 
       "PosMagErrorsBLC", ",", " ", "PosMagErrorsULC", " ", ",", " ", 
       "PosMagErrorsURC", ",", "\[IndentingNewLine]", "\[Delta]P", ",", " ", 
       "\[Delta]GV", ",", " ", "\[Delta]GH", ",", " ", "\[Delta]CP", ",", " ",
        "Termination", ",", "\[IndentingNewLine]", " ", "BlockGap", ",", " ", 
       "\[Delta]BRC", ",", " ", "BRC", ",", " ", "\[Delta]BLC", ",", " ", 
       "BLC", ",", " ", "\[Delta]ULC", ",", " ", "ULC", ",", " ", 
       "\[Delta]URC", ",", " ", "URC", ",", " ", "Delta", ",", " ", "t0", ",",
        " ", "t1"}], "}"}], ",", "\[IndentingNewLine]", 
     RowBox[{"(*", 
      RowBox[{
       RowBox[{
       "The", " ", "insertion", " ", "device", " ", "is", " ", "created", " ",
         "rotated", " ", "by", " ", 
        RowBox[{"\[Pi]", "/", "4"}], " ", "about", " ", "the", " ", "y"}], 
       "-", 
       RowBox[{
       "axis", " ", "to", " ", "simplified", " ", "the", " ", "magnetization",
         " ", 
        RowBox[{"functions", ".", " ", "The"}], " ", "entire", " ", "device", 
        " ", "is", " ", "rotated", " ", "to", " ", "the", " ", "correct", " ",
         "position", " ", "at", " ", "the", " ", "end", " ", "of", " ", "the",
         " ", 
        RowBox[{"function", "."}]}]}], "*)"}], "\[IndentingNewLine]", 
     "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"t0", "=", 
       RowBox[{"AbsoluteTime", "[", "]"}]}], ";", "\[IndentingNewLine]", 
      "\[IndentingNewLine]", 
      RowBox[{"(*", 
       RowBox[{"Delete", " ", "previous", " ", "Radia", " ", "objects"}], 
       "*)"}], "\[IndentingNewLine]", 
      RowBox[{"radUtiDelAll", "[", "]"}], ";", "\[IndentingNewLine]", 
      "\[IndentingNewLine]", 
      RowBox[{"(*", 
       RowBox[{"Check", " ", "arguments"}], "*)"}], "\[IndentingNewLine]", 
      RowBox[{"If", " ", "[", 
       RowBox[{
        RowBox[{"\[Lambda]u", " ", "\[LessEqual]", " ", "0"}], ",", " ", 
        RowBox[{"Return", "[", "]"}]}], "]"}], ";", "\[IndentingNewLine]", 
      RowBox[{"If", " ", "[", 
       RowBox[{
        RowBox[{"Np", " ", "\[LessEqual]", " ", "0"}], ",", " ", 
        RowBox[{"Return", "[", "]"}]}], "]"}], ";", "\[IndentingNewLine]", 
      RowBox[{"If", " ", "[", 
       RowBox[{
        RowBox[{"Br", " ", "\[LessEqual]", " ", "0"}], ",", " ", 
        RowBox[{"Return", "[", "]"}]}], "]"}], ";", "\[IndentingNewLine]", 
      RowBox[{"If", " ", "[", 
       RowBox[{
        RowBox[{"Gap", " ", "\[LessEqual]", " ", "0"}], ",", " ", 
        RowBox[{"Return", "[", "]"}]}], "]"}], ";", "\[IndentingNewLine]", 
      "\[IndentingNewLine]", 
      RowBox[{"(*", 
       RowBox[{"Gap", " ", "between", " ", "blocks"}], "*)"}], 
      "\[IndentingNewLine]", " ", 
      RowBox[{"BlockGap", " ", "=", " ", 
       RowBox[{"OptionValue", "[", "\"\<BlockGap\>\"", "]"}]}], ";", 
      "\[IndentingNewLine]", "\[IndentingNewLine]", 
      RowBox[{"(*", 
       RowBox[{"Cassettes", " ", "longitudinal", " ", 
        RowBox[{"displacement", " ", "[", "mm", "]"}]}], "*)"}], 
      "\[IndentingNewLine]", 
      RowBox[{"\[Delta]P", " ", "=", " ", 
       RowBox[{"OptionValue", "[", "\"\<\[Delta]P\>\"", "]"}]}], ";", " ", 
      RowBox[{"(*", 
       RowBox[{"Phase", " ", "adjustment"}], "*)"}], "\[IndentingNewLine]", 
      RowBox[{"\[Delta]GV", " ", "=", " ", 
       RowBox[{"OptionValue", "[", "\"\<\[Delta]GV\>\"", "]"}]}], ";", " ", 
      RowBox[{"(*", 
       RowBox[{
        RowBox[{
        "Vertical", " ", "field", " ", "amplitude", " ", "to", " ", 
         "longitudinal", " ", "field", " ", "amplitude"}], ",", " ", 
        RowBox[{
        "also", " ", "decreases", " ", "horizontal", " ", "field", " ", 
         "amplitude"}]}], "*)"}], "\[IndentingNewLine]", 
      RowBox[{"\[Delta]GH", " ", "=", " ", 
       RowBox[{"OptionValue", "[", "\"\<\[Delta]GH\>\"", "]"}]}], ";", 
      RowBox[{"(*", 
       RowBox[{
        RowBox[{
        "Horizontal", " ", "field", " ", "amplitude", " ", "to", " ", 
         "longitudinal", " ", "field", " ", "amplitude"}], ",", " ", 
        RowBox[{
        "also", " ", "decreases", " ", "vertical", " ", "field", " ", 
         "amplitude"}]}], "*)"}], "\[IndentingNewLine]", 
      RowBox[{"\[Delta]CP", " ", "=", " ", 
       RowBox[{"OptionValue", "[", "\"\<\[Delta]CP\>\"", "]"}]}], ";", 
      RowBox[{"(*", 
       RowBox[{"Inclined", " ", "polarization", " ", "adjustment"}], "*)"}], 
      "\[IndentingNewLine]", "\[IndentingNewLine]", 
      RowBox[{"(*", 
       RowBox[{"Termination", " ", "Type"}], "*)"}], "\[IndentingNewLine]", 
      RowBox[{"Termination", " ", "=", " ", 
       RowBox[{"OptionValue", "[", "\"\<Termination\>\"", "]"}]}], ";", 
      "\[IndentingNewLine]", "\[IndentingNewLine]", 
      RowBox[{"(*", 
       RowBox[{"Position", " ", "and", " ", "magnetization", " ", "errors"}], 
       "*)"}], "\[IndentingNewLine]", 
      RowBox[{"PosMagErrorsBRC", " ", "=", " ", 
       RowBox[{"OptionValue", "[", "\"\<PosMagErrorsBRC\>\"", "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"PosMagErrorsBLC", " ", "=", " ", 
       RowBox[{"OptionValue", "[", "\"\<PosMagErrorsBLC\>\"", "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"PosMagErrorsULC", " ", "=", " ", 
       RowBox[{"OptionValue", "[", "\"\<PosMagErrorsULC\>\"", "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"PosMagErrorsURC", " ", "=", " ", 
       RowBox[{"OptionValue", "[", "\"\<PosMagErrorsURC\>\"", "]"}]}], ";", 
      "\[IndentingNewLine]", "\[IndentingNewLine]", 
      RowBox[{"(*", 
       RowBox[{
        RowBox[{
        "Counterclockwise", " ", "rotation", " ", "of", " ", "errors", " ", 
         "by", " ", 
         RowBox[{"\[Pi]", "/", "4"}], " ", "around", " ", "the", " ", "y"}], 
        "-", "axis"}], "*)"}], "\[IndentingNewLine]", 
      RowBox[{"PosMagErrorsBRC", " ", "=", " ", 
       RowBox[{
        RowBox[{
         RowBox[{"Flatten", "[", 
          RowBox[{"{", 
           RowBox[{
            RowBox[{"Dot", "[", 
             RowBox[{
              RowBox[{"RotationMatrix", "[", 
               RowBox[{
                RowBox[{"-", "\[Pi]"}], "/", "4"}], "]"}], ",", 
              RowBox[{"{", 
               RowBox[{
                RowBox[{"#", "[", 
                 RowBox[{"[", "1", "]"}], "]"}], ",", " ", 
                RowBox[{"#", "[", 
                 RowBox[{"[", "2", "]"}], "]"}]}], "}"}]}], "]"}], ",", 
            RowBox[{"Dot", "[", 
             RowBox[{
              RowBox[{"RotationMatrix", "[", 
               RowBox[{
                RowBox[{"\[Pi]", "/", "4"}], ",", " ", 
                RowBox[{"{", 
                 RowBox[{"0", ",", " ", "1", ",", " ", "0"}], "}"}]}], "]"}], 
              ",", 
              RowBox[{"{", 
               RowBox[{
                RowBox[{"#", "[", 
                 RowBox[{"[", "3", "]"}], "]"}], ",", " ", 
                RowBox[{"#", "[", 
                 RowBox[{"[", "4", "]"}], "]"}], ",", " ", 
                RowBox[{"#", "[", 
                 RowBox[{"[", "5", "]"}], "]"}]}], "}"}]}], "]"}]}], "}"}], 
          "]"}], "&"}], "/@", " ", "PosMagErrorsBRC"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"PosMagErrorsBLC", " ", "=", " ", 
       RowBox[{
        RowBox[{
         RowBox[{"Flatten", "[", 
          RowBox[{"{", 
           RowBox[{
            RowBox[{"Dot", "[", 
             RowBox[{
              RowBox[{"RotationMatrix", "[", 
               RowBox[{
                RowBox[{"-", "\[Pi]"}], "/", "4"}], "]"}], ",", 
              RowBox[{"{", 
               RowBox[{
                RowBox[{"#", "[", 
                 RowBox[{"[", "1", "]"}], "]"}], ",", " ", 
                RowBox[{"#", "[", 
                 RowBox[{"[", "2", "]"}], "]"}]}], "}"}]}], "]"}], ",", 
            RowBox[{"Dot", "[", 
             RowBox[{
              RowBox[{"RotationMatrix", "[", 
               RowBox[{
                RowBox[{"\[Pi]", "/", "4"}], ",", " ", 
                RowBox[{"{", 
                 RowBox[{"0", ",", " ", "1", ",", " ", "0"}], "}"}]}], "]"}], 
              ",", 
              RowBox[{"{", 
               RowBox[{
                RowBox[{"#", "[", 
                 RowBox[{"[", "3", "]"}], "]"}], ",", " ", 
                RowBox[{"#", "[", 
                 RowBox[{"[", "4", "]"}], "]"}], ",", " ", 
                RowBox[{"#", "[", 
                 RowBox[{"[", "5", "]"}], "]"}]}], "}"}]}], "]"}]}], "}"}], 
          "]"}], "&"}], "/@", " ", "PosMagErrorsBLC"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"PosMagErrorsULC", " ", "=", " ", 
       RowBox[{
        RowBox[{
         RowBox[{"Flatten", "[", 
          RowBox[{"{", 
           RowBox[{
            RowBox[{"Dot", "[", 
             RowBox[{
              RowBox[{"RotationMatrix", "[", 
               RowBox[{
                RowBox[{"-", "\[Pi]"}], "/", "4"}], "]"}], ",", 
              RowBox[{"{", 
               RowBox[{
                RowBox[{"#", "[", 
                 RowBox[{"[", "1", "]"}], "]"}], ",", " ", 
                RowBox[{"#", "[", 
                 RowBox[{"[", "2", "]"}], "]"}]}], "}"}]}], "]"}], ",", 
            RowBox[{"Dot", "[", 
             RowBox[{
              RowBox[{"RotationMatrix", "[", 
               RowBox[{
                RowBox[{"\[Pi]", "/", "4"}], ",", " ", 
                RowBox[{"{", 
                 RowBox[{"0", ",", " ", "1", ",", " ", "0"}], "}"}]}], "]"}], 
              ",", 
              RowBox[{"{", 
               RowBox[{
                RowBox[{"#", "[", 
                 RowBox[{"[", "3", "]"}], "]"}], ",", " ", 
                RowBox[{"#", "[", 
                 RowBox[{"[", "4", "]"}], "]"}], ",", " ", 
                RowBox[{"#", "[", 
                 RowBox[{"[", "5", "]"}], "]"}]}], "}"}]}], "]"}]}], "}"}], 
          "]"}], "&"}], "/@", " ", "PosMagErrorsULC"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"PosMagErrorsURC", " ", "=", " ", 
       RowBox[{
        RowBox[{
         RowBox[{"Flatten", "[", 
          RowBox[{"{", 
           RowBox[{
            RowBox[{"Dot", "[", 
             RowBox[{
              RowBox[{"RotationMatrix", "[", 
               RowBox[{
                RowBox[{"-", "\[Pi]"}], "/", "4"}], "]"}], ",", 
              RowBox[{"{", 
               RowBox[{
                RowBox[{"#", "[", 
                 RowBox[{"[", "1", "]"}], "]"}], ",", " ", 
                RowBox[{"#", "[", 
                 RowBox[{"[", "2", "]"}], "]"}]}], "}"}]}], "]"}], ",", 
            RowBox[{"Dot", "[", 
             RowBox[{
              RowBox[{"RotationMatrix", "[", 
               RowBox[{
                RowBox[{"\[Pi]", "/", "4"}], ",", " ", 
                RowBox[{"{", 
                 RowBox[{"0", ",", " ", "1", ",", " ", "0"}], "}"}]}], "]"}], 
              ",", 
              RowBox[{"{", 
               RowBox[{
                RowBox[{"#", "[", 
                 RowBox[{"[", "3", "]"}], "]"}], ",", " ", 
                RowBox[{"#", "[", 
                 RowBox[{"[", "4", "]"}], "]"}], ",", " ", 
                RowBox[{"#", "[", 
                 RowBox[{"[", "5", "]"}], "]"}]}], "}"}]}], "]"}]}], "}"}], 
          "]"}], "&"}], "/@", " ", "PosMagErrorsURC"}]}], ";", 
      "\[IndentingNewLine]", "\[IndentingNewLine]", 
      RowBox[{"(*", 
       RowBox[{"Block", " ", "vertices"}], "*)"}], "\[IndentingNewLine]", 
      RowBox[{"f", " ", "=", " ", 
       RowBox[{"Gap", "/", "7"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"Blocks", " ", "=", " ", 
       RowBox[{"f", "*", " ", 
        RowBox[{"{", 
         RowBox[{"{", 
          RowBox[{
           RowBox[{"{", 
            RowBox[{
             RowBox[{"-", "2.25"}], ",", " ", "3.5"}], "}"}], ",", " ", 
           RowBox[{"{", 
            RowBox[{
             RowBox[{"-", "11.25"}], ",", " ", "13"}], "}"}], ",", " ", 
           RowBox[{"{", 
            RowBox[{
             RowBox[{"-", "11.25"}], ",", "28.5"}], "}"}], ",", 
           RowBox[{"{", 
            RowBox[{"11.25", ",", "28.5"}], "}"}], ",", " ", 
           RowBox[{"{", 
            RowBox[{"11.25", ",", " ", "13"}], "}"}], ",", " ", 
           RowBox[{"{", 
            RowBox[{"2.25", ",", " ", "3.5"}], "}"}]}], "}"}], "}"}]}]}], ";",
       "\[IndentingNewLine]", "\[IndentingNewLine]", 
      RowBox[{"(*", 
       RowBox[{
       "Block", " ", "vertices", " ", "for", " ", "each", " ", "cassette", 
        " ", 
        RowBox[{"(", 
         RowBox[{
         "cross", " ", "section", " ", "in", " ", "the", " ", "yz", " ", 
          "plane"}], ")"}]}], "*)"}], "\[IndentingNewLine]", 
      RowBox[{"BLCBlockList", " ", "=", "Blocks"}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"ULCBlockList", " ", "=", " ", 
       RowBox[{
        RowBox[{
         RowBox[{
          RowBox[{
           RowBox[{"Dot", "[", 
            RowBox[{
             RowBox[{"RotationMatrix", "[", 
              RowBox[{"\[Pi]", "/", "2"}], "]"}], ",", "#"}], "]"}], "&"}], "/@",
           "#"}], "&"}], "/@", "BLCBlockList"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"URCBlockList", " ", "=", " ", 
       RowBox[{
        RowBox[{
         RowBox[{
          RowBox[{
           RowBox[{"Dot", "[", 
            RowBox[{
             RowBox[{"RotationMatrix", "[", 
              RowBox[{"\[Pi]", "/", "2"}], "]"}], ",", "#"}], "]"}], "&"}], "/@",
           "#"}], "&"}], "/@", "ULCBlockList"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"BRCBlockList", " ", "=", " ", 
       RowBox[{
        RowBox[{
         RowBox[{
          RowBox[{
           RowBox[{"Dot", "[", 
            RowBox[{
             RowBox[{"RotationMatrix", "[", 
              RowBox[{"\[Pi]", "/", "2"}], "]"}], ",", "#"}], "]"}], "&"}], "/@",
           "#"}], "&"}], "/@", "URCBlockList"}]}], ";", "\[IndentingNewLine]",
       "\[IndentingNewLine]", 
      RowBox[{"(*", "Cassettes", "*)"}], "\[IndentingNewLine]", 
      RowBox[{"\[Delta]BRC", " ", "=", 
       RowBox[{
       "\[Delta]GV", " ", "+", " ", "\[Delta]P", "+", "\[Delta]CP"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"BRC", " ", "=", 
       RowBox[{"auxIDCassette", "[", 
        RowBox[{
        "\[Lambda]u", ",", " ", "Np", ",", " ", "Br", ",", " ", "\[Delta]BRC",
          ",", "BRCBlockList", ",", " ", "BlockGap", ",", " ", 
         RowBox[{"\"\<PointingUp\>\"", "\[Rule]", "False"}], ",", " ", 
         RowBox[{"\"\<FirstBlock\>\"", "\[Rule]", " ", "\"\<Down\>\""}], ",", 
         " ", 
         RowBox[{
         "\"\<FieldDirection\>\"", "\[Rule]", " ", "\"\<Horizontal\>\""}], 
         ",", 
         RowBox[{"\"\<Termination\>\"", "\[Rule]", " ", "Termination"}], ",", 
         RowBox[{
         "\"\<PosMagErrors\>\"", "\[Rule]", " ", "PosMagErrorsBRC"}]}], 
        "]"}]}], ";", "\[IndentingNewLine]", "\[IndentingNewLine]", 
      RowBox[{"\[Delta]BLC", " ", "=", 
       RowBox[{"\[Delta]GH", " ", "+", " ", "\[Delta]GV"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"BLC", " ", "=", " ", 
       RowBox[{"auxIDCassette", "[", 
        RowBox[{
        "\[Lambda]u", ",", " ", "Np", ",", " ", "Br", ",", "\[Delta]BLC", ",",
          " ", "BLCBlockList", ",", " ", "BlockGap", ",", " ", 
         RowBox[{"\"\<PointingUp\>\"", "\[Rule]", " ", "False"}], ",", 
         RowBox[{"\"\<FirstBlock\>\"", "\[Rule]", " ", "\"\<Down\>\""}], ",", 
         " ", 
         RowBox[{
         "\"\<FieldDirection\>\"", "\[Rule]", " ", "\"\<Vertical\>\""}], ",", 
         " ", 
         RowBox[{"\"\<Termination\>\"", "\[Rule]", " ", "Termination"}], ",", 
         RowBox[{
         "\"\<PosMagErrors\>\"", "\[Rule]", " ", "PosMagErrorsBLC"}]}], 
        "]"}]}], ";", "\[IndentingNewLine]", "\[IndentingNewLine]", 
      RowBox[{"\[Delta]ULC", " ", "=", " ", 
       RowBox[{"\[Delta]GH", "+", " ", "\[Delta]P", "-", "\[Delta]CP"}]}], 
      ";", "\[IndentingNewLine]", 
      RowBox[{"ULC", " ", "=", " ", 
       RowBox[{"auxIDCassette", "[", 
        RowBox[{
        "\[Lambda]u", ",", " ", "Np", ",", " ", "Br", ",", "\[Delta]ULC", ",",
          " ", "ULCBlockList", ",", " ", "BlockGap", ",", " ", 
         RowBox[{"\"\<PointingUp\>\"", "\[Rule]", " ", "True"}], ",", 
         RowBox[{"\"\<FirstBlock\>\"", "\[Rule]", " ", "\"\<Down\>\""}], ",", 
         " ", 
         RowBox[{
         "\"\<FieldDirection\>\"", "\[Rule]", " ", "\"\<Horizontal\>\""}], 
         ",", " ", 
         RowBox[{"\"\<Termination\>\"", "\[Rule]", " ", "Termination"}], ",", 
         RowBox[{
         "\"\<PosMagErrors\>\"", "\[Rule]", " ", "PosMagErrorsULC"}]}], 
        "]"}]}], ";", "\[IndentingNewLine]", "\[IndentingNewLine]", 
      RowBox[{"\[Delta]URC", " ", "=", " ", "0.0"}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"URC", " ", "=", " ", 
       RowBox[{"auxIDCassette", "[", 
        RowBox[{
        "\[Lambda]u", ",", " ", "Np", ",", " ", "Br", ",", "\[Delta]URC", ",",
          " ", "URCBlockList", ",", " ", "BlockGap", ",", " ", 
         RowBox[{"\"\<PointingUp\>\"", "\[Rule]", " ", "True"}], ",", 
         RowBox[{"\"\<FirstBlock\>\"", "\[Rule]", " ", "\"\<Down\>\""}], ",", 
         RowBox[{
         "\"\<FieldDirection\>\"", "\[Rule]", " ", "\"\<Vertical\>\""}], ",", 
         RowBox[{"\"\<Termination\>\"", "\[Rule]", " ", "Termination"}], ",", 
         RowBox[{
         "\"\<PosMagErrors\>\"", "\[Rule]", " ", "PosMagErrorsURC"}]}], 
        "]"}]}], ";", "\[IndentingNewLine]", "\[IndentingNewLine]", 
      RowBox[{"(*", 
       RowBox[{"Insertion", " ", "device"}], "*)"}], "\[IndentingNewLine]", 
      RowBox[{"Delta", " ", "=", " ", 
       RowBox[{"radObjCnt", "[", 
        RowBox[{"{", 
         RowBox[{"BRC", ",", " ", "BLC", ",", " ", "ULC", ",", " ", "URC"}], 
         "}"}], "]"}]}], ";", "\[IndentingNewLine]", "\[IndentingNewLine]", 
      RowBox[{"(*", 
       RowBox[{
        RowBox[{
        "Counterclockwise", " ", "rotation", " ", "of", " ", "insertion", " ",
          "device", " ", "by"}], " ", "-", 
        RowBox[{
         RowBox[{"\[Pi]", "/", "4"}], " ", "around", " ", "the", " ", "y"}], 
        "-", "axis"}], "*)"}], "\[IndentingNewLine]", 
      RowBox[{"Delta", "=", " ", 
       RowBox[{"radTrfOrnt", "[", 
        RowBox[{"Delta", ",", 
         RowBox[{"radTrfRot", "[", 
          RowBox[{
           RowBox[{"{", 
            RowBox[{"0", ",", "0", ",", "0"}], "}"}], ",", 
           RowBox[{"{", 
            RowBox[{"0", ",", "1", ",", "0"}], "}"}], ",", 
           RowBox[{
            RowBox[{"-", "\[Pi]"}], "/", "4"}]}], "]"}]}], "]"}]}], ";", 
      "\[IndentingNewLine]", "\[IndentingNewLine]", 
      RowBox[{"t1", "=", 
       RowBox[{"AbsoluteTime", "[", "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"Print", "[", 
       RowBox[{"\"\<IDDelta: elapsed time = \>\"", ",", 
        RowBox[{"(", 
         RowBox[{"t1", "-", "t0"}], ")"}], ",", "\"\< s\>\""}], "]"}], ";", 
      "\[IndentingNewLine]", "\[IndentingNewLine]", 
      RowBox[{"Return", "[", "Delta", "]"}], ";"}]}], "\[IndentingNewLine]", 
    "]"}]}], ";"}]}], "Input",
 CellChangeTimes->{{3.7667551788345585`*^9, 3.766755219697137*^9}, {
   3.7667552608722496`*^9, 3.766755336956355*^9}, {3.7667553842569494`*^9, 
   3.766755392727988*^9}, {3.7667554904075484`*^9, 3.7667554958142147`*^9}, {
   3.766755533035892*^9, 3.766755536817438*^9}, {3.7667555822585154`*^9, 
   3.766755653420355*^9}, {3.766756597123891*^9, 3.7667567178365045`*^9}, {
   3.766758273756778*^9, 3.7667582858827343`*^9}, {3.766758881931342*^9, 
   3.766758895901193*^9}, {3.7667589294194484`*^9, 3.766759099497465*^9}, {
   3.7667594411382713`*^9, 3.766759474594048*^9}, 3.766759676703664*^9, {
   3.7667597589931507`*^9, 3.7667597604151382`*^9}, {3.767445913038151*^9, 
   3.7674459154914675`*^9}, {3.7674480119644413`*^9, 3.767448037403933*^9}, {
   3.767517216023782*^9, 3.76751735632812*^9}, {3.767517388002474*^9, 
   3.7675175908758945`*^9}, {3.767517710921748*^9, 3.7675177169357166`*^9}, {
   3.767535010122141*^9, 3.767535166481933*^9}, {3.7675352448098354`*^9, 
   3.7675352531246276`*^9}, {3.7675365969260893`*^9, 3.767536601504578*^9}},
 Background->RGBColor[0.87, 0.94, 1]]
}, Closed]],

Cell[CellGroupData[{

Cell["IDDeltaV0", "Subsection",
 CellChangeTimes->{{3.766754518453103*^9, 3.766754525359883*^9}, {
  3.767534951344644*^9, 3.767534995136586*^9}}],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"IDDeltaV0", "::", "usage"}], "=", 
    "\"\<IDDeltaV0[\[Lambda]u, Np, Br, Gap, \\\"\[Delta]P\\\":0, \
\\\"\[Delta]GV\\\":0, \\\"\[Delta]GH\\\":0, \\\"\[Delta]CP\\\":0, \
\\\"BlockGap\\\":0, \\\"Termination\\\":\\\"None\\\", \\\"PosMagErrorsBRC\\\"\
\[Rule] {}, \\\"PosMagErrorsBLC\\\"\[Rule] {}, \\\"PosMagErrorsULC\\\"\[Rule] \
{}, \\\"PosMagErrorsURC\\\"\[Rule] {}]: Returns the ID model. \\n\\nArgs: \\n\
\[Lambda]u [mm] is the ID period, \\nNp is the number of periods, \\nBr [T] \
is the remanent magnetization of the permanent magnet blocks, \\nGap [mm] is \
the length of the minimum gap between the cassettes. \\n\\nOptional args: \\n\
\[Delta]P [mm], \[Delta]GV [mm], \[Delta]GH [mm] and \[Delta]CP [mm] are four \
types of longitudinal movements between the cassettes, \[Delta]P is the phase \
adjustement, \[Delta]GV and \[Delta]GH control the amplitude of the \
longitudinal field component and \[Delta]CP is the inclined-polarization \
adjustment, \\nBlockGap [mm] is the longitudinal gap between the blocks, \
\\nTermination is the termination type (one of the following: None, \
OneBlockSym, OneBlockAntiSym, ThreeBlocksSym, ThreeBlocksAntiSym), \
\\nPosMagErrorsBRC is a list of positions and magnetization errors for the BR \
cassette, \\nPosMagErrorsBLC is a list of positions and magnetization errors \
for the BL cassette, \\nPosMagErrorsULC is a list of positions and \
magnetization errors for the UL cassette, \\nPosMagErrorsURC is a list of \
positions and magnetization errors for the UR cassette. \\n\\nPosition and \
magnetization errors: \\nThe list of position and magnetization errors must \
be empty or have a number of elements igual to the number of blocks on each \
cassette. Each element is a list itself with the following format: \
\\n{horizontal position error[mm], vertical position error[mm], horizontal \
magnetization error[T], longitudinal magnetization error[T], vertical \
magnetization error[T]}. \\nThe errors will be add to the default values of \
position and magnetization of the blocks.\>\""}], ";"}], 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"IDDeltaV0", "[", 
    RowBox[{
    "\[Lambda]u_", ",", " ", "Np_", ",", " ", "Br_", ",", " ", "Gap_", ",", 
     " ", 
     RowBox[{"OptionsPattern", "[", 
      RowBox[{"{", 
       RowBox[{
        RowBox[{"\"\<\[Delta]P\>\"", "\[Rule]", " ", "0"}], ",", " ", 
        RowBox[{"\"\<\[Delta]GV\>\"", "\[Rule]", " ", "0"}], ",", " ", 
        RowBox[{"\"\<\[Delta]GH\>\"", "\[Rule]", " ", "0"}], ",", " ", 
        RowBox[{"\"\<\[Delta]CP\>\"", "\[Rule]", " ", "0"}], ",", " ", 
        RowBox[{"\"\<BlockGap\>\"", "->", "0"}], ",", "  ", 
        RowBox[{"\"\<Termination\>\"", "\[Rule]", " ", "\"\<None\>\""}], ",", 
        " ", 
        RowBox[{"\"\<PosMagErrorsBRC\>\"", "\[Rule]", " ", 
         RowBox[{"{", "}"}]}], ",", " ", 
        RowBox[{"\"\<PosMagErrorsBLC\>\"", "\[Rule]", " ", 
         RowBox[{"{", "}"}]}], ",", " ", 
        RowBox[{"\"\<PosMagErrorsULC\>\"", "\[Rule]", " ", 
         RowBox[{"{", "}"}]}], ",", " ", 
        RowBox[{"\"\<PosMagErrorsURC\>\"", "\[Rule]", " ", 
         RowBox[{"{", "}"}]}]}], "}"}], "]"}]}], "]"}], " ", ":=", " ", 
   RowBox[{"Module", "[", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
      "f", ",", " ", "Blocka", " ", ",", " ", "Blockb", ",", "Blocks", ",", 
       " ", "BRCBlockList", ",", " ", "BLCBlockList", ",", " ", 
       "ULCBlockList", ",", " ", "URCBlockList", ",", " ", 
       "\[IndentingNewLine]", "PosMagErrorsBRC", " ", ",", " ", 
       "PosMagErrorsBLC", ",", " ", "PosMagErrorsULC", " ", ",", " ", 
       "PosMagErrorsURC", ",", "\[IndentingNewLine]", "\[Delta]P", ",", " ", 
       "\[Delta]GV", ",", " ", "\[Delta]GH", ",", " ", "\[Delta]CP", ",", " ",
        "Termination", ",", "\[IndentingNewLine]", " ", "BlockGap", ",", " ", 
       "\[Delta]BRC", ",", " ", "BRC", ",", " ", "\[Delta]BLC", ",", " ", 
       "BLC", ",", " ", "\[Delta]ULC", ",", " ", "ULC", ",", " ", 
       "\[Delta]URC", ",", " ", "URC", ",", " ", "Delta", ",", " ", "t0", ",",
        " ", "t1"}], "}"}], ",", "\[IndentingNewLine]", 
     RowBox[{"(*", 
      RowBox[{
       RowBox[{
       "The", " ", "insertion", " ", "device", " ", "is", " ", "created", " ",
         "rotated", " ", "by", " ", 
        RowBox[{"\[Pi]", "/", "4"}], " ", "about", " ", "the", " ", "y"}], 
       "-", 
       RowBox[{
       "axis", " ", "to", " ", "simplified", " ", "the", " ", "magnetization",
         " ", 
        RowBox[{"functions", ".", " ", "The"}], " ", "entire", " ", "device", 
        " ", "is", " ", "rotated", " ", "to", " ", "the", " ", "correct", " ",
         "position", " ", "at", " ", "the", " ", "end", " ", "of", " ", "the",
         " ", 
        RowBox[{"function", "."}]}]}], "*)"}], "\[IndentingNewLine]", 
     "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"t0", "=", 
       RowBox[{"AbsoluteTime", "[", "]"}]}], ";", "\[IndentingNewLine]", 
      "\[IndentingNewLine]", 
      RowBox[{"(*", 
       RowBox[{"Delete", " ", "previous", " ", "Radia", " ", "objects"}], 
       "*)"}], "\[IndentingNewLine]", 
      RowBox[{"radUtiDelAll", "[", "]"}], ";", "\[IndentingNewLine]", 
      "\[IndentingNewLine]", 
      RowBox[{"(*", 
       RowBox[{"Check", " ", "arguments"}], "*)"}], "\[IndentingNewLine]", 
      RowBox[{"If", " ", "[", 
       RowBox[{
        RowBox[{"\[Lambda]u", " ", "\[LessEqual]", " ", "0"}], ",", " ", 
        RowBox[{"Return", "[", "]"}]}], "]"}], ";", "\[IndentingNewLine]", 
      RowBox[{"If", " ", "[", 
       RowBox[{
        RowBox[{"Np", " ", "\[LessEqual]", " ", "0"}], ",", " ", 
        RowBox[{"Return", "[", "]"}]}], "]"}], ";", "\[IndentingNewLine]", 
      RowBox[{"If", " ", "[", 
       RowBox[{
        RowBox[{"Br", " ", "\[LessEqual]", " ", "0"}], ",", " ", 
        RowBox[{"Return", "[", "]"}]}], "]"}], ";", "\[IndentingNewLine]", 
      RowBox[{"If", " ", "[", 
       RowBox[{
        RowBox[{"Gap", " ", "\[LessEqual]", " ", "0"}], ",", " ", 
        RowBox[{"Return", "[", "]"}]}], "]"}], ";", "\[IndentingNewLine]", 
      "\[IndentingNewLine]", 
      RowBox[{"(*", 
       RowBox[{"Gap", " ", "between", " ", "blocks"}], "*)"}], 
      "\[IndentingNewLine]", " ", 
      RowBox[{"BlockGap", " ", "=", " ", 
       RowBox[{"OptionValue", "[", "\"\<BlockGap\>\"", "]"}]}], ";", 
      "\[IndentingNewLine]", "\[IndentingNewLine]", 
      RowBox[{"(*", 
       RowBox[{"Cassettes", " ", "longitudinal", " ", 
        RowBox[{"displacement", " ", "[", "mm", "]"}]}], "*)"}], 
      "\[IndentingNewLine]", 
      RowBox[{"\[Delta]P", " ", "=", " ", 
       RowBox[{"OptionValue", "[", "\"\<\[Delta]P\>\"", "]"}]}], ";", " ", 
      RowBox[{"(*", 
       RowBox[{"Phase", " ", "adjustment"}], "*)"}], "\[IndentingNewLine]", 
      RowBox[{"\[Delta]GV", " ", "=", " ", 
       RowBox[{"OptionValue", "[", "\"\<\[Delta]GV\>\"", "]"}]}], ";", " ", 
      RowBox[{"(*", 
       RowBox[{
        RowBox[{
        "Vertical", " ", "field", " ", "amplitude", " ", "to", " ", 
         "longitudinal", " ", "field", " ", "amplitude"}], ",", " ", 
        RowBox[{
        "also", " ", "decreases", " ", "horizontal", " ", "field", " ", 
         "amplitude"}]}], "*)"}], "\[IndentingNewLine]", 
      RowBox[{"\[Delta]GH", " ", "=", " ", 
       RowBox[{"OptionValue", "[", "\"\<\[Delta]GH\>\"", "]"}]}], ";", 
      RowBox[{"(*", 
       RowBox[{
        RowBox[{
        "Horizontal", " ", "field", " ", "amplitude", " ", "to", " ", 
         "longitudinal", " ", "field", " ", "amplitude"}], ",", " ", 
        RowBox[{
        "also", " ", "decreases", " ", "vertical", " ", "field", " ", 
         "amplitude"}]}], "*)"}], "\[IndentingNewLine]", 
      RowBox[{"\[Delta]CP", " ", "=", " ", 
       RowBox[{"OptionValue", "[", "\"\<\[Delta]CP\>\"", "]"}]}], ";", 
      RowBox[{"(*", 
       RowBox[{"Inclined", " ", "polarization", " ", "adjustment"}], "*)"}], 
      "\[IndentingNewLine]", "\[IndentingNewLine]", 
      RowBox[{"(*", 
       RowBox[{"Termination", " ", "Type"}], "*)"}], "\[IndentingNewLine]", 
      RowBox[{"Termination", " ", "=", " ", 
       RowBox[{"OptionValue", "[", "\"\<Termination\>\"", "]"}]}], ";", 
      "\[IndentingNewLine]", "\[IndentingNewLine]", 
      RowBox[{"(*", 
       RowBox[{"Position", " ", "and", " ", "magnetization", " ", "errors"}], 
       "*)"}], "\[IndentingNewLine]", 
      RowBox[{"PosMagErrorsBRC", " ", "=", " ", 
       RowBox[{"OptionValue", "[", "\"\<PosMagErrorsBRC\>\"", "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"PosMagErrorsBLC", " ", "=", " ", 
       RowBox[{"OptionValue", "[", "\"\<PosMagErrorsBLC\>\"", "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"PosMagErrorsULC", " ", "=", " ", 
       RowBox[{"OptionValue", "[", "\"\<PosMagErrorsULC\>\"", "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"PosMagErrorsURC", " ", "=", " ", 
       RowBox[{"OptionValue", "[", "\"\<PosMagErrorsURC\>\"", "]"}]}], ";", 
      "\[IndentingNewLine]", "\[IndentingNewLine]", 
      RowBox[{"(*", 
       RowBox[{
        RowBox[{
        "Counterclockwise", " ", "rotation", " ", "of", " ", "errors", " ", 
         "by", " ", 
         RowBox[{"\[Pi]", "/", "4"}], " ", "around", " ", "the", " ", "y"}], 
        "-", "axis"}], "*)"}], "\[IndentingNewLine]", 
      RowBox[{"PosMagErrorsBRC", " ", "=", " ", 
       RowBox[{
        RowBox[{
         RowBox[{"Flatten", "[", 
          RowBox[{"{", 
           RowBox[{
            RowBox[{"Dot", "[", 
             RowBox[{
              RowBox[{"RotationMatrix", "[", 
               RowBox[{
                RowBox[{"-", "\[Pi]"}], "/", "4"}], "]"}], ",", 
              RowBox[{"{", 
               RowBox[{
                RowBox[{"#", "[", 
                 RowBox[{"[", "1", "]"}], "]"}], ",", " ", 
                RowBox[{"#", "[", 
                 RowBox[{"[", "2", "]"}], "]"}]}], "}"}]}], "]"}], ",", 
            RowBox[{"Dot", "[", 
             RowBox[{
              RowBox[{"RotationMatrix", "[", 
               RowBox[{
                RowBox[{"\[Pi]", "/", "4"}], ",", " ", 
                RowBox[{"{", 
                 RowBox[{"0", ",", " ", "1", ",", " ", "0"}], "}"}]}], "]"}], 
              ",", 
              RowBox[{"{", 
               RowBox[{
                RowBox[{"#", "[", 
                 RowBox[{"[", "3", "]"}], "]"}], ",", " ", 
                RowBox[{"#", "[", 
                 RowBox[{"[", "4", "]"}], "]"}], ",", " ", 
                RowBox[{"#", "[", 
                 RowBox[{"[", "5", "]"}], "]"}]}], "}"}]}], "]"}]}], "}"}], 
          "]"}], "&"}], "/@", " ", "PosMagErrorsBRC"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"PosMagErrorsBLC", " ", "=", " ", 
       RowBox[{
        RowBox[{
         RowBox[{"Flatten", "[", 
          RowBox[{"{", 
           RowBox[{
            RowBox[{"Dot", "[", 
             RowBox[{
              RowBox[{"RotationMatrix", "[", 
               RowBox[{
                RowBox[{"-", "\[Pi]"}], "/", "4"}], "]"}], ",", 
              RowBox[{"{", 
               RowBox[{
                RowBox[{"#", "[", 
                 RowBox[{"[", "1", "]"}], "]"}], ",", " ", 
                RowBox[{"#", "[", 
                 RowBox[{"[", "2", "]"}], "]"}]}], "}"}]}], "]"}], ",", 
            RowBox[{"Dot", "[", 
             RowBox[{
              RowBox[{"RotationMatrix", "[", 
               RowBox[{
                RowBox[{"\[Pi]", "/", "4"}], ",", " ", 
                RowBox[{"{", 
                 RowBox[{"0", ",", " ", "1", ",", " ", "0"}], "}"}]}], "]"}], 
              ",", 
              RowBox[{"{", 
               RowBox[{
                RowBox[{"#", "[", 
                 RowBox[{"[", "3", "]"}], "]"}], ",", " ", 
                RowBox[{"#", "[", 
                 RowBox[{"[", "4", "]"}], "]"}], ",", " ", 
                RowBox[{"#", "[", 
                 RowBox[{"[", "5", "]"}], "]"}]}], "}"}]}], "]"}]}], "}"}], 
          "]"}], "&"}], "/@", " ", "PosMagErrorsBLC"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"PosMagErrorsULC", " ", "=", " ", 
       RowBox[{
        RowBox[{
         RowBox[{"Flatten", "[", 
          RowBox[{"{", 
           RowBox[{
            RowBox[{"Dot", "[", 
             RowBox[{
              RowBox[{"RotationMatrix", "[", 
               RowBox[{
                RowBox[{"-", "\[Pi]"}], "/", "4"}], "]"}], ",", 
              RowBox[{"{", 
               RowBox[{
                RowBox[{"#", "[", 
                 RowBox[{"[", "1", "]"}], "]"}], ",", " ", 
                RowBox[{"#", "[", 
                 RowBox[{"[", "2", "]"}], "]"}]}], "}"}]}], "]"}], ",", 
            RowBox[{"Dot", "[", 
             RowBox[{
              RowBox[{"RotationMatrix", "[", 
               RowBox[{
                RowBox[{"\[Pi]", "/", "4"}], ",", " ", 
                RowBox[{"{", 
                 RowBox[{"0", ",", " ", "1", ",", " ", "0"}], "}"}]}], "]"}], 
              ",", 
              RowBox[{"{", 
               RowBox[{
                RowBox[{"#", "[", 
                 RowBox[{"[", "3", "]"}], "]"}], ",", " ", 
                RowBox[{"#", "[", 
                 RowBox[{"[", "4", "]"}], "]"}], ",", " ", 
                RowBox[{"#", "[", 
                 RowBox[{"[", "5", "]"}], "]"}]}], "}"}]}], "]"}]}], "}"}], 
          "]"}], "&"}], "/@", " ", "PosMagErrorsULC"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"PosMagErrorsURC", " ", "=", " ", 
       RowBox[{
        RowBox[{
         RowBox[{"Flatten", "[", 
          RowBox[{"{", 
           RowBox[{
            RowBox[{"Dot", "[", 
             RowBox[{
              RowBox[{"RotationMatrix", "[", 
               RowBox[{
                RowBox[{"-", "\[Pi]"}], "/", "4"}], "]"}], ",", 
              RowBox[{"{", 
               RowBox[{
                RowBox[{"#", "[", 
                 RowBox[{"[", "1", "]"}], "]"}], ",", " ", 
                RowBox[{"#", "[", 
                 RowBox[{"[", "2", "]"}], "]"}]}], "}"}]}], "]"}], ",", 
            RowBox[{"Dot", "[", 
             RowBox[{
              RowBox[{"RotationMatrix", "[", 
               RowBox[{
                RowBox[{"\[Pi]", "/", "4"}], ",", " ", 
                RowBox[{"{", 
                 RowBox[{"0", ",", " ", "1", ",", " ", "0"}], "}"}]}], "]"}], 
              ",", 
              RowBox[{"{", 
               RowBox[{
                RowBox[{"#", "[", 
                 RowBox[{"[", "3", "]"}], "]"}], ",", " ", 
                RowBox[{"#", "[", 
                 RowBox[{"[", "4", "]"}], "]"}], ",", " ", 
                RowBox[{"#", "[", 
                 RowBox[{"[", "5", "]"}], "]"}]}], "}"}]}], "]"}]}], "}"}], 
          "]"}], "&"}], "/@", " ", "PosMagErrorsURC"}]}], ";", 
      "\[IndentingNewLine]", "\[IndentingNewLine]", 
      RowBox[{"(*", 
       RowBox[{"Block", " ", "vertices"}], "*)"}], "\[IndentingNewLine]", 
      RowBox[{"f", " ", "=", " ", 
       RowBox[{"Gap", "/", "6.92"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"Blocka", " ", "=", " ", 
       RowBox[{"f", "*", 
        RowBox[{"{", 
         RowBox[{
          RowBox[{"{", 
           RowBox[{
            RowBox[{"-", "2.75"}], ",", " ", "3.46"}], "}"}], ",", " ", 
          RowBox[{"{", 
           RowBox[{
            RowBox[{"-", "11.2662"}], ",", " ", "12.4245"}], "}"}], ",", " ", 
          RowBox[{"{", 
           RowBox[{
            RowBox[{"-", "7.73071"}], ",", "15.96"}], "}"}], ",", 
          RowBox[{"{", 
           RowBox[{"7.73071", ",", "15.96"}], "}"}], ",", " ", 
          RowBox[{"{", 
           RowBox[{"11.2662", ",", " ", "12.4245"}], "}"}], ",", " ", 
          RowBox[{"{", 
           RowBox[{"2.75", ",", " ", "3.46"}], "}"}]}], "}"}]}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"Blockb", " ", "=", " ", 
       RowBox[{"f", "*", 
        RowBox[{"{", " ", 
         RowBox[{
          RowBox[{"{", 
           RowBox[{
            RowBox[{"-", "7.73071"}], ",", "15.96"}], "}"}], ",", 
          RowBox[{"{", 
           RowBox[{
            RowBox[{"-", "11.2662"}], ",", " ", "19.4955"}], "}"}], ",", 
          RowBox[{"{", 
           RowBox[{
            RowBox[{"-", "2.75"}], ",", "28.46"}], "}"}], ",", " ", 
          RowBox[{"{", 
           RowBox[{"2.75", ",", "28.46"}], "}"}], ",", " ", 
          RowBox[{"{", 
           RowBox[{"11.2662", ",", " ", "19.4955"}], "}"}], ",", " ", 
          RowBox[{"{", 
           RowBox[{"7.73071", ",", "15.96"}], "}"}]}], "}"}]}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"Blocks", " ", "=", " ", 
       RowBox[{"{", 
        RowBox[{"Blocka", ",", " ", "Blockb"}], "}"}]}], ";", 
      "\[IndentingNewLine]", "\[IndentingNewLine]", 
      RowBox[{"(*", 
       RowBox[{
       "Block", " ", "vertices", " ", "for", " ", "each", " ", "cassette", 
        " ", 
        RowBox[{"(", 
         RowBox[{
         "cross", " ", "section", " ", "in", " ", "the", " ", "yz", " ", 
          "plane"}], ")"}]}], "*)"}], "\[IndentingNewLine]", 
      RowBox[{"BLCBlockList", " ", "=", "Blocks"}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"ULCBlockList", " ", "=", " ", 
       RowBox[{
        RowBox[{
         RowBox[{
          RowBox[{
           RowBox[{"Dot", "[", 
            RowBox[{
             RowBox[{"RotationMatrix", "[", 
              RowBox[{"\[Pi]", "/", "2"}], "]"}], ",", "#"}], "]"}], "&"}], "/@",
           "#"}], "&"}], "/@", "BLCBlockList"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"URCBlockList", " ", "=", " ", 
       RowBox[{
        RowBox[{
         RowBox[{
          RowBox[{
           RowBox[{"Dot", "[", 
            RowBox[{
             RowBox[{"RotationMatrix", "[", 
              RowBox[{"\[Pi]", "/", "2"}], "]"}], ",", "#"}], "]"}], "&"}], "/@",
           "#"}], "&"}], "/@", "ULCBlockList"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"BRCBlockList", " ", "=", " ", 
       RowBox[{
        RowBox[{
         RowBox[{
          RowBox[{
           RowBox[{"Dot", "[", 
            RowBox[{
             RowBox[{"RotationMatrix", "[", 
              RowBox[{"\[Pi]", "/", "2"}], "]"}], ",", "#"}], "]"}], "&"}], "/@",
           "#"}], "&"}], "/@", "URCBlockList"}]}], ";", "\[IndentingNewLine]",
       "\[IndentingNewLine]", 
      RowBox[{"(*", "Cassettes", "*)"}], "\[IndentingNewLine]", 
      RowBox[{"\[Delta]BRC", " ", "=", 
       RowBox[{
       "\[Delta]GV", " ", "+", " ", "\[Delta]P", "+", "\[Delta]CP"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"BRC", " ", "=", 
       RowBox[{"auxIDCassette", "[", 
        RowBox[{
        "\[Lambda]u", ",", " ", "Np", ",", " ", "Br", ",", " ", "\[Delta]BRC",
          ",", "BRCBlockList", ",", " ", "BlockGap", ",", " ", 
         RowBox[{"\"\<PointingUp\>\"", "\[Rule]", "False"}], ",", " ", 
         RowBox[{"\"\<FirstBlock\>\"", "\[Rule]", " ", "\"\<Down\>\""}], ",", 
         " ", 
         RowBox[{
         "\"\<FieldDirection\>\"", "\[Rule]", " ", "\"\<Horizontal\>\""}], 
         ",", 
         RowBox[{"\"\<Termination\>\"", "\[Rule]", " ", "Termination"}], ",", 
         RowBox[{
         "\"\<PosMagErrors\>\"", "\[Rule]", " ", "PosMagErrorsBRC"}]}], 
        "]"}]}], ";", "\[IndentingNewLine]", "\[IndentingNewLine]", 
      RowBox[{"\[Delta]BLC", " ", "=", 
       RowBox[{"\[Delta]GH", " ", "+", " ", "\[Delta]GV"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"BLC", " ", "=", " ", 
       RowBox[{"auxIDCassette", "[", 
        RowBox[{
        "\[Lambda]u", ",", " ", "Np", ",", " ", "Br", ",", "\[Delta]BLC", ",",
          " ", "BLCBlockList", ",", " ", "BlockGap", ",", " ", 
         RowBox[{"\"\<PointingUp\>\"", "\[Rule]", " ", "False"}], ",", 
         RowBox[{"\"\<FirstBlock\>\"", "\[Rule]", " ", "\"\<Down\>\""}], ",", 
         " ", 
         RowBox[{
         "\"\<FieldDirection\>\"", "\[Rule]", " ", "\"\<Vertical\>\""}], ",", 
         " ", 
         RowBox[{"\"\<Termination\>\"", "\[Rule]", " ", "Termination"}], ",", 
         RowBox[{
         "\"\<PosMagErrors\>\"", "\[Rule]", " ", "PosMagErrorsBLC"}]}], 
        "]"}]}], ";", "\[IndentingNewLine]", "\[IndentingNewLine]", 
      RowBox[{"\[Delta]ULC", " ", "=", " ", 
       RowBox[{"\[Delta]GH", "+", " ", "\[Delta]P", "-", "\[Delta]CP"}]}], 
      ";", "\[IndentingNewLine]", 
      RowBox[{"ULC", " ", "=", " ", 
       RowBox[{"auxIDCassette", "[", 
        RowBox[{
        "\[Lambda]u", ",", " ", "Np", ",", " ", "Br", ",", "\[Delta]ULC", ",",
          " ", "ULCBlockList", ",", " ", "BlockGap", ",", " ", 
         RowBox[{"\"\<PointingUp\>\"", "\[Rule]", " ", "True"}], ",", 
         RowBox[{"\"\<FirstBlock\>\"", "\[Rule]", " ", "\"\<Down\>\""}], ",", 
         " ", 
         RowBox[{
         "\"\<FieldDirection\>\"", "\[Rule]", " ", "\"\<Horizontal\>\""}], 
         ",", " ", 
         RowBox[{"\"\<Termination\>\"", "\[Rule]", " ", "Termination"}], ",", 
         RowBox[{
         "\"\<PosMagErrors\>\"", "\[Rule]", " ", "PosMagErrorsULC"}]}], 
        "]"}]}], ";", "\[IndentingNewLine]", "\[IndentingNewLine]", 
      RowBox[{"\[Delta]URC", " ", "=", " ", "0.0"}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"URC", " ", "=", " ", 
       RowBox[{"auxIDCassette", "[", 
        RowBox[{
        "\[Lambda]u", ",", " ", "Np", ",", " ", "Br", ",", "\[Delta]URC", ",",
          " ", "URCBlockList", ",", " ", "BlockGap", ",", " ", 
         RowBox[{"\"\<PointingUp\>\"", "\[Rule]", " ", "True"}], ",", 
         RowBox[{"\"\<FirstBlock\>\"", "\[Rule]", " ", "\"\<Down\>\""}], ",", 
         RowBox[{
         "\"\<FieldDirection\>\"", "\[Rule]", " ", "\"\<Vertical\>\""}], ",", 
         RowBox[{"\"\<Termination\>\"", "\[Rule]", " ", "Termination"}], ",", 
         RowBox[{
         "\"\<PosMagErrors\>\"", "\[Rule]", " ", "PosMagErrorsURC"}]}], 
        "]"}]}], ";", "\[IndentingNewLine]", "\[IndentingNewLine]", 
      RowBox[{"(*", 
       RowBox[{"Insertion", " ", "device"}], "*)"}], "\[IndentingNewLine]", 
      RowBox[{"Delta", " ", "=", " ", 
       RowBox[{"radObjCnt", "[", 
        RowBox[{"{", 
         RowBox[{"BRC", ",", " ", "BLC", ",", " ", "ULC", ",", " ", "URC"}], 
         "}"}], "]"}]}], ";", "\[IndentingNewLine]", "\[IndentingNewLine]", 
      RowBox[{"(*", 
       RowBox[{
        RowBox[{
        "Counterclockwise", " ", "rotation", " ", "of", " ", "insertion", " ",
          "device", " ", "by"}], " ", "-", 
        RowBox[{
         RowBox[{"\[Pi]", "/", "4"}], " ", "around", " ", "the", " ", "y"}], 
        "-", "axis"}], "*)"}], "\[IndentingNewLine]", 
      RowBox[{"Delta", "=", " ", 
       RowBox[{"radTrfOrnt", "[", 
        RowBox[{"Delta", ",", 
         RowBox[{"radTrfRot", "[", 
          RowBox[{
           RowBox[{"{", 
            RowBox[{"0", ",", "0", ",", "0"}], "}"}], ",", 
           RowBox[{"{", 
            RowBox[{"0", ",", "1", ",", "0"}], "}"}], ",", 
           RowBox[{
            RowBox[{"-", "\[Pi]"}], "/", "4"}]}], "]"}]}], "]"}]}], ";", 
      "\[IndentingNewLine]", "\[IndentingNewLine]", 
      RowBox[{"t1", "=", 
       RowBox[{"AbsoluteTime", "[", "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"Print", "[", 
       RowBox[{"\"\<IDDelta: elapsed time = \>\"", ",", 
        RowBox[{"(", 
         RowBox[{"t1", "-", "t0"}], ")"}], ",", "\"\< s\>\""}], "]"}], ";", 
      "\[IndentingNewLine]", "\[IndentingNewLine]", 
      RowBox[{"Return", "[", "Delta", "]"}], ";"}]}], "\[IndentingNewLine]", 
    "]"}]}], ";"}]}], "Input",
 CellChangeTimes->{{3.7667551788345585`*^9, 3.766755219697137*^9}, {
   3.7667552608722496`*^9, 3.766755336956355*^9}, {3.7667553842569494`*^9, 
   3.766755392727988*^9}, {3.7667554904075484`*^9, 3.7667554958142147`*^9}, {
   3.766755533035892*^9, 3.766755536817438*^9}, {3.7667555822585154`*^9, 
   3.766755653420355*^9}, {3.766756597123891*^9, 3.7667567178365045`*^9}, {
   3.766758273756778*^9, 3.7667582858827343`*^9}, {3.766758881931342*^9, 
   3.766758895901193*^9}, {3.7667589294194484`*^9, 3.766759099497465*^9}, {
   3.7667594411382713`*^9, 3.766759474594048*^9}, 3.766759676703664*^9, {
   3.7667597589931507`*^9, 3.7667597604151382`*^9}, {3.767445913038151*^9, 
   3.7674459154914675`*^9}, {3.7674480119644413`*^9, 3.767448037403933*^9}, {
   3.767517216023782*^9, 3.76751735632812*^9}, {3.767517388002474*^9, 
   3.7675175908758945`*^9}, {3.767517710921748*^9, 3.7675177169357166`*^9}, {
   3.7675352221793385`*^9, 3.7675352299784536`*^9}},
 Background->RGBColor[0.87, 0.94, 1]]
}, Closed]],

Cell[CellGroupData[{

Cell["IDRectangularDelta", "Subsection",
 CellChangeTimes->{{3.7667545315791187`*^9, 3.7667545397047553`*^9}}],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"IDRectangularDelta", "::", "usage"}], "=", 
    "\"\<IDRectangularDelta[\[Lambda]u, Np, Br, Gap, \\\"\[Delta]P\\\":0, \
\\\"\[Delta]GV\\\":0, \\\"\[Delta]GH\\\":0, \\\"\[Delta]CP\\\":0, \
\\\"BlockGap\\\":0, \\\"BlockWidth\\\":gap, \\\"BlockHeight\\\":gap, \
\\\"Termination\\\":\\\"None\\\", \\\"PosMagErrorsBRC\\\"\[Rule] {}, \
\\\"PosMagErrorsBLC\\\"\[Rule] {}, \\\"PosMagErrorsULC\\\"\[Rule] {}, \
\\\"PosMagErrorsURC\\\"\[Rule] {}]: Returns the ID model. \\n\\nArgs: \\n\
\[Lambda]u [mm] is the ID period, \\nNp is the number of periods, \\nBr [T] \
is the remanent magnetization of the permanent magnet blocks, \\nGap [mm] is \
the length of the minimum gap between the cassettes. \\n\\nOptional args: \\n\
\[Delta]P [mm], \[Delta]GV [mm], \[Delta]GH [mm] and \[Delta]CP [mm] are four \
types of longitudinal movements between the cassettes, \[Delta]P is the phase \
adjustement, \[Delta]GV and \[Delta]GH control the amplitude of the \
longitudinal field component and \[Delta]CP is the inclined-polarization \
adjustment, \\nBlockGap [mm] is the longitudinal gap between the blocks, \
\\nBlockWidth [mm] is the block width, \\nBlockHeight [mm] is the block \
height, \\nTermination is the termination type (one of the following: None, \
OneBlockSym, OneBlockAntiSym, ThreeBlocksSym, ThreeBlocksAntiSym), \
\\nPosMagErrorsBRC is a list of positions and magnetization errors for the BR \
cassette, \\nPosMagErrorsBLC is a list of positions and magnetization errors \
for the BL cassette, \\nPosMagErrorsULC is a list of positions and \
magnetization errors for the UL cassette, \\nPosMagErrorsURC is a list of \
positions and magnetization errors for the UR cassette. \\n\\nPosition and \
magnetization errors: \\nThe list of position and magnetization errors must \
be empty or have a number of elements igual to the number of blocks on each \
cassette. Each element is a list itself with the following format: \
\\n{horizontal position error[mm], vertical position error[mm], horizontal \
magnetization error[T], longitudinal magnetization error[T], vertical \
magnetization error[T]}. \\nThe errors will be add to the default values of \
position and magnetization of the blocks.\>\""}], ";"}], 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"IDRectangularDelta", "[", 
    RowBox[{
    "\[Lambda]u_", ",", " ", "Np_", ",", " ", "Br_", ",", " ", "Gap_", ",", 
     " ", 
     RowBox[{"OptionsPattern", "[", 
      RowBox[{"{", 
       RowBox[{
        RowBox[{"\"\<\[Delta]P\>\"", "\[Rule]", " ", "0"}], ",", " ", 
        RowBox[{"\"\<\[Delta]GV\>\"", "\[Rule]", " ", "0"}], ",", " ", 
        RowBox[{"\"\<\[Delta]GH\>\"", "\[Rule]", " ", "0"}], ",", " ", 
        RowBox[{"\"\<\[Delta]CP\>\"", "\[Rule]", " ", "0"}], ",", " ", 
        RowBox[{"\"\<BlockGap\>\"", "->", "0"}], ",", " ", 
        RowBox[{"\"\<BlockWidth\>\"", "\[Rule]", " ", "\"\<default\>\""}], 
        ",", " ", 
        RowBox[{"\"\<BlockHeight\>\"", "\[Rule]", " ", "\"\<default\>\""}], 
        ",", 
        RowBox[{"\"\<Termination\>\"", "\[Rule]", " ", "\"\<None\>\""}], ",", 
        " ", 
        RowBox[{"\"\<PosMagErrorsBRC\>\"", "\[Rule]", " ", 
         RowBox[{"{", "}"}]}], ",", " ", 
        RowBox[{"\"\<PosMagErrorsBLC\>\"", "\[Rule]", " ", 
         RowBox[{"{", "}"}]}], ",", " ", 
        RowBox[{"\"\<PosMagErrorsULC\>\"", "\[Rule]", " ", 
         RowBox[{"{", "}"}]}], ",", " ", 
        RowBox[{"\"\<PosMagErrorsURC\>\"", "\[Rule]", " ", 
         RowBox[{"{", "}"}]}]}], "}"}], "]"}]}], "]"}], " ", ":=", " ", 
   RowBox[{"Module", "[", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"{", " ", 
      RowBox[{
      "BRCBlockList", ",", " ", "BLCBlockList", ",", " ", "ULCBlockList", ",",
        " ", "URCBlockList", ",", " ", " ", "Height", ",", " ", "Width", ",", 
       "\[IndentingNewLine]", "PosMagErrorsBRC", " ", ",", " ", 
       "PosMagErrorsBLC", ",", " ", "PosMagErrorsULC", " ", ",", " ", 
       "PosMagErrorsURC", ",", "\[IndentingNewLine]", "\[Delta]P", ",", " ", 
       "\[Delta]GV", ",", " ", "\[Delta]GH", ",", " ", "\[Delta]CP", ",", " ",
        "Termination", ",", "\[IndentingNewLine]", " ", "BlockGap", ",", " ", 
       "\[Delta]BRC", ",", " ", "BRC", ",", " ", "\[Delta]BLC", ",", " ", 
       "BLC", ",", " ", "\[Delta]ULC", ",", " ", "ULC", ",", " ", 
       "\[Delta]URC", ",", " ", "URC", ",", " ", "Delta", ",", " ", "t0", ",",
        " ", "t1"}], "}"}], ",", "\[IndentingNewLine]", 
     RowBox[{"(*", 
      RowBox[{
       RowBox[{
       "The", " ", "insertion", " ", "device", " ", "is", " ", "created", " ",
         "rotated", " ", "by", " ", 
        RowBox[{"\[Pi]", "/", "4"}], " ", "about", " ", "the", " ", "y"}], 
       "-", 
       RowBox[{
       "axis", " ", "to", " ", "simplified", " ", "the", " ", "magnetization",
         " ", 
        RowBox[{"functions", ".", " ", "The"}], " ", "entire", " ", "device", 
        " ", "is", " ", "rotated", " ", "to", " ", "the", " ", "correct", " ",
         "position", " ", "at", " ", "the", " ", "end", " ", "of", " ", "the",
         " ", 
        RowBox[{"function", "."}]}]}], "*)"}], "\[IndentingNewLine]", 
     "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"t0", "=", 
       RowBox[{"AbsoluteTime", "[", "]"}]}], ";", "\[IndentingNewLine]", 
      "\[IndentingNewLine]", 
      RowBox[{"(*", 
       RowBox[{"Delete", " ", "previous", " ", "Radia", " ", "objects"}], 
       "*)"}], "\[IndentingNewLine]", 
      RowBox[{"radUtiDelAll", "[", "]"}], ";", "\[IndentingNewLine]", 
      "\[IndentingNewLine]", 
      RowBox[{"(*", 
       RowBox[{"Check", " ", "arguments"}], "*)"}], "\[IndentingNewLine]", 
      RowBox[{"If", " ", "[", 
       RowBox[{
        RowBox[{"\[Lambda]u", " ", "\[LessEqual]", " ", "0"}], ",", " ", 
        RowBox[{"Return", "[", "]"}]}], "]"}], ";", "\[IndentingNewLine]", 
      RowBox[{"If", " ", "[", 
       RowBox[{
        RowBox[{"Np", " ", "\[LessEqual]", " ", "0"}], ",", " ", 
        RowBox[{"Return", "[", "]"}]}], "]"}], ";", "\[IndentingNewLine]", 
      RowBox[{"If", " ", "[", 
       RowBox[{
        RowBox[{"Br", " ", "\[LessEqual]", " ", "0"}], ",", " ", 
        RowBox[{"Return", "[", "]"}]}], "]"}], ";", "\[IndentingNewLine]", 
      RowBox[{"If", " ", "[", 
       RowBox[{
        RowBox[{"Gap", " ", "\[LessEqual]", " ", "0"}], ",", " ", 
        RowBox[{"Return", "[", "]"}]}], "]"}], ";", "\[IndentingNewLine]", 
      "\[IndentingNewLine]", 
      RowBox[{"(*", 
       RowBox[{"Gap", " ", "between", " ", "blocks"}], "*)"}], 
      "\[IndentingNewLine]", " ", 
      RowBox[{"BlockGap", " ", "=", " ", 
       RowBox[{"OptionValue", "[", "\"\<BlockGap\>\"", "]"}]}], ";", 
      "\[IndentingNewLine]", "\[IndentingNewLine]", 
      RowBox[{"(*", 
       RowBox[{"Block", " ", "size"}], "*)"}], "\[IndentingNewLine]", 
      RowBox[{"Height", " ", "=", 
       RowBox[{"If", "[", 
        RowBox[{
         RowBox[{
          RowBox[{"OptionValue", "[", "\"\<BlockHeight\>\"", "]"}], " ", 
          "\[Equal]", " ", "\"\<default\>\""}], ",", "Gap", ",", 
         RowBox[{"OptionValue", "[", "\"\<BlockHeight\>\"", "]"}]}], " ", 
        "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"Width", " ", "=", "  ", 
       RowBox[{"If", "[", 
        RowBox[{
         RowBox[{
          RowBox[{"OptionValue", "[", "\"\<BlockWidth\>\"", "]"}], 
          "\[Equal]", "\"\<default\>\""}], ",", " ", "Gap", ",", 
         RowBox[{"OptionValue", "[", "\"\<BlockWidth\>\"", "]"}]}], "]"}]}], 
      " ", ";", "\[IndentingNewLine]", 
      RowBox[{"If", "[", 
       RowBox[{
        RowBox[{
         RowBox[{"Height", "\[LessEqual]", "0"}], " ", "||", " ", 
         RowBox[{"Width", " ", "\[LessEqual]", "0"}]}], ",", " ", 
        RowBox[{"Return", "[", "]"}]}], "]"}], ";", "\[IndentingNewLine]", 
      "\[IndentingNewLine]", 
      RowBox[{"(*", 
       RowBox[{"Cassettes", " ", "longitudinal", " ", 
        RowBox[{"displacement", " ", "[", "mm", "]"}]}], "*)"}], 
      "\[IndentingNewLine]", 
      RowBox[{"\[Delta]P", " ", "=", " ", 
       RowBox[{"OptionValue", "[", "\"\<\[Delta]P\>\"", "]"}]}], ";", " ", 
      RowBox[{"(*", 
       RowBox[{"Phase", " ", "adjustment"}], "*)"}], "\[IndentingNewLine]", 
      RowBox[{"\[Delta]GV", " ", "=", " ", 
       RowBox[{"OptionValue", "[", "\"\<\[Delta]GV\>\"", "]"}]}], ";", " ", 
      RowBox[{"(*", 
       RowBox[{
        RowBox[{
        "Vertical", " ", "field", " ", "amplitude", " ", "to", " ", 
         "longitudinal", " ", "field", " ", "amplitude"}], ",", " ", 
        RowBox[{
        "also", " ", "decreases", " ", "horizontal", " ", "field", " ", 
         "amplitude"}]}], "*)"}], "\[IndentingNewLine]", 
      RowBox[{"\[Delta]GH", " ", "=", " ", 
       RowBox[{"OptionValue", "[", "\"\<\[Delta]GH\>\"", "]"}]}], ";", 
      RowBox[{"(*", 
       RowBox[{
        RowBox[{
        "Horizontal", " ", "field", " ", "amplitude", " ", "to", " ", 
         "longitudinal", " ", "field", " ", "amplitude"}], ",", " ", 
        RowBox[{
        "also", " ", "decreases", " ", "vertical", " ", "field", " ", 
         "amplitude"}]}], "*)"}], "\[IndentingNewLine]", 
      RowBox[{"\[Delta]CP", " ", "=", " ", 
       RowBox[{"OptionValue", "[", "\"\<\[Delta]CP\>\"", "]"}]}], ";", 
      RowBox[{"(*", 
       RowBox[{"Inclined", " ", "polarization", " ", "adjustment"}], "*)"}], 
      "\[IndentingNewLine]", "\[IndentingNewLine]", 
      RowBox[{"(*", 
       RowBox[{"Termination", " ", "Type"}], "*)"}], "\[IndentingNewLine]", 
      RowBox[{"Termination", " ", "=", " ", 
       RowBox[{"OptionValue", "[", "\"\<Termination\>\"", "]"}]}], ";", 
      "\[IndentingNewLine]", "\[IndentingNewLine]", 
      RowBox[{"(*", 
       RowBox[{"Position", " ", "and", " ", "magnetization", " ", "errors"}], 
       "*)"}], "\[IndentingNewLine]", 
      RowBox[{"PosMagErrorsBRC", " ", "=", " ", 
       RowBox[{"OptionValue", "[", "\"\<PosMagErrorsBRC\>\"", "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"PosMagErrorsBLC", " ", "=", " ", 
       RowBox[{"OptionValue", "[", "\"\<PosMagErrorsBLC\>\"", "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"PosMagErrorsULC", " ", "=", " ", 
       RowBox[{"OptionValue", "[", "\"\<PosMagErrorsULC\>\"", "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"PosMagErrorsURC", " ", "=", " ", 
       RowBox[{"OptionValue", "[", "\"\<PosMagErrorsURC\>\"", "]"}]}], ";", 
      "\[IndentingNewLine]", "\[IndentingNewLine]", 
      RowBox[{"(*", 
       RowBox[{
        RowBox[{
        "Counterclockwise", " ", "rotation", " ", "of", " ", "errors", " ", 
         "by", " ", 
         RowBox[{"\[Pi]", "/", "4"}], " ", "around", " ", "the", " ", "y"}], 
        "-", "axis"}], "*)"}], "\[IndentingNewLine]", 
      RowBox[{"PosMagErrorsBRC", " ", "=", " ", 
       RowBox[{
        RowBox[{
         RowBox[{"Flatten", "[", 
          RowBox[{"{", 
           RowBox[{
            RowBox[{"Dot", "[", 
             RowBox[{
              RowBox[{"RotationMatrix", "[", 
               RowBox[{
                RowBox[{"-", "\[Pi]"}], "/", "4"}], "]"}], ",", 
              RowBox[{"{", 
               RowBox[{
                RowBox[{"#", "[", 
                 RowBox[{"[", "1", "]"}], "]"}], ",", " ", 
                RowBox[{"#", "[", 
                 RowBox[{"[", "2", "]"}], "]"}]}], "}"}]}], "]"}], ",", 
            RowBox[{"Dot", "[", 
             RowBox[{
              RowBox[{"RotationMatrix", "[", 
               RowBox[{
                RowBox[{"\[Pi]", "/", "4"}], ",", " ", 
                RowBox[{"{", 
                 RowBox[{"0", ",", " ", "1", ",", " ", "0"}], "}"}]}], "]"}], 
              ",", 
              RowBox[{"{", 
               RowBox[{
                RowBox[{"#", "[", 
                 RowBox[{"[", "3", "]"}], "]"}], ",", " ", 
                RowBox[{"#", "[", 
                 RowBox[{"[", "4", "]"}], "]"}], ",", " ", 
                RowBox[{"#", "[", 
                 RowBox[{"[", "5", "]"}], "]"}]}], "}"}]}], "]"}]}], "}"}], 
          "]"}], "&"}], "/@", " ", "PosMagErrorsBRC"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"PosMagErrorsBLC", " ", "=", " ", 
       RowBox[{
        RowBox[{
         RowBox[{"Flatten", "[", 
          RowBox[{"{", 
           RowBox[{
            RowBox[{"Dot", "[", 
             RowBox[{
              RowBox[{"RotationMatrix", "[", 
               RowBox[{
                RowBox[{"-", "\[Pi]"}], "/", "4"}], "]"}], ",", 
              RowBox[{"{", 
               RowBox[{
                RowBox[{"#", "[", 
                 RowBox[{"[", "1", "]"}], "]"}], ",", " ", 
                RowBox[{"#", "[", 
                 RowBox[{"[", "2", "]"}], "]"}]}], "}"}]}], "]"}], ",", 
            RowBox[{"Dot", "[", 
             RowBox[{
              RowBox[{"RotationMatrix", "[", 
               RowBox[{
                RowBox[{"\[Pi]", "/", "4"}], ",", " ", 
                RowBox[{"{", 
                 RowBox[{"0", ",", " ", "1", ",", " ", "0"}], "}"}]}], "]"}], 
              ",", 
              RowBox[{"{", 
               RowBox[{
                RowBox[{"#", "[", 
                 RowBox[{"[", "3", "]"}], "]"}], ",", " ", 
                RowBox[{"#", "[", 
                 RowBox[{"[", "4", "]"}], "]"}], ",", " ", 
                RowBox[{"#", "[", 
                 RowBox[{"[", "5", "]"}], "]"}]}], "}"}]}], "]"}]}], "}"}], 
          "]"}], "&"}], "/@", " ", "PosMagErrorsBLC"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"PosMagErrorsULC", " ", "=", " ", 
       RowBox[{
        RowBox[{
         RowBox[{"Flatten", "[", 
          RowBox[{"{", 
           RowBox[{
            RowBox[{"Dot", "[", 
             RowBox[{
              RowBox[{"RotationMatrix", "[", 
               RowBox[{
                RowBox[{"-", "\[Pi]"}], "/", "4"}], "]"}], ",", 
              RowBox[{"{", 
               RowBox[{
                RowBox[{"#", "[", 
                 RowBox[{"[", "1", "]"}], "]"}], ",", " ", 
                RowBox[{"#", "[", 
                 RowBox[{"[", "2", "]"}], "]"}]}], "}"}]}], "]"}], ",", 
            RowBox[{"Dot", "[", 
             RowBox[{
              RowBox[{"RotationMatrix", "[", 
               RowBox[{
                RowBox[{"\[Pi]", "/", "4"}], ",", " ", 
                RowBox[{"{", 
                 RowBox[{"0", ",", " ", "1", ",", " ", "0"}], "}"}]}], "]"}], 
              ",", 
              RowBox[{"{", 
               RowBox[{
                RowBox[{"#", "[", 
                 RowBox[{"[", "3", "]"}], "]"}], ",", " ", 
                RowBox[{"#", "[", 
                 RowBox[{"[", "4", "]"}], "]"}], ",", " ", 
                RowBox[{"#", "[", 
                 RowBox[{"[", "5", "]"}], "]"}]}], "}"}]}], "]"}]}], "}"}], 
          "]"}], "&"}], "/@", " ", "PosMagErrorsULC"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"PosMagErrorsURC", " ", "=", " ", 
       RowBox[{
        RowBox[{
         RowBox[{"Flatten", "[", 
          RowBox[{"{", 
           RowBox[{
            RowBox[{"Dot", "[", 
             RowBox[{
              RowBox[{"RotationMatrix", "[", 
               RowBox[{
                RowBox[{"-", "\[Pi]"}], "/", "4"}], "]"}], ",", 
              RowBox[{"{", 
               RowBox[{
                RowBox[{"#", "[", 
                 RowBox[{"[", "1", "]"}], "]"}], ",", " ", 
                RowBox[{"#", "[", 
                 RowBox[{"[", "2", "]"}], "]"}]}], "}"}]}], "]"}], ",", 
            RowBox[{"Dot", "[", 
             RowBox[{
              RowBox[{"RotationMatrix", "[", 
               RowBox[{
                RowBox[{"\[Pi]", "/", "4"}], ",", " ", 
                RowBox[{"{", 
                 RowBox[{"0", ",", " ", "1", ",", " ", "0"}], "}"}]}], "]"}], 
              ",", 
              RowBox[{"{", 
               RowBox[{
                RowBox[{"#", "[", 
                 RowBox[{"[", "3", "]"}], "]"}], ",", " ", 
                RowBox[{"#", "[", 
                 RowBox[{"[", "4", "]"}], "]"}], ",", " ", 
                RowBox[{"#", "[", 
                 RowBox[{"[", "5", "]"}], "]"}]}], "}"}]}], "]"}]}], "}"}], 
          "]"}], "&"}], "/@", " ", "PosMagErrorsURC"}]}], ";", 
      "\[IndentingNewLine]", "\[IndentingNewLine]", 
      RowBox[{"(*", 
       RowBox[{
       "Block", " ", "vertices", " ", "for", " ", "each", " ", "cassette", 
        " ", 
        RowBox[{"(", 
         RowBox[{
         "cross", " ", "section", " ", "in", " ", "the", " ", "xz", " ", 
          "plane"}], ")"}]}], "*)"}], "\[IndentingNewLine]", 
      RowBox[{"BRCBlockList", "=", 
       RowBox[{"{", 
        RowBox[{
         RowBox[{"{", 
          RowBox[{
           RowBox[{"Gap", "/", "2"}], ",", " ", 
           RowBox[{"Width", "/", "2"}]}], "}"}], ",", 
         RowBox[{"{", 
          RowBox[{
           RowBox[{
            RowBox[{"Gap", "/", "2"}], "+", "Height"}], ",", " ", 
           RowBox[{"Width", "/", "2"}]}], "}"}], ",", 
         RowBox[{"{", 
          RowBox[{
           RowBox[{
            RowBox[{"Gap", "/", "2"}], "+", "Height"}], ",", 
           RowBox[{
            RowBox[{"-", " ", "Width"}], "/", "2"}]}], "}"}], ",", 
         RowBox[{"{", 
          RowBox[{
           RowBox[{"Gap", "/", "2"}], ",", 
           RowBox[{
            RowBox[{"-", " ", "Width"}], "/", "2"}]}], "}"}]}], "}"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"BLCBlockList", "=", 
       RowBox[{"{", 
        RowBox[{
         RowBox[{"{", 
          RowBox[{
           RowBox[{"Width", "/", "2"}], " ", ",", " ", 
           RowBox[{"Gap", "/", "2"}]}], "}"}], ",", 
         RowBox[{"{", 
          RowBox[{
           RowBox[{"Width", "/", "2"}], ",", " ", 
           RowBox[{
            RowBox[{"Gap", "/", "2"}], "+", "Height"}]}], "}"}], ",", 
         RowBox[{"{", 
          RowBox[{
           RowBox[{
            RowBox[{"-", "Width"}], "/", "2"}], " ", ",", 
           RowBox[{
            RowBox[{"Gap", "/", "2"}], "+", "Height"}]}], "}"}], ",", 
         RowBox[{"{", 
          RowBox[{
           RowBox[{
            RowBox[{"-", "Width"}], "/", "2"}], ",", 
           RowBox[{"Gap", "/", "2"}]}], "}"}]}], "}"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"ULCBlockList", "=", 
       RowBox[{"{", 
        RowBox[{
         RowBox[{"{", 
          RowBox[{
           RowBox[{
            RowBox[{"-", "Gap"}], "/", "2"}], ",", " ", 
           RowBox[{"Width", "/", "2"}]}], "}"}], ",", 
         RowBox[{"{", 
          RowBox[{
           RowBox[{
            RowBox[{
             RowBox[{"-", "Gap"}], "/", "2"}], "-", "Height"}], ",", " ", 
           RowBox[{"Width", "/", "2"}]}], "}"}], ",", 
         RowBox[{"{", 
          RowBox[{
           RowBox[{
            RowBox[{
             RowBox[{"-", "Gap"}], "/", "2"}], "-", "Height"}], ",", 
           RowBox[{
            RowBox[{"-", "Width"}], "/", "2"}]}], "}"}], ",", 
         RowBox[{"{", 
          RowBox[{
           RowBox[{
            RowBox[{"-", "Gap"}], "/", "2"}], ",", 
           RowBox[{
            RowBox[{"-", " ", "Width"}], "/", "2"}]}], "}"}]}], "}"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"URCBlockList", "=", 
       RowBox[{"{", 
        RowBox[{
         RowBox[{"{", 
          RowBox[{
           RowBox[{
            RowBox[{"-", "Width"}], "/", "2"}], " ", ",", " ", 
           RowBox[{
            RowBox[{"-", "Gap"}], "/", "2"}]}], "}"}], ",", 
         RowBox[{"{", 
          RowBox[{
           RowBox[{
            RowBox[{"-", "Width"}], "/", "2"}], ",", " ", 
           RowBox[{
            RowBox[{
             RowBox[{"-", "Gap"}], "/", "2"}], "-", "Height"}]}], "}"}], ",", 
         
         RowBox[{"{", 
          RowBox[{
           RowBox[{"Width", "/", "2"}], " ", ",", 
           RowBox[{
            RowBox[{
             RowBox[{"-", "Gap"}], "/", "2"}], "-", "Height"}]}], "}"}], ",", 
         
         RowBox[{"{", 
          RowBox[{
           RowBox[{"Width", "/", "2"}], ",", 
           RowBox[{
            RowBox[{"-", "Gap"}], "/", "2"}]}], "}"}]}], "}"}]}], ";", 
      "\[IndentingNewLine]", "\[IndentingNewLine]", 
      RowBox[{"(*", "Cassettes", "*)"}], "\[IndentingNewLine]", 
      RowBox[{"\[Delta]BRC", " ", "=", 
       RowBox[{
       "\[Delta]GV", " ", "+", " ", "\[Delta]P", "+", "\[Delta]CP"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"BRC", " ", "=", " ", 
       RowBox[{"auxIDRectangularCassette", "[", 
        RowBox[{
        "\[Lambda]u", ",", " ", "Np", ",", "Br", ",", " ", "Height", ",", 
         "Width", ",", " ", "\[Delta]BRC", ",", " ", "BRCBlockList", ",", " ",
          "BlockGap", ",", "  ", 
         RowBox[{"\"\<PointingUp\>\"", "\[Rule]", " ", "False"}], ",", 
         RowBox[{"\"\<FirstBlock\>\"", "\[Rule]", " ", "\"\<Down\>\""}], ",", 
         " ", 
         RowBox[{
         "\"\<FieldDirection\>\"", "\[Rule]", " ", "\"\<Horizontal\>\""}], 
         ",", " ", 
         RowBox[{"\"\<Termination\>\"", "\[Rule]", " ", "Termination"}], ",", 
         " ", 
         RowBox[{
         "\"\<PosMagErrors\>\"", "\[Rule]", " ", "PosMagErrorsBRC"}]}], 
        "]"}]}], " ", ";", "\[IndentingNewLine]", "\[IndentingNewLine]", 
      RowBox[{"\[Delta]BLC", " ", "=", " ", 
       RowBox[{"\[Delta]GH", " ", "+", " ", "\[Delta]GV"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"BLC", " ", "=", " ", 
       RowBox[{"auxIDRectangularCassette", "[", 
        RowBox[{
        "\[Lambda]u", ",", " ", "Np", ",", "Br", ",", " ", "Width", ",", " ", 
         "Height", ",", " ", "\[Delta]BLC", ",", " ", "BLCBlockList", ",", 
         "BlockGap", ",", 
         RowBox[{"\"\<PointingUp\>\"", "\[Rule]", " ", "False"}], ",", 
         RowBox[{"\"\<FirstBlock\>\"", "\[Rule]", " ", "\"\<Down\>\""}], ",", 
         " ", 
         RowBox[{
         "\"\<FieldDirection\>\"", "\[Rule]", " ", "\"\<Vertical\>\""}], ",", 
         " ", 
         RowBox[{"\"\<Termination\>\"", "\[Rule]", " ", "Termination"}], ",", 
         " ", 
         RowBox[{
         "\"\<PosMagErrors\>\"", "\[Rule]", " ", "PosMagErrorsBLC"}]}], 
        "]"}]}], " ", ";", "\[IndentingNewLine]", "\[IndentingNewLine]", 
      RowBox[{"\[Delta]ULC", " ", "=", " ", 
       RowBox[{"\[Delta]GH", "+", " ", "\[Delta]P", "-", "\[Delta]CP"}]}], 
      ";", "\[IndentingNewLine]", 
      RowBox[{"ULC", " ", "=", " ", 
       RowBox[{"auxIDRectangularCassette", "[", 
        RowBox[{
        "\[Lambda]u", ",", " ", "Np", ",", "Br", ",", " ", "Height", ",", " ",
          "Width", ",", "\[Delta]ULC", ",", " ", "ULCBlockList", ",", " ", 
         "BlockGap", ",", " ", 
         RowBox[{"\"\<PointingUp\>\"", "\[Rule]", "True"}], ",", " ", 
         RowBox[{"\"\<FirstBlock\>\"", "\[Rule]", " ", "\"\<Down\>\""}], ",", 
         " ", 
         RowBox[{
         "\"\<FieldDirection\>\"", "\[Rule]", " ", "\"\<Horizontal\>\""}], 
         ",", 
         RowBox[{"\"\<Termination\>\"", "\[Rule]", " ", "Termination"}], ",", 
         " ", 
         RowBox[{
         "\"\<PosMagErrors\>\"", "\[Rule]", " ", "PosMagErrorsULC"}]}], 
        "]"}]}], " ", ";", "\[IndentingNewLine]", "\[IndentingNewLine]", 
      RowBox[{"\[Delta]URC", " ", "=", " ", "0.0"}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"URC", " ", "=", " ", 
       RowBox[{"auxIDRectangularCassette", "[", 
        RowBox[{
        "\[Lambda]u", ",", " ", "Np", ",", " ", "Br", ",", " ", "Width", ",", 
         "Height", ",", "\[Delta]URC", ",", " ", "URCBlockList", ",", 
         "BlockGap", ",", " ", 
         RowBox[{"\"\<PointingUp\>\"", "\[Rule]", " ", "True"}], ",", 
         RowBox[{"\"\<FirstBlock\>\"", "\[Rule]", " ", "\"\<Down\>\""}], ",", 
         " ", 
         RowBox[{
         "\"\<FieldDirection\>\"", "\[Rule]", " ", "\"\<Vertical\>\""}], ",", 
         
         RowBox[{"\"\<Termination\>\"", "\[Rule]", " ", "Termination"}], ",", 
         " ", 
         RowBox[{
         "\"\<PosMagErrors\>\"", "\[Rule]", " ", "PosMagErrorsURC"}]}], 
        "]"}]}], " ", ";", "\[IndentingNewLine]", "\[IndentingNewLine]", 
      RowBox[{"(*", 
       RowBox[{"Insertion", " ", "device"}], "*)"}], "\[IndentingNewLine]", 
      RowBox[{"Delta", " ", "=", " ", 
       RowBox[{"radObjCnt", "[", 
        RowBox[{"{", 
         RowBox[{"BRC", ",", " ", "BLC", ",", " ", "ULC", ",", " ", "URC"}], 
         "}"}], "]"}]}], ";", "\[IndentingNewLine]", "\[IndentingNewLine]", 
      RowBox[{"(*", 
       RowBox[{
        RowBox[{
        "Counterclockwise", " ", "rotation", " ", "of", " ", "insertion", " ",
          "device", " ", "by"}], " ", "-", 
        RowBox[{
         RowBox[{"\[Pi]", "/", "4"}], " ", "around", " ", "the", " ", "y"}], 
        "-", "axis"}], "*)"}], "\[IndentingNewLine]", 
      RowBox[{"Delta", "=", " ", 
       RowBox[{"radTrfOrnt", "[", 
        RowBox[{"Delta", ",", 
         RowBox[{"radTrfRot", "[", 
          RowBox[{
           RowBox[{"{", 
            RowBox[{"0", ",", "0", ",", "0"}], "}"}], ",", 
           RowBox[{"{", 
            RowBox[{"0", ",", "1", ",", "0"}], "}"}], ",", 
           RowBox[{
            RowBox[{"-", "\[Pi]"}], "/", "4"}]}], "]"}]}], "]"}]}], ";", 
      "\[IndentingNewLine]", "\[IndentingNewLine]", 
      RowBox[{"t1", "=", 
       RowBox[{"AbsoluteTime", "[", "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"Print", "[", 
       RowBox[{"\"\<IDRectangularDelta: elapsed time = \>\"", ",", 
        RowBox[{"(", 
         RowBox[{"t1", "-", "t0"}], ")"}], ",", "\"\< s\>\""}], "]"}], ";", 
      "\[IndentingNewLine]", "\[IndentingNewLine]", 
      RowBox[{"Return", "[", "Delta", "]"}], ";"}]}], "\[IndentingNewLine]", 
    "]"}]}], ";"}]}], "Input",
 CellChangeTimes->{
  3.766754554596554*^9, {3.7667569552301683`*^9, 3.7667570056560073`*^9}, {
   3.76675829285203*^9, 3.76675835334116*^9}, {3.766760093224132*^9, 
   3.766760094099189*^9}, {3.7674459380401154`*^9, 3.7674459453688154`*^9}, {
   3.7674480555147233`*^9, 3.7674480792197313`*^9}, {3.7675182788140783`*^9, 
   3.7675184830330715`*^9}, {3.767519394743863*^9, 3.767519406832663*^9}},
 Background->RGBColor[0.87, 0.94, 1]]
}, Closed]],

Cell[CellGroupData[{

Cell["IDRoundGapDelta", "Subsection",
 CellChangeTimes->{
  3.7667545696914883`*^9, {3.767518951766947*^9, 3.767518953066939*^9}}],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"IDRoundGapDelta", "::", "usage"}], "=", 
    "\"\<IDRoundGapDelta[\[Lambda]u, Np, Br, Gap, \\\"\[Delta]P\\\":0, \\\"\
\[Delta]GV\\\":0, \\\"\[Delta]GH\\\":0, \\\"\[Delta]CP\\\":0, \
\\\"BlockGap\\\":0, \\\"Termination\\\":\\\"None\\\", \\\"PosMagErrorsBRC\\\"\
\[Rule] {}, \\\"PosMagErrorsBLC\\\"\[Rule] {}, \\\"PosMagErrorsULC\\\"\[Rule] \
{}, \\\"PosMagErrorsURC\\\"\[Rule] {}]: Returns the ID model. \\n\\nArgs: \\n\
\[Lambda]u [mm] is the ID period, \\nNp is the number of periods, \\nBr [T] \
is the remanent magnetization of the permanent magnet blocks, \\nGap [mm] is \
the length of the minimum gap between the cassettes. \\n\\nOptional args: \\n\
\[Delta]P [mm], \[Delta]GV [mm], \[Delta]GH [mm] and \[Delta]CP [mm] are four \
types of longitudinal movements between the cassettes, \[Delta]P is the phase \
adjustement, \[Delta]GV and \[Delta]GH control the amplitude of the \
longitudinal field component and \[Delta]CP is the inclined-polarization \
adjustment, \\nBlockGap [mm] is the longitudinal gap between the blocks, \
\\nTermination is the termination type (one of the following: None, \
OneBlockSym, OneBlockAntiSym, ThreeBlocksSym, ThreeBlocksAntiSym), \
\\nPosMagErrorsBRC is a list of positions and magnetization errors for the BR \
cassette, \\nPosMagErrorsBLC is a list of positions and magnetization errors \
for the BL cassette, \\nPosMagErrorsULC is a list of positions and \
magnetization errors for the UL cassette, \\nPosMagErrorsURC is a list of \
positions and magnetization errors for the UR cassette. \\n\\nPosition and \
magnetization errors: \\nThe list of position and magnetization errors must \
be empty or have a number of elements igual to the number of blocks on each \
cassette. Each element is a list itself with the following format: \
\\n{horizontal position error[mm], vertical position error[mm], horizontal \
magnetization error[T], longitudinal magnetization error[T], vertical \
magnetization error[T]}. \\nThe errors will be add to the default values of \
position and magnetization of the blocks.\>\""}], ";"}], 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"IDRoundGapDelta", "[", 
    RowBox[{
    "\[Lambda]u_", ",", " ", "Np_", ",", " ", "Br_", ",", " ", "Gap_", ",", 
     " ", 
     RowBox[{"OptionsPattern", "[", 
      RowBox[{"{", 
       RowBox[{
        RowBox[{"\"\<\[Delta]P\>\"", "\[Rule]", " ", "0"}], ",", " ", 
        RowBox[{"\"\<\[Delta]GV\>\"", "\[Rule]", " ", "0"}], ",", " ", 
        RowBox[{"\"\<\[Delta]GH\>\"", "\[Rule]", " ", "0"}], ",", " ", 
        RowBox[{"\"\<\[Delta]CP\>\"", "\[Rule]", " ", "0"}], ",", " ", 
        RowBox[{"\"\<BlockGap\>\"", "->", "0"}], ",", " ", 
        RowBox[{"\"\<Termination\>\"", "\[Rule]", " ", "\"\<None\>\""}], ",", 
        " ", 
        RowBox[{"\"\<PosMagErrorsBRC\>\"", "\[Rule]", " ", 
         RowBox[{"{", "}"}]}], ",", " ", 
        RowBox[{"\"\<PosMagErrorsBLC\>\"", "\[Rule]", " ", 
         RowBox[{"{", "}"}]}], ",", " ", 
        RowBox[{"\"\<PosMagErrorsULC\>\"", "\[Rule]", " ", 
         RowBox[{"{", "}"}]}], ",", " ", 
        RowBox[{"\"\<PosMagErrorsURC\>\"", "\[Rule]", " ", 
         RowBox[{"{", "}"}]}]}], "}"}], "]"}]}], "]"}], " ", ":=", " ", 
   RowBox[{"Module", "[", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
      "r", ",", " ", "\[Theta]i", ",", " ", "\[Theta]", ",", " ", "n\[Theta]",
        ",", " ", "f", ",", " ", "b1", ",", " ", "b2", ",", " ", "b3", ",", 
       " ", "b4", ",", " ", "Blocks", ",", " ", "pneg", ",", " ", "ppos", ",",
        "bpos", ",", " ", "bneg", ",", "i", ",", "BRCBlockList", ",", " ", 
       "BLCBlockList", ",", " ", "ULCBlockList", ",", " ", "URCBlockList", 
       ",", " ", "\[IndentingNewLine]", "PosMagErrorsBRC", " ", ",", " ", 
       "PosMagErrorsBLC", ",", " ", "PosMagErrorsULC", " ", ",", " ", 
       "PosMagErrorsURC", ",", "\[IndentingNewLine]", "\[Delta]P", ",", " ", 
       "\[Delta]GV", ",", " ", "\[Delta]GH", ",", " ", "\[Delta]CP", ",", " ",
        "Termination", ",", "\[IndentingNewLine]", " ", "BlockGap", ",", " ", 
       "\[Delta]BRC", ",", " ", "BRC", ",", " ", "\[Delta]BLC", ",", " ", 
       "BLC", ",", " ", "\[Delta]ULC", ",", " ", "ULC", ",", " ", 
       "\[Delta]URC", ",", " ", "URC", ",", " ", "Delta", ",", " ", "t0", ",",
        " ", "t1"}], "}"}], ",", "\[IndentingNewLine]", 
     RowBox[{"(*", 
      RowBox[{
       RowBox[{
       "The", " ", "insertion", " ", "device", " ", "is", " ", "created", " ",
         "rotated", " ", "by", " ", 
        RowBox[{"\[Pi]", "/", "4"}], " ", "about", " ", "the", " ", "y"}], 
       "-", 
       RowBox[{
       "axis", " ", "to", " ", "simplified", " ", "the", " ", "magnetization",
         " ", 
        RowBox[{"functions", ".", " ", "The"}], " ", "entire", " ", "device", 
        " ", "is", " ", "rotated", " ", "to", " ", "the", " ", "correct", " ",
         "position", " ", "at", " ", "the", " ", "end", " ", "of", " ", "the",
         " ", 
        RowBox[{"function", "."}]}]}], "*)"}], "\[IndentingNewLine]", 
     "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"t0", "=", 
       RowBox[{"AbsoluteTime", "[", "]"}]}], ";", "\[IndentingNewLine]", 
      "\[IndentingNewLine]", 
      RowBox[{"(*", 
       RowBox[{"Delete", " ", "previous", " ", "Radia", " ", "objects"}], 
       "*)"}], "\[IndentingNewLine]", 
      RowBox[{"radUtiDelAll", "[", "]"}], ";", "\[IndentingNewLine]", 
      "\[IndentingNewLine]", 
      RowBox[{"(*", 
       RowBox[{"Check", " ", "arguments"}], "*)"}], "\[IndentingNewLine]", 
      RowBox[{"If", " ", "[", 
       RowBox[{
        RowBox[{"\[Lambda]u", " ", "\[LessEqual]", " ", "0"}], ",", " ", 
        RowBox[{"Return", "[", "]"}]}], "]"}], ";", "\[IndentingNewLine]", 
      RowBox[{"If", " ", "[", 
       RowBox[{
        RowBox[{"Np", " ", "\[LessEqual]", " ", "0"}], ",", " ", 
        RowBox[{"Return", "[", "]"}]}], "]"}], ";", "\[IndentingNewLine]", 
      RowBox[{"If", " ", "[", 
       RowBox[{
        RowBox[{"Br", " ", "\[LessEqual]", " ", "0"}], ",", " ", 
        RowBox[{"Return", "[", "]"}]}], "]"}], ";", "\[IndentingNewLine]", 
      RowBox[{"If", " ", "[", 
       RowBox[{
        RowBox[{"Gap", " ", "\[LessEqual]", " ", "0"}], ",", " ", 
        RowBox[{"Return", "[", "]"}]}], "]"}], ";", "\[IndentingNewLine]", 
      "\[IndentingNewLine]", 
      RowBox[{"(*", 
       RowBox[{"Gap", " ", "between", " ", "blocks"}], "*)"}], 
      "\[IndentingNewLine]", " ", 
      RowBox[{"BlockGap", " ", "=", " ", 
       RowBox[{"OptionValue", "[", "\"\<BlockGap\>\"", "]"}]}], ";", 
      "\[IndentingNewLine]", "\[IndentingNewLine]", 
      RowBox[{"(*", 
       RowBox[{"Cassettes", " ", "longitudinal", " ", 
        RowBox[{"displacement", " ", "[", "mm", "]"}]}], "*)"}], 
      "\[IndentingNewLine]", 
      RowBox[{"\[Delta]P", " ", "=", " ", 
       RowBox[{"OptionValue", "[", "\"\<\[Delta]P\>\"", "]"}]}], ";", " ", 
      RowBox[{"(*", 
       RowBox[{"Phase", " ", "adjustment"}], "*)"}], "\[IndentingNewLine]", 
      RowBox[{"\[Delta]GV", " ", "=", " ", 
       RowBox[{"OptionValue", "[", "\"\<\[Delta]GV\>\"", "]"}]}], ";", " ", 
      RowBox[{"(*", 
       RowBox[{
        RowBox[{
        "Vertical", " ", "field", " ", "amplitude", " ", "to", " ", 
         "longitudinal", " ", "field", " ", "amplitude"}], ",", " ", 
        RowBox[{
        "also", " ", "decreases", " ", "horizontal", " ", "field", " ", 
         "amplitude"}]}], "*)"}], "\[IndentingNewLine]", 
      RowBox[{"\[Delta]GH", " ", "=", " ", 
       RowBox[{"OptionValue", "[", "\"\<\[Delta]GH\>\"", "]"}]}], ";", 
      RowBox[{"(*", 
       RowBox[{
        RowBox[{
        "Horizontal", " ", "field", " ", "amplitude", " ", "to", " ", 
         "longitudinal", " ", "field", " ", "amplitude"}], ",", " ", 
        RowBox[{
        "also", " ", "decreases", " ", "vertical", " ", "field", " ", 
         "amplitude"}]}], "*)"}], "\[IndentingNewLine]", 
      RowBox[{"\[Delta]CP", " ", "=", " ", 
       RowBox[{"OptionValue", "[", "\"\<\[Delta]CP\>\"", "]"}]}], ";", 
      RowBox[{"(*", 
       RowBox[{"Inclined", " ", "polarization", " ", "adjustment"}], "*)"}], 
      "\[IndentingNewLine]", "\[IndentingNewLine]", 
      RowBox[{"(*", 
       RowBox[{"Termination", " ", "Type"}], "*)"}], "\[IndentingNewLine]", 
      RowBox[{"Termination", " ", "=", " ", 
       RowBox[{"OptionValue", "[", "\"\<Termination\>\"", "]"}]}], ";", 
      "\[IndentingNewLine]", "\[IndentingNewLine]", 
      RowBox[{"(*", 
       RowBox[{"Position", " ", "and", " ", "magnetization", " ", "errors"}], 
       "*)"}], "\[IndentingNewLine]", 
      RowBox[{"PosMagErrorsBRC", " ", "=", " ", 
       RowBox[{"OptionValue", "[", "\"\<PosMagErrorsBRC\>\"", "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"PosMagErrorsBLC", " ", "=", " ", 
       RowBox[{"OptionValue", "[", "\"\<PosMagErrorsBLC\>\"", "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"PosMagErrorsULC", " ", "=", " ", 
       RowBox[{"OptionValue", "[", "\"\<PosMagErrorsULC\>\"", "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"PosMagErrorsURC", " ", "=", " ", 
       RowBox[{"OptionValue", "[", "\"\<PosMagErrorsURC\>\"", "]"}]}], ";", 
      "\[IndentingNewLine]", "\[IndentingNewLine]", 
      RowBox[{"(*", 
       RowBox[{
        RowBox[{
        "Counterclockwise", " ", "rotation", " ", "of", " ", "errors", " ", 
         "by", " ", 
         RowBox[{"\[Pi]", "/", "4"}], " ", "around", " ", "the", " ", "y"}], 
        "-", "axis"}], "*)"}], "\[IndentingNewLine]", 
      RowBox[{"PosMagErrorsBRC", " ", "=", " ", 
       RowBox[{
        RowBox[{
         RowBox[{"Flatten", "[", 
          RowBox[{"{", 
           RowBox[{
            RowBox[{"Dot", "[", 
             RowBox[{
              RowBox[{"RotationMatrix", "[", 
               RowBox[{
                RowBox[{"-", "\[Pi]"}], "/", "4"}], "]"}], ",", 
              RowBox[{"{", 
               RowBox[{
                RowBox[{"#", "[", 
                 RowBox[{"[", "1", "]"}], "]"}], ",", " ", 
                RowBox[{"#", "[", 
                 RowBox[{"[", "2", "]"}], "]"}]}], "}"}]}], "]"}], ",", 
            RowBox[{"Dot", "[", 
             RowBox[{
              RowBox[{"RotationMatrix", "[", 
               RowBox[{
                RowBox[{"\[Pi]", "/", "4"}], ",", " ", 
                RowBox[{"{", 
                 RowBox[{"0", ",", " ", "1", ",", " ", "0"}], "}"}]}], "]"}], 
              ",", 
              RowBox[{"{", 
               RowBox[{
                RowBox[{"#", "[", 
                 RowBox[{"[", "3", "]"}], "]"}], ",", " ", 
                RowBox[{"#", "[", 
                 RowBox[{"[", "4", "]"}], "]"}], ",", " ", 
                RowBox[{"#", "[", 
                 RowBox[{"[", "5", "]"}], "]"}]}], "}"}]}], "]"}]}], "}"}], 
          "]"}], "&"}], "/@", " ", "PosMagErrorsBRC"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"PosMagErrorsBLC", " ", "=", " ", 
       RowBox[{
        RowBox[{
         RowBox[{"Flatten", "[", 
          RowBox[{"{", 
           RowBox[{
            RowBox[{"Dot", "[", 
             RowBox[{
              RowBox[{"RotationMatrix", "[", 
               RowBox[{
                RowBox[{"-", "\[Pi]"}], "/", "4"}], "]"}], ",", 
              RowBox[{"{", 
               RowBox[{
                RowBox[{"#", "[", 
                 RowBox[{"[", "1", "]"}], "]"}], ",", " ", 
                RowBox[{"#", "[", 
                 RowBox[{"[", "2", "]"}], "]"}]}], "}"}]}], "]"}], ",", 
            RowBox[{"Dot", "[", 
             RowBox[{
              RowBox[{"RotationMatrix", "[", 
               RowBox[{
                RowBox[{"\[Pi]", "/", "4"}], ",", " ", 
                RowBox[{"{", 
                 RowBox[{"0", ",", " ", "1", ",", " ", "0"}], "}"}]}], "]"}], 
              ",", 
              RowBox[{"{", 
               RowBox[{
                RowBox[{"#", "[", 
                 RowBox[{"[", "3", "]"}], "]"}], ",", " ", 
                RowBox[{"#", "[", 
                 RowBox[{"[", "4", "]"}], "]"}], ",", " ", 
                RowBox[{"#", "[", 
                 RowBox[{"[", "5", "]"}], "]"}]}], "}"}]}], "]"}]}], "}"}], 
          "]"}], "&"}], "/@", " ", "PosMagErrorsBLC"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"PosMagErrorsULC", " ", "=", " ", 
       RowBox[{
        RowBox[{
         RowBox[{"Flatten", "[", 
          RowBox[{"{", 
           RowBox[{
            RowBox[{"Dot", "[", 
             RowBox[{
              RowBox[{"RotationMatrix", "[", 
               RowBox[{
                RowBox[{"-", "\[Pi]"}], "/", "4"}], "]"}], ",", 
              RowBox[{"{", 
               RowBox[{
                RowBox[{"#", "[", 
                 RowBox[{"[", "1", "]"}], "]"}], ",", " ", 
                RowBox[{"#", "[", 
                 RowBox[{"[", "2", "]"}], "]"}]}], "}"}]}], "]"}], ",", 
            RowBox[{"Dot", "[", 
             RowBox[{
              RowBox[{"RotationMatrix", "[", 
               RowBox[{
                RowBox[{"\[Pi]", "/", "4"}], ",", " ", 
                RowBox[{"{", 
                 RowBox[{"0", ",", " ", "1", ",", " ", "0"}], "}"}]}], "]"}], 
              ",", 
              RowBox[{"{", 
               RowBox[{
                RowBox[{"#", "[", 
                 RowBox[{"[", "3", "]"}], "]"}], ",", " ", 
                RowBox[{"#", "[", 
                 RowBox[{"[", "4", "]"}], "]"}], ",", " ", 
                RowBox[{"#", "[", 
                 RowBox[{"[", "5", "]"}], "]"}]}], "}"}]}], "]"}]}], "}"}], 
          "]"}], "&"}], "/@", " ", "PosMagErrorsULC"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"PosMagErrorsURC", " ", "=", " ", 
       RowBox[{
        RowBox[{
         RowBox[{"Flatten", "[", 
          RowBox[{"{", 
           RowBox[{
            RowBox[{"Dot", "[", 
             RowBox[{
              RowBox[{"RotationMatrix", "[", 
               RowBox[{
                RowBox[{"-", "\[Pi]"}], "/", "4"}], "]"}], ",", 
              RowBox[{"{", 
               RowBox[{
                RowBox[{"#", "[", 
                 RowBox[{"[", "1", "]"}], "]"}], ",", " ", 
                RowBox[{"#", "[", 
                 RowBox[{"[", "2", "]"}], "]"}]}], "}"}]}], "]"}], ",", 
            RowBox[{"Dot", "[", 
             RowBox[{
              RowBox[{"RotationMatrix", "[", 
               RowBox[{
                RowBox[{"\[Pi]", "/", "4"}], ",", " ", 
                RowBox[{"{", 
                 RowBox[{"0", ",", " ", "1", ",", " ", "0"}], "}"}]}], "]"}], 
              ",", 
              RowBox[{"{", 
               RowBox[{
                RowBox[{"#", "[", 
                 RowBox[{"[", "3", "]"}], "]"}], ",", " ", 
                RowBox[{"#", "[", 
                 RowBox[{"[", "4", "]"}], "]"}], ",", " ", 
                RowBox[{"#", "[", 
                 RowBox[{"[", "5", "]"}], "]"}]}], "}"}]}], "]"}]}], "}"}], 
          "]"}], "&"}], "/@", " ", "PosMagErrorsURC"}]}], ";", 
      "\[IndentingNewLine]", "\[IndentingNewLine]", 
      RowBox[{"(*", 
       RowBox[{"Block", " ", "vertices"}], "*)"}], "\[IndentingNewLine]", 
      RowBox[{"r", " ", "=", " ", 
       RowBox[{"Sqrt", "[", 
        RowBox[{
         RowBox[{"2.75", "^", "2"}], " ", "+", " ", 
         RowBox[{"3.46", "^", "2"}]}], "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"\[Theta]i", " ", "=", " ", 
       RowBox[{"ArcTan", "[", 
        RowBox[{"3.46", "/", "2.75"}], "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"f", " ", "=", " ", 
       RowBox[{"Gap", "/", 
        RowBox[{"(", 
         RowBox[{"2", "*", "r"}], ")"}]}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"b1", " ", "=", 
       RowBox[{"f", "*", 
        RowBox[{"{", 
         RowBox[{
          RowBox[{"{", 
           RowBox[{
            RowBox[{
             RowBox[{"-", "2.75"}], " ", "-", " ", "r", "+", "3.46"}], ",", 
            " ", "r"}], "}"}], ",", " ", 
          RowBox[{"{", 
           RowBox[{
            RowBox[{"-", "11.2662"}], ",", " ", "12.4245"}], "}"}], ",", " ", 
          
          RowBox[{"{", 
           RowBox[{
            RowBox[{"-", "7.73071"}], ",", "15.96"}], "}"}], ",", 
          RowBox[{"{", 
           RowBox[{"7.73071", ",", "15.96"}], "}"}], ",", " ", 
          RowBox[{"{", 
           RowBox[{"11.2662", ",", " ", "12.4245"}], "}"}], ",", " ", 
          RowBox[{"{", 
           RowBox[{
            RowBox[{"2.75", " ", "+", " ", "r", "-", " ", "3.46"}], ",", " ", 
            "r"}], "}"}]}], "}"}]}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"b2", " ", "=", " ", 
       RowBox[{"f", "*", 
        RowBox[{"{", " ", 
         RowBox[{
          RowBox[{"{", 
           RowBox[{
            RowBox[{"-", "7.73071"}], ",", "15.96"}], "}"}], ",", 
          RowBox[{"{", 
           RowBox[{
            RowBox[{"-", "11.2662"}], ",", " ", "19.4955"}], "}"}], ",", 
          RowBox[{"{", 
           RowBox[{
            RowBox[{"-", "2.75"}], ",", "28.46"}], "}"}], ",", " ", 
          RowBox[{"{", 
           RowBox[{"2.75", ",", "28.46"}], "}"}], ",", " ", 
          RowBox[{"{", 
           RowBox[{"11.2662", ",", " ", "19.4955"}], "}"}], ",", " ", 
          RowBox[{"{", 
           RowBox[{"7.73071", ",", "15.96"}], "}"}]}], "}"}]}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"b3", " ", "=", " ", 
       RowBox[{"f", "*", 
        RowBox[{"{", 
         RowBox[{
          RowBox[{"{", 
           RowBox[{"2.75", ",", " ", "3.46"}], "}"}], ",", " ", 
          RowBox[{"{", 
           RowBox[{"2.75", ",", " ", "r"}], "}"}], ",", " ", 
          RowBox[{"{", 
           RowBox[{
            RowBox[{"2.75", " ", "+", " ", "r", "-", " ", "3.46"}], ",", " ", 
            "r"}], "}"}]}], "}"}]}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"b4", " ", "=", " ", 
       RowBox[{"f", "*", 
        RowBox[{"{", 
         RowBox[{
          RowBox[{"{", 
           RowBox[{
            RowBox[{"-", "2.75"}], ",", " ", "3.46"}], "}"}], ",", " ", 
          RowBox[{"{", 
           RowBox[{
            RowBox[{"-", "2.75"}], ",", " ", "r"}], "}"}], ",", " ", 
          RowBox[{"{", 
           RowBox[{
            RowBox[{
             RowBox[{"-", "2.75"}], " ", "-", " ", "r", "+", " ", "3.46"}], 
            ",", " ", "r"}], "}"}]}], "}"}]}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"Blocks", " ", "=", " ", 
       RowBox[{"{", 
        RowBox[{"b1", ",", "b2", ",", " ", "b3", ",", " ", "b4"}], "}"}]}], 
      ";", "\[IndentingNewLine]", "\[IndentingNewLine]", 
      RowBox[{"n\[Theta]", " ", "=", " ", "10"}], ";", "\[IndentingNewLine]", 
      
      RowBox[{"\[Theta]", " ", "=", " ", 
       RowBox[{"Range", "[", 
        RowBox[{
         RowBox[{"\[Pi]", "/", "2"}], ",", " ", "\[Theta]i", ",", "  ", 
         RowBox[{
          RowBox[{"-", 
           RowBox[{"(", 
            RowBox[{
             RowBox[{"\[Pi]", "/", "2"}], "-", " ", "\[Theta]i"}], ")"}]}], 
          "/", 
          RowBox[{"(", 
           RowBox[{"n\[Theta]", "-", "1"}], ")"}]}]}], "]"}]}], ";", 
      "\[IndentingNewLine]", "\[IndentingNewLine]", 
      RowBox[{"AppendTo", "[", 
       RowBox[{"Blocks", ",", " ", 
        RowBox[{"f", "*", 
         RowBox[{"{", 
          RowBox[{
           RowBox[{"{", 
            RowBox[{"0", ",", " ", "r"}], "}"}], ",", " ", 
           RowBox[{"{", 
            RowBox[{
             RowBox[{"r", "*", 
              RowBox[{"Cos", "[", 
               RowBox[{"\[Pi]", "-", 
                RowBox[{"\[Theta]", "[", 
                 RowBox[{"[", "2", "]"}], "]"}]}], "]"}]}], ",", " ", 
             RowBox[{"r", "*", 
              RowBox[{"Sin", "[", 
               RowBox[{"\[Pi]", "-", 
                RowBox[{"\[Theta]", "[", 
                 RowBox[{"[", "2", "]"}], "]"}]}], "]"}]}]}], "}"}], ",", " ", 
           RowBox[{"{", 
            RowBox[{
             RowBox[{"r", "*", 
              RowBox[{"Cos", "[", 
               RowBox[{"\[Pi]", "-", 
                RowBox[{"\[Theta]", "[", 
                 RowBox[{"[", "2", "]"}], "]"}]}], "]"}]}], ",", " ", "r"}], 
            "}"}]}], "}"}]}]}], "]"}], ";", "\[IndentingNewLine]", 
      RowBox[{"pneg", " ", "=", " ", 
       RowBox[{"{", 
        RowBox[{
         RowBox[{"r", "*", 
          RowBox[{"Cos", "[", 
           RowBox[{"\[Pi]", "-", 
            RowBox[{"\[Theta]", "[", 
             RowBox[{"[", "2", "]"}], "]"}]}], "]"}]}], ",", " ", "r"}], 
        "}"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"AppendTo", "[", 
       RowBox[{"Blocks", ",", " ", 
        RowBox[{"f", "*", 
         RowBox[{"{", 
          RowBox[{
           RowBox[{"{", 
            RowBox[{"0", ",", " ", "r"}], "}"}], ",", " ", 
           RowBox[{"{", 
            RowBox[{
             RowBox[{"r", "*", 
              RowBox[{"Cos", "[", 
               RowBox[{"\[Theta]", "[", 
                RowBox[{"[", "2", "]"}], "]"}], "]"}]}], ",", " ", 
             RowBox[{"r", "*", 
              RowBox[{"Sin", "[", 
               RowBox[{"\[Theta]", "[", 
                RowBox[{"[", "2", "]"}], "]"}], "]"}]}]}], "}"}], ",", " ", 
           RowBox[{"{", 
            RowBox[{
             RowBox[{"r", "*", 
              RowBox[{"Cos", "[", 
               RowBox[{"\[Theta]", "[", 
                RowBox[{"[", "2", "]"}], "]"}], "]"}]}], ",", " ", "r"}], 
            "}"}]}], "}"}]}]}], "]"}], ";", "\[IndentingNewLine]", 
      RowBox[{"ppos", " ", "=", 
       RowBox[{"{", 
        RowBox[{
         RowBox[{"r", "*", 
          RowBox[{"Cos", "[", 
           RowBox[{"\[Theta]", "[", 
            RowBox[{"[", "2", "]"}], "]"}], "]"}]}], ",", " ", "r"}], "}"}]}],
       ";", " ", "\[IndentingNewLine]", "\[IndentingNewLine]", 
      RowBox[{"For", " ", "[", 
       RowBox[{
        RowBox[{"i", "=", "3"}], ",", " ", 
        RowBox[{"i", "\[LessEqual]", 
         RowBox[{"Length", "[", "\[Theta]", "]"}]}], ",", " ", 
        RowBox[{"i", "++"}], ",", " ", "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"bpos", " ", "=", " ", 
          RowBox[{"f", "*", 
           RowBox[{"{", 
            RowBox[{"ppos", ",", " ", 
             RowBox[{"{", 
              RowBox[{
               RowBox[{"r", "*", 
                RowBox[{"Cos", "[", 
                 RowBox[{"\[Theta]", "[", 
                  RowBox[{"[", 
                   RowBox[{"i", "-", "1"}], "]"}], "]"}], "]"}]}], ",", " ", 
               RowBox[{"r", "*", 
                RowBox[{"Sin", "[", 
                 RowBox[{"\[Theta]", "[", 
                  RowBox[{"[", 
                   RowBox[{"i", "-", "1"}], "]"}], "]"}], "]"}]}]}], "}"}], 
             ",", " ", 
             RowBox[{"{", 
              RowBox[{
               RowBox[{"r", "*", 
                RowBox[{"Cos", "[", 
                 RowBox[{"\[Theta]", "[", 
                  RowBox[{"[", "i", "]"}], "]"}], "]"}]}], ",", " ", 
               RowBox[{"r", "*", 
                RowBox[{"Sin", "[", 
                 RowBox[{"\[Theta]", "[", 
                  RowBox[{"[", "i", "]"}], "]"}], "]"}]}]}], "}"}], ",", " ", 
             
             RowBox[{"{", 
              RowBox[{
               RowBox[{"r", "*", 
                RowBox[{"Cos", "[", 
                 RowBox[{"\[Theta]", "[", 
                  RowBox[{"[", "i", "]"}], "]"}], "]"}]}], ",", " ", "r"}], 
              "}"}]}], "}"}]}]}], ";", "\[IndentingNewLine]", 
         RowBox[{"ppos", " ", "=", " ", 
          RowBox[{"{", 
           RowBox[{
            RowBox[{"r", "*", 
             RowBox[{"Cos", "[", 
              RowBox[{"\[Theta]", "[", 
               RowBox[{"[", "i", "]"}], "]"}], "]"}]}], ",", " ", "r"}], 
           "}"}]}], ";", "\[IndentingNewLine]", 
         RowBox[{"AppendTo", "[", 
          RowBox[{"Blocks", ",", "bpos"}], "]"}], ";", "\[IndentingNewLine]", 
         
         RowBox[{"bneg", " ", "=", " ", 
          RowBox[{"f", "*", 
           RowBox[{"{", 
            RowBox[{"pneg", ",", " ", 
             RowBox[{"{", 
              RowBox[{
               RowBox[{"r", "*", 
                RowBox[{"Cos", "[", 
                 RowBox[{"\[Pi]", "-", 
                  RowBox[{"\[Theta]", "[", 
                   RowBox[{"[", 
                    RowBox[{"i", "-", "1"}], "]"}], "]"}]}], "]"}]}], ",", 
               " ", 
               RowBox[{"r", "*", 
                RowBox[{"Sin", "[", 
                 RowBox[{"\[Pi]", "-", 
                  RowBox[{"\[Theta]", "[", 
                   RowBox[{"[", 
                    RowBox[{"i", "-", "1"}], "]"}], "]"}]}], "]"}]}]}], "}"}],
              ",", " ", 
             RowBox[{"{", 
              RowBox[{
               RowBox[{"r", "*", 
                RowBox[{"Cos", "[", 
                 RowBox[{"\[Pi]", "-", 
                  RowBox[{"\[Theta]", "[", 
                   RowBox[{"[", "i", "]"}], "]"}]}], "]"}]}], ",", " ", 
               RowBox[{"r", "*", 
                RowBox[{"Sin", "[", 
                 RowBox[{"\[Pi]", "-", 
                  RowBox[{"\[Theta]", "[", 
                   RowBox[{"[", "i", "]"}], "]"}]}], "]"}]}]}], "}"}], ",", 
             " ", 
             RowBox[{"{", 
              RowBox[{
               RowBox[{"r", "*", 
                RowBox[{"Cos", "[", 
                 RowBox[{"\[Pi]", "-", 
                  RowBox[{"\[Theta]", "[", 
                   RowBox[{"[", "i", "]"}], "]"}]}], "]"}]}], ",", " ", "r"}],
               "}"}]}], "}"}]}]}], ";", "\[IndentingNewLine]", 
         RowBox[{"pneg", " ", "=", 
          RowBox[{"{", 
           RowBox[{
            RowBox[{"r", "*", 
             RowBox[{"Cos", "[", 
              RowBox[{"\[Pi]", "-", 
               RowBox[{"\[Theta]", "[", 
                RowBox[{"[", "i", "]"}], "]"}]}], "]"}]}], ",", " ", "r"}], 
           "}"}]}], ";", "\[IndentingNewLine]", 
         RowBox[{"AppendTo", "[", 
          RowBox[{"Blocks", ",", " ", "bneg"}], "]"}], ";"}]}], 
       "\[IndentingNewLine]", "]"}], ";", "\[IndentingNewLine]", 
      "\[IndentingNewLine]", 
      RowBox[{"(*", 
       RowBox[{
       "Block", " ", "vertices", " ", "for", " ", "each", " ", "cassette", 
        " ", 
        RowBox[{"(", 
         RowBox[{
         "cross", " ", "section", " ", "in", " ", "the", " ", "yz", " ", 
          "plane"}], ")"}]}], "*)"}], "\[IndentingNewLine]", 
      RowBox[{"BLCBlockList", " ", "=", "Blocks"}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"ULCBlockList", " ", "=", " ", 
       RowBox[{
        RowBox[{
         RowBox[{
          RowBox[{
           RowBox[{"Dot", "[", 
            RowBox[{
             RowBox[{"RotationMatrix", "[", 
              RowBox[{"\[Pi]", "/", "2"}], "]"}], ",", "#"}], "]"}], "&"}], "/@",
           "#"}], "&"}], "/@", "BLCBlockList"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"URCBlockList", " ", "=", " ", 
       RowBox[{
        RowBox[{
         RowBox[{
          RowBox[{
           RowBox[{"Dot", "[", 
            RowBox[{
             RowBox[{"RotationMatrix", "[", 
              RowBox[{"\[Pi]", "/", "2"}], "]"}], ",", "#"}], "]"}], "&"}], "/@",
           "#"}], "&"}], "/@", "ULCBlockList"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"BRCBlockList", " ", "=", " ", 
       RowBox[{
        RowBox[{
         RowBox[{
          RowBox[{
           RowBox[{"Dot", "[", 
            RowBox[{
             RowBox[{"RotationMatrix", "[", 
              RowBox[{"\[Pi]", "/", "2"}], "]"}], ",", "#"}], "]"}], "&"}], "/@",
           "#"}], "&"}], "/@", "URCBlockList"}]}], ";", "\[IndentingNewLine]",
       "\[IndentingNewLine]", 
      RowBox[{"(*", "Cassettes", "*)"}], "\[IndentingNewLine]", 
      RowBox[{"\[Delta]BRC", " ", "=", 
       RowBox[{
       "\[Delta]GV", " ", "+", " ", "\[Delta]P", "+", "\[Delta]CP"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"BRC", " ", "=", 
       RowBox[{"auxIDCassette", "[", 
        RowBox[{
        "\[Lambda]u", ",", " ", "Np", ",", " ", "Br", ",", " ", "\[Delta]BRC",
          ",", "BRCBlockList", ",", " ", "BlockGap", ",", " ", 
         RowBox[{"\"\<PointingUp\>\"", "\[Rule]", "False"}], ",", " ", 
         RowBox[{"\"\<FirstBlock\>\"", "\[Rule]", " ", "\"\<Down\>\""}], ",", 
         " ", 
         RowBox[{
         "\"\<FieldDirection\>\"", "\[Rule]", " ", "\"\<Horizontal\>\""}], 
         ",", 
         RowBox[{"\"\<Termination\>\"", "\[Rule]", " ", "Termination"}], ",", 
         
         RowBox[{
         "\"\<PosMagErrors\>\"", "\[Rule]", " ", "PosMagErrorsBRC"}]}], 
        "]"}]}], ";", "\[IndentingNewLine]", "\[IndentingNewLine]", 
      RowBox[{"\[Delta]BLC", " ", "=", 
       RowBox[{"\[Delta]GH", " ", "+", " ", "\[Delta]GV"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"BLC", " ", "=", " ", 
       RowBox[{"auxIDCassette", "[", 
        RowBox[{
        "\[Lambda]u", ",", " ", "Np", ",", " ", "Br", ",", "\[Delta]BLC", ",",
          " ", "BLCBlockList", ",", " ", "BlockGap", ",", " ", 
         RowBox[{"\"\<PointingUp\>\"", "\[Rule]", " ", "False"}], ",", 
         RowBox[{"\"\<FirstBlock\>\"", "\[Rule]", " ", "\"\<Down\>\""}], ",", 
         " ", 
         RowBox[{
         "\"\<FieldDirection\>\"", "\[Rule]", " ", "\"\<Vertical\>\""}], ",", 
         " ", 
         RowBox[{"\"\<Termination\>\"", "\[Rule]", " ", "Termination"}], ",", 
         
         RowBox[{
         "\"\<PosMagErrors\>\"", "\[Rule]", " ", "PosMagErrorsBLC"}]}], 
        "]"}]}], ";", "\[IndentingNewLine]", "\[IndentingNewLine]", 
      RowBox[{"\[Delta]ULC", " ", "=", " ", 
       RowBox[{"\[Delta]GH", "+", " ", "\[Delta]P", "-", "\[Delta]CP"}]}], 
      ";", "\[IndentingNewLine]", 
      RowBox[{"ULC", " ", "=", " ", 
       RowBox[{"auxIDCassette", "[", 
        RowBox[{
        "\[Lambda]u", ",", " ", "Np", ",", " ", "Br", ",", "\[Delta]ULC", ",",
          " ", "ULCBlockList", ",", " ", "BlockGap", ",", " ", 
         RowBox[{"\"\<PointingUp\>\"", "\[Rule]", " ", "True"}], ",", 
         RowBox[{"\"\<FirstBlock\>\"", "\[Rule]", " ", "\"\<Down\>\""}], ",", 
         " ", 
         RowBox[{
         "\"\<FieldDirection\>\"", "\[Rule]", " ", "\"\<Horizontal\>\""}], 
         ",", " ", 
         RowBox[{"\"\<Termination\>\"", "\[Rule]", " ", "Termination"}], ",", 
         
         RowBox[{
         "\"\<PosMagErrors\>\"", "\[Rule]", " ", "PosMagErrorsULC"}]}], 
        "]"}]}], ";", "\[IndentingNewLine]", "\[IndentingNewLine]", 
      RowBox[{"\[Delta]URC", " ", "=", " ", "0.0"}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"URC", " ", "=", " ", 
       RowBox[{"auxIDCassette", "[", 
        RowBox[{
        "\[Lambda]u", ",", " ", "Np", ",", " ", "Br", ",", "\[Delta]URC", ",",
          " ", "URCBlockList", ",", " ", "BlockGap", ",", " ", 
         RowBox[{"\"\<PointingUp\>\"", "\[Rule]", " ", "True"}], ",", 
         RowBox[{"\"\<FirstBlock\>\"", "\[Rule]", " ", "\"\<Down\>\""}], ",", 
         
         RowBox[{
         "\"\<FieldDirection\>\"", "\[Rule]", " ", "\"\<Vertical\>\""}], ",", 
         
         RowBox[{"\"\<Termination\>\"", "\[Rule]", " ", "Termination"}], ",", 
         
         RowBox[{
         "\"\<PosMagErrors\>\"", "\[Rule]", " ", "PosMagErrorsURC"}]}], 
        "]"}]}], ";", "\[IndentingNewLine]", "\[IndentingNewLine]", 
      RowBox[{"(*", 
       RowBox[{"Insertion", " ", "device"}], "*)"}], "\[IndentingNewLine]", 
      RowBox[{"Delta", " ", "=", " ", 
       RowBox[{"radObjCnt", "[", 
        RowBox[{"{", 
         RowBox[{"BRC", ",", " ", "BLC", ",", " ", "ULC", ",", " ", "URC"}], 
         "}"}], "]"}]}], ";", "\[IndentingNewLine]", "\[IndentingNewLine]", 
      RowBox[{"(*", 
       RowBox[{
        RowBox[{
        "Counterclockwise", " ", "rotation", " ", "of", " ", "insertion", " ",
          "device", " ", "by"}], " ", "-", 
        RowBox[{
         RowBox[{"\[Pi]", "/", "4"}], " ", "around", " ", "the", " ", "y"}], 
        "-", "axis"}], "*)"}], "\[IndentingNewLine]", 
      RowBox[{"Delta", "=", " ", 
       RowBox[{"radTrfOrnt", "[", 
        RowBox[{"Delta", ",", 
         RowBox[{"radTrfRot", "[", 
          RowBox[{
           RowBox[{"{", 
            RowBox[{"0", ",", "0", ",", "0"}], "}"}], ",", 
           RowBox[{"{", 
            RowBox[{"0", ",", "1", ",", "0"}], "}"}], ",", 
           RowBox[{
            RowBox[{"-", "\[Pi]"}], "/", "4"}]}], "]"}]}], "]"}]}], ";", 
      "\[IndentingNewLine]", "\[IndentingNewLine]", 
      RowBox[{"t1", "=", 
       RowBox[{"AbsoluteTime", "[", "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"Print", "[", 
       RowBox[{"\"\<IDDeltaRoundGap: elapsed time = \>\"", ",", 
        RowBox[{"(", 
         RowBox[{"t1", "-", "t0"}], ")"}], ",", "\"\< s\>\""}], "]"}], ";", 
      "\[IndentingNewLine]", "\[IndentingNewLine]", 
      RowBox[{"Return", "[", "Delta", "]"}], ";"}]}], "\[IndentingNewLine]", 
    "]"}]}], ";"}], "\[IndentingNewLine]"}], "Input",
 CellChangeTimes->{{3.7667570196414795`*^9, 3.76675705883206*^9}, {
   3.7667583636544714`*^9, 3.766758382374689*^9}, {3.7667601105067225`*^9, 
   3.7667601111473975`*^9}, {3.7674459577447896`*^9, 
   3.7674459679643497`*^9}, {3.767448092345765*^9, 3.767448121113639*^9}, {
   3.767518533236807*^9, 3.7675185941188755`*^9}, 3.767518630053323*^9, {
   3.767518961797905*^9, 3.7675189732208247`*^9}},
 Background->RGBColor[0.87, 0.94, 1]]
}, Closed]],

Cell[CellGroupData[{

Cell["IDCornellDelta", "Subsection",
 CellChangeTimes->{
  3.7667545696914883`*^9, {3.766754603772298*^9, 3.7667546054286704`*^9}, {
   3.7675189550426054`*^9, 3.7675189567222004`*^9}}],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"IDCornellDelta", "::", "usage"}], "=", 
    "\"\<IDCornellDelta[\[Lambda]u, Np, Br, Gap, \\\"\[Delta]P\\\":0, \\\"\
\[Delta]GV\\\":0, \\\"\[Delta]GH\\\":0, \\\"\[Delta]CP\\\":0, \
\\\"BlockGap\\\":0, \\\"Termination\\\":\\\"None\\\", \\\"PosMagErrorsBRC\\\"\
\[Rule] {}, \\\"PosMagErrorsBLC\\\"\[Rule] {}, \\\"PosMagErrorsULC\\\"\[Rule] \
{}, \\\"PosMagErrorsURC\\\"\[Rule] {}]: Returns the ID model. \\n\\nArgs: \\n\
\[Lambda]u [mm] is the ID period, \\nNp is the number of periods, \\nBr [T] \
is the remanent magnetization of the permanent magnet blocks, \\nGap [mm] is \
the length of the minimum gap between the cassettes. \\n\\nOptional args: \\n\
\[Delta]P [mm], \[Delta]GV [mm], \[Delta]GH [mm] and \[Delta]CP [mm] are four \
types of longitudinal movements between the cassettes, \[Delta]P is the phase \
adjustement, \[Delta]GV and \[Delta]GH control the amplitude of the \
longitudinal field component and \[Delta]CP is the inclined-polarization \
adjustment, \\nBlockGap [mm] is the longitudinal gap between the blocks, \
\\nTermination is the termination type (one of the following: None, \
OneBlockSym, OneBlockAntiSym, ThreeBlocksSym, ThreeBlocksAntiSym), \
\\nPosMagErrorsBRC is a list of positions and magnetization errors for the BR \
cassette, \\nPosMagErrorsBLC is a list of positions and magnetization errors \
for the BL cassette, \\nPosMagErrorsULC is a list of positions and \
magnetization errors for the UL cassette, \\nPosMagErrorsURC is a list of \
positions and magnetization errors for the UR cassette. \\n\\nPosition and \
magnetization errors: \\nThe list of position and magnetization errors must \
be empty or have a number of elements igual to the number of blocks on each \
cassette. Each element is a list itself with the following format: \
\\n{horizontal position error[mm], vertical position error[mm], horizontal \
magnetization error[T], longitudinal magnetization error[T], vertical \
magnetization error[T]}. \\nThe errors will be add to the default values of \
position and magnetization of the blocks.\>\""}], ";"}], 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"IDCornellDelta", "[", 
    RowBox[{
    "\[Lambda]u_", ",", " ", "Np_", ",", " ", "Br_", ",", " ", "Gap_", ",", 
     " ", 
     RowBox[{"OptionsPattern", "[", 
      RowBox[{"{", 
       RowBox[{
        RowBox[{"\"\<\[Delta]P\>\"", "\[Rule]", " ", "0"}], ",", " ", 
        RowBox[{"\"\<\[Delta]GV\>\"", "\[Rule]", " ", "0"}], ",", " ", 
        RowBox[{"\"\<\[Delta]GH\>\"", "\[Rule]", " ", "0"}], ",", " ", 
        RowBox[{"\"\<\[Delta]CP\>\"", "\[Rule]", " ", "0"}], ",", " ", 
        RowBox[{"\"\<BlockGap\>\"", "->", "0"}], ",", "  ", 
        RowBox[{"\"\<Termination\>\"", "\[Rule]", " ", "\"\<None\>\""}], ",", 
        " ", 
        RowBox[{"\"\<PosMagErrorsBRC\>\"", "\[Rule]", " ", 
         RowBox[{"{", "}"}]}], ",", " ", 
        RowBox[{"\"\<PosMagErrorsBLC\>\"", "\[Rule]", " ", 
         RowBox[{"{", "}"}]}], ",", " ", 
        RowBox[{"\"\<PosMagErrorsULC\>\"", "\[Rule]", " ", 
         RowBox[{"{", "}"}]}], ",", " ", 
        RowBox[{"\"\<PosMagErrorsURC\>\"", "\[Rule]", " ", 
         RowBox[{"{", "}"}]}]}], "}"}], "]"}]}], "]"}], " ", ":=", " ", 
   RowBox[{"Module", "[", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
      "r", ",", " ", "\[Theta]i", ",", " ", "\[Theta]", ",", " ", "n\[Theta]",
        ",", " ", "dr", ",", " ", "rc", ",", " ", "f", ",", " ", "b1", ",", 
       " ", "b2", ",", " ", "b3", ",", " ", "b4", ",", " ", "Blocks", ",", 
       " ", "pneg", ",", " ", "ppos", ",", "bpos", ",", " ", "bneg", ",", "i",
        ",", " ", "BRCBlockList", ",", " ", "BLCBlockList", ",", " ", 
       "ULCBlockList", ",", " ", "URCBlockList", ",", " ", 
       "\[IndentingNewLine]", "PosMagErrorsBRC", " ", ",", " ", 
       "PosMagErrorsBLC", ",", " ", "PosMagErrorsULC", " ", ",", " ", 
       "PosMagErrorsURC", ",", "\[IndentingNewLine]", "\[Delta]P", ",", " ", 
       "\[Delta]GV", ",", " ", "\[Delta]GH", ",", " ", "\[Delta]CP", ",", 
       "Termination", ",", "\[IndentingNewLine]", " ", "BlockGap", ",", " ", 
       "\[Delta]BRC", ",", " ", "BRC", ",", " ", "\[Delta]BLC", ",", " ", 
       "BLC", ",", " ", "\[Delta]ULC", ",", " ", "ULC", ",", " ", 
       "\[Delta]URC", ",", " ", "URC", ",", " ", "Delta", ",", " ", "t0", ",",
        " ", "t1"}], "}"}], ",", "\[IndentingNewLine]", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"t0", "=", 
       RowBox[{"AbsoluteTime", "[", "]"}]}], ";", "\[IndentingNewLine]", 
      "\[IndentingNewLine]", 
      RowBox[{"(*", 
       RowBox[{"Delete", " ", "previous", " ", "Radia", " ", "objects"}], 
       "*)"}], "\[IndentingNewLine]", 
      RowBox[{"radUtiDelAll", "[", "]"}], ";", "\[IndentingNewLine]", 
      "\[IndentingNewLine]", 
      RowBox[{"(*", 
       RowBox[{"Check", " ", "arguments"}], "*)"}], "\[IndentingNewLine]", 
      RowBox[{"If", " ", "[", 
       RowBox[{
        RowBox[{"\[Lambda]u", " ", "\[LessEqual]", " ", "0"}], ",", " ", 
        RowBox[{"Return", "[", "]"}]}], "]"}], ";", "\[IndentingNewLine]", 
      RowBox[{"If", " ", "[", 
       RowBox[{
        RowBox[{"Np", " ", "\[LessEqual]", " ", "0"}], ",", " ", 
        RowBox[{"Return", "[", "]"}]}], "]"}], ";", "\[IndentingNewLine]", 
      RowBox[{"If", " ", "[", 
       RowBox[{
        RowBox[{"Br", " ", "\[LessEqual]", " ", "0"}], ",", " ", 
        RowBox[{"Return", "[", "]"}]}], "]"}], ";", "\[IndentingNewLine]", 
      RowBox[{"If", " ", "[", 
       RowBox[{
        RowBox[{"Gap", " ", "\[LessEqual]", " ", "0"}], ",", " ", 
        RowBox[{"Return", "[", "]"}]}], "]"}], ";", "\[IndentingNewLine]", 
      "\[IndentingNewLine]", 
      RowBox[{"(*", 
       RowBox[{"Gap", " ", "between", " ", "blocks"}], "*)"}], 
      "\[IndentingNewLine]", " ", 
      RowBox[{"BlockGap", " ", "=", " ", 
       RowBox[{"OptionValue", "[", "\"\<BlockGap\>\"", "]"}]}], ";", 
      "\[IndentingNewLine]", "\[IndentingNewLine]", 
      RowBox[{"(*", 
       RowBox[{"Cassettes", " ", "longitudinal", " ", 
        RowBox[{"displacement", " ", "[", "mm", "]"}]}], "*)"}], 
      "\[IndentingNewLine]", 
      RowBox[{"\[Delta]P", " ", "=", " ", 
       RowBox[{"OptionValue", "[", "\"\<\[Delta]P\>\"", "]"}]}], ";", " ", 
      RowBox[{"(*", 
       RowBox[{"Phase", " ", "adjustment"}], "*)"}], "\[IndentingNewLine]", 
      RowBox[{"\[Delta]GV", " ", "=", " ", 
       RowBox[{"OptionValue", "[", "\"\<\[Delta]GV\>\"", "]"}]}], ";", " ", 
      RowBox[{"(*", 
       RowBox[{
        RowBox[{
        "Vertical", " ", "field", " ", "amplitude", " ", "to", " ", 
         "longitudinal", " ", "field", " ", "amplitude"}], ",", " ", 
        RowBox[{
        "also", " ", "decreases", " ", "horizontal", " ", "field", " ", 
         "amplitude"}]}], "*)"}], "\[IndentingNewLine]", 
      RowBox[{"\[Delta]GH", " ", "=", " ", 
       RowBox[{"OptionValue", "[", "\"\<\[Delta]GH\>\"", "]"}]}], ";", 
      RowBox[{"(*", 
       RowBox[{
        RowBox[{
        "Horizontal", " ", "field", " ", "amplitude", " ", "to", " ", 
         "longitudinal", " ", "field", " ", "amplitude"}], ",", " ", 
        RowBox[{
        "also", " ", "decreases", " ", "vertical", " ", "field", " ", 
         "amplitude"}]}], "*)"}], "\[IndentingNewLine]", 
      RowBox[{"\[Delta]CP", " ", "=", " ", 
       RowBox[{"OptionValue", "[", "\"\<\[Delta]CP\>\"", "]"}]}], ";", 
      RowBox[{"(*", 
       RowBox[{"Inclined", " ", "polarization", " ", "adjustment"}], "*)"}], 
      "\[IndentingNewLine]", "\[IndentingNewLine]", 
      RowBox[{"(*", 
       RowBox[{"Termination", " ", "Type"}], "*)"}], "\[IndentingNewLine]", 
      RowBox[{"Termination", " ", "=", " ", 
       RowBox[{"OptionValue", "[", "\"\<Termination\>\"", "]"}]}], ";", 
      "\[IndentingNewLine]", "\[IndentingNewLine]", 
      RowBox[{"(*", 
       RowBox[{"Position", " ", "and", " ", "magnetization", " ", "errors"}], 
       "*)"}], "\[IndentingNewLine]", 
      RowBox[{"PosMagErrorsBRC", " ", "=", " ", 
       RowBox[{"OptionValue", "[", "\"\<PosMagErrorsBRC\>\"", "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"PosMagErrorsBLC", " ", "=", " ", 
       RowBox[{"OptionValue", "[", "\"\<PosMagErrorsBLC\>\"", "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"PosMagErrorsULC", " ", "=", " ", 
       RowBox[{"OptionValue", "[", "\"\<PosMagErrorsULC\>\"", "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"PosMagErrorsURC", " ", "=", " ", 
       RowBox[{"OptionValue", "[", "\"\<PosMagErrorsURC\>\"", "]"}]}], ";", 
      "\[IndentingNewLine]", "\[IndentingNewLine]", 
      RowBox[{"(*", 
       RowBox[{"Block", " ", "vertices"}], "*)"}], "\[IndentingNewLine]", 
      RowBox[{"r", " ", "=", " ", "2.5"}], ";", "\[IndentingNewLine]", 
      RowBox[{"f", " ", "=", " ", 
       RowBox[{"Gap", "/", 
        RowBox[{"(", 
         RowBox[{"2", "*", "r"}], ")"}]}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"dr", " ", "=", " ", "0.35"}], ";", "\[IndentingNewLine]", 
      RowBox[{"rc", " ", "=", " ", 
       RowBox[{"r", "-", "dr"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"b1", "=", " ", 
       RowBox[{"f", "*", 
        RowBox[{"{", 
         RowBox[{
          RowBox[{"{", 
           RowBox[{
            RowBox[{"-", "12.7"}], ",", " ", "15.20"}], "}"}], ",", " ", 
          RowBox[{"{", 
           RowBox[{"12.7", ",", " ", "15.20"}], "}"}], ",", " ", 
          RowBox[{"{", 
           RowBox[{"12.7", ",", "13.05"}], "}"}], ",", " ", 
          RowBox[{"{", 
           RowBox[{"rc", ",", " ", "r"}], "}"}], ",", " ", 
          RowBox[{"{", 
           RowBox[{
            RowBox[{"-", "rc"}], ",", " ", "r"}], "}"}], ",", " ", 
          RowBox[{"{", 
           RowBox[{
            RowBox[{"-", "12.7"}], ",", " ", "13.05"}], "}"}]}], "}"}]}]}], 
      ";", "\[IndentingNewLine]", 
      RowBox[{"b2", " ", "=", " ", 
       RowBox[{"f", "*", 
        RowBox[{"{", 
         RowBox[{
          RowBox[{"{", "  ", 
           RowBox[{"rc", ",", " ", "r"}], " ", "}"}], ",", " ", 
          RowBox[{"{", "   ", 
           RowBox[{
            RowBox[{"rc", "*", 
             RowBox[{"Sin", "[", 
              RowBox[{"\[Pi]", "/", "4"}], "]"}]}], ",", " ", "r"}], "}"}], 
          ",", " ", 
          RowBox[{"{", "   ", 
           RowBox[{
            RowBox[{"rc", "*", 
             RowBox[{"Sin", "[", 
              RowBox[{"\[Pi]", "/", "4"}], "]"}]}], ",", " ", 
            RowBox[{
             RowBox[{"rc", "*", 
              RowBox[{"Cos", "[", 
               RowBox[{"\[Pi]", "/", "4"}], "]"}]}], "+", "dr"}]}], " ", 
           "}"}]}], "}"}]}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"b3", " ", "=", " ", 
       RowBox[{"f", "*", 
        RowBox[{"{", 
         RowBox[{
          RowBox[{"{", 
           RowBox[{
            RowBox[{"-", "rc"}], ",", " ", "r"}], " ", "}"}], ",", " ", 
          RowBox[{"{", 
           RowBox[{
            RowBox[{
             RowBox[{"-", "rc"}], "*", 
             RowBox[{"Sin", "[", 
              RowBox[{"\[Pi]", "/", "4"}], "]"}]}], ",", " ", "r"}], "}"}], 
          ",", " ", 
          RowBox[{"{", 
           RowBox[{
            RowBox[{
             RowBox[{"-", "rc"}], "*", 
             RowBox[{"Sin", "[", 
              RowBox[{"\[Pi]", "/", "4"}], "]"}]}], ",", "  ", 
            RowBox[{
             RowBox[{"rc", "*", 
              RowBox[{"Cos", "[", 
               RowBox[{"\[Pi]", "/", "4"}], "]"}]}], "+", "dr"}]}], " ", 
           "}"}]}], "}"}]}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"Blocks", " ", "=", 
       RowBox[{"{", 
        RowBox[{"b1", ",", " ", "b2", ",", " ", "b3"}], "}"}]}], ";", 
      "\[IndentingNewLine]", "\[IndentingNewLine]", 
      RowBox[{"n\[Theta]", " ", "=", " ", "10"}], ";", "\[IndentingNewLine]", 
      
      RowBox[{"\[Theta]", " ", "=", " ", 
       RowBox[{"Range", "[", 
        RowBox[{
         RowBox[{"\[Pi]", "/", "2"}], ",", " ", 
         RowBox[{"\[Pi]", "/", "4"}], ",", "  ", 
         RowBox[{
          RowBox[{"-", 
           RowBox[{"(", 
            RowBox[{"\[Pi]", "/", "4"}], ")"}]}], "/", 
          RowBox[{"(", 
           RowBox[{"n\[Theta]", "-", "1"}], ")"}]}]}], "]"}]}], ";", 
      "\[IndentingNewLine]", "\[IndentingNewLine]", 
      RowBox[{"AppendTo", "[", 
       RowBox[{"Blocks", ",", " ", 
        RowBox[{"f", "*", 
         RowBox[{"{", 
          RowBox[{
           RowBox[{"{", 
            RowBox[{"0", ",", " ", "r"}], "}"}], ",", " ", 
           RowBox[{"{", 
            RowBox[{
             RowBox[{"rc", "*", 
              RowBox[{"Cos", "[", 
               RowBox[{"\[Pi]", "-", 
                RowBox[{"\[Theta]", "[", 
                 RowBox[{"[", "2", "]"}], "]"}]}], "]"}]}], ",", " ", 
             RowBox[{
              RowBox[{"rc", "*", 
               RowBox[{"Sin", "[", 
                RowBox[{"\[Pi]", "-", 
                 RowBox[{"\[Theta]", "[", 
                  RowBox[{"[", "2", "]"}], "]"}]}], "]"}]}], "+", "dr"}]}], 
            "}"}], ",", " ", 
           RowBox[{"{", 
            RowBox[{
             RowBox[{"rc", "*", 
              RowBox[{"Cos", "[", 
               RowBox[{"\[Pi]", "-", 
                RowBox[{"\[Theta]", "[", 
                 RowBox[{"[", "2", "]"}], "]"}]}], "]"}]}], ",", " ", "r"}], 
            "}"}]}], "}"}]}]}], "]"}], ";", "\[IndentingNewLine]", 
      RowBox[{"pneg", " ", "=", " ", 
       RowBox[{"{", 
        RowBox[{
         RowBox[{"rc", "*", 
          RowBox[{"Cos", "[", 
           RowBox[{"\[Pi]", "-", 
            RowBox[{"\[Theta]", "[", 
             RowBox[{"[", "2", "]"}], "]"}]}], "]"}]}], ",", " ", "r"}], 
        "}"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"AppendTo", "[", 
       RowBox[{"Blocks", ",", " ", 
        RowBox[{"f", "*", 
         RowBox[{"{", 
          RowBox[{
           RowBox[{"{", 
            RowBox[{"0", ",", " ", "r"}], "}"}], ",", " ", 
           RowBox[{"{", 
            RowBox[{
             RowBox[{"rc", "*", 
              RowBox[{"Cos", "[", 
               RowBox[{"\[Theta]", "[", 
                RowBox[{"[", "2", "]"}], "]"}], "]"}]}], ",", " ", 
             RowBox[{
              RowBox[{"rc", "*", 
               RowBox[{"Sin", "[", 
                RowBox[{"\[Theta]", "[", 
                 RowBox[{"[", "2", "]"}], "]"}], "]"}]}], "+", " ", "dr"}]}], 
            "}"}], ",", " ", 
           RowBox[{"{", 
            RowBox[{
             RowBox[{"rc", "*", 
              RowBox[{"Cos", "[", 
               RowBox[{"\[Theta]", "[", 
                RowBox[{"[", "2", "]"}], "]"}], "]"}]}], ",", " ", "r"}], 
            "}"}]}], "}"}]}]}], "]"}], ";", "\[IndentingNewLine]", 
      RowBox[{"ppos", " ", "=", 
       RowBox[{"{", 
        RowBox[{
         RowBox[{"rc", "*", 
          RowBox[{"Cos", "[", 
           RowBox[{"\[Theta]", "[", 
            RowBox[{"[", "2", "]"}], "]"}], "]"}]}], ",", " ", "r"}], "}"}]}],
       ";", " ", "\[IndentingNewLine]", "\[IndentingNewLine]", 
      RowBox[{"For", " ", "[", 
       RowBox[{
        RowBox[{"i", "=", "3"}], ",", " ", 
        RowBox[{"i", "\[LessEqual]", 
         RowBox[{"Length", "[", "\[Theta]", "]"}]}], ",", " ", 
        RowBox[{"i", "++"}], ",", " ", "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"bpos", " ", "=", " ", 
          RowBox[{"f", "*", 
           RowBox[{"{", 
            RowBox[{"ppos", ",", " ", 
             RowBox[{"{", 
              RowBox[{
               RowBox[{"rc", "*", 
                RowBox[{"Cos", "[", 
                 RowBox[{"\[Theta]", "[", 
                  RowBox[{"[", 
                   RowBox[{"i", "-", "1"}], "]"}], "]"}], "]"}]}], ",", " ", 
               RowBox[{
                RowBox[{"rc", "*", 
                 RowBox[{"Sin", "[", 
                  RowBox[{"\[Theta]", "[", 
                   RowBox[{"[", 
                    RowBox[{"i", "-", "1"}], "]"}], "]"}], "]"}]}], "+", 
                "dr"}]}], "}"}], ",", " ", 
             RowBox[{"{", 
              RowBox[{
               RowBox[{"rc", "*", 
                RowBox[{"Cos", "[", 
                 RowBox[{"\[Theta]", "[", 
                  RowBox[{"[", "i", "]"}], "]"}], "]"}]}], ",", " ", 
               RowBox[{
                RowBox[{"rc", "*", 
                 RowBox[{"Sin", "[", 
                  RowBox[{"\[Theta]", "[", 
                   RowBox[{"[", "i", "]"}], "]"}], "]"}]}], "+", "dr"}]}], 
              "}"}], ",", " ", 
             RowBox[{"{", 
              RowBox[{
               RowBox[{"rc", "*", 
                RowBox[{"Cos", "[", 
                 RowBox[{"\[Theta]", "[", 
                  RowBox[{"[", "i", "]"}], "]"}], "]"}]}], ",", " ", "r"}], 
              "}"}]}], "}"}]}]}], ";", "\[IndentingNewLine]", 
         RowBox[{"ppos", " ", "=", " ", 
          RowBox[{"{", 
           RowBox[{
            RowBox[{"rc", "*", 
             RowBox[{"Cos", "[", 
              RowBox[{"\[Theta]", "[", 
               RowBox[{"[", "i", "]"}], "]"}], "]"}]}], ",", " ", "r"}], 
           "}"}]}], ";", "\[IndentingNewLine]", 
         RowBox[{"AppendTo", "[", 
          RowBox[{"Blocks", ",", "bpos"}], "]"}], ";", "\[IndentingNewLine]", 
         
         RowBox[{"bneg", " ", "=", " ", 
          RowBox[{"f", "*", 
           RowBox[{"{", 
            RowBox[{"pneg", ",", " ", 
             RowBox[{"{", 
              RowBox[{
               RowBox[{"rc", "*", 
                RowBox[{"Cos", "[", 
                 RowBox[{"\[Pi]", "-", 
                  RowBox[{"\[Theta]", "[", 
                   RowBox[{"[", 
                    RowBox[{"i", "-", "1"}], "]"}], "]"}]}], "]"}]}], ",", 
               " ", 
               RowBox[{
                RowBox[{"rc", "*", 
                 RowBox[{"Sin", "[", 
                  RowBox[{"\[Pi]", "-", 
                   RowBox[{"\[Theta]", "[", 
                    RowBox[{"[", 
                    RowBox[{"i", "-", "1"}], "]"}], "]"}]}], "]"}]}], "+", 
                "dr"}]}], "}"}], ",", " ", 
             RowBox[{"{", 
              RowBox[{
               RowBox[{"rc", "*", 
                RowBox[{"Cos", "[", 
                 RowBox[{"\[Pi]", "-", 
                  RowBox[{"\[Theta]", "[", 
                   RowBox[{"[", "i", "]"}], "]"}]}], "]"}]}], ",", " ", 
               RowBox[{
                RowBox[{"rc", "*", 
                 RowBox[{"Sin", "[", 
                  RowBox[{"\[Pi]", "-", 
                   RowBox[{"\[Theta]", "[", 
                    RowBox[{"[", "i", "]"}], "]"}]}], "]"}]}], "+", "dr"}]}], 
              "}"}], ",", " ", 
             RowBox[{"{", 
              RowBox[{
               RowBox[{"rc", "*", 
                RowBox[{"Cos", "[", 
                 RowBox[{"\[Pi]", "-", 
                  RowBox[{"\[Theta]", "[", 
                   RowBox[{"[", "i", "]"}], "]"}]}], "]"}]}], ",", " ", "r"}],
               "}"}]}], "}"}]}]}], ";", "\[IndentingNewLine]", 
         RowBox[{"pneg", " ", "=", 
          RowBox[{"{", 
           RowBox[{
            RowBox[{"rc", "*", 
             RowBox[{"Cos", "[", 
              RowBox[{"\[Pi]", "-", 
               RowBox[{"\[Theta]", "[", 
                RowBox[{"[", "i", "]"}], "]"}]}], "]"}]}], ",", " ", "r"}], 
           "}"}]}], ";", "\[IndentingNewLine]", 
         RowBox[{"AppendTo", "[", 
          RowBox[{"Blocks", ",", " ", "bneg"}], "]"}], ";"}]}], 
       "\[IndentingNewLine]", "]"}], ";", "\[IndentingNewLine]", 
      "\[IndentingNewLine]", 
      RowBox[{"(*", 
       RowBox[{
       "Block", " ", "vertices", " ", "for", " ", "each", " ", "cassette", 
        " ", 
        RowBox[{"(", 
         RowBox[{
         "cross", " ", "section", " ", "in", " ", "the", " ", "yz", " ", 
          "plane"}], ")"}]}], "*)"}], "\[IndentingNewLine]", 
      RowBox[{"BLCBlockList", " ", "=", "Blocks"}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"ULCBlockList", " ", "=", " ", 
       RowBox[{
        RowBox[{
         RowBox[{
          RowBox[{
           RowBox[{"Dot", "[", 
            RowBox[{
             RowBox[{"RotationMatrix", "[", 
              RowBox[{"\[Pi]", "/", "2"}], "]"}], ",", "#"}], "]"}], "&"}], "/@",
           "#"}], "&"}], "/@", "BLCBlockList"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"URCBlockList", " ", "=", " ", 
       RowBox[{
        RowBox[{
         RowBox[{
          RowBox[{
           RowBox[{"Dot", "[", 
            RowBox[{
             RowBox[{"RotationMatrix", "[", 
              RowBox[{"\[Pi]", "/", "2"}], "]"}], ",", "#"}], "]"}], "&"}], "/@",
           "#"}], "&"}], "/@", "ULCBlockList"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"BRCBlockList", " ", "=", " ", 
       RowBox[{
        RowBox[{
         RowBox[{
          RowBox[{
           RowBox[{"Dot", "[", 
            RowBox[{
             RowBox[{"RotationMatrix", "[", 
              RowBox[{"\[Pi]", "/", "2"}], "]"}], ",", "#"}], "]"}], "&"}], "/@",
           "#"}], "&"}], "/@", "URCBlockList"}]}], ";", "\[IndentingNewLine]",
       "\[IndentingNewLine]", 
      RowBox[{"(*", "Cassettes", "*)"}], "\[IndentingNewLine]", 
      RowBox[{"\[Delta]BRC", " ", "=", 
       RowBox[{
       "\[Delta]GV", " ", "+", " ", "\[Delta]P", "+", "\[Delta]CP"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"BRC", " ", "=", 
       RowBox[{"auxIDCassette", "[", 
        RowBox[{
        "\[Lambda]u", ",", " ", "Np", ",", " ", "Br", ",", " ", "\[Delta]BRC",
          ",", "BRCBlockList", ",", " ", "BlockGap", ",", " ", 
         RowBox[{"\"\<PointingUp\>\"", "\[Rule]", "False"}], ",", " ", 
         RowBox[{"\"\<FirstBlock\>\"", "\[Rule]", " ", "\"\<Down\>\""}], ",", 
         " ", 
         RowBox[{
         "\"\<FieldDirection\>\"", "\[Rule]", " ", "\"\<Horizontal\>\""}], 
         ",", 
         RowBox[{"\"\<Termination\>\"", "\[Rule]", " ", "Termination"}], ",", 
         
         RowBox[{
         "\"\<PosMagErrors\>\"", "\[Rule]", " ", "PosMagErrorsBRC"}]}], 
        "]"}]}], ";", "\[IndentingNewLine]", "\[IndentingNewLine]", 
      RowBox[{"\[Delta]BLC", " ", "=", 
       RowBox[{"\[Delta]GH", " ", "+", " ", "\[Delta]GV"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"BLC", " ", "=", " ", 
       RowBox[{"auxIDCassette", "[", 
        RowBox[{
        "\[Lambda]u", ",", " ", "Np", ",", " ", "Br", ",", "\[Delta]BLC", ",",
          " ", "BLCBlockList", ",", " ", "BlockGap", ",", " ", 
         RowBox[{"\"\<PointingUp\>\"", "\[Rule]", " ", "False"}], ",", 
         RowBox[{"\"\<FirstBlock\>\"", "\[Rule]", " ", "\"\<Down\>\""}], ",", 
         " ", 
         RowBox[{
         "\"\<FieldDirection\>\"", "\[Rule]", " ", "\"\<Vertical\>\""}], ",", 
         " ", 
         RowBox[{"\"\<Termination\>\"", "\[Rule]", " ", "Termination"}], ",", 
         
         RowBox[{
         "\"\<PosMagErrors\>\"", "\[Rule]", " ", "PosMagErrorsBLC"}]}], 
        "]"}]}], ";", "\[IndentingNewLine]", "\[IndentingNewLine]", 
      RowBox[{"\[Delta]ULC", " ", "=", " ", 
       RowBox[{"\[Delta]GH", "+", " ", "\[Delta]P", "-", "\[Delta]CP"}]}], 
      ";", "\[IndentingNewLine]", 
      RowBox[{"ULC", " ", "=", " ", 
       RowBox[{"auxIDCassette", "[", 
        RowBox[{
        "\[Lambda]u", ",", " ", "Np", ",", " ", "Br", ",", "\[Delta]ULC", ",",
          " ", "ULCBlockList", ",", " ", "BlockGap", ",", " ", 
         RowBox[{"\"\<PointingUp\>\"", "\[Rule]", " ", "True"}], ",", 
         RowBox[{"\"\<FirstBlock\>\"", "\[Rule]", " ", "\"\<Down\>\""}], ",", 
         " ", 
         RowBox[{
         "\"\<FieldDirection\>\"", "\[Rule]", " ", "\"\<Horizontal\>\""}], 
         ",", " ", 
         RowBox[{"\"\<Termination\>\"", "\[Rule]", " ", "Termination"}], ",", 
         
         RowBox[{
         "\"\<PosMagErrors\>\"", "\[Rule]", " ", "PosMagErrorsULC"}]}], 
        "]"}]}], ";", "\[IndentingNewLine]", "\[IndentingNewLine]", 
      RowBox[{"\[Delta]URC", " ", "=", " ", "0.0"}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"URC", " ", "=", " ", 
       RowBox[{"auxIDCassette", "[", 
        RowBox[{
        "\[Lambda]u", ",", " ", "Np", ",", " ", "Br", ",", "\[Delta]URC", ",",
          " ", "URCBlockList", ",", " ", "BlockGap", ",", " ", 
         RowBox[{"\"\<PointingUp\>\"", "\[Rule]", " ", "True"}], ",", 
         RowBox[{"\"\<FirstBlock\>\"", "\[Rule]", " ", "\"\<Down\>\""}], ",", 
         
         RowBox[{
         "\"\<FieldDirection\>\"", "\[Rule]", " ", "\"\<Vertical\>\""}], ",", 
         
         RowBox[{"\"\<Termination\>\"", "\[Rule]", " ", "Termination"}], ",", 
         
         RowBox[{
         "\"\<PosMagErrors\>\"", "\[Rule]", " ", "PosMagErrorsURC"}]}], 
        "]"}]}], ";", "\[IndentingNewLine]", "\[IndentingNewLine]", 
      RowBox[{"(*", 
       RowBox[{"Insertion", " ", "device"}], "*)"}], "\[IndentingNewLine]", 
      RowBox[{"Delta", " ", "=", " ", 
       RowBox[{"radObjCnt", "[", 
        RowBox[{"{", 
         RowBox[{"BRC", ",", " ", "BLC", ",", " ", "ULC", ",", " ", "URC"}], 
         "}"}], "]"}]}], ";", "\[IndentingNewLine]", "\[IndentingNewLine]", 
      RowBox[{"t1", "=", 
       RowBox[{"AbsoluteTime", "[", "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"Print", "[", 
       RowBox[{"\"\<IDDeltaCornell: elapsed time = \>\"", ",", 
        RowBox[{"(", 
         RowBox[{"t1", "-", "t0"}], ")"}], ",", "\"\< s\>\""}], "]"}], ";", 
      "\[IndentingNewLine]", "\[IndentingNewLine]", 
      RowBox[{"Return", "[", "Delta", "]"}], ";"}]}], "\[IndentingNewLine]", 
    "]"}]}], ";"}]}], "Input",
 CellChangeTimes->{{3.766402099935676*^9, 3.766402100922615*^9}, {
  3.766402258253394*^9, 3.766402468375741*^9}, {3.766402720530408*^9, 
  3.766402907050172*^9}, {3.7664029812222176`*^9, 3.766403182172817*^9}, {
  3.7667545058427196`*^9, 3.7667545075459843`*^9}, {3.766754544736413*^9, 
  3.766754588427339*^9}, {3.766757067645253*^9, 3.766757103507449*^9}, {
  3.766758395016309*^9, 3.76675840983173*^9}, {3.767445985793868*^9, 
  3.767445990278596*^9}, {3.767448133520872*^9, 3.7674481585853477`*^9}, {
  3.76751864301694*^9, 3.767518729052259*^9}, {3.767518981823285*^9, 
  3.767518993524044*^9}},
 Background->RGBColor[0.87, 0.94, 1]]
}, Closed]]
}, Open  ]],

Cell[CellGroupData[{

Cell["EPU", "Section",
 CellChangeTimes->{{3.7663980882406*^9, 3.7663980966536646`*^9}}],

Cell[CellGroupData[{

Cell["IDRectangularEPU", "Subsection",
 CellChangeTimes->{{3.766754657792163*^9, 3.7667546656521573`*^9}}],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"IDRectangularEPU", "::", "usage"}], "=", 
    "\"\<IDRectangularEPU[\[Lambda]u, Np, Br, Gap, \\\"\[Delta]P\\\":0, \\\"\
\[Delta]CP\\\":0, \\\"BlockGap\\\":0, \\\"BlockWidth\\\":gap, \\\"BlockHeight\
\\\":gap, \\\"Termination\\\":\\\"None\\\", \\\"PosMagErrorsBRC\\\"\[Rule] \
{}, \\\"PosMagErrorsBLC\\\"\[Rule] {}, \\\"PosMagErrorsULC\\\"\[Rule] {}, \
\\\"PosMagErrorsURC\\\"\[Rule] {}]: Returns the ID model. \\n\\nArgs: \\n\
\[Lambda]u [mm] is the ID period, \\nNp is the number of periods, \\nBr [T] \
is the remanent magnetization of the permanent magnet blocks, \\nGap [mm] is \
the length of the minimum gap between the cassettes. \\n\\nOptional args: \\n\
\[Delta]P [mm] is the phase adjustement and \[Delta]CP [mm] is the \
inclined-polarization adjustment, \\nBlockGap [mm] is the longitudinal gap \
between the blocks, \\nBlockWidth [mm] is the block width, \\nBlockHeight \
[mm] is the block height, \\nTermination is the termination type (one of the \
following: None, OneBlockSym, OneBlockAntiSym, ThreeBlocksSym, \
ThreeBlocksAntiSym), \\nPosMagErrorsBRC is a list of positions and \
magnetization errors for the BR cassette, \\nPosMagErrorsBLC is a list of \
positions and magnetization errors for the BL cassette, \\nPosMagErrorsULC is \
a list of positions and magnetization errors for the UL cassette, \
\\nPosMagErrorsURC is a list of positions and magnetization errors for the UR \
cassette. \\n\\nPosition and magnetization errors: \\nThe list of position \
and magnetization errors must be empty or have a number of elements igual to \
the number of blocks on each cassette. Each element is a list itself with the \
following format: \\n{horizontal position error[mm], vertical position \
error[mm], horizontal magnetization error[T], longitudinal magnetization \
error[T], vertical magnetization error[T]}. \\nThe errors will be add to the \
default values of position and magnetization of the blocks.\>\""}], ";"}], 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"IDRectangularEPU", "[", 
    RowBox[{
    "\[Lambda]u_", ",", " ", "Np_", ",", " ", "Br_", ",", " ", "Gap_", ",", 
     " ", 
     RowBox[{"OptionsPattern", "[", 
      RowBox[{"{", 
       RowBox[{
        RowBox[{"\"\<\[Delta]P\>\"", "\[Rule]", " ", "0"}], ",", 
        RowBox[{"\"\<\[Delta]CP\>\"", "\[Rule]", " ", "0"}], ",", " ", 
        RowBox[{"\"\<BlockGap\>\"", "->", "0"}], ",", " ", 
        RowBox[{"\"\<BlockWidth\>\"", "\[Rule]", " ", "\"\<default\>\""}], 
        ",", " ", 
        RowBox[{"\"\<BlockHeight\>\"", "\[Rule]", " ", "\"\<default\>\""}], 
        ",", " ", 
        RowBox[{"\"\<Termination\>\"", "\[Rule]", " ", "\"\<None\>\""}], ",", 
        " ", 
        RowBox[{"\"\<PosMagErrorsBRC\>\"", "\[Rule]", " ", 
         RowBox[{"{", "}"}]}], ",", " ", 
        RowBox[{"\"\<PosMagErrorsBLC\>\"", "\[Rule]", " ", 
         RowBox[{"{", "}"}]}], ",", " ", 
        RowBox[{"\"\<PosMagErrorsULC\>\"", "\[Rule]", " ", 
         RowBox[{"{", "}"}]}], ",", " ", 
        RowBox[{"\"\<PosMagErrorsURC\>\"", "\[Rule]", " ", 
         RowBox[{"{", "}"}]}]}], "}"}], "]"}]}], "]"}], " ", ":=", " ", 
   RowBox[{"Module", "[", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
      "Termination", ",", " ", "Width", ",", "Height", ",", " ", 
       "BRCBlockList", ",", " ", "BLCBlockList", ",", " ", "ULCBlockList", 
       ",", " ", "URCBlockList", ",", "\[IndentingNewLine]", 
       "PosMagErrorsBRC", " ", ",", " ", "PosMagErrorsBLC", ",", " ", 
       "PosMagErrorsULC", " ", ",", " ", "PosMagErrorsURC", ",", 
       "\[IndentingNewLine]", "BlockGap", ",", "\[Delta]P", ",", " ", 
       "\[Delta]CP", ",", " ", "\[Delta]BRC", ",", " ", "BRC", ",", " ", 
       "\[Delta]BLC", ",", " ", "BLC", ",", " ", "\[Delta]ULC", ",", " ", 
       "ULC", ",", " ", "\[Delta]URC", ",", " ", "URC", ",", " ", "EPU", ",", 
       " ", "t0", ",", " ", "t1"}], "}"}], ",", "\[IndentingNewLine]", 
     "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"t0", "=", 
       RowBox[{"AbsoluteTime", "[", "]"}]}], ";", "\[IndentingNewLine]", 
      "\[IndentingNewLine]", 
      RowBox[{"(*", 
       RowBox[{"Delete", " ", "previous", " ", "Radia", " ", "objects"}], 
       "*)"}], "\[IndentingNewLine]", 
      RowBox[{"radUtiDelAll", "[", "]"}], ";", "\[IndentingNewLine]", 
      "\[IndentingNewLine]", 
      RowBox[{"(*", 
       RowBox[{"Check", " ", "arguments"}], "*)"}], "\[IndentingNewLine]", 
      RowBox[{"If", " ", "[", 
       RowBox[{
        RowBox[{"\[Lambda]u", " ", "\[LessEqual]", " ", "0"}], ",", " ", 
        RowBox[{"Return", "[", "]"}]}], "]"}], ";", "\[IndentingNewLine]", 
      RowBox[{"If", " ", "[", 
       RowBox[{
        RowBox[{"Np", " ", "\[LessEqual]", " ", "0"}], ",", " ", 
        RowBox[{"Return", "[", "]"}]}], "]"}], ";", "\[IndentingNewLine]", 
      RowBox[{"If", " ", "[", 
       RowBox[{
        RowBox[{"Br", " ", "\[LessEqual]", " ", "0"}], ",", " ", 
        RowBox[{"Return", "[", "]"}]}], "]"}], ";", "\[IndentingNewLine]", 
      RowBox[{"If", " ", "[", 
       RowBox[{
        RowBox[{"Gap", " ", "\[LessEqual]", " ", "0"}], ",", " ", 
        RowBox[{"Return", "[", "]"}]}], "]"}], ";", "\[IndentingNewLine]", 
      "\[IndentingNewLine]", 
      RowBox[{"(*", 
       RowBox[{"Gap", " ", "between", " ", "blocks"}], "*)"}], 
      "\[IndentingNewLine]", 
      RowBox[{"BlockGap", " ", "=", "  ", 
       RowBox[{"OptionValue", "[", "\"\<BlockGap\>\"", "]"}]}], ";", 
      "\[IndentingNewLine]", "\[IndentingNewLine]", 
      RowBox[{"(*", 
       RowBox[{"Block", " ", "size"}], "*)"}], "\[IndentingNewLine]", 
      RowBox[{"Height", " ", "=", 
       RowBox[{"If", "[", 
        RowBox[{
         RowBox[{
          RowBox[{"OptionValue", "[", "\"\<BlockHeight\>\"", "]"}], " ", 
          "\[Equal]", " ", "\"\<default\>\""}], ",", " ", "Gap", ",", 
         RowBox[{"OptionValue", "[", "\"\<BlockHeight\>\"", "]"}]}], " ", 
        "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"Width", " ", "=", "  ", 
       RowBox[{"If", "[", 
        RowBox[{
         RowBox[{
          RowBox[{"OptionValue", "[", "\"\<BlockWidth\>\"", "]"}], 
          "\[Equal]", "\"\<default\>\""}], ",", " ", "Gap", ",", 
         RowBox[{"OptionValue", "[", "\"\<BlockWidth\>\"", "]"}]}], "]"}]}], 
      " ", ";", "\[IndentingNewLine]", 
      RowBox[{"If", "[", 
       RowBox[{
        RowBox[{
         RowBox[{"Height", "\[LessEqual]", "0"}], " ", "||", " ", 
         RowBox[{"Width", " ", "\[LessEqual]", "0"}]}], ",", " ", 
        RowBox[{"Return", "[", "]"}]}], "]"}], ";", "\[IndentingNewLine]", 
      "\[IndentingNewLine]", 
      RowBox[{"(*", 
       RowBox[{"Cassettes", " ", "longitudinal", " ", 
        RowBox[{"displacement", " ", "[", "mm", "]"}]}], "*)"}], 
      "\[IndentingNewLine]", 
      RowBox[{"\[Delta]P", " ", "=", " ", 
       RowBox[{"OptionValue", "[", "\"\<\[Delta]P\>\"", "]"}]}], ";", " ", 
      RowBox[{"(*", 
       RowBox[{"Phase", " ", "adjustment"}], "*)"}], "\[IndentingNewLine]", 
      RowBox[{"\[Delta]CP", " ", "=", " ", 
       RowBox[{"OptionValue", "[", "\"\<\[Delta]CP\>\"", "]"}]}], ";", 
      RowBox[{"(*", 
       RowBox[{"Inclined", " ", "polarization", " ", "adjustment"}], "*)"}], 
      "\[IndentingNewLine]", "\[IndentingNewLine]", 
      RowBox[{"(*", 
       RowBox[{"Termination", " ", "Type"}], "*)"}], "\[IndentingNewLine]", 
      RowBox[{"Termination", " ", "=", " ", 
       RowBox[{"OptionValue", "[", "\"\<Termination\>\"", "]"}]}], ";", 
      "\[IndentingNewLine]", "\[IndentingNewLine]", 
      RowBox[{"(*", 
       RowBox[{"Position", " ", "and", " ", "magnetization", " ", "errors"}], 
       "*)"}], "\[IndentingNewLine]", 
      RowBox[{"PosMagErrorsBRC", " ", "=", " ", 
       RowBox[{"OptionValue", "[", "\"\<PosMagErrorsBRC\>\"", "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"PosMagErrorsBLC", " ", "=", " ", 
       RowBox[{"OptionValue", "[", "\"\<PosMagErrorsBLC\>\"", "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"PosMagErrorsULC", " ", "=", " ", 
       RowBox[{"OptionValue", "[", "\"\<PosMagErrorsULC\>\"", "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"PosMagErrorsURC", " ", "=", " ", 
       RowBox[{"OptionValue", "[", "\"\<PosMagErrorsURC\>\"", "]"}]}], ";", 
      "\[IndentingNewLine]", "\[IndentingNewLine]", 
      RowBox[{"(*", 
       RowBox[{
       "Block", " ", "vertices", " ", "for", " ", "each", " ", "cassette", 
        " ", 
        RowBox[{"(", 
         RowBox[{
         "cross", " ", "section", " ", "in", " ", "the", " ", "xz", " ", 
          "plane"}], ")"}]}], "*)"}], "\[IndentingNewLine]", 
      RowBox[{"BRCBlockList", "=", 
       RowBox[{"{", 
        RowBox[{
         RowBox[{"{", " ", 
          RowBox[{"0", ",", " ", 
           RowBox[{"Gap", "/", "2"}]}], "}"}], ",", 
         RowBox[{"{", 
          RowBox[{"0", ",", " ", 
           RowBox[{
            RowBox[{"Gap", "/", "2"}], " ", "+", "Height"}]}], "}"}], ",", 
         RowBox[{"{", " ", 
          RowBox[{"Width", ",", " ", 
           RowBox[{
            RowBox[{"Gap", "/", "2"}], "+", "Height"}]}], "}"}], ",", 
         RowBox[{"{", " ", 
          RowBox[{"Width", ",", 
           RowBox[{"Gap", "/", "2"}]}], "}"}]}], "}"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"BLCBlockList", "=", 
       RowBox[{"{", 
        RowBox[{
         RowBox[{"{", " ", 
          RowBox[{"0", ",", " ", 
           RowBox[{"Gap", "/", "2"}]}], "}"}], ",", 
         RowBox[{"{", 
          RowBox[{"0", ",", " ", 
           RowBox[{
            RowBox[{"Gap", "/", "2"}], " ", "+", "Height"}]}], "}"}], ",", 
         RowBox[{"{", 
          RowBox[{
           RowBox[{"-", "Width"}], ",", " ", 
           RowBox[{
            RowBox[{"Gap", "/", "2"}], "+", "Height"}]}], "}"}], ",", 
         RowBox[{"{", 
          RowBox[{
           RowBox[{"-", "Width"}], ",", 
           RowBox[{"Gap", "/", "2"}]}], "}"}]}], "}"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"ULCBlockList", "=", 
       RowBox[{"{", 
        RowBox[{
         RowBox[{"{", " ", 
          RowBox[{"0", ",", 
           RowBox[{
            RowBox[{"-", "Gap"}], "/", "2"}]}], "}"}], ",", 
         RowBox[{"{", 
          RowBox[{"0", ",", 
           RowBox[{
            RowBox[{
             RowBox[{"-", "Gap"}], "/", "2"}], " ", "-", "Height"}]}], "}"}], 
         ",", 
         RowBox[{"{", 
          RowBox[{
           RowBox[{"-", "Width"}], ",", 
           RowBox[{
            RowBox[{
             RowBox[{"-", "Gap"}], "/", "2"}], "-", "Height"}]}], "}"}], ",", 
         
         RowBox[{"{", 
          RowBox[{
           RowBox[{"-", "Width"}], ",", 
           RowBox[{
            RowBox[{"-", "Gap"}], "/", "2"}]}], "}"}]}], "}"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"URCBlockList", "=", 
       RowBox[{"{", 
        RowBox[{
         RowBox[{"{", " ", 
          RowBox[{"0", ",", 
           RowBox[{
            RowBox[{"-", "Gap"}], "/", "2"}]}], "}"}], ",", 
         RowBox[{"{", 
          RowBox[{"0", ",", 
           RowBox[{
            RowBox[{
             RowBox[{"-", "Gap"}], "/", "2"}], " ", "-", "Height"}]}], "}"}], 
         ",", 
         RowBox[{"{", " ", 
          RowBox[{"Width", ",", 
           RowBox[{
            RowBox[{
             RowBox[{"-", "Gap"}], "/", "2"}], "-", "Height"}]}], "}"}], ",", 
         
         RowBox[{"{", " ", 
          RowBox[{"Width", ",", 
           RowBox[{
            RowBox[{"-", "Gap"}], "/", "2"}]}], "}"}]}], "}"}]}], ";", 
      "\[IndentingNewLine]", "\[IndentingNewLine]", 
      RowBox[{"(*", "Cassettes", "*)"}], "\[IndentingNewLine]", 
      RowBox[{"\[Delta]BRC", " ", "=", 
       RowBox[{"\[Delta]P", " ", "+", " ", "\[Delta]CP"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"BRC", " ", "=", " ", 
       RowBox[{"auxIDRectangularCassette", "[", 
        RowBox[{
        "\[Lambda]u", ",", " ", "Np", ",", "Br", ",", " ", "Width", ",", 
         "Height", ",", "\[Delta]BRC", ",", " ", "BRCBlockList", ",", " ", 
         "BlockGap", ",", 
         RowBox[{"\"\<PointingUp\>\"", "\[Rule]", " ", "False"}], ",", " ", 
         RowBox[{"\"\<FirstBlock\>\"", "\[Rule]", " ", "\"\<Down\>\""}], ",", 
         " ", 
         RowBox[{"\"\<Termination\>\"", "\[Rule]", " ", "Termination"}], ",", 
         
         RowBox[{
         "\"\<PosMagErrors\>\"", "\[Rule]", " ", "PosMagErrorsBRC"}]}], 
        "]"}]}], " ", ";", "\[IndentingNewLine]", "\[IndentingNewLine]", 
      RowBox[{"\[Delta]BLC", " ", "=", " ", "0"}], ";", "\[IndentingNewLine]", 
      RowBox[{"BLC", " ", "=", " ", 
       RowBox[{"auxIDRectangularCassette", "[", 
        RowBox[{
        "\[Lambda]u", ",", " ", "Np", ",", "Br", ",", " ", "Width", ",", 
         "Height", ",", "\[Delta]BLC", ",", " ", "BLCBlockList", ",", " ", 
         "BlockGap", ",", " ", 
         RowBox[{"\"\<PointingUp\>\"", "\[Rule]", " ", "False"}], ",", " ", 
         RowBox[{"\"\<FirstBlock\>\"", "\[Rule]", " ", "\"\<Down\>\""}], ",", 
         
         RowBox[{"\"\<Termination\>\"", "\[Rule]", " ", "Termination"}], ",", 
         
         RowBox[{
         "\"\<PosMagErrors\>\"", "\[Rule]", " ", "PosMagErrorsBLC"}]}], 
        "]"}]}], " ", ";", "\[IndentingNewLine]", "\[IndentingNewLine]", 
      RowBox[{"\[Delta]ULC", " ", "=", " ", 
       RowBox[{"\[Delta]P", "-", "\[Delta]CP"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"ULC", " ", "=", " ", 
       RowBox[{"auxIDRectangularCassette", "[", 
        RowBox[{
        "\[Lambda]u", ",", " ", "Np", ",", "Br", ",", " ", "Width", ",", 
         "Height", ",", "\[Delta]ULC", ",", " ", "ULCBlockList", ",", " ", 
         "BlockGap", ",", " ", 
         RowBox[{"\"\<PointingUp\>\"", "\[Rule]", "True"}], ",", 
         RowBox[{"\"\<FirstBlock\>\"", "\[Rule]", " ", "\"\<Down\>\""}], ",", 
         
         RowBox[{"\"\<Termination\>\"", "\[Rule]", " ", "Termination"}], ",", 
         " ", 
         RowBox[{
         "\"\<PosMagErrors\>\"", "\[Rule]", " ", "PosMagErrorsULC"}]}], 
        "]"}]}], " ", ";", "\[IndentingNewLine]", "\[IndentingNewLine]", 
      RowBox[{"\[Delta]URC", "=", " ", "0.0"}], ";", "\[IndentingNewLine]", 
      RowBox[{"URC", " ", "=", " ", 
       RowBox[{"auxIDRectangularCassette", "[", 
        RowBox[{
        "\[Lambda]u", ",", " ", "Np", ",", "Br", ",", " ", "Width", ",", 
         "Height", ",", "\[Delta]URC", ",", " ", "URCBlockList", ",", 
         "BlockGap", ",", "  ", 
         RowBox[{"\"\<PointingUp\>\"", "\[Rule]", " ", "True"}], ",", 
         RowBox[{"\"\<FirstBlock\>\"", "\[Rule]", " ", "\"\<Down\>\""}], ",", 
         
         RowBox[{"\"\<Termination\>\"", "\[Rule]", " ", "Termination"}], ",", 
         " ", 
         RowBox[{
         "\"\<PosMagErrors\>\"", "\[Rule]", " ", "PosMagErrorsURC"}]}], 
        "]"}]}], " ", ";", "\[IndentingNewLine]", "\[IndentingNewLine]", 
      RowBox[{"(*", 
       RowBox[{"Insertion", " ", "device"}], "*)"}], "\[IndentingNewLine]", 
      RowBox[{"EPU", " ", "=", " ", 
       RowBox[{"radObjCnt", "[", 
        RowBox[{"{", 
         RowBox[{"BRC", ",", " ", "BLC", ",", " ", "ULC", ",", " ", "URC"}], 
         "}"}], "]"}]}], ";", "\[IndentingNewLine]", "\[IndentingNewLine]", 
      RowBox[{"t1", "=", 
       RowBox[{"AbsoluteTime", "[", "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"Print", "[", 
       RowBox[{"\"\<IDRectangularEPU: elapsed time = \>\"", ",", 
        RowBox[{"(", 
         RowBox[{"t1", "-", "t0"}], ")"}], ",", "\"\< s\>\""}], "]"}], ";", 
      "\[IndentingNewLine]", "\[IndentingNewLine]", 
      RowBox[{"Return", "[", "EPU", "]"}], ";"}]}], "\[IndentingNewLine]", 
    "]"}]}], ";"}]}], "Input",
 CellChangeTimes->{{3.766403272085984*^9, 3.7664033578521757`*^9}, {
  3.7667571136176224`*^9, 3.7667571709189963`*^9}, {3.7667584177386036`*^9, 
  3.766758466117406*^9}, {3.767445998138589*^9, 3.7674460044647546`*^9}, {
  3.7674481732114954`*^9, 3.767448197291478*^9}, {3.7675190261227913`*^9, 
  3.7675192663618317`*^9}, {3.7675192966658735`*^9, 3.767519297637305*^9}, {
  3.7675193763480625`*^9, 3.767519383231429*^9}, {3.7675195926494403`*^9, 
  3.767519605315816*^9}},
 Background->RGBColor[0.87, 0.94, 1]]
}, Closed]]
}, Open  ]],

Cell[CellGroupData[{

Cell["Utilities", "Section",
 CellChangeTimes->{{3.7663982103876667`*^9, 3.7663982168978977`*^9}, {
  3.7663982623594646`*^9, 3.766398265542498*^9}}],

Cell[CellGroupData[{

Cell["IDShow", "Subsection",
 CellChangeTimes->{3.766754821368951*^9}],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"IDShow", "::", "usage"}], " ", "=", " ", 
    "\"\<IDShow[ID, \\\"MagDirection\\\"\[Rule] False, \\\"ArrowSize\\\"\
\[Rule] 10, \\\"ArrowHeadSize\\\"\[Rule] Medium]: Show the ID model.\>\""}], 
   ";"}], " ", "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"IDShow", "[", 
    RowBox[{"ID_", ",", " ", 
     RowBox[{"OptionsPattern", "[", 
      RowBox[{"{", 
       RowBox[{
        RowBox[{"\"\<MagDirection\>\"", "\[Rule]", " ", "False"}], ",", "  ", 
        
        RowBox[{"\"\<ArrowSize\>\"", "\[Rule]", " ", "10"}], ",", " ", 
        RowBox[{"\"\<ArrowHeadSize\>\"", "\[Rule]", "Medium"}]}], "}"}], 
      "]"}]}], "]"}], " ", ":=", " ", 
   RowBox[{"Module", "[", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
      "MagDirection", ",", " ", "ArrowSize", " ", ",", " ", "ArrowHeadSize", 
       " ", ",", " ", "ObjM", " ", ",", " ", "ArrowList", ",", " ", "t0", ",",
        " ", "t1"}], "}"}], ",", "\[IndentingNewLine]", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"t0", "=", 
       RowBox[{"AbsoluteTime", "[", "]"}]}], ";", "\[IndentingNewLine]", 
      "\[IndentingNewLine]", 
      RowBox[{"RadPlot3DOptions", "[", "]"}], ";", "\[IndentingNewLine]", 
      "\[IndentingNewLine]", 
      RowBox[{"MagDirection", " ", "=", " ", 
       RowBox[{"OptionValue", "[", "\"\<MagDirection\>\"", "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"ArrowSize", " ", "=", " ", 
       RowBox[{"OptionValue", "[", "\"\<ArrowSize\>\"", "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"ArrowHeadSize", " ", "=", " ", 
       RowBox[{"OptionValue", "[", "\"\<ArrowHeadSize\>\"", "]"}]}], ";", 
      "\[IndentingNewLine]", "\[IndentingNewLine]", 
      RowBox[{"If", "[", 
       RowBox[{"MagDirection", ",", "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"ObjM", " ", "=", " ", 
          RowBox[{"radObjM", "[", "ID", "]"}]}], ";", "\[IndentingNewLine]", 
         RowBox[{"ArrowList", " ", "=", " ", 
          RowBox[{
           RowBox[{
            RowBox[{"auxIDBlockArrow", "[", 
             RowBox[{
              RowBox[{"#", "[", 
               RowBox[{"[", "1", "]"}], "]"}], ",", " ", 
              RowBox[{"#", "[", 
               RowBox[{"[", "2", "]"}], "]"}], ",", " ", "ArrowSize"}], "]"}],
             "&"}], "/@", "ObjM"}]}], ";", "\[IndentingNewLine]", 
         RowBox[{"Print", "[", 
          RowBox[{"Graphics3D", "[", 
           RowBox[{
            RowBox[{"{", 
             RowBox[{
              RowBox[{"Opacity", "[", "0.5", "]"}], ",", " ", 
              RowBox[{"radObjDrw", "[", "ID", "]"}], ",", 
              RowBox[{"Opacity", "[", "1", "]"}], ",", 
              RowBox[{"Arrowheads", "[", "ArrowHeadSize", "]"}], ",", 
              "ArrowList"}], "}"}], ",", " ", 
            RowBox[{"BaseStyle", " ", "\[Rule]", " ", 
             RowBox[{"{", 
              RowBox[{"12", ",", " ", 
               RowBox[{
               "FontFamily", " ", "\[Rule]", " ", "\"\<Calibri\>\""}]}], 
              "}"}]}]}], "]"}], "]"}], ";"}], ",", "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"Print", "[", 
          RowBox[{"Graphics3D", "[", 
           RowBox[{
            RowBox[{"radObjDrw", "[", "ID", "]"}], ",", 
            RowBox[{"BaseStyle", " ", "\[Rule]", " ", 
             RowBox[{"{", 
              RowBox[{"12", ",", " ", 
               RowBox[{
               "FontFamily", " ", "\[Rule]", " ", "\"\<Calibri\>\""}]}], 
              "}"}]}]}], "]"}], "]"}], ";"}]}], "\[IndentingNewLine]", "]"}], 
      ";", "\[IndentingNewLine]", "\[IndentingNewLine]", 
      RowBox[{"t1", "=", 
       RowBox[{"AbsoluteTime", "[", "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"Print", "[", 
       RowBox[{"\"\<IDShow: elapsed time = \>\"", ",", 
        RowBox[{"(", 
         RowBox[{"t1", "-", "t0"}], ")"}], ",", "\"\< s\>\""}], "]"}], 
      ";"}]}], "\[IndentingNewLine]", "]"}]}], ";"}]}], "Input",
 CellChangeTimes->{{3.7667558489826016`*^9, 3.766755892642285*^9}, {
   3.76675595766302*^9, 3.7667561689633245`*^9}, {3.7667562043411093`*^9, 
   3.766756256829613*^9}, 3.7667563179437857`*^9, 3.766757279583788*^9, {
   3.7674475847961235`*^9, 3.7674476020787315`*^9}, {3.767447784535589*^9, 
   3.767447797099101*^9}},
 Background->RGBColor[0.87, 0.94, 1]]
}, Closed]],

Cell[CellGroupData[{

Cell["IDInfo", "Subsection",
 CellChangeTimes->{{3.766754821368951*^9, 3.766754837401464*^9}, {
  3.76744992179731*^9, 3.7674499282822175`*^9}}],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"IDInfo", "::", "usage"}], " ", "=", " ", 
    "\"\<IDInfo[ID, \[Lambda]u]: Print the field amplitudes and K values of \
the ID.\>\""}], ";"}], "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"IDInfo", "[", 
    RowBox[{"ID_", ",", " ", "\[Lambda]u_"}], "]"}], " ", ":=", " ", 
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
      "Bv", ",", " ", "Bh", ",", " ", "Bs", ",", " ", "Kh", ",", " ", "Kv", 
       ",", " ", "t0", ",", " ", "t1"}], "}"}], ",", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"t0", "=", 
       RowBox[{"AbsoluteTime", "[", "]"}]}], ";", "\[IndentingNewLine]", 
      "\[IndentingNewLine]", 
      RowBox[{"Bh", " ", "=", 
       RowBox[{"Max", "[", 
        RowBox[{
         RowBox[{"radFldLst", "[", 
          RowBox[{"ID", ",", " ", "\"\<Bx\>\"", ",", " ", 
           RowBox[{"{", " ", 
            RowBox[{"0", ",", 
             RowBox[{"-", "\[Lambda]u"}], ",", " ", "0"}], "}"}], ",", " ", 
           RowBox[{"{", 
            RowBox[{"0", ",", "\[Lambda]u", ",", " ", "0"}], "}"}], ",", " ", 
           "100", ",", " ", "\"\<arg\>\"", ",", " ", 
           RowBox[{"-", "\[Lambda]u"}]}], "]"}], "[", 
         RowBox[{"[", 
          RowBox[{"All", ",", " ", "2"}], "]"}], "]"}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"Bv", " ", "=", 
       RowBox[{"Max", "[", 
        RowBox[{
         RowBox[{"radFldLst", "[", 
          RowBox[{"ID", ",", " ", "\"\<Bz\>\"", ",", " ", 
           RowBox[{"{", " ", 
            RowBox[{"0", ",", 
             RowBox[{"-", "\[Lambda]u"}], ",", " ", "0"}], "}"}], ",", " ", 
           RowBox[{"{", 
            RowBox[{"0", ",", "\[Lambda]u", ",", " ", "0"}], "}"}], ",", " ", 
           "100", ",", " ", "\"\<arg\>\"", ",", " ", 
           RowBox[{"-", "\[Lambda]u"}]}], "]"}], "[", 
         RowBox[{"[", 
          RowBox[{"All", ",", " ", "2"}], "]"}], "]"}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"Bs", " ", "=", 
       RowBox[{"Max", "[", 
        RowBox[{
         RowBox[{"radFldLst", "[", 
          RowBox[{"ID", ",", " ", "\"\<By\>\"", ",", " ", 
           RowBox[{"{", " ", 
            RowBox[{"0", ",", 
             RowBox[{"-", "\[Lambda]u"}], ",", " ", "0"}], "}"}], ",", " ", 
           RowBox[{"{", 
            RowBox[{"0", ",", "\[Lambda]u", ",", " ", "0"}], "}"}], ",", " ", 
           "100", ",", " ", "\"\<arg\>\"", ",", " ", 
           RowBox[{"-", "\[Lambda]u"}]}], "]"}], "[", 
         RowBox[{"[", 
          RowBox[{"All", ",", " ", "2"}], "]"}], "]"}], "]"}]}], ";", 
      "\[IndentingNewLine]", "\[IndentingNewLine]", 
      RowBox[{"Print", "[", 
       RowBox[{
       "\"\<\\nHorizontal field amplitude:    \>\"", ",", " ", "Bh", ",", 
        "  ", "\"\< [T]\>\""}], "]"}], ";", "\[IndentingNewLine]", 
      RowBox[{"Print", "[", 
       RowBox[{
       "\"\<Vertical field amplitude:      \>\"", ",", " ", "Bv", ",", " ", 
        "\"\< [T]\>\""}], "]"}], ";", "\[IndentingNewLine]", 
      RowBox[{"Print", "[", 
       RowBox[{
       "\"\<Longitudinal field amplitude:  \>\"", ",", " ", "Bs", ",", "  ", 
        "\"\< [T]\>\""}], "]"}], ";", "\[IndentingNewLine]", 
      "\[IndentingNewLine]", 
      RowBox[{"Kh", " ", "=", " ", 
       RowBox[{"0.934", "*", "Bv", "*", 
        RowBox[{"(", 
         RowBox[{"\[Lambda]u", "/", "10"}], ")"}]}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"Kv", " ", "=", " ", 
       RowBox[{"0.934", "*", "Bh", "*", 
        RowBox[{"(", 
         RowBox[{"\[Lambda]u", "/", "10"}], ")"}]}]}], ";", 
      "\[IndentingNewLine]", "\[IndentingNewLine]", 
      RowBox[{"Print", "[", 
       RowBox[{"\"\<\\nHorizontal K: \>\"", ",", " ", "Kh"}], "]"}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"Print", "[", 
       RowBox[{"\"\<Vertical K:   \>\"", ",", " ", "Kv"}], "]"}], ";", 
      "\[IndentingNewLine]", "\[IndentingNewLine]", 
      RowBox[{"t1", "=", 
       RowBox[{"AbsoluteTime", "[", "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"Print", "[", 
       RowBox[{"\"\<IDInfo: elapsed time = \>\"", ",", 
        RowBox[{"(", 
         RowBox[{"t1", "-", "t0"}], ")"}], ",", "\"\< s\>\""}], "]"}], 
      ";"}]}], "\[IndentingNewLine]", "]"}]}], ";"}]}], "Input",
 CellChangeTimes->{{3.7674474456397743`*^9, 3.7674474806295147`*^9}, {
  3.7674475680916853`*^9, 3.7674475684823327`*^9}, {3.767447806856612*^9, 
  3.767447814544712*^9}, {3.76744993168874*^9, 3.76744994276999*^9}},
 Background->RGBColor[0.87, 0.94, 1]]
}, Closed]],

Cell[CellGroupData[{

Cell["IDPlotFields", "Subsection",
 CellChangeTimes->{3.7667548496524267`*^9}],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"IDPlotFields", "::", "usage"}], " ", "=", " ", 
    "\"\<IDPlotFields[ID, p, pRange, BRange:{All, All}, p2:0, p3:0]: Plot the \
ID magnetic field versus the coordinate p ('x', 'y' or 'z').\>\""}], ";"}], 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"IDPlotFields", "[", 
    RowBox[{"ID_", ",", " ", "p_", ",", "pRange_", ",", " ", 
     RowBox[{"BRange_:", 
      RowBox[{"{", 
       RowBox[{"All", ",", " ", "All"}], "}"}]}], " ", ",", 
     RowBox[{"p2_:", "0"}], ",", " ", 
     RowBox[{"p3_:", "0"}]}], "]"}], " ", ":=", " ", 
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"plots", ",", " ", "t0", ",", " ", "t1"}], "}"}], ",", 
     "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"t0", "=", 
       RowBox[{"AbsoluteTime", "[", "]"}]}], ";", "\[IndentingNewLine]", 
      "\[IndentingNewLine]", 
      RowBox[{"plots", " ", "=", " ", 
       RowBox[{"{", "}"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"If", "[", 
       RowBox[{
        RowBox[{"p", " ", "\[Equal]", " ", "\"\<x\>\""}], ",", 
        "\[IndentingNewLine]", 
        RowBox[{"(", 
         RowBox[{
          RowBox[{"AppendTo", "[", 
           RowBox[{"plots", ",", 
            RowBox[{"Plot", "[", 
             RowBox[{
              RowBox[{"{", 
               RowBox[{"radFld", "[", 
                RowBox[{"ID", ",", "\"\<Bx\>\"", ",", 
                 RowBox[{"{", 
                  RowBox[{"x", ",", "p2", ",", "p3"}], "}"}]}], "]"}], "}"}], 
              ",", 
              RowBox[{"{", 
               RowBox[{"x", ",", 
                RowBox[{"pRange", "[", 
                 RowBox[{"[", "1", "]"}], "]"}], ",", 
                RowBox[{"pRange", "[", 
                 RowBox[{"[", "2", "]"}], "]"}]}], "}"}], ",", 
              RowBox[{"PlotRange", "\[Rule]", " ", 
               RowBox[{"{", 
                RowBox[{"pRange", ",", " ", "BRange"}], "}"}]}], ",", 
              RowBox[{"PlotTheme", "\[Rule]", "\"\<Detailed\>\""}], ",", 
              RowBox[{"FrameLabel", "\[Rule]", 
               RowBox[{"{", 
                RowBox[{"\"\<x [mm]\>\"", ",", "\"\<Bx[T]\>\""}], "}"}]}]}], 
             "]"}]}], "]"}], ";", "\[IndentingNewLine]", 
          RowBox[{"AppendTo", "[", 
           RowBox[{"plots", ",", 
            RowBox[{"Plot", "[", 
             RowBox[{
              RowBox[{"{", 
               RowBox[{"radFld", "[", 
                RowBox[{"ID", ",", "\"\<By\>\"", ",", 
                 RowBox[{"{", 
                  RowBox[{"x", ",", "p2", ",", "p3"}], "}"}]}], "]"}], "}"}], 
              ",", 
              RowBox[{"{", 
               RowBox[{"x", ",", 
                RowBox[{"pRange", "[", 
                 RowBox[{"[", "1", "]"}], "]"}], ",", 
                RowBox[{"pRange", "[", 
                 RowBox[{"[", "2", "]"}], "]"}]}], "}"}], ",", 
              RowBox[{"PlotLabel", "\[Rule]", "\"\<Longitudinal Field\>\""}], 
              " ", ",", 
              RowBox[{"PlotRange", "\[Rule]", " ", 
               RowBox[{"{", 
                RowBox[{"pRange", ",", "  ", "BRange"}], "}"}]}], ",", 
              RowBox[{"PlotTheme", "\[Rule]", "\"\<Detailed\>\""}], ",", 
              RowBox[{"FrameLabel", "\[Rule]", 
               RowBox[{"{", 
                RowBox[{"\"\<x [mm]\>\"", ",", "\"\<By[T]\>\""}], "}"}]}]}], 
             "]"}]}], "]"}], ";", "\[IndentingNewLine]", 
          RowBox[{"AppendTo", "[", 
           RowBox[{"plots", ",", 
            RowBox[{"Plot", "[", 
             RowBox[{
              RowBox[{"{", 
               RowBox[{"radFld", "[", 
                RowBox[{"ID", ",", "\"\<Bz\>\"", ",", 
                 RowBox[{"{", 
                  RowBox[{"x", ",", "p2", ",", "p3"}], "}"}]}], "]"}], "}"}], 
              ",", 
              RowBox[{"{", 
               RowBox[{"x", ",", 
                RowBox[{"pRange", "[", 
                 RowBox[{"[", "1", "]"}], "]"}], ",", 
                RowBox[{"pRange", "[", 
                 RowBox[{"[", "2", "]"}], "]"}]}], "}"}], ",", 
              RowBox[{"PlotRange", "\[Rule]", " ", 
               RowBox[{"{", 
                RowBox[{"pRange", ",", " ", "BRange"}], "}"}]}], ",", 
              RowBox[{"PlotTheme", "\[Rule]", "\"\<Detailed\>\""}], ",", 
              RowBox[{"FrameLabel", "\[Rule]", 
               RowBox[{"{", 
                RowBox[{"\"\<x [mm]\>\"", ",", "\"\<Bz[T]\>\""}], "}"}]}]}], 
             "]"}]}], "]"}], ";"}], ")"}]}], "\[IndentingNewLine]", "]"}], 
      ";", "\[IndentingNewLine]", 
      RowBox[{"If", "[", 
       RowBox[{
        RowBox[{"p", " ", "\[Equal]", " ", "\"\<y\>\""}], ",", 
        "\[IndentingNewLine]", 
        RowBox[{"(", 
         RowBox[{
          RowBox[{"AppendTo", "[", 
           RowBox[{"plots", ",", 
            RowBox[{"Plot", "[", 
             RowBox[{
              RowBox[{"{", 
               RowBox[{"radFld", "[", 
                RowBox[{"ID", ",", "\"\<Bx\>\"", ",", 
                 RowBox[{"{", 
                  RowBox[{"p2", ",", "y", ",", "p3"}], "}"}]}], "]"}], "}"}], 
              ",", 
              RowBox[{"{", 
               RowBox[{"y", ",", 
                RowBox[{"pRange", "[", 
                 RowBox[{"[", "1", "]"}], "]"}], ",", 
                RowBox[{"pRange", "[", 
                 RowBox[{"[", "2", "]"}], "]"}]}], "}"}], ",", 
              RowBox[{"PlotRange", "\[Rule]", " ", 
               RowBox[{"{", 
                RowBox[{"pRange", ",", " ", "BRange"}], "}"}]}], ",", 
              RowBox[{"PlotTheme", "\[Rule]", "\"\<Detailed\>\""}], ",", 
              RowBox[{"FrameLabel", "\[Rule]", 
               RowBox[{"{", 
                RowBox[{"\"\<y [mm]\>\"", ",", "\"\<Bx[T]\>\""}], "}"}]}]}], 
             "]"}]}], "]"}], ";", "\[IndentingNewLine]", 
          RowBox[{"AppendTo", "[", 
           RowBox[{"plots", ",", 
            RowBox[{"Plot", "[", 
             RowBox[{
              RowBox[{"{", 
               RowBox[{"radFld", "[", 
                RowBox[{"ID", ",", "\"\<By\>\"", ",", 
                 RowBox[{"{", 
                  RowBox[{"p2", ",", "y", ",", "p3"}], "}"}]}], "]"}], "}"}], 
              ",", 
              RowBox[{"{", 
               RowBox[{"y", ",", 
                RowBox[{"pRange", "[", 
                 RowBox[{"[", "1", "]"}], "]"}], ",", 
                RowBox[{"pRange", "[", 
                 RowBox[{"[", "2", "]"}], "]"}]}], "}"}], ",", 
              RowBox[{"PlotRange", "\[Rule]", " ", 
               RowBox[{"{", 
                RowBox[{"pRange", ",", "  ", "BRange"}], "}"}]}], ",", 
              RowBox[{"PlotTheme", "\[Rule]", "\"\<Detailed\>\""}], ",", 
              RowBox[{"FrameLabel", "\[Rule]", 
               RowBox[{"{", 
                RowBox[{"\"\<y [mm]\>\"", ",", "\"\<By[T]\>\""}], "}"}]}]}], 
             "]"}]}], "]"}], ";", "\[IndentingNewLine]", 
          RowBox[{"AppendTo", "[", 
           RowBox[{"plots", ",", 
            RowBox[{"Plot", "[", 
             RowBox[{
              RowBox[{"{", 
               RowBox[{"radFld", "[", 
                RowBox[{"ID", ",", "\"\<Bz\>\"", ",", 
                 RowBox[{"{", 
                  RowBox[{"p2", ",", "y", ",", "p3"}], "}"}]}], "]"}], "}"}], 
              ",", 
              RowBox[{"{", 
               RowBox[{"y", ",", 
                RowBox[{"pRange", "[", 
                 RowBox[{"[", "1", "]"}], "]"}], ",", 
                RowBox[{"pRange", "[", 
                 RowBox[{"[", "2", "]"}], "]"}]}], "}"}], ",", 
              RowBox[{"PlotRange", "\[Rule]", " ", 
               RowBox[{"{", 
                RowBox[{"pRange", ",", "BRange"}], "}"}]}], ",", 
              RowBox[{"PlotTheme", "\[Rule]", "\"\<Detailed\>\""}], ",", 
              RowBox[{"FrameLabel", "\[Rule]", 
               RowBox[{"{", 
                RowBox[{"\"\<y [mm]\>\"", ",", "\"\<Bz[T]\>\""}], "}"}]}]}], 
             "]"}]}], "]"}], ";"}], ")"}]}], "\[IndentingNewLine]", "]"}], 
      ";", "\[IndentingNewLine]", 
      RowBox[{"If", "[", 
       RowBox[{
        RowBox[{"p", " ", "\[Equal]", " ", "\"\<z\>\""}], ",", 
        "\[IndentingNewLine]", 
        RowBox[{"(", 
         RowBox[{
          RowBox[{"AppendTo", "[", 
           RowBox[{"plots", ",", 
            RowBox[{"Plot", "[", 
             RowBox[{
              RowBox[{"{", 
               RowBox[{"radFld", "[", 
                RowBox[{"ID", ",", "\"\<Bx\>\"", ",", 
                 RowBox[{"{", 
                  RowBox[{"p2", ",", "p3", ",", "z"}], "}"}]}], "]"}], "}"}], 
              ",", 
              RowBox[{"{", 
               RowBox[{"z", ",", 
                RowBox[{"pRange", "[", 
                 RowBox[{"[", "1", "]"}], "]"}], ",", 
                RowBox[{"pRange", "[", 
                 RowBox[{"[", "2", "]"}], "]"}]}], "}"}], ",", 
              RowBox[{"PlotRange", "\[Rule]", " ", 
               RowBox[{"{", 
                RowBox[{"pRange", ",", " ", "BRange"}], "}"}]}], ",", 
              RowBox[{"PlotTheme", "\[Rule]", "\"\<Detailed\>\""}], ",", 
              RowBox[{"FrameLabel", "\[Rule]", 
               RowBox[{"{", 
                RowBox[{"\"\<z [mm]\>\"", ",", "\"\<Bx[T]\>\""}], "}"}]}]}], 
             "]"}]}], "]"}], ";", "\[IndentingNewLine]", 
          RowBox[{"AppendTo", "[", 
           RowBox[{"plots", ",", 
            RowBox[{"Plot", "[", 
             RowBox[{
              RowBox[{"{", 
               RowBox[{"radFld", "[", 
                RowBox[{"ID", ",", "\"\<By\>\"", ",", 
                 RowBox[{"{", 
                  RowBox[{"p2", ",", "p3", ",", "z"}], "}"}]}], "]"}], "}"}], 
              ",", 
              RowBox[{"{", 
               RowBox[{"z", ",", 
                RowBox[{"pRange", "[", 
                 RowBox[{"[", "1", "]"}], "]"}], ",", 
                RowBox[{"pRange", "[", 
                 RowBox[{"[", "2", "]"}], "]"}]}], "}"}], ",", 
              RowBox[{"PlotRange", "\[Rule]", " ", 
               RowBox[{"{", 
                RowBox[{"pRange", ",", "  ", "BRange"}], "}"}]}], ",", 
              RowBox[{"PlotTheme", "\[Rule]", "\"\<Detailed\>\""}], ",", 
              RowBox[{"FrameLabel", "\[Rule]", 
               RowBox[{"{", 
                RowBox[{"\"\<z [mm]\>\"", ",", "\"\<By[T]\>\""}], "}"}]}]}], 
             "]"}]}], "]"}], ";", "\[IndentingNewLine]", 
          RowBox[{"AppendTo", "[", 
           RowBox[{"plots", ",", 
            RowBox[{"Plot", "[", 
             RowBox[{
              RowBox[{"{", 
               RowBox[{"radFld", "[", 
                RowBox[{"ID", ",", "\"\<Bz\>\"", ",", 
                 RowBox[{"{", 
                  RowBox[{"p2", ",", "p3", ",", "z"}], "}"}]}], "]"}], "}"}], 
              ",", 
              RowBox[{"{", 
               RowBox[{"z", ",", 
                RowBox[{"pRange", "[", 
                 RowBox[{"[", "1", "]"}], "]"}], ",", 
                RowBox[{"pRange", "[", 
                 RowBox[{"[", "2", "]"}], "]"}]}], "}"}], ",", 
              RowBox[{"PlotRange", "\[Rule]", " ", 
               RowBox[{"{", 
                RowBox[{"pRange", ",", "BRange"}], "}"}]}], ",", 
              RowBox[{"PlotTheme", "\[Rule]", "\"\<Detailed\>\""}], ",", 
              RowBox[{"FrameLabel", "\[Rule]", 
               RowBox[{"{", 
                RowBox[{"\"\<z [mm]\>\"", ",", "\"\<Bz[T]\>\""}], "}"}]}]}], 
             "]"}]}], "]"}], ";"}], ")"}]}], "\[IndentingNewLine]", "]"}], 
      ";", "\[IndentingNewLine]", "\[IndentingNewLine]", 
      RowBox[{"t1", "=", 
       RowBox[{"AbsoluteTime", "[", "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"Print", "[", 
       RowBox[{"\"\<IDPlotFields: elapsed time = \>\"", ",", 
        RowBox[{"(", 
         RowBox[{"t1", "-", "t0"}], ")"}], ",", "\"\< s\>\""}], "]"}], ";", 
      "\[IndentingNewLine]", "\[IndentingNewLine]", 
      RowBox[{"Return", "[", "plots", "]"}], ";"}]}], "\[IndentingNewLine]", 
    "]"}]}], ";"}]}], "Input",
 CellChangeTimes->{{3.7674474943805976`*^9, 3.767447507209737*^9}, 
   3.7674475635600443`*^9, {3.767447820092058*^9, 3.767447829967826*^9}},
 Background->RGBColor[0.87, 0.94, 1]]
}, Closed]],

Cell[CellGroupData[{

Cell["IDFieldIntegrals", "Subsection",
 CellChangeTimes->{3.7667548688726835`*^9}],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"IDFieldIntegrals", "::", "usage"}], " ", "=", " ", 
    "\"\<IDFieldIntegrals[ID, field, yrange, ny]: Returns the first and \
second magnetic field integrals. The unit is G.cm for the first integral and \
T.cm\.b2 for the second integral.\>\""}], ";"}], " ", 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"IDFieldIntegrals", "[", 
    RowBox[{"ID_", ",", " ", "field_", ",", " ", "yrange_", ",", " ", "ny_"}],
     "]"}], " ", ":=", " ", 
   RowBox[{"Module", "[", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
      "ylist", ",", " ", "firstintlist", ",", " ", "i", ",", " ", "sfl", ",", 
       " ", "firstint", ",", " ", "secondint", ",", " ", "t0", ",", " ", 
       "t1"}], "}"}], ",", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"t0", "=", 
       RowBox[{"AbsoluteTime", "[", "]"}]}], ";", "\[IndentingNewLine]", 
      "\[IndentingNewLine]", 
      RowBox[{"firstint", " ", "=", " ", 
       RowBox[{"radFldInt", "[", 
        RowBox[{"ID", ",", "\"\<fin\>\"", ",", 
         RowBox[{"StringJoin", "[", 
          RowBox[{"\"\<i\>\"", ",", " ", "field"}], "]"}], ",", 
         RowBox[{"{", 
          RowBox[{"0", ",", " ", 
           RowBox[{"yrange", "[", 
            RowBox[{"[", "1", "]"}], "]"}], ",", " ", "0"}], "}"}], ",", 
         RowBox[{"{", 
          RowBox[{"0", ",", " ", 
           RowBox[{"yrange", "[", 
            RowBox[{"[", "2", "]"}], "]"}], ",", " ", "0"}], "}"}]}], "]"}]}],
       ";", "\[IndentingNewLine]", "\[IndentingNewLine]", 
      RowBox[{"ylist", " ", "=", " ", 
       RowBox[{"Array", "[", 
        RowBox[{
         RowBox[{"#", "&"}], ",", "ny", ",", 
         RowBox[{"{", 
          RowBox[{
           RowBox[{"yrange", "[", 
            RowBox[{"[", "1", "]"}], "]"}], ",", 
           RowBox[{"yrange", "[", 
            RowBox[{"[", "2", "]"}], "]"}]}], "}"}]}], "]"}]}], ";", 
      "\[IndentingNewLine]", "\[IndentingNewLine]", 
      RowBox[{"sfl", " ", "=", " ", "0"}], ";", "\[IndentingNewLine]", 
      RowBox[{"firstintlist", " ", "=", " ", 
       RowBox[{"{", "0", "}"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"For", " ", "[", 
       RowBox[{
        RowBox[{"i", "=", "1"}], ",", " ", 
        RowBox[{"i", "\[LessEqual]", " ", 
         RowBox[{
          RowBox[{"Length", "[", "ylist", "]"}], "-", "1"}]}], ",", " ", 
        RowBox[{"i", "++"}], ",", "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"sfl", " ", "=", " ", 
          RowBox[{"sfl", " ", "+", " ", 
           RowBox[{"radFldInt", "[", 
            RowBox[{"ID", ",", "\"\<fin\>\"", ",", 
             RowBox[{"StringJoin", "[", 
              RowBox[{"\"\<i\>\"", ",", " ", "field"}], "]"}], ",", 
             RowBox[{"{", 
              RowBox[{"0", ",", " ", 
               RowBox[{"ylist", "[", 
                RowBox[{"[", "i", "]"}], "]"}], ",", " ", "0"}], "}"}], ",", 
             RowBox[{"{", 
              RowBox[{"0", ",", " ", 
               RowBox[{"ylist", "[", 
                RowBox[{"[", 
                 RowBox[{"i", "+", "1"}], "]"}], "]"}], ",", " ", "0"}], 
              "}"}]}], "]"}]}]}], ";", "\[IndentingNewLine]", 
         RowBox[{"AppendTo", "[", 
          RowBox[{"firstintlist", ",", " ", "sfl"}], "]"}]}]}], 
       "\[IndentingNewLine]", "]"}], ";", "\[IndentingNewLine]", 
      RowBox[{"secondint", " ", "=", " ", 
       RowBox[{"Integrate", "[", 
        RowBox[{
         RowBox[{
          RowBox[{"Interpolation", "[", 
           RowBox[{
            RowBox[{"Transpose", "@", 
             RowBox[{"{", 
              RowBox[{"ylist", ",", " ", "firstintlist"}], "}"}]}], ",", " ", 
            
            RowBox[{"InterpolationOrder", "\[Rule]", "3"}]}], "]"}], "[", "y",
           "]"}], ",", " ", 
         RowBox[{"{", 
          RowBox[{"y", ",", " ", 
           RowBox[{"yrange", "[", 
            RowBox[{"[", "1", "]"}], "]"}], ",", " ", 
           RowBox[{"yrange", "[", 
            RowBox[{"[", "2", "]"}], "]"}]}], "}"}]}], "]"}]}], ";", 
      "\[IndentingNewLine]", "\[IndentingNewLine]", 
      RowBox[{"firstint", " ", "=", " ", 
       RowBox[{"firstint", "*", "1000"}]}], " ", ";", 
      RowBox[{"(*", 
       RowBox[{
        RowBox[{"[", 
         RowBox[{"T", ".", "mm"}], "]"}], " ", "\[Rule]", " ", 
        RowBox[{"[", 
         RowBox[{"G", ".", "cm"}], "]"}]}], "*)"}], "\[IndentingNewLine]", 
      RowBox[{"secondint", " ", "=", " ", 
       RowBox[{"secondint", "/", "100"}]}], ";", " ", 
      RowBox[{"(*", 
       RowBox[{
        RowBox[{"[", 
         RowBox[{"T", ".", "mm\.b2"}], "]"}], " ", "\[Rule]", " ", 
        RowBox[{"[", 
         RowBox[{"T", ".", "cm\.b2"}], "]"}]}], "*)"}], "\[IndentingNewLine]",
       "\[IndentingNewLine]", 
      RowBox[{"Print", "[", 
       RowBox[{
       "\"\<First integral: \>\"", ",", " ", "firstint", ",", 
        "\"\< G.cm\>\""}], "]"}], ";", "\[IndentingNewLine]", 
      RowBox[{"Print", "[", 
       RowBox[{
       "\"\<Second integral: \>\"", ",", " ", "secondint", ",", 
        "\"\< T.cm\.b2\>\""}], "]"}], ";", "\[IndentingNewLine]", 
      "\[IndentingNewLine]", 
      RowBox[{"t1", "=", 
       RowBox[{"AbsoluteTime", "[", "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"Print", "[", 
       RowBox[{"\"\<IDFieldIntegrals: elapsed time = \>\"", ",", 
        RowBox[{"(", 
         RowBox[{"t1", "-", "t0"}], ")"}], ",", "\"\< s\>\""}], "]"}], ";", 
      "\[IndentingNewLine]", "\[IndentingNewLine]", 
      RowBox[{"Return", "[", 
       RowBox[{"{", 
        RowBox[{"firstint", ",", " ", "secondint"}], "}"}], "]"}], ";"}]}], 
    "\[IndentingNewLine]", "]"}]}], ";"}]}], "Input",
 CellChangeTimes->{{3.767447519038801*^9, 3.7674475570126853`*^9}, {
  3.7674478527196264`*^9, 3.767447856876173*^9}, {3.7674486002357836`*^9, 
  3.7674486471790524`*^9}},
 Background->RGBColor[0.87, 0.94, 1]]
}, Closed]],

Cell[CellGroupData[{

Cell["IDFieldMap", "Subsection",
 CellChangeTimes->{3.7667548871084976`*^9, 3.7674498548389435`*^9}],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"IDFieldMap", "::", "usage"}], " ", "=", " ", 
    "\"\<IDFieldMap[fieldmapname, ID, xrange, yrange, zrange, nx, ny, nz]: \
Applies the transformation for Sirius coordinate system convention and write \
the fieldmap to file.\>\""}], ";"}], 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"IDFieldMap", "[", 
    RowBox[{
    "fieldmapname_", ",", " ", "ID_", ",", "xrange_", ",", " ", "yrange_", 
     ",", " ", "zrange_", ",", " ", "nx_", ",", " ", "ny_", ",", " ", "nz_"}],
     " ", "]"}], " ", ":=", " ", 
   RowBox[{"Module", "[", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
      "fieldmap", ",", " ", "hmin", ",", " ", "hmax", ",", " ", "vmin", ",", 
       " ", "vmax", ",", " ", "smin", ",", " ", "smax", ",", "nh", ",", " ", 
       "nv", ",", " ", "ns", ",", " ", "hstep", ",", " ", "vstep", ",", " ", 
       "sstep", ",", " ", "h", ",", " ", "v", ",", " ", "s", ",", "  ", "i", 
       ",", " ", "j", ",", " ", "k", ",", "field", ",", " ", "line", ",", " ",
        "t0", ",", " ", "t1"}], "}"}], ",", "\[IndentingNewLine]", 
     "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"t0", "=", 
       RowBox[{"AbsoluteTime", "[", "]"}]}], ";", "\[IndentingNewLine]", 
      "\[IndentingNewLine]", 
      RowBox[{"(*", 
       RowBox[{
       "Conversion", " ", "for", " ", "coordinate", " ", "system", " ", 
        "with", " ", "z", " ", "as", " ", "the", " ", "longitudinal", " ", 
        "position", " ", 
        RowBox[{"(", 
         RowBox[{
          RowBox[{
           RowBox[{"x", "'"}], "=", " ", "x"}], ",", " ", 
          RowBox[{
           RowBox[{"y", "'"}], "=", " ", 
           RowBox[{"-", "z"}]}], ",", " ", 
          RowBox[{
           RowBox[{"z", "'"}], "=", " ", "y"}]}], ")"}]}], "*)"}], 
      "\[IndentingNewLine]", "\[IndentingNewLine]", 
      RowBox[{"fieldmap", "=", 
       RowBox[{"OpenWrite", "[", "fieldmapname", "]"}]}], ";", 
      "\[IndentingNewLine]", "\[IndentingNewLine]", 
      RowBox[{"hmin", " ", "=", 
       RowBox[{"xrange", "[", 
        RowBox[{"[", "1", "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"hmax", " ", "=", 
       RowBox[{"xrange", "[", 
        RowBox[{"[", "2", "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"nh", " ", "=", " ", "nx"}], ";", "\[IndentingNewLine]", 
      "\[IndentingNewLine]", 
      RowBox[{"vmin", " ", "=", 
       RowBox[{"-", 
        RowBox[{"zrange", "[", 
         RowBox[{"[", "2", "]"}], "]"}]}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"vmax", " ", "=", 
       RowBox[{"-", 
        RowBox[{"zrange", "[", 
         RowBox[{"[", "1", "]"}], "]"}]}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"nv", " ", "=", " ", "nz"}], ";", "\[IndentingNewLine]", 
      "\[IndentingNewLine]", 
      RowBox[{"smin", " ", "=", 
       RowBox[{"yrange", "[", 
        RowBox[{"[", "1", "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"smax", " ", "=", 
       RowBox[{"yrange", "[", 
        RowBox[{"[", "2", "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"ns", " ", "=", "ny"}], ";", "\[IndentingNewLine]", 
      "\[IndentingNewLine]", 
      RowBox[{"If", " ", "[", 
       RowBox[{
        RowBox[{"(", 
         RowBox[{"hmin", " ", "\[NotEqual]", " ", "hmax"}], ")"}], ",", 
        RowBox[{"hstep", " ", "=", " ", 
         RowBox[{
          RowBox[{"(", 
           RowBox[{"hmax", "-", "hmin"}], ")"}], "/", 
          RowBox[{"(", 
           RowBox[{"nh", "-", "1"}], ")"}]}]}], ",", " ", 
        RowBox[{"hstep", "=", "0"}]}], " ", "]"}], ";", "\[IndentingNewLine]", 
      RowBox[{"If", " ", "[", 
       RowBox[{
        RowBox[{"(", 
         RowBox[{"vmin", " ", "\[NotEqual]", " ", "vmax"}], ")"}], ",", 
        RowBox[{"vstep", " ", "=", " ", 
         RowBox[{
          RowBox[{"(", 
           RowBox[{"vmax", "-", "vmin"}], ")"}], "/", 
          RowBox[{"(", 
           RowBox[{"nv", "-", "1"}], ")"}]}]}], ",", " ", 
        RowBox[{"vstep", "=", "0"}]}], " ", "]"}], ";", "\[IndentingNewLine]", 
      RowBox[{"If", " ", "[", 
       RowBox[{
        RowBox[{"(", 
         RowBox[{"smin", " ", "\[NotEqual]", " ", "smax"}], ")"}], ",", 
        RowBox[{"sstep", " ", "=", " ", 
         RowBox[{
          RowBox[{"(", 
           RowBox[{"smax", "-", "smin"}], ")"}], "/", 
          RowBox[{"(", 
           RowBox[{"ns", "-", "1"}], ")"}]}]}], ",", " ", 
        RowBox[{"sstep", "=", "0"}]}], " ", "]"}], ";", "\[IndentingNewLine]",
       "\[IndentingNewLine]", 
      RowBox[{"WriteString", "[", 
       RowBox[{"fieldmap", ",", " ", 
        RowBox[{
        "\"\<X[mm]\>\"", "<>", " ", "\"\<\\t\>\"", "<>", " ", "\"\<Y[mm]\>\"",
          "<>", " ", "\"\<\\t\>\"", "<>", " ", "\"\<Z[mm]\>\"", "<>", " ", 
         "\"\<\\t\>\"", "<>", " ", "\"\<Bx[T]\>\"", "<>", " ", "\"\<\\t\>\"", 
         "<>", " ", "\"\<By[T]\>\"", "<>", " ", "\"\<\\t\>\"", "<>", " ", 
         "\"\<Bz[T]\>\"", "<>", "\"\<\\n\>\""}]}], "]"}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"WriteString", "[", 
       RowBox[{
       "fieldmap", ",", 
        "\"\<-----------------------------------------------------------------\
------------------------------------------------------------------------------\
-------------------\\n\>\""}], "]"}], ";", "\[IndentingNewLine]", 
      RowBox[{"For", "[", 
       RowBox[{
        RowBox[{"k", "=", "1"}], ",", 
        RowBox[{"k", "\[LessEqual]", "ns"}], ",", 
        RowBox[{"k", "++"}], ",", "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"For", "[", 
          RowBox[{
           RowBox[{"j", "=", "1"}], ",", 
           RowBox[{"j", "\[LessEqual]", "nv"}], ",", 
           RowBox[{"j", "++"}], ",", "\[IndentingNewLine]", 
           RowBox[{
            RowBox[{"For", "[", 
             RowBox[{
              RowBox[{"i", "=", "1"}], ",", 
              RowBox[{"i", "\[LessEqual]", "nh"}], ",", 
              RowBox[{"i", "++"}], ",", "\[IndentingNewLine]", 
              RowBox[{
               RowBox[{"h", " ", "=", " ", 
                RowBox[{"hmin", "+", 
                 RowBox[{
                  RowBox[{"(", 
                   RowBox[{"i", "-", "1"}], ")"}], "*", "hstep"}]}]}], ";", 
               "\[IndentingNewLine]", 
               RowBox[{"v", " ", "=", " ", 
                RowBox[{"vmax", "-", 
                 RowBox[{
                  RowBox[{"(", 
                   RowBox[{"j", "-", "1"}], ")"}], "*", "vstep"}]}]}], ";", 
               "\[IndentingNewLine]", 
               RowBox[{"s", " ", "=", " ", 
                RowBox[{"smin", "+", 
                 RowBox[{
                  RowBox[{"(", 
                   RowBox[{"k", "-", "1"}], ")"}], "*", "sstep"}]}]}], ";", 
               "\[IndentingNewLine]", 
               RowBox[{"field", " ", "=", " ", 
                RowBox[{"radFld", "[", 
                 RowBox[{"ID", ",", "\"\<b\>\"", ",", 
                  RowBox[{"{", 
                   RowBox[{"h", ",", "s", ",", "v"}], "}"}]}], "]"}]}], ";", 
               "\[IndentingNewLine]", 
               RowBox[{"line", " ", "=", 
                RowBox[{
                 RowBox[{"auxIDNumberToString", "[", "h", "]"}], "<>", " ", 
                 "\"\<\\t\>\"", " ", "<>", " ", 
                 RowBox[{"auxIDNumberToString", "[", 
                  RowBox[{"-", "v"}], "]"}], " ", "<>", " ", "\"\<\\t\>\"", 
                 " ", "<>", " ", 
                 RowBox[{"auxIDNumberToString", "[", "s", "]"}], " ", "<>", 
                 "\"\<\\t\>\"", " ", "<>", " ", 
                 RowBox[{"auxIDNumberToString", "[", 
                  RowBox[{"field", "[", 
                   RowBox[{"[", "1", "]"}], "]"}], "]"}], " ", "<>", " ", 
                 "\"\<\\t\>\"", " ", "<>", "  ", 
                 RowBox[{"auxIDNumberToString", "[", 
                  RowBox[{"-", 
                   RowBox[{"field", "[", 
                    RowBox[{"[", "3", "]"}], "]"}]}], "]"}], "<>", " ", 
                 "\"\<\\t\>\"", " ", "<>", "  ", 
                 RowBox[{"auxIDNumberToString", "[", 
                  RowBox[{"field", "[", 
                   RowBox[{"[", "2", "]"}], "]"}], "]"}], "<>", 
                 "\"\<\\n\>\""}]}], "  ", ";", " ", "\[IndentingNewLine]", 
               RowBox[{"WriteString", "[", 
                RowBox[{"fieldmap", ",", "line"}], "]"}], ";"}]}], 
             "\[IndentingNewLine]", "]"}], ";"}]}], "\[IndentingNewLine]", 
          "]"}], ";"}]}], "\[IndentingNewLine]", "]"}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"Close", "[", "fieldmap", "]"}], ";", "\[IndentingNewLine]", 
      RowBox[{"Print", "[", 
       RowBox[{"\"\<Fieldmap saved in file: \>\"", ",", " ", "fieldmapname"}],
        "]"}], ";", "\[IndentingNewLine]", "\[IndentingNewLine]", 
      RowBox[{"t1", "=", 
       RowBox[{"AbsoluteTime", "[", "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"Print", "[", 
       RowBox[{"\"\<IDFieldMap: elapsed time = \>\"", ",", 
        RowBox[{"(", 
         RowBox[{"t1", "-", "t0"}], ")"}], ",", "\"\< s\>\""}], "]"}], 
      ";"}]}], "\[IndentingNewLine]", "]"}]}], ";"}]}], "Input",
 CellChangeTimes->{{3.767447625002409*^9, 3.7674476715560517`*^9}, {
  3.7674478665175743`*^9, 3.7674478708460393`*^9}, {3.767449858932992*^9, 
  3.7674498711214747`*^9}},
 Background->RGBColor[0.87, 0.94, 1]]
}, Closed]],

Cell[CellGroupData[{

Cell["IDFieldMapNoTransf", "Subsection",
 CellChangeTimes->{{3.7667548871084976`*^9, 3.76675490671941*^9}, 
   3.767449882481743*^9}],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"IDFieldMapNoTransf", "::", "usage"}], " ", "=", " ", 
    "\"\<IDFieldMapNoTransf[fieldmapname, ID, xrange, yrange, zrange, nx, ny, \
nz]: Writes the fieldmap to file without any coordinate system \
transformation.\>\""}], ";"}], "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"IDFieldMapNoTransf", "[", 
    RowBox[{
    "fieldmapname_", ",", " ", "ID_", ",", "xrange_", ",", " ", "yrange_", 
     ",", " ", "zrange_", ",", " ", "nx_", ",", " ", "ny_", ",", " ", "nz_"}],
     " ", "]"}], " ", ":=", " ", 
   RowBox[{"Module", "[", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
      "fieldmap", ",", " ", "hmin", ",", " ", "hmax", ",", " ", "vmin", ",", 
       " ", "vmax", ",", " ", "smin", ",", " ", "smax", ",", "nh", ",", " ", 
       "nv", ",", " ", "ns", ",", " ", "hstep", ",", " ", "vstep", ",", " ", 
       "sstep", ",", " ", "h", ",", " ", "v", ",", " ", "s", ",", "  ", "i", 
       ",", " ", "j", ",", " ", "k", ",", "field", ",", " ", "line", ",", " ",
        "t0", ",", " ", "t1"}], "}"}], ",", "\[IndentingNewLine]", 
     "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"t0", "=", 
       RowBox[{"AbsoluteTime", "[", "]"}]}], ";", "\[IndentingNewLine]", 
      "\[IndentingNewLine]", 
      RowBox[{"fieldmap", "=", 
       RowBox[{"OpenWrite", "[", "fieldmapname", "]"}]}], ";", 
      "\[IndentingNewLine]", "\[IndentingNewLine]", 
      RowBox[{"hmin", " ", "=", 
       RowBox[{"xrange", "[", 
        RowBox[{"[", "1", "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"hmax", " ", "=", 
       RowBox[{"xrange", "[", 
        RowBox[{"[", "2", "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"nh", " ", "=", " ", "nx"}], ";", "\[IndentingNewLine]", 
      "\[IndentingNewLine]", 
      RowBox[{"vmin", " ", "=", 
       RowBox[{"yrange", "[", 
        RowBox[{"[", "1", "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"vmax", " ", "=", 
       RowBox[{"yrange", "[", 
        RowBox[{"[", "2", "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"nv", " ", "=", " ", "ny"}], ";", "\[IndentingNewLine]", 
      "\[IndentingNewLine]", 
      RowBox[{"smin", " ", "=", 
       RowBox[{"zrange", "[", 
        RowBox[{"[", "1", "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"smax", " ", "=", 
       RowBox[{"zrange", "[", 
        RowBox[{"[", "2", "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"ns", " ", "=", "nz"}], ";", "\[IndentingNewLine]", 
      "\[IndentingNewLine]", 
      RowBox[{"If", " ", "[", 
       RowBox[{
        RowBox[{"(", 
         RowBox[{"hmin", " ", "\[NotEqual]", " ", "hmax"}], ")"}], ",", 
        RowBox[{"hstep", " ", "=", " ", 
         RowBox[{
          RowBox[{"(", 
           RowBox[{"hmax", "-", "hmin"}], ")"}], "/", 
          RowBox[{"(", 
           RowBox[{"nh", "-", "1"}], ")"}]}]}], ",", " ", 
        RowBox[{"hstep", "=", "0"}]}], " ", "]"}], ";", "\[IndentingNewLine]", 
      RowBox[{"If", " ", "[", 
       RowBox[{
        RowBox[{"(", 
         RowBox[{"vmin", " ", "\[NotEqual]", " ", "vmax"}], ")"}], ",", 
        RowBox[{"vstep", " ", "=", " ", 
         RowBox[{
          RowBox[{"(", 
           RowBox[{"vmax", "-", "vmin"}], ")"}], "/", 
          RowBox[{"(", 
           RowBox[{"nv", "-", "1"}], ")"}]}]}], ",", " ", 
        RowBox[{"vstep", "=", "0"}]}], " ", "]"}], ";", "\[IndentingNewLine]", 
      RowBox[{"If", " ", "[", 
       RowBox[{
        RowBox[{"(", 
         RowBox[{"smin", " ", "\[NotEqual]", " ", "smax"}], ")"}], ",", 
        RowBox[{"sstep", " ", "=", " ", 
         RowBox[{
          RowBox[{"(", 
           RowBox[{"smax", "-", "smin"}], ")"}], "/", 
          RowBox[{"(", 
           RowBox[{"ns", "-", "1"}], ")"}]}]}], ",", " ", 
        RowBox[{"sstep", "=", "0"}]}], " ", "]"}], ";", "\[IndentingNewLine]",
       "\[IndentingNewLine]", 
      RowBox[{"WriteString", "[", 
       RowBox[{"fieldmap", ",", " ", 
        RowBox[{
        "\"\<X[mm]\>\"", "<>", " ", "\"\<\\t\>\"", "<>", " ", "\"\<Y[mm]\>\"",
          "<>", " ", "\"\<\\t\>\"", "<>", " ", "\"\<Z[mm]\>\"", "<>", " ", 
         "\"\<\\t\>\"", "<>", " ", "\"\<Bx[T]\>\"", "<>", " ", "\"\<\\t\>\"", 
         "<>", " ", "\"\<By[T]\>\"", "<>", " ", "\"\<\\t\>\"", "<>", " ", 
         "\"\<Bz[T]\>\"", "<>", "\"\<\\n\>\""}]}], "]"}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"WriteString", "[", 
       RowBox[{
       "fieldmap", ",", 
        "\"\<-----------------------------------------------------------------\
------------------------------------------------------------------------------\
-------------------\\n\>\""}], "]"}], ";", "\[IndentingNewLine]", 
      RowBox[{"For", "[", 
       RowBox[{
        RowBox[{"k", "=", "1"}], ",", 
        RowBox[{"k", "\[LessEqual]", "ns"}], ",", 
        RowBox[{"k", "++"}], ",", "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"For", "[", 
          RowBox[{
           RowBox[{"j", "=", "1"}], ",", 
           RowBox[{"j", "\[LessEqual]", "nv"}], ",", 
           RowBox[{"j", "++"}], ",", "\[IndentingNewLine]", 
           RowBox[{
            RowBox[{"For", "[", 
             RowBox[{
              RowBox[{"i", "=", "1"}], ",", 
              RowBox[{"i", "\[LessEqual]", "nh"}], ",", 
              RowBox[{"i", "++"}], ",", "\[IndentingNewLine]", 
              RowBox[{
               RowBox[{"h", " ", "=", " ", 
                RowBox[{"hmin", "+", 
                 RowBox[{
                  RowBox[{"(", 
                   RowBox[{"i", "-", "1"}], ")"}], "*", "hstep"}]}]}], ";", 
               "\[IndentingNewLine]", 
               RowBox[{"v", " ", "=", " ", 
                RowBox[{"vmax", "+", 
                 RowBox[{
                  RowBox[{"(", 
                   RowBox[{"j", "-", "1"}], ")"}], "*", "vstep"}]}]}], ";", 
               "\[IndentingNewLine]", 
               RowBox[{"s", " ", "=", " ", 
                RowBox[{"smin", "+", 
                 RowBox[{
                  RowBox[{"(", 
                   RowBox[{"k", "-", "1"}], ")"}], "*", "sstep"}]}]}], ";", 
               "\[IndentingNewLine]", 
               RowBox[{"field", " ", "=", " ", 
                RowBox[{"radFld", "[", 
                 RowBox[{"ID", ",", "\"\<b\>\"", ",", 
                  RowBox[{"{", 
                   RowBox[{"h", ",", "s", ",", "v"}], "}"}]}], "]"}]}], ";", 
               "\[IndentingNewLine]", 
               RowBox[{"line", " ", "=", 
                RowBox[{
                 RowBox[{"auxIDNumberToString", "[", "h", "]"}], "<>", " ", 
                 "\"\<\\t\>\"", " ", "<>", " ", 
                 RowBox[{"auxIDNumberToString", "[", 
                  RowBox[{"-", "v"}], "]"}], " ", "<>", " ", "\"\<\\t\>\"", 
                 " ", "<>", " ", 
                 RowBox[{"auxIDNumberToString", "[", "s", "]"}], " ", "<>", 
                 "\"\<\\t\>\"", " ", "<>", " ", 
                 RowBox[{"auxIDNumberToString", "[", 
                  RowBox[{"field", "[", 
                   RowBox[{"[", "1", "]"}], "]"}], "]"}], " ", "<>", " ", 
                 "\"\<\\t\>\"", " ", "<>", "  ", 
                 RowBox[{"auxIDNumberToString", "[", 
                  RowBox[{"-", 
                   RowBox[{"field", "[", 
                    RowBox[{"[", "3", "]"}], "]"}]}], "]"}], "<>", " ", 
                 "\"\<\\t\>\"", " ", "<>", "  ", 
                 RowBox[{"auxIDNumberToString", "[", 
                  RowBox[{"field", "[", 
                   RowBox[{"[", "2", "]"}], "]"}], "]"}], "<>", 
                 "\"\<\\n\>\""}]}], "  ", ";", " ", "\[IndentingNewLine]", 
               RowBox[{"WriteString", "[", 
                RowBox[{"fieldmap", ",", "line"}], "]"}], ";"}]}], 
             "\[IndentingNewLine]", "]"}], ";"}]}], "\[IndentingNewLine]", 
          "]"}], ";"}]}], "\[IndentingNewLine]", "]"}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"Close", "[", "fieldmap", "]"}], ";", "\[IndentingNewLine]", 
      RowBox[{"Print", "[", 
       RowBox[{"\"\<Fieldmap saved in file: \>\"", ",", " ", "fieldmapname"}],
        "]"}], ";", "\[IndentingNewLine]", "\[IndentingNewLine]", 
      RowBox[{"t1", "=", 
       RowBox[{"AbsoluteTime", "[", "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"Print", "[", 
       RowBox[{"\"\<IDFieldMapNoTransf: elapsed time = \>\"", ",", 
        RowBox[{"(", 
         RowBox[{"t1", "-", "t0"}], ")"}], ",", "\"\< s\>\""}], "]"}], 
      ";"}]}], "\[IndentingNewLine]", "]"}]}], ";"}]}], "Input",
 CellChangeTimes->{{3.767447676712742*^9, 3.7674476901356754`*^9}, {
  3.767447877752833*^9, 3.7674478819250393`*^9}, {3.7674498877634153`*^9, 
  3.7674499000768747`*^9}},
 Background->RGBColor[0.87, 0.94, 1]]
}, Closed]],

Cell[CellGroupData[{

Cell["IDRungeKuttaTrajectory", "Subsection",
 CellChangeTimes->{{3.7667548871084976`*^9, 3.76675490671941*^9}, 
   3.7667549708182*^9}],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"IDRungeKuttaTrajectory", "::", "usage"}], " ", "=", " ", 
    "\"\<IDRungeKuttaTrajectory[ID, energy, r0, smax, rkstep]: Calculates the \
particle trajectory using the Runge-Kutta algorithm. The particle energy must \
be in GeV, r0 is the initial position and normalized momentum vector {x0, y0, \
z0, dx0ds, dy0ds, dz0ds}, smax and rkstep are the final longitudinal position \
and the Runge-Kutta step. All positions are in millimeters.\>\""}], ";"}], 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"IDRungeKuttaTrajectory", "[", 
    RowBox[{
    "ID_", ",", " ", "energy_", ",", "r0_", ",", "smax_", ",", "rkstep_"}], 
    "]"}], " ", ":=", " ", 
   RowBox[{"Module", "[", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
      "trajectory", ",", " ", "ElectronRestEnergy", ",", " ", "LightSpeed", 
       ",", " ", "beta", ",", " ", "brho", ",", " ", "a", ",", " ", "b", ",", 
       " ", "b1", ",", " ", "b2", ",", " ", "b3", ",", " ", "r", ",", " ", 
       "r1", ",", " ", "r2", ",", " ", "r3", ",", " ", "drds1", ",", " ", 
       "drds2", ",", " ", "drds3", ",", " ", "drds4", ",", " ", "i", ",", " ",
        "sm", ",", " ", "step", ",", " ", "t0", ",", " ", "t1"}], "}"}], ",", 
     "\n", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"t0", "=", 
       RowBox[{"AbsoluteTime", "[", "]"}]}], ";", "\[IndentingNewLine]", 
      "\[IndentingNewLine]", 
      RowBox[{"ElectronRestEnergy", "=", "510998.92811"}], ";", " ", 
      RowBox[{"(*", 
       RowBox[{"[", "eV", "]"}], "*)"}], "\[IndentingNewLine]", 
      RowBox[{"LightSpeed", "=", "299792458"}], ";", 
      RowBox[{"(*", 
       RowBox[{"[", 
        RowBox[{"m", "/", "s"}], "]"}], "*)"}], "\[IndentingNewLine]", 
      "\[IndentingNewLine]", 
      RowBox[{"r1", " ", "=", " ", 
       RowBox[{"{", 
        RowBox[{"0", ",", "0", ",", "0", ",", "0", ",", "0", ",", "0"}], 
        "}"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"r2", " ", "=", " ", 
       RowBox[{"{", 
        RowBox[{"0", ",", "0", ",", "0", ",", "0", ",", "0", ",", "0"}], 
        "}"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"r3", " ", "=", " ", 
       RowBox[{"{", 
        RowBox[{"0", ",", "0", ",", "0", ",", "0", ",", "0", ",", "0"}], 
        "}"}]}], ";", "\[IndentingNewLine]", "\[IndentingNewLine]", 
      RowBox[{"(*", 
       RowBox[{"from", " ", "GeV", " ", "to", " ", "eV"}], "*)"}], 
      "\[IndentingNewLine]", 
      RowBox[{"beta", "=", 
       RowBox[{"Sqrt", "[", 
        RowBox[{"1.0", "-", 
         RowBox[{"(", 
          RowBox[{"1.0", "/", 
           RowBox[{"(", 
            RowBox[{
             RowBox[{"(", 
              RowBox[{"energy", "*", 
               RowBox[{"1000000000", "/", "ElectronRestEnergy"}]}], ")"}], 
             "^", "2"}], ")"}]}], ")"}]}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"brho", "=", 
       RowBox[{"(", 
        RowBox[{"beta", "*", "energy", "*", 
         RowBox[{"1000000000", "/", "LightSpeed"}]}], ")"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"a", "=", 
       RowBox[{
        RowBox[{"1.0", "/", "brho"}], "/", "beta"}]}], ";", 
      "\[IndentingNewLine]", "\[IndentingNewLine]", 
      RowBox[{"r", "=", " ", "r0"}], ";", "\[IndentingNewLine]", 
      "\[IndentingNewLine]", 
      RowBox[{"(*", 
       RowBox[{"from", " ", "mm", " ", "to", " ", "m"}], "*)"}], 
      "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"r", "[", 
        RowBox[{"[", "1", "]"}], "]"}], "=", " ", 
       RowBox[{
        RowBox[{"r", "[", 
         RowBox[{"[", "1", "]"}], "]"}], "/", "1000"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"r", "[", 
        RowBox[{"[", "2", "]"}], "]"}], "=", " ", 
       RowBox[{
        RowBox[{"r", "[", 
         RowBox[{"[", "2", "]"}], "]"}], "/", "1000"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"r", "[", 
        RowBox[{"[", "3", "]"}], "]"}], "=", " ", 
       RowBox[{
        RowBox[{"r", "[", 
         RowBox[{"[", "3", "]"}], "]"}], "/", "1000"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"sm", " ", "=", " ", 
       RowBox[{"smax", "/", "1000"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"step", " ", "=", " ", 
       RowBox[{"rkstep", "/", "1000"}]}], ";", "\[IndentingNewLine]", 
      "\[IndentingNewLine]", 
      RowBox[{"trajectory", "=", 
       RowBox[{"{", "}"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"AppendTo", "[", 
       RowBox[{"trajectory", ",", " ", 
        RowBox[{"{", 
         RowBox[{
          RowBox[{
           RowBox[{"r", "[", 
            RowBox[{"[", "1", "]"}], "]"}], "*", "1000"}], ",", " ", 
          RowBox[{
           RowBox[{"r", "[", 
            RowBox[{"[", "2", "]"}], "]"}], "*", "1000"}], ",", " ", 
          RowBox[{
           RowBox[{"r", "[", 
            RowBox[{"[", "3", "]"}], "]"}], "*", "1000"}], ",", " ", 
          RowBox[{"r", "[", 
           RowBox[{"[", "4", "]"}], "]"}], ",", " ", 
          RowBox[{"r", "[", 
           RowBox[{"[", "5", "]"}], "]"}], ",", " ", 
          RowBox[{"r", "[", 
           RowBox[{"[", "6", "]"}], "]"}]}], "}"}]}], "]"}], ";", 
      "\[IndentingNewLine]", "\[IndentingNewLine]", 
      RowBox[{"While", " ", "[", 
       RowBox[{
        RowBox[{
         RowBox[{"r", "[", 
          RowBox[{"[", "2", "]"}], "]"}], "<", "sm"}], ",", 
        "\[IndentingNewLine]", "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"b", "=", 
          RowBox[{"radFld", "[", 
           RowBox[{"ID", ",", " ", "\"\<BxByBz\>\"", ",", " ", 
            RowBox[{"1000", "*", 
             RowBox[{"r", "[", 
              RowBox[{"[", 
               RowBox[{";;", "3"}], "]"}], "]"}]}]}], "]"}]}], ";", "\n", 
         "\t", 
         RowBox[{"drds1", "=", 
          RowBox[{"auxIDNewtonLorentzEquation", "[", 
           RowBox[{"a", ",", "r", ",", "b"}], "]"}]}], ";", 
         "\[IndentingNewLine]", 
         RowBox[{"For", " ", "[", 
          RowBox[{
           RowBox[{"i", "=", "1"}], ",", " ", 
           RowBox[{"i", "\[LessEqual]", "6"}], ",", " ", 
           RowBox[{"i", "++"}], ",", 
           RowBox[{
            RowBox[{"r1", "[", 
             RowBox[{"[", "i", "]"}], "]"}], "=", 
            RowBox[{
             RowBox[{"r", "[", 
              RowBox[{"[", "i", "]"}], "]"}], "+", 
             RowBox[{
              RowBox[{"(", 
               RowBox[{"step", "/", "2.0"}], ")"}], "*", 
              RowBox[{"drds1", "[", 
               RowBox[{"[", "i", "]"}], "]"}]}]}]}]}], "]"}], ";", 
         "\[IndentingNewLine]", "\[IndentingNewLine]", 
         RowBox[{"b1", "=", 
          RowBox[{"radFld", "[", 
           RowBox[{"ID", ",", " ", "\"\<BxByBz\>\"", ",", " ", 
            RowBox[{"1000", "*", 
             RowBox[{"r1", "[", 
              RowBox[{"[", 
               RowBox[{";;", "3"}], "]"}], "]"}]}]}], "]"}]}], ";", "\n", 
         "\t", 
         RowBox[{"drds2", "=", 
          RowBox[{"auxIDNewtonLorentzEquation", "[", 
           RowBox[{"a", ",", "r1", ",", "b1"}], "]"}]}], ";", 
         "\[IndentingNewLine]", 
         RowBox[{"For", "[", 
          RowBox[{
           RowBox[{"i", "=", "1"}], ",", " ", 
           RowBox[{"i", "\[LessEqual]", "6"}], ",", " ", 
           RowBox[{"i", "++"}], ",", 
           RowBox[{
            RowBox[{"r2", "[", 
             RowBox[{"[", "i", "]"}], "]"}], "=", 
            RowBox[{
             RowBox[{"r", "[", 
              RowBox[{"[", "i", "]"}], "]"}], "+", 
             RowBox[{
              RowBox[{"(", 
               RowBox[{"step", "/", "2.0"}], ")"}], "*", 
              RowBox[{"drds2", "[", 
               RowBox[{"[", "i", "]"}], "]"}]}]}]}]}], "]"}], ";", 
         "\[IndentingNewLine]", "\[IndentingNewLine]", 
         RowBox[{"b2", "=", 
          RowBox[{"radFld", "[", 
           RowBox[{"ID", ",", " ", "\"\<BxByBz\>\"", ",", " ", 
            RowBox[{"1000", "*", 
             RowBox[{"r2", "[", 
              RowBox[{"[", 
               RowBox[{";;", "3"}], "]"}], "]"}]}]}], "]"}]}], ";", 
         "\[IndentingNewLine]", 
         RowBox[{"drds3", "=", 
          RowBox[{"auxIDNewtonLorentzEquation", "[", 
           RowBox[{"a", ",", "r2", ",", "b2"}], "]"}]}], ";", 
         "\[IndentingNewLine]", 
         RowBox[{"For", "[", 
          RowBox[{
           RowBox[{"i", "=", "1"}], ",", " ", 
           RowBox[{"i", "\[LessEqual]", " ", "6"}], ",", " ", 
           RowBox[{"i", "++"}], ",", " ", 
           RowBox[{
            RowBox[{"r3", "[", 
             RowBox[{"[", "i", "]"}], "]"}], "=", 
            RowBox[{
             RowBox[{"r", "[", 
              RowBox[{"[", "i", "]"}], "]"}], "+", 
             RowBox[{"step", "*", 
              RowBox[{"drds3", "[", 
               RowBox[{"[", "i", "]"}], "]"}]}]}]}]}], "]"}], ";", 
         "\[IndentingNewLine]", "\[IndentingNewLine]", 
         RowBox[{"b3", "=", 
          RowBox[{"radFld", "[", 
           RowBox[{"ID", ",", " ", "\"\<BxByBz\>\"", ",", " ", 
            RowBox[{"1000", "*", 
             RowBox[{"r3", "[", 
              RowBox[{"[", 
               RowBox[{";;", "3"}], "]"}], "]"}]}]}], "]"}]}], ";", 
         "\[IndentingNewLine]", 
         RowBox[{"drds4", "=", 
          RowBox[{"auxIDNewtonLorentzEquation", "[", 
           RowBox[{"a", ",", "r3", ",", "b3"}], "]"}]}], ";", 
         "\[IndentingNewLine]", "\[IndentingNewLine]", 
         RowBox[{"For", " ", "[", 
          RowBox[{
           RowBox[{"i", "=", "1"}], ",", " ", 
           RowBox[{"i", "\[LessEqual]", "6"}], ",", " ", 
           RowBox[{"i", "++"}], ",", " ", 
           RowBox[{
            RowBox[{"r", "[", 
             RowBox[{"[", "i", "]"}], "]"}], "=", 
            RowBox[{
             RowBox[{"r", "[", 
              RowBox[{"[", "i", "]"}], "]"}], "+", 
             RowBox[{
              RowBox[{"(", 
               RowBox[{"step", "/", "6.0"}], ")"}], "*", 
              RowBox[{"(", 
               RowBox[{
                RowBox[{"drds1", "[", 
                 RowBox[{"[", "i", "]"}], "]"}], "+", 
                RowBox[{"2.0", "*", 
                 RowBox[{"drds2", "[", 
                  RowBox[{"[", "i", "]"}], "]"}]}], "+", 
                RowBox[{"2.0", "*", 
                 RowBox[{"drds3", "[", 
                  RowBox[{"[", "i", "]"}], "]"}]}], "+", 
                RowBox[{"drds4", "[", 
                 RowBox[{"[", "i", "]"}], "]"}]}], ")"}]}]}]}]}], "]"}], ";", 
         "\[IndentingNewLine]", "\[IndentingNewLine]", 
         RowBox[{"AppendTo", "[", 
          RowBox[{"trajectory", ",", " ", 
           RowBox[{"{", 
            RowBox[{
             RowBox[{
              RowBox[{"r", "[", 
               RowBox[{"[", "1", "]"}], "]"}], "*", "1000"}], ",", " ", 
             RowBox[{
              RowBox[{"r", "[", 
               RowBox[{"[", "2", "]"}], "]"}], "*", "1000"}], ",", " ", 
             RowBox[{
              RowBox[{"r", "[", 
               RowBox[{"[", "3", "]"}], "]"}], "*", "1000"}], ",", " ", 
             RowBox[{"r", "[", 
              RowBox[{"[", "4", "]"}], "]"}], ",", " ", 
             RowBox[{"r", "[", 
              RowBox[{"[", "5", "]"}], "]"}], ",", " ", 
             RowBox[{"r", "[", 
              RowBox[{"[", "6", "]"}], "]"}]}], "}"}]}], "]"}], ";"}]}], 
       "\[IndentingNewLine]", "]"}], ";", "\[IndentingNewLine]", 
      "\[IndentingNewLine]", 
      RowBox[{"t1", "=", 
       RowBox[{"AbsoluteTime", "[", "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"Print", "[", 
       RowBox[{"\"\<IDRungeKuttaTrajectory: elapsed time = \>\"", ",", 
        RowBox[{"(", 
         RowBox[{"t1", "-", "t0"}], ")"}], ",", "\"\< s\>\""}], "]"}], ";", 
      "\[IndentingNewLine]", "\[IndentingNewLine]", 
      RowBox[{"Return", "[", "trajectory", "]"}], ";"}]}], 
    "\[IndentingNewLine]", "]"}]}], ";"}]}], "Input",
 CellChangeTimes->{{3.76744770185725*^9, 3.767447715061404*^9}, {
  3.7674478894725156`*^9, 3.7674478930665445`*^9}},
 Background->RGBColor[0.87, 0.94, 1]]
}, Closed]],

Cell[CellGroupData[{

Cell["IDPlotRungeKuttaTrajectory", "Subsection",
 CellChangeTimes->{{3.7667548871084976`*^9, 3.76675490671941*^9}, 
   3.7667549708182*^9, {3.766755041776903*^9, 3.7667550428863707`*^9}}],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"IDPlotRungeKuttaTrajectory", "::", "usage"}], " ", "=", " ", 
    "\"\<IDPlotRungeKuttaTrajectory[trajectory, s:\\\"y\\\"]: Plot the \
electron trajectory.\>\""}], ";"}], 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"IDPlotRungeKuttaTrajectory", "[", 
    RowBox[{"trajectory_", ",", " ", 
     RowBox[{"s_:", "\"\<y\>\""}]}], "]"}], " ", ":=", " ", 
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
      "plots", ",", " ", "x", ",", " ", "y", ",", " ", "z", ",", " ", "t0", 
       ",", " ", "t1"}], "}"}], ",", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"t0", "=", 
       RowBox[{"AbsoluteTime", "[", "]"}]}], ";", "\[IndentingNewLine]", 
      "\[IndentingNewLine]", 
      RowBox[{"plots", " ", "=", " ", 
       RowBox[{"{", "}"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"x", "=", " ", 
       RowBox[{"trajectory", "[", 
        RowBox[{"[", 
         RowBox[{"All", ",", " ", "1"}], "]"}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"y", " ", "=", " ", 
       RowBox[{"trajectory", "[", 
        RowBox[{"[", 
         RowBox[{"All", ",", " ", "2"}], "]"}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"z", " ", "=", " ", 
       RowBox[{"trajectory", "[", 
        RowBox[{"[", 
         RowBox[{"All", ",", " ", "3"}], "]"}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"If", "[", 
       RowBox[{
        RowBox[{"s", " ", "\[Equal]", " ", "\"\<x\>\""}], ",", 
        "\[IndentingNewLine]", 
        RowBox[{"(", 
         RowBox[{
          RowBox[{"AppendTo", "[", 
           RowBox[{"plots", ",", 
            RowBox[{"ListPlot", "[", 
             RowBox[{
              RowBox[{"Transpose", "@", 
               RowBox[{"{", 
                RowBox[{"x", ",", " ", 
                 RowBox[{"y", "*", "1000"}]}], "}"}]}], ",", " ", 
              RowBox[{"PlotRange", "\[Rule]", " ", 
               RowBox[{"{", 
                RowBox[{"All", ",", " ", "All"}], "}"}]}], ",", 
              RowBox[{"PlotTheme", "\[Rule]", "\"\<Detailed\>\""}], ",", " ", 
              
              RowBox[{"Joined", "\[Rule]", "True"}], ",", " ", 
              RowBox[{"FrameLabel", "\[Rule]", 
               RowBox[{"{", 
                RowBox[{"\"\<x [mm]\>\"", ",", "\"\<y [\[Mu]m]\>\""}], 
                "}"}]}]}], "]"}]}], "]"}], ";", "\[IndentingNewLine]", 
          RowBox[{"AppendTo", "[", 
           RowBox[{"plots", ",", 
            RowBox[{"ListPlot", "[", 
             RowBox[{
              RowBox[{"Transpose", "@", 
               RowBox[{"{", 
                RowBox[{"x", ",", " ", 
                 RowBox[{"z", "*", "1000"}]}], "}"}]}], ",", " ", 
              RowBox[{"PlotRange", "\[Rule]", " ", 
               RowBox[{"{", 
                RowBox[{"All", ",", " ", "All"}], "}"}]}], ",", 
              RowBox[{"PlotTheme", "\[Rule]", "\"\<Detailed\>\""}], ",", " ", 
              
              RowBox[{"Joined", "\[Rule]", "True"}], ",", " ", 
              RowBox[{"FrameLabel", "\[Rule]", 
               RowBox[{"{", 
                RowBox[{"\"\<x [mm]\>\"", ",", "\"\<z [\[Mu]m]\>\""}], 
                "}"}]}]}], "]"}]}], "]"}], ";"}], ")"}]}], 
       "\[IndentingNewLine]", "]"}], ";", "\[IndentingNewLine]", 
      RowBox[{"If", "[", 
       RowBox[{
        RowBox[{"s", " ", "\[Equal]", " ", "\"\<y\>\""}], ",", 
        "\[IndentingNewLine]", 
        RowBox[{"(", 
         RowBox[{
          RowBox[{"AppendTo", "[", 
           RowBox[{"plots", ",", 
            RowBox[{"ListPlot", "[", 
             RowBox[{
              RowBox[{"Transpose", "@", 
               RowBox[{"{", 
                RowBox[{"y", ",", " ", 
                 RowBox[{"x", "*", "1000"}]}], "}"}]}], ",", " ", 
              RowBox[{"PlotRange", "\[Rule]", " ", 
               RowBox[{"{", 
                RowBox[{"All", ",", " ", "All"}], "}"}]}], ",", 
              RowBox[{"PlotTheme", "\[Rule]", "\"\<Detailed\>\""}], ",", " ", 
              
              RowBox[{"Joined", "\[Rule]", "True"}], ",", " ", 
              RowBox[{"FrameLabel", "\[Rule]", 
               RowBox[{"{", 
                RowBox[{"\"\<y [mm]\>\"", ",", "\"\<x [\[Mu]m]\>\""}], 
                "}"}]}]}], "]"}]}], "]"}], ";", "\[IndentingNewLine]", 
          RowBox[{"AppendTo", "[", 
           RowBox[{"plots", ",", 
            RowBox[{"ListPlot", "[", 
             RowBox[{
              RowBox[{"Transpose", "@", 
               RowBox[{"{", 
                RowBox[{"y", ",", " ", 
                 RowBox[{"z", "*", "1000"}]}], "}"}]}], ",", " ", 
              RowBox[{"PlotRange", "\[Rule]", " ", 
               RowBox[{"{", 
                RowBox[{"All", ",", " ", "All"}], "}"}]}], ",", 
              RowBox[{"PlotTheme", "\[Rule]", "\"\<Detailed\>\""}], ",", " ", 
              
              RowBox[{"Joined", "\[Rule]", "True"}], ",", " ", 
              RowBox[{"FrameLabel", "\[Rule]", 
               RowBox[{"{", 
                RowBox[{"\"\<y [mm]\>\"", ",", "\"\<z [\[Mu]m]\>\""}], 
                "}"}]}]}], "]"}]}], "]"}], ";"}], ")"}]}], 
       "\[IndentingNewLine]", "]"}], ";", "\[IndentingNewLine]", 
      RowBox[{"If", "[", 
       RowBox[{
        RowBox[{"s", " ", "\[Equal]", " ", "\"\<z\>\""}], ",", 
        "\[IndentingNewLine]", 
        RowBox[{"(", 
         RowBox[{
          RowBox[{"AppendTo", "[", 
           RowBox[{"plots", ",", 
            RowBox[{"ListPlot", "[", 
             RowBox[{
              RowBox[{"Transpose", "@", 
               RowBox[{"{", 
                RowBox[{"z", ",", " ", 
                 RowBox[{"x", "*", "1000"}]}], "}"}]}], ",", " ", 
              RowBox[{"PlotRange", "\[Rule]", " ", 
               RowBox[{"{", 
                RowBox[{"All", ",", " ", "All"}], "}"}]}], ",", 
              RowBox[{"PlotTheme", "\[Rule]", "\"\<Detailed\>\""}], ",", " ", 
              
              RowBox[{"Joined", "\[Rule]", "True"}], ",", " ", 
              RowBox[{"FrameLabel", "\[Rule]", 
               RowBox[{"{", 
                RowBox[{"\"\<z [mm]\>\"", ",", "\"\<x [\[Mu]m]\>\""}], 
                "}"}]}]}], "]"}]}], "]"}], ";", "\[IndentingNewLine]", 
          RowBox[{"AppendTo", "[", 
           RowBox[{"plots", ",", 
            RowBox[{"ListPlot", "[", 
             RowBox[{
              RowBox[{"Transpose", "@", 
               RowBox[{"{", 
                RowBox[{"z", ",", " ", 
                 RowBox[{"y", "*", "1000"}]}], "}"}]}], ",", " ", 
              RowBox[{"PlotRange", "\[Rule]", " ", 
               RowBox[{"{", 
                RowBox[{"All", ",", " ", "All"}], "}"}]}], ",", 
              RowBox[{"PlotTheme", "\[Rule]", "\"\<Detailed\>\""}], ",", " ", 
              
              RowBox[{"Joined", "\[Rule]", "True"}], ",", " ", 
              RowBox[{"FrameLabel", "\[Rule]", 
               RowBox[{"{", 
                RowBox[{"\"\<z [mm]\>\"", ",", "\"\<y [\[Mu]m]\>\""}], 
                "}"}]}]}], "]"}]}], "]"}], ";"}], ")"}]}], 
       "\[IndentingNewLine]", "]"}], ";", "\[IndentingNewLine]", 
      "\[IndentingNewLine]", 
      RowBox[{"t1", "=", 
       RowBox[{"AbsoluteTime", "[", "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"Print", "[", 
       RowBox[{"\"\<IDPlotRungeKuttaTrajectory: elapsed time = \>\"", ",", 
        RowBox[{"(", 
         RowBox[{"t1", "-", "t0"}], ")"}], ",", "\"\< s\>\""}], "]"}], ";", 
      "\[IndentingNewLine]", "\[IndentingNewLine]", 
      RowBox[{"Return", "[", "plots", "]"}], ";"}]}], "\[IndentingNewLine]", 
    "]"}]}], ";"}]}], "Input",
 CellChangeTimes->{{3.767447724265257*^9, 3.7674477376412992`*^9}, {
  3.767447904067401*^9, 3.7674479092240562`*^9}},
 Background->RGBColor[0.87, 0.94, 1]]
}, Closed]],

Cell[CellGroupData[{

Cell["IDPlotRadFldPtcTrj", "Subsection",
 CellChangeTimes->{{3.7667548871084976`*^9, 3.76675490671941*^9}, 
   3.7667549708182*^9, {3.766755041776903*^9, 3.7667550428863707`*^9}, 
   3.7667550770140467`*^9}],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"IDPlotRadFldPtcTrj", "::", "usage"}], " ", "=", " ", 
    "\"\<IDPlotRadFldPtcTrj[trajectory, s:\\\"y\\\"]: Plot the electron \
trajectory.\>\""}], ";"}], "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"IDPlotRadFldPtcTrj", "[", 
    RowBox[{"trajectory_", ",", " ", 
     RowBox[{"s_:", "\"\<y\>\""}]}], "]"}], " ", ":=", " ", 
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
      "plots", ",", " ", "x", ",", " ", "y", ",", " ", "z", ",", " ", "t1", 
       ",", " ", "t0"}], "}"}], ",", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"t0", "=", 
       RowBox[{"AbsoluteTime", "[", "]"}]}], ";", "\[IndentingNewLine]", 
      "\[IndentingNewLine]", 
      RowBox[{"plots", " ", "=", " ", 
       RowBox[{"{", "}"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"y", "=", " ", 
       RowBox[{"trajectory", "[", 
        RowBox[{"[", 
         RowBox[{"All", ",", " ", "1"}], "]"}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"x", " ", "=", " ", 
       RowBox[{"trajectory", "[", 
        RowBox[{"[", 
         RowBox[{"All", ",", " ", "2"}], "]"}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"z", " ", "=", " ", 
       RowBox[{"trajectory", "[", 
        RowBox[{"[", 
         RowBox[{"All", ",", " ", "4"}], "]"}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"If", "[", 
       RowBox[{
        RowBox[{"s", " ", "\[Equal]", " ", "\"\<x\>\""}], ",", 
        "\[IndentingNewLine]", 
        RowBox[{"(", 
         RowBox[{
          RowBox[{"AppendTo", "[", 
           RowBox[{"plots", ",", 
            RowBox[{"ListPlot", "[", 
             RowBox[{
              RowBox[{"Transpose", "@", 
               RowBox[{"{", 
                RowBox[{"x", ",", " ", 
                 RowBox[{"y", "*", "1000"}]}], "}"}]}], ",", " ", 
              RowBox[{"PlotRange", "\[Rule]", " ", 
               RowBox[{"{", 
                RowBox[{"All", ",", " ", "All"}], "}"}]}], ",", 
              RowBox[{"PlotTheme", "\[Rule]", "\"\<Detailed\>\""}], ",", " ", 
              
              RowBox[{"Joined", "\[Rule]", "True"}], ",", " ", 
              RowBox[{"FrameLabel", "\[Rule]", 
               RowBox[{"{", 
                RowBox[{"\"\<x [mm]\>\"", ",", "\"\<y [\[Mu]m]\>\""}], 
                "}"}]}]}], "]"}]}], "]"}], ";", "\[IndentingNewLine]", 
          RowBox[{"AppendTo", "[", 
           RowBox[{"plots", ",", 
            RowBox[{"ListPlot", "[", 
             RowBox[{
              RowBox[{"Transpose", "@", 
               RowBox[{"{", 
                RowBox[{"x", ",", " ", 
                 RowBox[{"z", "*", "1000"}]}], "}"}]}], ",", " ", 
              RowBox[{"PlotRange", "\[Rule]", " ", 
               RowBox[{"{", 
                RowBox[{"All", ",", " ", "All"}], "}"}]}], ",", 
              RowBox[{"PlotTheme", "\[Rule]", "\"\<Detailed\>\""}], ",", " ", 
              
              RowBox[{"Joined", "\[Rule]", "True"}], ",", " ", 
              RowBox[{"FrameLabel", "\[Rule]", 
               RowBox[{"{", 
                RowBox[{"\"\<x [mm]\>\"", ",", "\"\<z [\[Mu]m]\>\""}], 
                "}"}]}]}], "]"}]}], "]"}], ";"}], ")"}]}], 
       "\[IndentingNewLine]", "]"}], ";", "\[IndentingNewLine]", 
      RowBox[{"If", "[", 
       RowBox[{
        RowBox[{"s", " ", "\[Equal]", " ", "\"\<y\>\""}], ",", 
        "\[IndentingNewLine]", 
        RowBox[{"(", 
         RowBox[{
          RowBox[{"AppendTo", "[", 
           RowBox[{"plots", ",", 
            RowBox[{"ListPlot", "[", 
             RowBox[{
              RowBox[{"Transpose", "@", 
               RowBox[{"{", 
                RowBox[{"y", ",", " ", 
                 RowBox[{"x", "*", "1000"}]}], "}"}]}], ",", " ", 
              RowBox[{"PlotRange", "\[Rule]", " ", 
               RowBox[{"{", 
                RowBox[{"All", ",", " ", "All"}], "}"}]}], ",", 
              RowBox[{"PlotTheme", "\[Rule]", "\"\<Detailed\>\""}], ",", " ", 
              
              RowBox[{"Joined", "\[Rule]", "True"}], ",", " ", 
              RowBox[{"FrameLabel", "\[Rule]", 
               RowBox[{"{", 
                RowBox[{"\"\<y [mm]\>\"", ",", "\"\<x [\[Mu]m]\>\""}], 
                "}"}]}]}], "]"}]}], "]"}], ";", "\[IndentingNewLine]", 
          RowBox[{"AppendTo", "[", 
           RowBox[{"plots", ",", 
            RowBox[{"ListPlot", "[", 
             RowBox[{
              RowBox[{"Transpose", "@", 
               RowBox[{"{", 
                RowBox[{"y", ",", " ", 
                 RowBox[{"z", "*", "1000"}]}], "}"}]}], ",", " ", 
              RowBox[{"PlotRange", "\[Rule]", " ", 
               RowBox[{"{", 
                RowBox[{"All", ",", " ", "All"}], "}"}]}], ",", 
              RowBox[{"PlotTheme", "\[Rule]", "\"\<Detailed\>\""}], ",", " ", 
              
              RowBox[{"Joined", "\[Rule]", "True"}], ",", " ", 
              RowBox[{"FrameLabel", "\[Rule]", 
               RowBox[{"{", 
                RowBox[{"\"\<y [mm]\>\"", ",", "\"\<z [\[Mu]m]\>\""}], 
                "}"}]}]}], "]"}]}], "]"}], ";"}], ")"}]}], 
       "\[IndentingNewLine]", "]"}], ";", "\[IndentingNewLine]", 
      RowBox[{"If", "[", 
       RowBox[{
        RowBox[{"s", " ", "\[Equal]", " ", "\"\<z\>\""}], ",", 
        "\[IndentingNewLine]", 
        RowBox[{"(", 
         RowBox[{
          RowBox[{"AppendTo", "[", 
           RowBox[{"plots", ",", 
            RowBox[{"ListPlot", "[", 
             RowBox[{
              RowBox[{"Transpose", "@", 
               RowBox[{"{", 
                RowBox[{"z", ",", " ", 
                 RowBox[{"x", "*", "1000"}]}], "}"}]}], ",", " ", 
              RowBox[{"PlotRange", "\[Rule]", " ", 
               RowBox[{"{", 
                RowBox[{"All", ",", " ", "All"}], "}"}]}], ",", 
              RowBox[{"PlotTheme", "\[Rule]", "\"\<Detailed\>\""}], ",", " ", 
              
              RowBox[{"Joined", "\[Rule]", "True"}], ",", " ", 
              RowBox[{"FrameLabel", "\[Rule]", 
               RowBox[{"{", 
                RowBox[{"\"\<z [mm]\>\"", ",", "\"\<x [\[Mu]m]\>\""}], 
                "}"}]}]}], "]"}]}], "]"}], ";", "\[IndentingNewLine]", 
          RowBox[{"AppendTo", "[", 
           RowBox[{"plots", ",", 
            RowBox[{"ListPlot", "[", 
             RowBox[{
              RowBox[{"Transpose", "@", 
               RowBox[{"{", 
                RowBox[{"z", ",", " ", 
                 RowBox[{"y", "*", "1000"}]}], "}"}]}], ",", " ", 
              RowBox[{"PlotRange", "\[Rule]", " ", 
               RowBox[{"{", 
                RowBox[{"All", ",", " ", "All"}], "}"}]}], ",", 
              RowBox[{"PlotTheme", "\[Rule]", "\"\<Detailed\>\""}], ",", " ", 
              
              RowBox[{"Joined", "\[Rule]", "True"}], ",", " ", 
              RowBox[{"FrameLabel", "\[Rule]", 
               RowBox[{"{", 
                RowBox[{"\"\<z [mm]\>\"", ",", "\"\<y [\[Mu]m]\>\""}], 
                "}"}]}]}], "]"}]}], "]"}], ";"}], ")"}]}], 
       "\[IndentingNewLine]", "]"}], ";", "\[IndentingNewLine]", 
      "\[IndentingNewLine]", 
      RowBox[{"t1", "=", 
       RowBox[{"AbsoluteTime", "[", "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"Print", "[", 
       RowBox[{"\"\<IDPlotRadFldPtcTrj: elapsed time = \>\"", ",", 
        RowBox[{"(", 
         RowBox[{"t1", "-", "t0"}], ")"}], ",", "\"\< s\>\""}], "]"}], ";", 
      "\[IndentingNewLine]", "\[IndentingNewLine]", 
      RowBox[{"Return", "[", "plots", "]"}], ";"}]}], "\[IndentingNewLine]", 
    "]"}]}], ";"}]}], "Input",
 CellChangeTimes->{{3.7674477537831893`*^9, 3.7674477653153687`*^9}, {
  3.7674479161308327`*^9, 3.7674479203811855`*^9}},
 Background->RGBColor[0.87, 0.94, 1]]
}, Closed]],

Cell[CellGroupData[{

Cell["IDDrawCassettes", "Subsection",
 CellChangeTimes->{{3.7667548871084976`*^9, 3.76675490671941*^9}, 
   3.7667549708182*^9, {3.766755041776903*^9, 3.7667550428863707`*^9}, {
   3.7667550770140467`*^9, 3.7667550886556067`*^9}, {3.767519902604745*^9, 
   3.767519902740988*^9}}],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"IDDrawCassettes", "::", "usage"}], " ", "=", " ", 
    "\"\<IDDrawCassettes[]: Show the delta cassettes and coordinate system \
conventions.\>\""}], ";"}], "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"IDDrawCassettes", "[", "]"}], " ", ":=", " ", 
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
      "Rn45", ",", " ", "Rp90", ",", " ", "Vertex", ",", " ", "B1", ",", " ", 
       "B2", ",", " ", "B3", ",", " ", "B4", ",", " ", "shift", ",", " ", 
       "B1Shift", ",", " ", "B2Shift", ",", " ", "B3Shift", ",", " ", 
       "B4Shift"}], "}"}], ",", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"Rn45", "=", 
       RowBox[{"RotationMatrix", "[", 
        RowBox[{
         RowBox[{"-", "\[Pi]"}], "/", "4"}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"Rp90", "=", 
       RowBox[{"RotationMatrix", "[", "  ", 
        RowBox[{"\[Pi]", "/", "2"}], "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"Vertex", " ", "=", " ", 
       RowBox[{"{", 
        RowBox[{
         RowBox[{"{", 
          RowBox[{
           RowBox[{"-", "2.75"}], ",", " ", "3.46"}], "}"}], ",", " ", 
         RowBox[{"{", 
          RowBox[{
           RowBox[{"-", "11.2662"}], ",", " ", "12.4245"}], "}"}], ",", " ", 
         RowBox[{"{", 
          RowBox[{
           RowBox[{"-", "7.73071"}], ",", "15.96"}], "}"}], ",", 
         RowBox[{"{", 
          RowBox[{
           RowBox[{"-", "11.2662"}], ",", " ", "19.4955"}], "}"}], ",", 
         RowBox[{"{", 
          RowBox[{
           RowBox[{"-", "2.75"}], ",", "28.46"}], "}"}], ",", " ", 
         RowBox[{"{", 
          RowBox[{"2.75", ",", "28.46"}], "}"}], ",", " ", 
         RowBox[{"{", 
          RowBox[{"11.2662", ",", " ", "19.4955"}], "}"}], ",", " ", 
         RowBox[{"{", 
          RowBox[{"7.73071", ",", "15.96"}], "}"}], ",", " ", 
         RowBox[{"{", 
          RowBox[{"11.2662", ",", " ", "12.4245"}], "}"}], ",", " ", 
         RowBox[{"{", 
          RowBox[{"2.75", ",", " ", "3.46"}], "}"}]}], "}"}]}], ";", 
      "\[IndentingNewLine]", "\[IndentingNewLine]", 
      RowBox[{"B1", " ", "=", " ", 
       RowBox[{
        RowBox[{
         RowBox[{"Dot", "[", 
          RowBox[{"Rn45", ",", "#"}], "]"}], "&"}], "/@", "Vertex"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"B2", " ", "=", " ", 
       RowBox[{
        RowBox[{
         RowBox[{"Dot", "[", 
          RowBox[{"Rp90", ",", "#"}], "]"}], "&"}], "/@", "B1"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"B3", " ", "=", " ", 
       RowBox[{
        RowBox[{
         RowBox[{"Dot", "[", 
          RowBox[{"Rp90", ",", "#"}], "]"}], "&"}], "/@", "B2"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"B4", " ", "=", " ", 
       RowBox[{
        RowBox[{
         RowBox[{"Dot", "[", 
          RowBox[{"Rp90", ",", "#"}], "]"}], "&"}], "/@", "B3"}]}], ";", 
      "\[IndentingNewLine]", "\[IndentingNewLine]", 
      RowBox[{"shift", " ", "=", " ", "60"}], ";", "\[IndentingNewLine]", 
      RowBox[{"B1Shift", " ", "=", 
       RowBox[{
        RowBox[{
         RowBox[{"{", 
          RowBox[{
           RowBox[{
            RowBox[{"#", "[", 
             RowBox[{"[", "1", "]"}], "]"}], "+", "shift"}], ",", " ", 
           RowBox[{"#", "[", 
            RowBox[{"[", "2", "]"}], "]"}]}], "}"}], "&"}], "/@", " ", 
        "B1"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"B2Shift", " ", "=", 
       RowBox[{
        RowBox[{
         RowBox[{"{", 
          RowBox[{
           RowBox[{
            RowBox[{"#", "[", 
             RowBox[{"[", "1", "]"}], "]"}], "+", "shift"}], ",", " ", 
           RowBox[{"#", "[", 
            RowBox[{"[", "2", "]"}], "]"}]}], "}"}], "&"}], "/@", " ", 
        "B2"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"B3Shift", " ", "=", 
       RowBox[{
        RowBox[{
         RowBox[{"{", 
          RowBox[{
           RowBox[{
            RowBox[{"#", "[", 
             RowBox[{"[", "1", "]"}], "]"}], "+", "shift"}], ",", " ", 
           RowBox[{"#", "[", 
            RowBox[{"[", "2", "]"}], "]"}]}], "}"}], "&"}], "/@", " ", 
        "B3"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"B4Shift", " ", "=", 
       RowBox[{
        RowBox[{
         RowBox[{"{", 
          RowBox[{
           RowBox[{
            RowBox[{"#", "[", 
             RowBox[{"[", "1", "]"}], "]"}], "+", "shift"}], ",", " ", 
           RowBox[{"#", "[", 
            RowBox[{"[", "2", "]"}], "]"}]}], "}"}], "&"}], "/@", " ", 
        "B4"}]}], ";", "\[IndentingNewLine]", "\[IndentingNewLine]", 
      RowBox[{
      "Print", "[", 
       "\"\<The Radia coordinate system convention is used here:\>\"", "]"}], 
      ";", "\[IndentingNewLine]", "\[IndentingNewLine]", 
      RowBox[{"Print", "[", 
       RowBox[{"Graphics", "[", " ", 
        RowBox[{
         RowBox[{"{", 
          RowBox[{
           RowBox[{"Arrowheads", "[", "0.02", "]"}], ",", 
           RowBox[{"{", 
            RowBox[{"Pink", ",", 
             RowBox[{
              RowBox[{
               RowBox[{"Polygon", "[", "#", "]"}], "&"}], "/@", 
              RowBox[{"{", 
               RowBox[{"B1", ",", " ", "B2", ",", " ", "B3", ",", " ", "B4"}],
                "}"}]}]}], "}"}], ",", " ", "\[IndentingNewLine]", 
           RowBox[{"Circle", "[", 
            RowBox[{
             RowBox[{"{", 
              RowBox[{"0", ",", "0"}], "}"}], ",", " ", "0.7"}], "]"}], ",", 
           RowBox[{"Disk", "[", 
            RowBox[{
             RowBox[{"{", 
              RowBox[{"0", ",", "0"}], "}"}], ",", " ", "0.3"}], "]"}], ",", 
           "  ", 
           RowBox[{"Arrow", "[", 
            RowBox[{"{", 
             RowBox[{
              RowBox[{"{", 
               RowBox[{"0", ",", "0"}], "}"}], ",", 
              RowBox[{"{", 
               RowBox[{"0", ",", "3.5"}], "}"}]}], "}"}], "]"}], ",", "  ", 
           RowBox[{"Arrow", "[", 
            RowBox[{"{", 
             RowBox[{
              RowBox[{"{", 
               RowBox[{"0", ",", "0"}], "}"}], ",", 
              RowBox[{"{", 
               RowBox[{
                RowBox[{"-", "3.5"}], ",", "0"}], "}"}]}], "}"}], "]"}], ",", 
           " ", "\[IndentingNewLine]", 
           RowBox[{"Text", "[", 
            RowBox[{
             RowBox[{"Style", "[", 
              RowBox[{"\"\<x\>\"", ",", " ", "Medium"}], "]"}], ",", 
             RowBox[{"{", 
              RowBox[{
               RowBox[{"-", "4"}], ",", "0"}], "}"}]}], "]"}], ",", 
           RowBox[{"Text", "[", 
            RowBox[{
             RowBox[{"Style", "[", 
              RowBox[{"\"\<z\>\"", ",", " ", "Medium"}], "]"}], ",", 
             RowBox[{"{", 
              RowBox[{"0", ",", "4"}], "}"}]}], "]"}], ",", 
           RowBox[{"Text", "[", 
            RowBox[{
             RowBox[{"Style", "[", 
              RowBox[{"\"\<y\>\"", ",", " ", "Medium"}], "]"}], ",", 
             RowBox[{"{", 
              RowBox[{"1.5", ",", 
               RowBox[{"-", "1"}]}], "}"}]}], "]"}], ",", 
           "\[IndentingNewLine]", 
           RowBox[{"Text", "[", 
            RowBox[{
             RowBox[{"Style", "[", 
              RowBox[{
              "\"\<Radia convention (y == longitudinal)\>\"", ",", " ", 
               "Large"}], "]"}], ",", 
             RowBox[{"{", 
              RowBox[{"0", ",", "25"}], "}"}]}], "]"}], ",", 
           "\[IndentingNewLine]", 
           RowBox[{"Text", "[", 
            RowBox[{
             RowBox[{"Style", "[", 
              RowBox[{"\"\<BLC\>\"", ",", " ", "Large"}], "]"}], ",", 
             RowBox[{"{", 
              RowBox[{"10", ",", "10"}], "}"}]}], "]"}], ",", 
           "\[IndentingNewLine]", 
           RowBox[{"Text", "[", 
            RowBox[{
             RowBox[{"Style", "[", 
              RowBox[{"\"\<BRC\>\"", ",", " ", "Large"}], "]"}], ",", 
             RowBox[{"{", 
              RowBox[{
               RowBox[{"-", "10"}], ",", "10"}], "}"}]}], "]"}], ",", 
           "\[IndentingNewLine]", 
           RowBox[{"Text", "[", 
            RowBox[{
             RowBox[{"Style", "[", 
              RowBox[{"\"\<ULC\>\"", ",", " ", "Large"}], "]"}], ",", 
             RowBox[{"{", 
              RowBox[{"10", ",", 
               RowBox[{"-", "10"}]}], "}"}]}], "]"}], ",", 
           "\[IndentingNewLine]", 
           RowBox[{"Text", "[", 
            RowBox[{
             RowBox[{"Style", "[", 
              RowBox[{"\"\<URC\>\"", ",", " ", "Large"}], "]"}], ",", 
             RowBox[{"{", 
              RowBox[{
               RowBox[{"-", "10"}], ",", 
               RowBox[{"-", "10"}]}], "}"}]}], "]"}], ",", 
           "\[IndentingNewLine]", 
           RowBox[{"Text", "[", 
            RowBox[{
             RowBox[{"Style", "[", 
              RowBox[{
              "\"\<ID rotation by 90\[Degree] about the X-axis\>\"", ",", " ",
                "Medium"}], "]"}], ",", 
             RowBox[{"{", 
              RowBox[{
               RowBox[{"shift", "/", "2"}], ",", "3"}], "}"}]}], "]"}], ",", 
           "\[IndentingNewLine]", " ", 
           RowBox[{"Arrow", "[", 
            RowBox[{"{", 
             RowBox[{
              RowBox[{"{", 
               RowBox[{
                RowBox[{
                 RowBox[{"shift", "/", "2"}], "-", "10"}], ",", "0"}], "}"}], 
              ",", " ", 
              RowBox[{"{", 
               RowBox[{
                RowBox[{
                 RowBox[{"shift", "/", "2"}], " ", "+", " ", "10"}], ",", 
                "0"}], "}"}]}], "}"}], "]"}], ",", "\[IndentingNewLine]", 
           RowBox[{"{", 
            RowBox[{"Orange", ",", 
             RowBox[{
              RowBox[{
               RowBox[{"Polygon", "[", "#", "]"}], "&"}], "/@", 
              RowBox[{"{", 
               RowBox[{
               "B1Shift", ",", " ", "B2Shift", ",", " ", "B3Shift", ",", " ", 
                "B4Shift"}], "}"}]}]}], "}"}], ",", "\[IndentingNewLine]", 
           RowBox[{"Circle", "[", 
            RowBox[{
             RowBox[{"{", 
              RowBox[{
               RowBox[{"0", "+", "shift"}], ",", "0"}], "}"}], ",", " ", 
             "0.7"}], "]"}], ",", 
           RowBox[{"Line", "[", 
            RowBox[{"{", 
             RowBox[{
              RowBox[{"{", 
               RowBox[{
                RowBox[{
                 RowBox[{"-", "0.5"}], "+", "shift"}], ",", 
                RowBox[{"-", "0.5"}]}], "}"}], ",", 
              RowBox[{"{", 
               RowBox[{
                RowBox[{"0.5", "+", "shift"}], ",", "0.5"}], "}"}]}], "}"}], 
            "]"}], ",", " ", 
           RowBox[{"Line", "[", 
            RowBox[{"{", 
             RowBox[{
              RowBox[{"{", 
               RowBox[{
                RowBox[{
                 RowBox[{"-", "0.5"}], "+", "shift"}], ",", "0.5"}], "}"}], 
              ",", 
              RowBox[{"{", 
               RowBox[{
                RowBox[{"0.5", "+", "shift"}], ",", 
                RowBox[{"-", "0.5"}]}], "}"}]}], "}"}], "]"}], ",", "  ", 
           RowBox[{"Arrow", "[", 
            RowBox[{"{", 
             RowBox[{
              RowBox[{"{", 
               RowBox[{
                RowBox[{"0", "+", "shift"}], ",", "0"}], "}"}], ",", " ", 
              RowBox[{"{", 
               RowBox[{
                RowBox[{"0", "+", "shift"}], ",", "3.5"}], "}"}]}], "}"}], 
            "]"}], ",", "  ", 
           RowBox[{"Arrow", "[", 
            RowBox[{"{", 
             RowBox[{
              RowBox[{"{", 
               RowBox[{
                RowBox[{"0", "+", "shift"}], ",", "0"}], "}"}], ",", " ", 
              RowBox[{"{", 
               RowBox[{
                RowBox[{
                 RowBox[{"-", "3.5"}], "+", "shift"}], ",", "0"}], "}"}]}], 
             "}"}], "]"}], ",", " ", "\[IndentingNewLine]", 
           RowBox[{"Text", "[", 
            RowBox[{
             RowBox[{"Style", "[", 
              RowBox[{"\"\<x\>\"", ",", " ", "Medium"}], "]"}], ",", 
             RowBox[{"{", 
              RowBox[{
               RowBox[{
                RowBox[{"-", "4"}], "+", "shift"}], ",", "0"}], "}"}]}], 
            "]"}], ",", 
           RowBox[{"Text", "[", 
            RowBox[{
             RowBox[{"Style", "[", 
              RowBox[{"\"\<y\>\"", ",", " ", "Medium"}], "]"}], ",", 
             RowBox[{"{", 
              RowBox[{
               RowBox[{"0", "+", "shift"}], ",", "4"}], "}"}]}], "]"}], ",", 
           RowBox[{"Text", "[", 
            RowBox[{
             RowBox[{"Style", "[", 
              RowBox[{"\"\<z\>\"", ",", " ", "Medium"}], "]"}], ",", 
             RowBox[{"{", 
              RowBox[{
               RowBox[{"1.5", "+", "shift"}], ",", 
               RowBox[{"-", "1"}]}], "}"}]}], "]"}], ",", 
           "\[IndentingNewLine]", 
           RowBox[{"Text", "[", 
            RowBox[{
             RowBox[{"Style", "[", 
              RowBox[{
              "\"\<Sirius convention (z == longitudinal)\>\"", ",", " ", 
               "Large"}], "]"}], ",", 
             RowBox[{"{", 
              RowBox[{
               RowBox[{"0", "+", "shift"}], ",", "25"}], "}"}]}], "]"}], ",", 
           "\[IndentingNewLine]", 
           RowBox[{"Text", "[", 
            RowBox[{
             RowBox[{"Style", "[", 
              RowBox[{"\"\<ULC\>\"", ",", " ", "Large"}], "]"}], ",", 
             RowBox[{"{", 
              RowBox[{
               RowBox[{"10", "+", "shift"}], ",", "10"}], "}"}]}], "]"}], ",",
            "\[IndentingNewLine]", 
           RowBox[{"Text", "[", 
            RowBox[{
             RowBox[{"Style", "[", 
              RowBox[{"\"\<URC\>\"", ",", " ", "Large"}], "]"}], ",", 
             RowBox[{"{", 
              RowBox[{
               RowBox[{
                RowBox[{"-", "10"}], "+", "shift"}], ",", "10"}], "}"}]}], 
            "]"}], ",", "\[IndentingNewLine]", 
           RowBox[{"Text", "[", 
            RowBox[{
             RowBox[{"Style", "[", 
              RowBox[{"\"\<BLC\>\"", ",", " ", "Large"}], "]"}], ",", 
             RowBox[{"{", 
              RowBox[{
               RowBox[{"10", "+", "shift"}], ",", 
               RowBox[{"-", "10"}]}], "}"}]}], "]"}], ",", 
           "\[IndentingNewLine]", 
           RowBox[{"Text", "[", 
            RowBox[{
             RowBox[{"Style", "[", 
              RowBox[{"\"\<BRC\>\"", ",", " ", "Large"}], "]"}], ",", 
             RowBox[{"{", 
              RowBox[{
               RowBox[{
                RowBox[{"-", "10"}], "+", "shift"}], ",", 
               RowBox[{"-", "10"}]}], "}"}]}], "]"}]}], "\[IndentingNewLine]",
           "}"}], ",", " ", 
         RowBox[{"ImageSize", "\[Rule]", " ", "1000"}]}], "]"}], "]"}], 
      ";"}]}], "\[IndentingNewLine]", "\[IndentingNewLine]", "]"}]}], 
  ";"}]}], "Input",
 CellChangeTimes->{{3.76675480841481*^9, 3.766754926158442*^9}, {
  3.766754977584357*^9, 3.7667549895853047`*^9}, {3.766755050871372*^9, 
  3.766755080858101*^9}, {3.76751695288941*^9, 3.7675169645125494`*^9}, {
  3.7675171280707097`*^9, 3.7675171415808496`*^9}, {3.767519930767761*^9, 
  3.767519937580052*^9}, {3.7675213654992776`*^9, 3.767521549362143*^9}},
 Background->RGBColor[0.87, 0.94, 1]]
}, Closed]]
}, Open  ]],

Cell[CellGroupData[{

Cell["Auxiliary", "Section",
 CellChangeTimes->{{3.76639811614032*^9, 3.7663981237176037`*^9}}],

Cell[CellGroupData[{

Cell["auxIDCassette", "Subsection",
 CellChangeTimes->{{3.766754730782276*^9, 3.7667547560811443`*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"auxIDCassette", "[", 
    RowBox[{
    "\[Lambda]u_", ",", " ", "Np_", ",", " ", "Br_", ",", " ", "\[Delta]_", 
     ",", " ", "BC_", ",", "  ", "BlockGap_", ",", " ", 
     RowBox[{"OptionsPattern", "[", 
      RowBox[{"{", 
       RowBox[{
        RowBox[{"\"\<PointingUp\>\"", "\[Rule]", " ", "True"}], ",", " ", 
        RowBox[{"\"\<FirstBlock\>\"", "\[Rule]", " ", "\"\<Up\>\""}], ",", 
        " ", 
        RowBox[{
        "\"\<FieldDirection\>\"", "\[Rule]", " ", "\"\<Vertical\>\""}], ",", 
        RowBox[{"\"\<Termination\>\"", "\[Rule]", " ", "\"\<None\>\""}], ",", 
        " ", 
        RowBox[{"\"\<PosMagErrors\>\"", "\[Rule]", " ", 
         RowBox[{"{", "}"}]}]}], "}"}], "]"}]}], "]"}], " ", ":=", " ", 
   RowBox[{"Module", "[", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"{", " ", 
      RowBox[{
      "Wm", ",", " ", "Ly", ",", "NrBlocks", ",", " ", "NrCoreBlocks", ",", 
       " ", "NrTermBlocks", ",", "  ", "AddCoreBlocks", ",", " ", "Pos", ",", 
       " ", "PointingUp", ",", " ", "FirstBlock", ",", " ", "FieldDirection", 
       " ", ",", " ", "\[IndentingNewLine]", "PosMagErrors", ",", " ", "Eh", 
       ",", " ", "Ev", ",", " ", "Em", ",", "EmRot", ",", " ", "BCRef", ",", 
       " ", "BCPosErrorRef", ",", " ", "BCPosError", ",", " ", 
       "PointingUpList", ",", " ", "PointingDownList", ",", " ", "AddIdx", 
       ",", "\[IndentingNewLine]", "Mag", ",", " ", "RotMag", ",", " ", "i", 
       ",", " ", "Count", ",", " ", "Shift", ",", " ", "CenterBC", ",", 
       "Termination", ",", "\[IndentingNewLine]", "CassetteBeg", ",", 
       "CassetteBeg1", ",", " ", "CassetteBeg2", ",", " ", "CassetteBeg3", 
       ",", "\[IndentingNewLine]", "CassetteEnd", ",", "CassetteEnd1", ",", 
       " ", "CassetteEnd2", ",", " ", "CassetteEnd3", ",", 
       "\[IndentingNewLine]", "CassetteCore", ",", "Cassette"}], "}"}], ",", 
     "\[IndentingNewLine]", "\[IndentingNewLine]", 
     RowBox[{"(*", 
      RowBox[{
       RowBox[{
       "The", " ", "permanent", " ", "blocks", " ", "are", " ", "created", 
        " ", "with", " ", "a", " ", "extrusion", " ", "of", " ", "the", " ", 
        "cross", " ", "section", " ", "of", " ", "the", " ", "block", " ", 
        "and", " ", "the", " ", "magnetization", " ", "vector", " ", "must", 
        " ", "be", " ", "specified", " ", "in", " ", "the", " ", "block", " ", 
        RowBox[{"creation", ".", " ", "\[IndentingNewLine]", "However"}]}], 
       ",", " ", 
       RowBox[{
       "the", " ", "extrusion", " ", "is", " ", "done", " ", "in", " ", "the",
         " ", "x", " ", "direction"}], ",", " ", 
       RowBox[{
       "so", " ", "for", " ", "blocks", " ", "with", " ", "a", " ", 
        "constant", " ", "cross", " ", "section", " ", "in", " ", "the", " ", 
        "longitudinal", " ", "direction"}], ",", " ", 
       RowBox[{
       "the", " ", "objects", " ", "must", " ", "be", " ", "rotated", " ", 
        "after", " ", 
        RowBox[{"creation", ".", " ", "\[IndentingNewLine]", "The"}], " ", 
        "magnetization", " ", "vector", " ", "is", " ", "affected", " ", "by",
         " ", "this", " ", "rotation"}], ",", " ", 
       RowBox[{
       "so", " ", "a", " ", "inverse", " ", "transformation", " ", "must", 
        " ", "be", " ", "applied", " ", "to", " ", "the", " ", "vector", " ", 
        "before", " ", "the", " ", "block", " ", "is", " ", 
        RowBox[{"created", "."}]}]}], "*)"}], "\[IndentingNewLine]", 
     "\[IndentingNewLine]", 
     RowBox[{"(*", 
      RowBox[{"Termination", " ", "Type"}], "*)"}], "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"NrTermBlocks", "=", " ", "0"}], ";", "\[IndentingNewLine]", 
      RowBox[{"AddCoreBlocks", " ", "=", " ", "0"}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"Termination", " ", "=", " ", 
       RowBox[{"OptionValue", "[", "\"\<Termination\>\"", "]"}]}], ";", 
      "\[IndentingNewLine]", "\[IndentingNewLine]", 
      RowBox[{"If", "[", 
       RowBox[{
        RowBox[{"Termination", "\[Equal]", " ", "\"\<OneBlockSym\>\""}], ",", 
        "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"NrTermBlocks", "=", " ", "1"}], ";", "\[IndentingNewLine]", 
         
         RowBox[{"AddCoreBlocks", " ", "=", " ", "3"}], ";"}]}], 
       "\[IndentingNewLine]", "]"}], ";", "\[IndentingNewLine]", 
      "\[IndentingNewLine]", 
      RowBox[{"If", "[", 
       RowBox[{
        RowBox[{"Termination", "\[Equal]", " ", "\"\<OneBlockAntiSym\>\""}], 
        ",", "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"NrTermBlocks", "=", " ", "1"}], ";", "\[IndentingNewLine]", 
         
         RowBox[{"AddCoreBlocks", " ", "=", " ", "1"}], ";"}]}], 
       "\[IndentingNewLine]", "]"}], ";", "\[IndentingNewLine]", 
      "\[IndentingNewLine]", 
      RowBox[{"If", "[", 
       RowBox[{
        RowBox[{"Termination", "\[Equal]", " ", "\"\<ThreeBlocksSym\>\""}], 
        ",", "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"NrTermBlocks", "=", " ", "3"}], ";", "\[IndentingNewLine]", 
         
         RowBox[{"AddCoreBlocks", " ", "=", "3"}], ";"}]}], 
       "\[IndentingNewLine]", "]"}], ";", "\[IndentingNewLine]", 
      "\[IndentingNewLine]", 
      RowBox[{"If", "[", 
       RowBox[{
        RowBox[{
        "Termination", "\[Equal]", " ", "\"\<ThreeBlocksAntiSym\>\""}], ",", 
        "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"NrTermBlocks", "=", " ", "3"}], ";", "\[IndentingNewLine]", 
         
         RowBox[{"AddCoreBlocks", " ", "=", "1"}], ";"}]}], 
       "\[IndentingNewLine]", "]"}], ";", "\[IndentingNewLine]", 
      "\[IndentingNewLine]", 
      RowBox[{"(*", 
       RowBox[{
       "Longitudinal", " ", "position", " ", "of", " ", "the", " ", 
        "blocks"}], "*)"}], "\[IndentingNewLine]", 
      RowBox[{"Wm", "=", " ", 
       RowBox[{"\[Lambda]u", "/", "4"}]}], ";", "\[IndentingNewLine]", 
      "\[IndentingNewLine]", 
      RowBox[{"(*", 
       RowBox[{"Block", " ", "size"}], "*)"}], "\[IndentingNewLine]", 
      RowBox[{"Ly", " ", "=", " ", 
       RowBox[{"Wm", " ", "-", " ", "BlockGap"}]}], ";", 
      "\[IndentingNewLine]", "\[IndentingNewLine]", 
      RowBox[{"(*", 
       RowBox[{"Position", " ", "of", " ", "blocks"}], "*)"}], 
      "\[IndentingNewLine]", 
      RowBox[{"NrCoreBlocks", "=", " ", 
       RowBox[{
        RowBox[{"(", 
         RowBox[{"4", "*", "Np"}], ")"}], " ", "+", " ", "AddCoreBlocks"}]}], 
      ";", "\[IndentingNewLine]", 
      RowBox[{"NrBlocks", " ", "=", " ", 
       RowBox[{"NrCoreBlocks", "+", " ", 
        RowBox[{"(", 
         RowBox[{"2", "*", "NrTermBlocks"}], ")"}]}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"Pos", " ", "=", " ", 
       RowBox[{"Wm", "*", 
        RowBox[{"Range", "[", 
         RowBox[{"0", ",", 
          RowBox[{"NrBlocks", " ", "-", " ", "1"}]}], "]"}]}]}], ";", 
      "\[IndentingNewLine]", "\[IndentingNewLine]", 
      RowBox[{"(*", 
       RowBox[{"Magnetization", " ", "direction"}], "*)"}], 
      "\[IndentingNewLine]", 
      RowBox[{"PointingUp", " ", "=", " ", 
       RowBox[{"OptionValue", "[", "\"\<PointingUp\>\"", "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"FirstBlock", " ", "=", " ", 
       RowBox[{"OptionValue", "[", "\"\<FirstBlock\>\"", "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"FieldDirection", " ", "=", " ", 
       RowBox[{"OptionValue", "[", "\"\<FieldDirection\>\"", "]"}]}], ";", 
      "\[IndentingNewLine]", "\[IndentingNewLine]", 
      RowBox[{"If", "[", 
       RowBox[{
        RowBox[{
        "FieldDirection", " ", "\[Equal]", " ", "\"\<Horizontal\>\""}], ",", 
        "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"PointingUpList", " ", "=", " ", 
          RowBox[{"{", 
           RowBox[{
            RowBox[{"{", 
             RowBox[{"Br", ",", "0", ",", "0"}], "}"}], ",", " ", 
            RowBox[{"{", 
             RowBox[{"0", ",", " ", 
              RowBox[{"-", "Br"}], ",", " ", "0"}], "}"}], ",", " ", 
            RowBox[{"{", 
             RowBox[{
              RowBox[{"-", "Br"}], ",", "0", ",", "0"}], "}"}], ",", " ", 
            RowBox[{"{", 
             RowBox[{"0", ",", " ", "Br", ",", " ", "0"}], "}"}]}], "}"}]}], 
         ";", "\[IndentingNewLine]", 
         RowBox[{"PointingDownList", " ", "=", " ", 
          RowBox[{"{", 
           RowBox[{
            RowBox[{"{", 
             RowBox[{"Br", ",", "0", ",", "0"}], "}"}], ",", " ", 
            RowBox[{"{", 
             RowBox[{"0", ",", " ", "Br", ",", " ", "0"}], "}"}], ",", " ", 
            RowBox[{"{", 
             RowBox[{
              RowBox[{"-", "Br"}], ",", "0", ",", "0"}], "}"}], ",", " ", 
            RowBox[{"{", 
             RowBox[{"0", ",", " ", 
              RowBox[{"-", "Br"}], ",", " ", "0"}], "}"}]}], "}"}]}], ";"}], 
        ",", "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"PointingUpList", " ", "=", " ", 
          RowBox[{"{", 
           RowBox[{
            RowBox[{"{", 
             RowBox[{"0", ",", "0", ",", "Br"}], "}"}], ",", " ", 
            RowBox[{"{", 
             RowBox[{"0", ",", " ", 
              RowBox[{"-", "Br"}], ",", " ", "0"}], "}"}], ",", " ", 
            RowBox[{"{", 
             RowBox[{"0", ",", "0", ",", 
              RowBox[{"-", "Br"}]}], "}"}], ",", " ", 
            RowBox[{"{", 
             RowBox[{"0", ",", " ", "Br", ",", " ", "0"}], "}"}]}], "}"}]}], 
         ";", "\[IndentingNewLine]", 
         RowBox[{"PointingDownList", " ", "=", " ", 
          RowBox[{"{", 
           RowBox[{
            RowBox[{"{", 
             RowBox[{"0", ",", "0", ",", "Br"}], "}"}], ",", " ", 
            RowBox[{"{", 
             RowBox[{"0", ",", " ", "Br", ",", " ", "0"}], "}"}], ",", " ", 
            RowBox[{"{", 
             RowBox[{"0", ",", "0", ",", 
              RowBox[{"-", "Br"}]}], "}"}], ",", " ", 
            RowBox[{"{", 
             RowBox[{"0", ",", " ", 
              RowBox[{"-", "Br"}], ",", " ", "0"}], "}"}]}], "}"}]}], ";"}]}],
        "\[IndentingNewLine]", "]"}], ";", "\[IndentingNewLine]", 
      "\[IndentingNewLine]", 
      RowBox[{"AddIdx", " ", "=", " ", "0"}], ";", "\[IndentingNewLine]", 
      RowBox[{"If", " ", "[", 
       RowBox[{
        RowBox[{"FirstBlock", " ", "\[Equal]", " ", "\"\<Up\>\""}], ",", " ", 
        
        RowBox[{"AddIdx", " ", "=", "0"}]}], "]"}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"If", " ", "[", 
       RowBox[{
        RowBox[{"FirstBlock", " ", "\[Equal]", " ", "\"\<Down\>\""}], ",", 
        " ", 
        RowBox[{"AddIdx", "=", "2"}]}], "]"}], ";", "\[IndentingNewLine]", 
      RowBox[{"If", " ", "[", 
       RowBox[{
        RowBox[{
         RowBox[{"FirstBlock", " ", "\[Equal]", " ", "\"\<Foward\>\""}], " ", 
         "&&", " ", "PointingUp"}], ",", " ", 
        RowBox[{"AddIdx", "=", "3"}]}], "]"}], ";", "\[IndentingNewLine]", 
      RowBox[{"If", " ", "[", 
       RowBox[{
        RowBox[{
         RowBox[{"FirstBlock", " ", "\[Equal]", " ", "\"\<Foward\>\""}], " ", 
         "&&", " ", 
         RowBox[{"Not", " ", "PointingUp"}]}], ",", " ", 
        RowBox[{"AddIdx", "=", "1"}]}], "]"}], ";", "\[IndentingNewLine]", 
      RowBox[{"If", " ", "[", 
       RowBox[{
        RowBox[{
         RowBox[{"FirstBlock", " ", "\[Equal]", " ", "\"\<Backward\>\""}], 
         " ", "&&", " ", "PointingUp"}], ",", " ", 
        RowBox[{"AddIdx", "=", "1"}]}], "]"}], ";", "\[IndentingNewLine]", 
      RowBox[{"If", " ", "[", 
       RowBox[{
        RowBox[{
         RowBox[{"FirstBlock", " ", "\[Equal]", " ", "\"\<Backward\>\""}], 
         " ", "&&", " ", 
         RowBox[{"Not", " ", "PointingUp"}]}], ",", " ", 
        RowBox[{"AddIdx", "=", "3"}]}], "]"}], ";", "\[IndentingNewLine]", 
      "\[IndentingNewLine]", 
      RowBox[{"If", " ", "[", 
       RowBox[{"PointingUp", ",", "  ", "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"Mag", "[", "idx_", "]"}], " ", ":=", " ", 
         RowBox[{"PointingUpList", "[", 
          RowBox[{"[", 
           RowBox[{"If", "[", 
            RowBox[{
             RowBox[{"Divisible", "[", 
              RowBox[{
               RowBox[{"idx", " ", "+", " ", "AddIdx"}], ",", " ", "4"}], 
              "]"}], " ", ",", " ", "4", " ", ",", " ", 
             RowBox[{"Mod", "[", 
              RowBox[{
               RowBox[{"idx", "+", " ", "AddIdx"}], ",", " ", "4"}], "]"}]}], 
            " ", "]"}], "]"}], "]"}]}], ",", " ", "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"Mag", "[", "idx_", "]"}], " ", ":=", " ", 
         RowBox[{"PointingDownList", "[", 
          RowBox[{"[", 
           RowBox[{"If", "[", 
            RowBox[{
             RowBox[{"Divisible", "[", 
              RowBox[{
               RowBox[{"idx", " ", "+", " ", "AddIdx"}], ",", " ", "4"}], 
              "]"}], ",", " ", "4", " ", ",", " ", 
             RowBox[{"Mod", "[", 
              RowBox[{
               RowBox[{"idx", "+", " ", "AddIdx"}], ",", " ", "4"}], "]"}]}], 
            " ", "]"}], "]"}], "]"}]}]}], "\[IndentingNewLine]", "]"}], ";", 
      " ", "\[IndentingNewLine]", "\[IndentingNewLine]", 
      RowBox[{"(*", 
       RowBox[{"Position", " ", "and", " ", "magnetization", " ", "errors"}], 
       "*)"}], "\[IndentingNewLine]", 
      RowBox[{"PosMagErrors", " ", "=", " ", 
       RowBox[{"OptionValue", "[", "\"\<PosMagErrors\>\"", "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"If", " ", "[", 
       RowBox[{
        RowBox[{
         RowBox[{"Length", "[", "PosMagErrors", "]"}], " ", "\[Equal]", " ", 
         "0"}], ",", " ", 
        RowBox[{"PosMagErrors", " ", "=", " ", 
         RowBox[{"Table", "[", 
          RowBox[{
           RowBox[{"{", 
            RowBox[{
            "0", ",", " ", "0", ",", " ", "0", ",", " ", "0", ",", " ", "0"}],
             "}"}], ",", " ", "NrBlocks"}], "]"}]}]}], "]"}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"If", " ", "[", 
       RowBox[{
        RowBox[{
         RowBox[{"Length", "[", "PosMagErrors", "]"}], " ", "\[NotEqual]", 
         " ", "NrBlocks"}], ",", " ", 
        RowBox[{"Return", "[", "]"}]}], "]"}], ";", "\[IndentingNewLine]", 
      RowBox[{"Eh", " ", "=", " ", 
       RowBox[{"PosMagErrors", "[", 
        RowBox[{"[", 
         RowBox[{"All", ",", " ", "1"}], "]"}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"Ev", " ", "=", " ", 
       RowBox[{"PosMagErrors", "[", 
        RowBox[{"[", 
         RowBox[{"All", ",", " ", "2"}], "]"}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"Em", " ", "=", 
       RowBox[{"Transpose", "@", 
        RowBox[{"{", 
         RowBox[{
          RowBox[{"PosMagErrors", "[", 
           RowBox[{"[", 
            RowBox[{"All", ",", " ", "3"}], "]"}], "]"}], ",", " ", 
          RowBox[{"PosMagErrors", "[", 
           RowBox[{"[", 
            RowBox[{"All", ",", " ", "4"}], "]"}], "]"}], ",", " ", 
          RowBox[{"PosMagErrors", "[", 
           RowBox[{"[", 
            RowBox[{"All", ",", " ", "5"}], "]"}], "]"}]}], "}"}]}]}], ";", 
      "\[IndentingNewLine]", "\[IndentingNewLine]", 
      RowBox[{"BCRef", " ", "=", " ", 
       RowBox[{
        RowBox[{
         RowBox[{
          RowBox[{
           RowBox[{"{", 
            RowBox[{
             RowBox[{
              RowBox[{"#", "[", 
               RowBox[{"[", "1", "]"}], "]"}], "*", 
              RowBox[{"-", "1"}]}], ",", " ", 
             RowBox[{"#", "[", 
              RowBox[{"[", "2", "]"}], "]"}]}], "}"}], "&"}], "/@", "#"}], 
         "&"}], "/@", "BC"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"BCPosErrorRef", "[", "idx_", "]"}], " ", ":=", " ", 
       RowBox[{
        RowBox[{
         RowBox[{
          RowBox[{
           RowBox[{"#", "+", 
            RowBox[{"{", 
             RowBox[{
              RowBox[{"-", 
               RowBox[{"Eh", "[", 
                RowBox[{"[", "idx", "]"}], "]"}]}], ",", 
              RowBox[{"Ev", "[", 
               RowBox[{"[", "idx", "]"}], "]"}]}], "}"}]}], "&"}], "/@", 
          "#"}], "&"}], "/@", "BCRef"}]}], ";", "\[IndentingNewLine]", 
      "\[IndentingNewLine]", 
      RowBox[{"(*", 
       RowBox[{
        RowBox[{
        "Counterclockwise", " ", "rotation", " ", "of", " ", "the", " ", 
         "magnetization", " ", "vector", " ", "by"}], " ", "-", 
        RowBox[{
         RowBox[{"\[Pi]", "/", "2"}], " ", "around", " ", "the", " ", "z"}], 
        "-", "axis"}], "*)"}], "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"RotMag", "[", "idx_", "]"}], " ", ":=", 
       RowBox[{"Dot", "[", 
        RowBox[{
         RowBox[{"RotationMatrix", "[", 
          RowBox[{
           RowBox[{
            RowBox[{"-", "\[Pi]"}], "/", "2"}], ",", " ", 
           RowBox[{"{", 
            RowBox[{"0", ",", "0", ",", "1"}], "}"}]}], "]"}], ",", " ", 
         RowBox[{"Mag", "[", "idx", "]"}]}], "]"}]}], ";", " ", 
      "\[IndentingNewLine]", 
      RowBox[{"EmRot", " ", "=", " ", 
       RowBox[{
        RowBox[{
         RowBox[{"Dot", "[", 
          RowBox[{
           RowBox[{"RotationMatrix", "[", 
            RowBox[{
             RowBox[{
              RowBox[{"-", "\[Pi]"}], "/", "2"}], ",", " ", 
             RowBox[{"{", 
              RowBox[{"0", ",", "0", ",", "1"}], "}"}]}], "]"}], ",", " ", 
           "#"}], "]"}], "&"}], "/@", "Em"}]}], ";", "\[IndentingNewLine]", 
      "\[IndentingNewLine]", 
      RowBox[{"(*", 
       RowBox[{"Termination", " ", "blocks"}], "*)"}], "\[IndentingNewLine]", 
      
      RowBox[{"CassetteBeg", " ", "=", " ", 
       RowBox[{"{", "}"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"CassetteEnd", " ", "=", " ", 
       RowBox[{"{", "}"}]}], ";", "\[IndentingNewLine]", 
      "\[IndentingNewLine]", 
      RowBox[{"If", " ", "[", 
       RowBox[{
        RowBox[{
         RowBox[{"Termination", "\[Equal]", " ", "\"\<OneBlockSym\>\""}], " ",
          "||", " ", 
         RowBox[{
         "Termination", "\[Equal]", " ", "\"\<OneBlockAntiSym\>\""}]}], ",", 
        "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"CassetteBeg", " ", "=", " ", 
          RowBox[{
           RowBox[{
            RowBox[{"radObjThckPgn", "[", 
             RowBox[{
              RowBox[{
               RowBox[{"Pos", "[", 
                RowBox[{"[", "1", "]"}], "]"}], " ", "+", " ", 
               RowBox[{"Wm", "/", "4"}], " ", "+", " ", "\[Delta]"}], ",", 
              "   ", 
              RowBox[{"Ly", "/", "2"}], ",", "#", ",", " ", 
              RowBox[{
               RowBox[{"RotMag", "[", "1", "]"}], "+", " ", 
               RowBox[{"EmRot", "[", 
                RowBox[{"[", "1", "]"}], "]"}]}]}], "]"}], "&"}], "/@", " ", 
           RowBox[{"BCPosErrorRef", "[", "1", "]"}]}]}], " ", ";", 
         "\[IndentingNewLine]", 
         RowBox[{"CassetteEnd", " ", "=", " ", 
          RowBox[{
           RowBox[{
            RowBox[{"radObjThckPgn", "[", 
             RowBox[{
              RowBox[{
               RowBox[{"Pos", "[", 
                RowBox[{"[", 
                 RowBox[{"-", "1"}], "]"}], "]"}], " ", "-", "  ", 
               RowBox[{"Wm", "/", "4"}], "+", " ", "\[Delta]"}], ",", " ", 
              RowBox[{"Ly", "/", "2"}], ",", "#", ",", " ", 
              RowBox[{
               RowBox[{"RotMag", "[", "NrBlocks", "]"}], "+", " ", 
               RowBox[{"EmRot", "[", 
                RowBox[{"[", 
                 RowBox[{"-", "1"}], "]"}], "]"}]}]}], "]"}], "&"}], "/@", 
           " ", 
           RowBox[{"BCPosErrorRef", "[", 
            RowBox[{"-", "1"}], "]"}]}]}], ";"}]}], "\[IndentingNewLine]", 
       "]"}], ";", "\[IndentingNewLine]", "\[IndentingNewLine]", 
      RowBox[{"If", " ", "[", 
       RowBox[{
        RowBox[{
         RowBox[{"Termination", "\[Equal]", " ", "\"\<ThreeBlocksSym\>\""}], 
         " ", "||", " ", 
         RowBox[{
         "Termination", "\[Equal]", " ", "\"\<ThreeBlocksAntiSym\>\""}]}], 
        ",", "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"CassetteBeg1", " ", "=", " ", 
          RowBox[{
           RowBox[{
            RowBox[{"radObjThckPgn", "[", 
             RowBox[{
              RowBox[{
               RowBox[{"Pos", "[", 
                RowBox[{"[", "1", "]"}], "]"}], " ", "+", " ", 
               RowBox[{"3", 
                RowBox[{"Wm", "/", "8"}]}], " ", "+", " ", "\[Delta]"}], ",", 
              "   ", 
              RowBox[{"Ly", "/", "4"}], ",", "#", ",", " ", 
              RowBox[{
               RowBox[{"RotMag", "[", "1", "]"}], "+", " ", 
               RowBox[{"EmRot", "[", 
                RowBox[{"[", "1", "]"}], "]"}]}]}], "]"}], "&"}], "/@", 
           RowBox[{"BCPosErrorRef", "[", "1", "]"}]}]}], ";", 
         "\[IndentingNewLine]", 
         RowBox[{"CassetteBeg2", " ", "=", " ", 
          RowBox[{
           RowBox[{
            RowBox[{"radObjThckPgn", "[", 
             RowBox[{
              RowBox[{
               RowBox[{"Pos", "[", 
                RowBox[{"[", "2", "]"}], "]"}], " ", "+", "     ", 
               RowBox[{"Wm", "/", "4"}], "+", " ", "\[Delta]"}], ",", "   ", 
              RowBox[{"Ly", "/", "2"}], ",", "#", ",", " ", 
              RowBox[{
               RowBox[{"RotMag", "[", "2", "]"}], "+", " ", 
               RowBox[{"EmRot", "[", 
                RowBox[{"[", "2", "]"}], "]"}]}]}], "]"}], "&"}], "/@", 
           RowBox[{"BCPosErrorRef", "[", "2", "]"}]}]}], ";", 
         "\[IndentingNewLine]", 
         RowBox[{"CassetteBeg3", " ", "=", " ", 
          RowBox[{
           RowBox[{
            RowBox[{"radObjThckPgn", "[", 
             RowBox[{
              RowBox[{
               RowBox[{"Pos", "[", 
                RowBox[{"[", "3", "]"}], "]"}], " ", "+", "    ", 
               RowBox[{"Wm", "/", "8"}], "+", " ", "\[Delta]"}], ",", " ", 
              RowBox[{"3", 
               RowBox[{"Ly", "/", "4"}]}], ",", "#", ",", " ", 
              RowBox[{
               RowBox[{"RotMag", "[", "3", "]"}], "+", " ", 
               RowBox[{"EmRot", "[", 
                RowBox[{"[", "3", "]"}], "]"}]}]}], "]"}], "&"}], "/@", " ", 
           RowBox[{"BCPosErrorRef", "[", "3", "]"}]}]}], ";", 
         "\[IndentingNewLine]", 
         RowBox[{"CassetteBeg", " ", "=", " ", 
          RowBox[{"{", 
           RowBox[{
           "CassetteBeg1", ",", " ", "CassetteBeg2", ",", " ", 
            "CassetteBeg3"}], "}"}]}], ";", "\[IndentingNewLine]", 
         "\[IndentingNewLine]", 
         RowBox[{"CassetteEnd3", " ", "=", " ", 
          RowBox[{
           RowBox[{
            RowBox[{"radObjThckPgn", "[", 
             RowBox[{
              RowBox[{
               RowBox[{"Pos", "[", 
                RowBox[{"[", 
                 RowBox[{"-", "3"}], "]"}], "]"}], " ", "-", "    ", 
               RowBox[{"Wm", "/", "8"}], "+", " ", "\[Delta]"}], ",", " ", 
              RowBox[{"3", 
               RowBox[{"Ly", "/", "4"}]}], ",", "#", ",", " ", 
              RowBox[{
               RowBox[{"RotMag", "[", 
                RowBox[{"NrBlocks", "-", "2"}], "]"}], "+", " ", 
               RowBox[{"EmRot", "[", 
                RowBox[{"[", 
                 RowBox[{"-", "3"}], "]"}], "]"}]}]}], "]"}], "&"}], "/@", 
           RowBox[{"BCPosErrorRef", "[", 
            RowBox[{"-", "3"}], "]"}]}]}], ";", "\[IndentingNewLine]", 
         RowBox[{"CassetteEnd2", " ", "=", " ", 
          RowBox[{
           RowBox[{
            RowBox[{"radObjThckPgn", "[", 
             RowBox[{
              RowBox[{
               RowBox[{"Pos", "[", 
                RowBox[{"[", 
                 RowBox[{"-", "2"}], "]"}], "]"}], " ", "-", "    ", 
               RowBox[{"Wm", "/", "4"}], "+", " ", "\[Delta]"}], ",", "    ", 
              
              RowBox[{"Ly", "/", "2"}], ",", "#", ",", " ", 
              RowBox[{
               RowBox[{"RotMag", "[", 
                RowBox[{"NrBlocks", "-", "1"}], "]"}], "+", " ", 
               RowBox[{"EmRot", "[", 
                RowBox[{"[", 
                 RowBox[{"-", "2"}], "]"}], "]"}]}]}], "]"}], "&"}], "/@", 
           RowBox[{"BCPosErrorRef", "[", 
            RowBox[{"-", "2"}], "]"}]}]}], ";", "\[IndentingNewLine]", 
         RowBox[{"CassetteEnd1", " ", "=", " ", 
          RowBox[{
           RowBox[{
            RowBox[{"radObjThckPgn", "[", 
             RowBox[{
              RowBox[{
               RowBox[{"Pos", "[", 
                RowBox[{"[", 
                 RowBox[{"-", "1"}], "]"}], "]"}], " ", "-", 
               RowBox[{"3", 
                RowBox[{"Wm", "/", "8"}]}], "+", " ", "\[Delta]"}], ",", 
              "     ", 
              RowBox[{"Ly", "/", "4"}], ",", "#", ",", " ", 
              RowBox[{
               RowBox[{"RotMag", "[", "NrBlocks", "]"}], "+", " ", 
               RowBox[{"EmRot", "[", 
                RowBox[{"[", 
                 RowBox[{"-", "1"}], "]"}], "]"}]}]}], "]"}], "&"}], "/@", 
           RowBox[{"BCPosErrorRef", "[", 
            RowBox[{"-", "1"}], "]"}]}]}], ";", "\[IndentingNewLine]", 
         RowBox[{"CassetteEnd", " ", "=", " ", 
          RowBox[{"{", 
           RowBox[{
           "CassetteEnd3", ",", " ", "CassetteEnd2", ",", " ", 
            "CassetteEnd1"}], "}"}]}], ";"}]}], "\[IndentingNewLine]", "]"}], 
      ";", "\[IndentingNewLine]", "\[IndentingNewLine]", 
      RowBox[{"(*", "Core", "*)"}], "\[IndentingNewLine]", 
      RowBox[{"CassetteCore", " ", "=", " ", 
       RowBox[{"{", "}"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"For", " ", "[", 
       RowBox[{
        RowBox[{"i", "=", 
         RowBox[{"(", 
          RowBox[{"NrTermBlocks", "+", "1"}], ")"}]}], ",", " ", 
        RowBox[{"i", "\[LessEqual]", " ", 
         RowBox[{"NrBlocks", " ", "-", " ", "NrTermBlocks"}]}], ",", " ", 
        RowBox[{"i", "++"}], ",", "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{
          RowBox[{
           RowBox[{"AppendTo", "[", 
            RowBox[{"CassetteCore", ",", " ", 
             RowBox[{"radObjThckPgn", "[", 
              RowBox[{
               RowBox[{
                RowBox[{"Pos", "[", 
                 RowBox[{"[", "i", "]"}], "]"}], "+", " ", "\[Delta]"}], ",", 
               "Ly", ",", "#", ",", " ", 
               RowBox[{
                RowBox[{"RotMag", "[", "i", "]"}], "+", " ", 
                RowBox[{"EmRot", "[", 
                 RowBox[{"[", "i", "]"}], "]"}]}]}], "]"}]}], "]"}], "&"}], "/@",
           " ", 
          RowBox[{"BCPosErrorRef", "[", "i", "]"}]}], " ", ";"}]}], 
       "\[IndentingNewLine]", "]"}], ";", "\[IndentingNewLine]", 
      "\[IndentingNewLine]", 
      RowBox[{"Cassette", "   ", "=", " ", 
       RowBox[{"radObjCnt", "[", 
        RowBox[{"Flatten", "[", 
         RowBox[{"{", 
          RowBox[{
          "CassetteBeg", " ", ",", " ", "CassetteCore", ",", "CassetteEnd"}], 
          "}"}], "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
      "\[IndentingNewLine]", 
      RowBox[{"(*", 
       RowBox[{
        RowBox[{
        "Counterclockwise", " ", "rotation", " ", "of", " ", "the", " ", 
         "cassette", " ", "by", " ", 
         RowBox[{"\[Pi]", "/", "2"}], " ", "around", " ", "the", " ", "z"}], 
        "-", "axis"}], "*)"}], "\[IndentingNewLine]", 
      RowBox[{"Cassette", "=", " ", 
       RowBox[{"radTrfOrnt", "[", 
        RowBox[{"Cassette", ",", " ", 
         RowBox[{"radTrfRot", "[", 
          RowBox[{
           RowBox[{"{", 
            RowBox[{"0", ",", "0", ",", "0"}], "}"}], ",", 
           RowBox[{"{", 
            RowBox[{"0", ",", "0", ",", "1"}], "}"}], ",", 
           RowBox[{"\[Pi]", "/", "2"}]}], "]"}]}], "]"}]}], ";", 
      "\[IndentingNewLine]", "\[IndentingNewLine]", 
      RowBox[{"(*", 
       RowBox[{"Shift", " ", "the", " ", "cassette"}], "*)"}], 
      "\[IndentingNewLine]", 
      RowBox[{"Shift", "=", 
       RowBox[{
        RowBox[{"-", 
         RowBox[{"(", 
          RowBox[{
           RowBox[{"Pos", "[", 
            RowBox[{"[", "1", "]"}], "]"}], "+", " ", 
           RowBox[{"Pos", "[", 
            RowBox[{"[", 
             RowBox[{"-", "1"}], "]"}], "]"}]}], ")"}]}], "/", "2"}]}], " ", 
      ";", "\[IndentingNewLine]", 
      RowBox[{"Cassette", " ", "=", " ", 
       RowBox[{"radTrfOrnt", "[", 
        RowBox[{"Cassette", ",", 
         RowBox[{"radTrfTrsl", "[", 
          RowBox[{"{", 
           RowBox[{"0", ",", "Shift", ",", "0"}], "}"}], "]"}]}], "]"}]}], 
      ";", "\[IndentingNewLine]", "\[IndentingNewLine]", 
      RowBox[{"Print", "[", 
       RowBox[{"\"\<Cassette number of blocks: \>\"", ",", " ", "NrBlocks"}], 
       "]"}], ";", "\[IndentingNewLine]", 
      RowBox[{"Return", "[", "Cassette", "]"}], ";"}]}], 
    "\[IndentingNewLine]", "]"}]}], ";"}]], "Input",
 CellChangeTimes->{{3.7667563716198864`*^9, 3.76675637607336*^9}, {
   3.7667564210925236`*^9, 3.7667565039740367`*^9}, {3.767445221866372*^9, 
   3.7674452499623413`*^9}, 3.7674492825809617`*^9},
 Background->RGBColor[0.87, 0.94, 1]]
}, Closed]],

Cell[CellGroupData[{

Cell["auxIDRectangularCassette", "Subsection",
 CellChangeTimes->{{3.766754730782276*^9, 3.766754770082241*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"auxIDRectangularCassette", "[", 
    RowBox[{
    "\[Lambda]u_", ",", " ", "Np_", ",", "  ", "Br_", ",", " ", "Lx_", ",", 
     "Lz_", ",", "  ", "\[Delta]_", ",", " ", "BC_", ",", " ", "BlockGap_", 
     ",", 
     RowBox[{"OptionsPattern", "[", 
      RowBox[{"{", 
       RowBox[{
        RowBox[{"\"\<PointingUp\>\"", "\[Rule]", " ", "True"}], ",", " ", 
        RowBox[{"\"\<FirstBlock\>\"", "\[Rule]", " ", "\"\<Up\>\""}], ",", 
        " ", 
        RowBox[{
        "\"\<FieldDirection\>\"", "\[Rule]", " ", "\"\<Vertical\>\""}], ",", 
        " ", 
        RowBox[{"\"\<Termination\>\"", "\[Rule]", " ", "\"\<None\>\""}], ",", 
        " ", 
        RowBox[{"\"\<PosMagErrors\>\"", "\[Rule]", " ", 
         RowBox[{"{", "}"}]}]}], "}"}], "]"}]}], "]"}], " ", ":=", " ", 
   RowBox[{"Module", "[", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"{", " ", 
      RowBox[{
      "Wm", ",", " ", "Ly", ",", "NrBlocks", ",", " ", "NrCoreBlocks", ",", 
       " ", "NrTermBlocks", ",", "  ", "AddCoreBlocks", ",", " ", "Pos", ",", 
       " ", "PointingUp", ",", " ", "FirstBlock", ",", " ", "FieldDirection", 
       ",", " ", "PosMagErrors", ",", " ", "Eh", ",", " ", "Ev", ",", " ", 
       "Em", ",", "\[IndentingNewLine]", "PointingUpList", ",", " ", 
       "PointingDownList", ",", " ", "AddIdx", ",", " ", "Mag", ",", " ", "i",
        ",", " ", "Shift", ",", " ", "CenterBC", ",", "Termination", ",", 
       "\[IndentingNewLine]", "CassetteBeg", ",", "CassetteBeg1", ",", " ", 
       "CassetteBeg2", ",", " ", "CassetteBeg3", ",", "\[IndentingNewLine]", 
       "CassetteEnd", ",", "CassetteEnd1", ",", " ", "CassetteEnd2", ",", " ",
        "CassetteEnd3", ",", "\[IndentingNewLine]", "CassetteCore", ",", 
       "Cassette"}], "}"}], ",", "\[IndentingNewLine]", "\[IndentingNewLine]", 
     RowBox[{"(*", 
      RowBox[{"Termination", " ", "Type"}], "*)"}], "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"NrTermBlocks", "=", " ", "0"}], ";", "\[IndentingNewLine]", 
      RowBox[{"AddCoreBlocks", " ", "=", " ", "0"}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"Termination", " ", "=", " ", 
       RowBox[{"OptionValue", "[", "\"\<Termination\>\"", "]"}]}], ";", 
      "\[IndentingNewLine]", "\[IndentingNewLine]", 
      RowBox[{"If", "[", 
       RowBox[{
        RowBox[{"Termination", "\[Equal]", " ", "\"\<OneBlockSym\>\""}], ",", 
        "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"NrTermBlocks", "=", " ", "1"}], ";", "\[IndentingNewLine]", 
         
         RowBox[{"AddCoreBlocks", " ", "=", " ", "3"}], ";"}]}], 
       "\[IndentingNewLine]", "]"}], ";", "\[IndentingNewLine]", 
      "\[IndentingNewLine]", 
      RowBox[{"If", "[", 
       RowBox[{
        RowBox[{"Termination", "\[Equal]", " ", "\"\<OneBlockAntiSym\>\""}], 
        ",", "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"NrTermBlocks", "=", " ", "1"}], ";", "\[IndentingNewLine]", 
         
         RowBox[{"AddCoreBlocks", " ", "=", " ", "1"}], ";"}]}], 
       "\[IndentingNewLine]", "]"}], ";", "\[IndentingNewLine]", 
      "\[IndentingNewLine]", 
      RowBox[{"If", "[", 
       RowBox[{
        RowBox[{"Termination", "\[Equal]", " ", "\"\<ThreeBlocksSym\>\""}], 
        ",", "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"NrTermBlocks", "=", " ", "3"}], ";", "\[IndentingNewLine]", 
         
         RowBox[{"AddCoreBlocks", " ", "=", "3"}], ";"}]}], 
       "\[IndentingNewLine]", "]"}], ";", "\[IndentingNewLine]", 
      "\[IndentingNewLine]", 
      RowBox[{"If", "[", 
       RowBox[{
        RowBox[{
        "Termination", "\[Equal]", " ", "\"\<ThreeBlocksAntiSym\>\""}], ",", 
        "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"NrTermBlocks", "=", " ", "3"}], ";", "\[IndentingNewLine]", 
         
         RowBox[{"AddCoreBlocks", " ", "=", "1"}], ";"}]}], 
       "\[IndentingNewLine]", "]"}], ";", "\[IndentingNewLine]", 
      "\[IndentingNewLine]", 
      RowBox[{"(*", 
       RowBox[{
       "Longitudinal", " ", "position", " ", "of", " ", "the", " ", 
        "blocks"}], "*)"}], "\[IndentingNewLine]", 
      RowBox[{"Wm", "=", " ", 
       RowBox[{"\[Lambda]u", "/", "4"}]}], ";", "\[IndentingNewLine]", 
      "\[IndentingNewLine]", 
      RowBox[{"(*", 
       RowBox[{"Block", " ", "size"}], "*)"}], "\[IndentingNewLine]", 
      RowBox[{"Ly", " ", "=", " ", 
       RowBox[{"Wm", " ", "-", " ", "BlockGap"}]}], ";", 
      "\[IndentingNewLine]", "\[IndentingNewLine]", 
      RowBox[{"(*", 
       RowBox[{"Position", " ", "of", " ", "blocks"}], "*)"}], 
      "\[IndentingNewLine]", 
      RowBox[{"NrCoreBlocks", "=", " ", 
       RowBox[{
        RowBox[{"(", 
         RowBox[{"4", "*", "Np"}], ")"}], " ", "+", " ", "AddCoreBlocks"}]}], 
      ";", "\[IndentingNewLine]", 
      RowBox[{"NrBlocks", " ", "=", " ", 
       RowBox[{"NrCoreBlocks", "+", " ", 
        RowBox[{"(", 
         RowBox[{"2", "*", "NrTermBlocks"}], ")"}]}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"Pos", " ", "=", " ", 
       RowBox[{"Wm", "*", 
        RowBox[{"Range", "[", 
         RowBox[{"0", ",", 
          RowBox[{"NrBlocks", " ", "-", " ", "1"}]}], "]"}]}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"CenterBC", " ", "=", " ", 
       RowBox[{"RegionCentroid", "[", 
        RowBox[{"Polygon", "[", "BC", "]"}], "]"}]}], ";", 
      "\[IndentingNewLine]", "\[IndentingNewLine]", 
      RowBox[{"(*", 
       RowBox[{"Magnetization", " ", "direction"}], "*)"}], 
      "\[IndentingNewLine]", 
      RowBox[{"PointingUp", " ", "=", " ", 
       RowBox[{"OptionValue", "[", "\"\<PointingUp\>\"", "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"FirstBlock", " ", "=", " ", 
       RowBox[{"OptionValue", "[", "\"\<FirstBlock\>\"", "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"FieldDirection", " ", "=", " ", 
       RowBox[{"OptionValue", "[", "\"\<FieldDirection\>\"", "]"}]}], ";", 
      "\[IndentingNewLine]", "\[IndentingNewLine]", 
      RowBox[{"If", "[", 
       RowBox[{
        RowBox[{
        "FieldDirection", " ", "\[Equal]", " ", "\"\<Horizontal\>\""}], ",", 
        "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"PointingUpList", " ", "=", " ", 
          RowBox[{"{", 
           RowBox[{
            RowBox[{"{", 
             RowBox[{"Br", ",", "0", ",", "0"}], "}"}], ",", " ", 
            RowBox[{"{", 
             RowBox[{"0", ",", " ", 
              RowBox[{"-", "Br"}], ",", " ", "0"}], "}"}], ",", " ", 
            RowBox[{"{", 
             RowBox[{
              RowBox[{"-", "Br"}], ",", "0", ",", "0"}], "}"}], ",", " ", 
            RowBox[{"{", 
             RowBox[{"0", ",", " ", "Br", ",", " ", "0"}], "}"}]}], "}"}]}], 
         ";", "\[IndentingNewLine]", 
         RowBox[{"PointingDownList", " ", "=", " ", 
          RowBox[{"{", 
           RowBox[{
            RowBox[{"{", 
             RowBox[{"Br", ",", "0", ",", "0"}], "}"}], ",", " ", 
            RowBox[{"{", 
             RowBox[{"0", ",", " ", "Br", ",", " ", "0"}], "}"}], ",", " ", 
            RowBox[{"{", 
             RowBox[{
              RowBox[{"-", "Br"}], ",", "0", ",", "0"}], "}"}], ",", " ", 
            RowBox[{"{", 
             RowBox[{"0", ",", " ", 
              RowBox[{"-", "Br"}], ",", " ", "0"}], "}"}]}], "}"}]}], ";"}], 
        ",", "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"PointingUpList", " ", "=", " ", 
          RowBox[{"{", 
           RowBox[{
            RowBox[{"{", 
             RowBox[{"0", ",", "0", ",", "Br"}], "}"}], ",", " ", 
            RowBox[{"{", 
             RowBox[{"0", ",", " ", 
              RowBox[{"-", "Br"}], ",", " ", "0"}], "}"}], ",", " ", 
            RowBox[{"{", 
             RowBox[{"0", ",", "0", ",", 
              RowBox[{"-", "Br"}]}], "}"}], ",", " ", 
            RowBox[{"{", 
             RowBox[{"0", ",", " ", "Br", ",", " ", "0"}], "}"}]}], "}"}]}], 
         ";", "\[IndentingNewLine]", 
         RowBox[{"PointingDownList", " ", "=", " ", 
          RowBox[{"{", 
           RowBox[{
            RowBox[{"{", 
             RowBox[{"0", ",", "0", ",", "Br"}], "}"}], ",", " ", 
            RowBox[{"{", 
             RowBox[{"0", ",", " ", "Br", ",", " ", "0"}], "}"}], ",", " ", 
            RowBox[{"{", 
             RowBox[{"0", ",", "0", ",", 
              RowBox[{"-", "Br"}]}], "}"}], ",", " ", 
            RowBox[{"{", 
             RowBox[{"0", ",", " ", 
              RowBox[{"-", "Br"}], ",", " ", "0"}], "}"}]}], "}"}]}], ";"}]}],
        "\[IndentingNewLine]", "]"}], ";", "\[IndentingNewLine]", 
      "\[IndentingNewLine]", 
      RowBox[{"AddIdx", " ", "=", " ", "0"}], ";", "\[IndentingNewLine]", 
      RowBox[{"If", " ", "[", 
       RowBox[{
        RowBox[{"FirstBlock", " ", "\[Equal]", " ", "\"\<Up\>\""}], ",", " ", 
        
        RowBox[{"AddIdx", " ", "=", "0"}]}], "]"}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"If", " ", "[", 
       RowBox[{
        RowBox[{"FirstBlock", " ", "\[Equal]", " ", "\"\<Down\>\""}], ",", 
        " ", 
        RowBox[{"AddIdx", "=", "2"}]}], "]"}], ";", "\[IndentingNewLine]", 
      RowBox[{"If", " ", "[", 
       RowBox[{
        RowBox[{
         RowBox[{"FirstBlock", " ", "\[Equal]", " ", "\"\<Foward\>\""}], " ", 
         "&&", " ", "PointingUp"}], ",", " ", 
        RowBox[{"AddIdx", "=", "3"}]}], "]"}], ";", "\[IndentingNewLine]", 
      RowBox[{"If", " ", "[", 
       RowBox[{
        RowBox[{
         RowBox[{"FirstBlock", " ", "\[Equal]", " ", "\"\<Foward\>\""}], " ", 
         "&&", " ", 
         RowBox[{"Not", " ", "PointingUp"}]}], ",", " ", 
        RowBox[{"AddIdx", "=", "1"}]}], "]"}], ";", "\[IndentingNewLine]", 
      RowBox[{"If", " ", "[", 
       RowBox[{
        RowBox[{
         RowBox[{"FirstBlock", " ", "\[Equal]", " ", "\"\<Backward\>\""}], 
         " ", "&&", " ", "PointingUp"}], ",", " ", 
        RowBox[{"AddIdx", "=", "1"}]}], "]"}], ";", "\[IndentingNewLine]", 
      RowBox[{"If", " ", "[", 
       RowBox[{
        RowBox[{
         RowBox[{"FirstBlock", " ", "\[Equal]", " ", "\"\<Backward\>\""}], 
         " ", "&&", " ", 
         RowBox[{"Not", " ", "PointingUp"}]}], ",", " ", 
        RowBox[{"AddIdx", "=", "3"}]}], "]"}], ";", "\[IndentingNewLine]", 
      "\[IndentingNewLine]", 
      RowBox[{"If", " ", "[", 
       RowBox[{"PointingUp", ",", "  ", "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"Mag", "[", "idx_", "]"}], " ", ":=", " ", 
         RowBox[{"PointingUpList", "[", 
          RowBox[{"[", 
           RowBox[{"If", "[", 
            RowBox[{
             RowBox[{"Divisible", "[", 
              RowBox[{
               RowBox[{"idx", " ", "+", " ", "AddIdx"}], ",", " ", "4"}], 
              "]"}], " ", ",", " ", "4", " ", ",", " ", 
             RowBox[{"Mod", "[", 
              RowBox[{
               RowBox[{"idx", "+", " ", "AddIdx"}], ",", " ", "4"}], "]"}]}], 
            " ", "]"}], "]"}], "]"}]}], ",", " ", "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"Mag", "[", "idx_", "]"}], " ", ":=", " ", 
         RowBox[{"PointingDownList", "[", 
          RowBox[{"[", 
           RowBox[{"If", "[", 
            RowBox[{
             RowBox[{"Divisible", "[", 
              RowBox[{
               RowBox[{"idx", " ", "+", " ", "AddIdx"}], ",", " ", "4"}], 
              "]"}], ",", " ", "4", " ", ",", " ", 
             RowBox[{"Mod", "[", 
              RowBox[{
               RowBox[{"idx", "+", " ", "AddIdx"}], ",", " ", "4"}], "]"}]}], 
            " ", "]"}], "]"}], "]"}]}]}], "\[IndentingNewLine]", "]"}], ";", 
      " ", "\[IndentingNewLine]", "\[IndentingNewLine]", 
      RowBox[{"(*", 
       RowBox[{"Position", " ", "and", " ", "magnetization", " ", "errors"}], 
       "*)"}], "\[IndentingNewLine]", 
      RowBox[{"PosMagErrors", " ", "=", " ", 
       RowBox[{"OptionValue", "[", "\"\<PosMagErrors\>\"", "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"If", " ", "[", 
       RowBox[{
        RowBox[{
         RowBox[{"Length", "[", "PosMagErrors", "]"}], " ", "\[Equal]", " ", 
         "0"}], ",", " ", 
        RowBox[{"PosMagErrors", " ", "=", " ", 
         RowBox[{"Table", "[", 
          RowBox[{
           RowBox[{"{", 
            RowBox[{
            "0", ",", " ", "0", ",", " ", "0", ",", " ", "0", ",", " ", "0"}],
             "}"}], ",", " ", "NrBlocks"}], "]"}]}]}], "]"}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"If", " ", "[", 
       RowBox[{
        RowBox[{
         RowBox[{"Length", "[", "PosMagErrors", "]"}], " ", "\[NotEqual]", 
         " ", "NrBlocks"}], ",", " ", 
        RowBox[{"Return", "[", "]"}]}], "]"}], ";", "\[IndentingNewLine]", 
      RowBox[{"Eh", " ", "=", " ", 
       RowBox[{"PosMagErrors", "[", 
        RowBox[{"[", 
         RowBox[{"All", ",", " ", "1"}], "]"}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"Ev", " ", "=", " ", 
       RowBox[{"PosMagErrors", "[", 
        RowBox[{"[", 
         RowBox[{"All", ",", " ", "2"}], "]"}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"Em", " ", "=", 
       RowBox[{"Transpose", "@", 
        RowBox[{"{", 
         RowBox[{
          RowBox[{"PosMagErrors", "[", 
           RowBox[{"[", 
            RowBox[{"All", ",", " ", "3"}], "]"}], "]"}], ",", " ", 
          RowBox[{"PosMagErrors", "[", 
           RowBox[{"[", 
            RowBox[{"All", ",", " ", "4"}], "]"}], "]"}], ",", " ", 
          RowBox[{"PosMagErrors", "[", 
           RowBox[{"[", 
            RowBox[{"All", ",", " ", "5"}], "]"}], "]"}]}], "}"}]}]}], ";", 
      "\[IndentingNewLine]", "\[IndentingNewLine]", 
      RowBox[{"(*", 
       RowBox[{"Termination", " ", "blocks"}], "*)"}], "\[IndentingNewLine]", 
      
      RowBox[{"CassetteBeg", " ", "=", " ", 
       RowBox[{"{", "}"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"CassetteEnd", " ", "=", " ", 
       RowBox[{"{", "}"}]}], ";", "\[IndentingNewLine]", 
      "\[IndentingNewLine]", 
      RowBox[{"If", " ", "[", 
       RowBox[{
        RowBox[{
         RowBox[{"Termination", "\[Equal]", " ", "\"\<OneBlockSym\>\""}], " ",
          "||", " ", 
         RowBox[{
         "Termination", "\[Equal]", " ", "\"\<OneBlockAntiSym\>\""}]}], ",", 
        "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"CassetteBeg", " ", "=", 
          RowBox[{"radObjRecMag", "[", 
           RowBox[{
            RowBox[{"{", 
             RowBox[{
              RowBox[{
               RowBox[{"CenterBC", "[", 
                RowBox[{"[", "1", "]"}], "]"}], " ", "+", " ", 
               RowBox[{"Eh", "[", 
                RowBox[{"[", "1", "]"}], "]"}]}], ",", 
              RowBox[{
               RowBox[{"Pos", "[", 
                RowBox[{"[", "1", "]"}], "]"}], "+", " ", 
               RowBox[{"Wm", "/", "4"}], " ", "+", " ", "\[Delta]"}], ",", 
              RowBox[{
               RowBox[{"CenterBC", "[", 
                RowBox[{"[", "2", "]"}], "]"}], "+", " ", 
               RowBox[{"Ev", "[", 
                RowBox[{"[", "1", "]"}], "]"}]}]}], "}"}], ",", 
            RowBox[{"{", 
             RowBox[{"Lx", ",", 
              RowBox[{"Ly", "/", "2"}], ",", "Lz"}], "}"}], ",", 
            RowBox[{
             RowBox[{"Mag", "[", "1", "]"}], "+", " ", 
             RowBox[{"Em", "[", 
              RowBox[{"[", "1", "]"}], "]"}]}]}], "]"}]}], ";", 
         "\[IndentingNewLine]", 
         RowBox[{"CassetteEnd", " ", "=", " ", 
          RowBox[{"radObjRecMag", "[", 
           RowBox[{
            RowBox[{"{", 
             RowBox[{
              RowBox[{
               RowBox[{"CenterBC", "[", 
                RowBox[{"[", "1", "]"}], "]"}], "+", " ", 
               RowBox[{"Eh", "[", 
                RowBox[{"[", 
                 RowBox[{"-", "1"}], "]"}], "]"}]}], ",", 
              RowBox[{
               RowBox[{"Pos", "[", 
                RowBox[{"[", 
                 RowBox[{"-", "1"}], "]"}], "]"}], "-", " ", 
               RowBox[{"Wm", "/", "4"}], " ", "+", " ", "\[Delta]"}], ",", 
              RowBox[{
               RowBox[{"CenterBC", "[", 
                RowBox[{"[", "2", "]"}], "]"}], "+", 
               RowBox[{"Ev", "[", 
                RowBox[{"[", 
                 RowBox[{"-", "1"}], "]"}], "]"}]}]}], "}"}], ",", 
            RowBox[{"{", 
             RowBox[{"Lx", ",", 
              RowBox[{"Ly", "/", "2"}], ",", "Lz"}], "}"}], ",", 
            RowBox[{
             RowBox[{"Mag", "[", "NrBlocks", "]"}], " ", "+", " ", 
             RowBox[{"Em", "[", 
              RowBox[{"[", 
               RowBox[{"-", "1"}], "]"}], "]"}]}]}], "]"}]}], ";"}]}], 
       "\[IndentingNewLine]", "]"}], ";", "\[IndentingNewLine]", 
      "\[IndentingNewLine]", 
      RowBox[{"If", " ", "[", 
       RowBox[{
        RowBox[{
         RowBox[{"Termination", "\[Equal]", " ", "\"\<ThreeBlocksSym\>\""}], 
         " ", "||", " ", 
         RowBox[{
         "Termination", "\[Equal]", " ", "\"\<ThreeBlocksAntiSym\>\""}]}], 
        ",", "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"CassetteBeg1", " ", "=", 
          RowBox[{"radObjRecMag", "[", 
           RowBox[{
            RowBox[{"{", 
             RowBox[{
              RowBox[{
               RowBox[{"CenterBC", "[", 
                RowBox[{"[", "1", "]"}], "]"}], "+", " ", 
               RowBox[{"Eh", "[", 
                RowBox[{"[", "1", "]"}], "]"}]}], ",", 
              RowBox[{
               RowBox[{"Pos", "[", 
                RowBox[{"[", "1", "]"}], "]"}], "+", " ", 
               RowBox[{"3", "*", 
                RowBox[{"Wm", "/", "8"}]}], " ", "+", " ", "\[Delta]"}], ",", 
              
              RowBox[{
               RowBox[{"CenterBC", "[", 
                RowBox[{"[", "2", "]"}], "]"}], "+", " ", 
               RowBox[{"Ev", "[", 
                RowBox[{"[", "1", "]"}], "]"}]}]}], "}"}], ",", 
            RowBox[{"{", 
             RowBox[{"Lx", ",", 
              RowBox[{"Ly", "/", "4"}], ",", "Lz"}], "}"}], ",", 
            RowBox[{
             RowBox[{"Mag", "[", "1", "]"}], "+", " ", 
             RowBox[{"Em", "[", 
              RowBox[{"[", "1", "]"}], "]"}]}]}], "]"}]}], ";", 
         "\[IndentingNewLine]", 
         RowBox[{"CassetteBeg2", " ", "=", 
          RowBox[{"radObjRecMag", "[", 
           RowBox[{
            RowBox[{"{", 
             RowBox[{
              RowBox[{
               RowBox[{"CenterBC", "[", 
                RowBox[{"[", "1", "]"}], "]"}], "+", " ", 
               RowBox[{"Eh", "[", 
                RowBox[{"[", "2", "]"}], "]"}]}], ",", 
              RowBox[{
               RowBox[{"Pos", "[", 
                RowBox[{"[", "2", "]"}], "]"}], "+", "    ", 
               RowBox[{"Wm", "/", "4"}], " ", "+", " ", "\[Delta]"}], ",", 
              RowBox[{
               RowBox[{"CenterBC", "[", 
                RowBox[{"[", "2", "]"}], "]"}], "+", " ", 
               RowBox[{"Ev", "[", 
                RowBox[{"[", "2", "]"}], "]"}]}]}], "}"}], ",", 
            RowBox[{"{", 
             RowBox[{"Lx", ",", 
              RowBox[{"Ly", "/", "2"}], ",", "Lz"}], "}"}], ",", 
            RowBox[{
             RowBox[{"Mag", "[", "2", "]"}], "+", " ", 
             RowBox[{"Em", "[", 
              RowBox[{"[", "2", "]"}], "]"}]}]}], "]"}]}], ";", 
         "\[IndentingNewLine]", 
         RowBox[{"CassetteBeg3", " ", "=", 
          RowBox[{"radObjRecMag", "[", 
           RowBox[{
            RowBox[{"{", 
             RowBox[{
              RowBox[{
               RowBox[{"CenterBC", "[", 
                RowBox[{"[", "1", "]"}], "]"}], "+", " ", 
               RowBox[{"Eh", "[", 
                RowBox[{"[", "3", "]"}], "]"}]}], ",", 
              RowBox[{
               RowBox[{"Pos", "[", 
                RowBox[{"[", "3", "]"}], "]"}], "+", "     ", 
               RowBox[{"Wm", "/", "8"}], "+", " ", "\[Delta]"}], ",", 
              RowBox[{
               RowBox[{"CenterBC", "[", 
                RowBox[{"[", "2", "]"}], "]"}], "+", " ", 
               RowBox[{"Ev", "[", 
                RowBox[{"[", "3", "]"}], "]"}]}]}], "}"}], ",", 
            RowBox[{"{", 
             RowBox[{"Lx", ",", 
              RowBox[{"3", "*", 
               RowBox[{"Ly", "/", "4"}]}], ",", "Lz"}], "}"}], ",", 
            RowBox[{
             RowBox[{"Mag", "[", "3", "]"}], "+", " ", 
             RowBox[{"Em", "[", 
              RowBox[{"[", "3", "]"}], "]"}]}]}], "]"}]}], ";", 
         "\[IndentingNewLine]", 
         RowBox[{"CassetteBeg", " ", "=", " ", 
          RowBox[{"{", 
           RowBox[{
           "CassetteBeg1", ",", " ", "CassetteBeg2", ",", " ", 
            "CassetteBeg3"}], "}"}]}], ";", "\[IndentingNewLine]", 
         "\[IndentingNewLine]", 
         RowBox[{"CassetteEnd3", " ", "=", " ", 
          RowBox[{"radObjRecMag", "[", 
           RowBox[{
            RowBox[{"{", 
             RowBox[{
              RowBox[{
               RowBox[{"CenterBC", "[", 
                RowBox[{"[", "1", "]"}], "]"}], "+", " ", 
               RowBox[{"Eh", "[", 
                RowBox[{"[", 
                 RowBox[{"-", "3"}], "]"}], "]"}]}], ",", 
              RowBox[{
               RowBox[{"Pos", "[", 
                RowBox[{"[", 
                 RowBox[{"-", "3"}], "]"}], "]"}], "-", "   ", 
               RowBox[{"Wm", "/", "8"}], "+", " ", "\[Delta]"}], " ", ",", 
              RowBox[{
               RowBox[{"CenterBC", "[", 
                RowBox[{"[", "2", "]"}], "]"}], "+", " ", 
               RowBox[{"Ev", "[", 
                RowBox[{"[", 
                 RowBox[{"-", "3"}], "]"}], "]"}]}]}], "}"}], ",", 
            RowBox[{"{", 
             RowBox[{"Lx", ",", 
              RowBox[{"3", "*", 
               RowBox[{"Ly", "/", "4"}]}], ",", "Lz"}], "}"}], ",", 
            RowBox[{
             RowBox[{"Mag", "[", 
              RowBox[{"NrBlocks", "-", "2"}], "]"}], "+", " ", 
             RowBox[{"Em", "[", 
              RowBox[{"[", 
               RowBox[{"-", "3"}], "]"}], "]"}]}]}], "]"}]}], ";", 
         "\[IndentingNewLine]", 
         RowBox[{"CassetteEnd2", " ", "=", " ", 
          RowBox[{"radObjRecMag", "[", 
           RowBox[{
            RowBox[{"{", 
             RowBox[{
              RowBox[{
               RowBox[{"CenterBC", "[", 
                RowBox[{"[", "1", "]"}], "]"}], "+", " ", 
               RowBox[{"Eh", "[", 
                RowBox[{"[", 
                 RowBox[{"-", "2"}], "]"}], "]"}]}], ",", 
              RowBox[{
               RowBox[{"Pos", "[", 
                RowBox[{"[", 
                 RowBox[{"-", "2"}], "]"}], "]"}], "-", "    ", 
               RowBox[{"Wm", "/", "4"}], " ", "+", " ", "\[Delta]"}], ",", 
              RowBox[{
               RowBox[{"CenterBC", "[", 
                RowBox[{"[", "2", "]"}], "]"}], "+", " ", 
               RowBox[{"Ev", "[", 
                RowBox[{"[", 
                 RowBox[{"-", "2"}], "]"}], "]"}]}]}], "}"}], ",", 
            RowBox[{"{", 
             RowBox[{"Lx", ",", 
              RowBox[{"Ly", "/", "2"}], ",", "Lz"}], "}"}], ",", 
            RowBox[{
             RowBox[{"Mag", "[", 
              RowBox[{"NrBlocks", "-", "1"}], "]"}], "+", " ", 
             RowBox[{"Em", "[", 
              RowBox[{"[", 
               RowBox[{"-", "2"}], "]"}], "]"}]}]}], "]"}]}], ";", 
         "\[IndentingNewLine]", 
         RowBox[{"CassetteEnd1", " ", "=", " ", 
          RowBox[{"radObjRecMag", "[", 
           RowBox[{
            RowBox[{"{", 
             RowBox[{
              RowBox[{
               RowBox[{"CenterBC", "[", 
                RowBox[{"[", "1", "]"}], "]"}], "+", " ", 
               RowBox[{"Eh", "[", 
                RowBox[{"[", 
                 RowBox[{"-", "1"}], "]"}], "]"}]}], ",", 
              RowBox[{
               RowBox[{"Pos", "[", 
                RowBox[{"[", 
                 RowBox[{"-", "1"}], "]"}], "]"}], "-", " ", 
               RowBox[{"3", "*", 
                RowBox[{"Wm", "/", "8"}]}], " ", "+", " ", "\[Delta]"}], ",", 
              
              RowBox[{
               RowBox[{"CenterBC", "[", 
                RowBox[{"[", "2", "]"}], "]"}], "+", " ", 
               RowBox[{"Ev", "[", 
                RowBox[{"[", 
                 RowBox[{"-", "1"}], "]"}], "]"}]}]}], "}"}], ",", 
            RowBox[{"{", 
             RowBox[{"Lx", ",", 
              RowBox[{"Ly", "/", "4"}], ",", "Lz"}], "}"}], ",", 
            RowBox[{
             RowBox[{"Mag", "[", "NrBlocks", "]"}], "+", " ", 
             RowBox[{"Em", "[", 
              RowBox[{"[", 
               RowBox[{"-", "1"}], "]"}], "]"}]}]}], "]"}]}], ";", 
         "\[IndentingNewLine]", 
         RowBox[{"CassetteEnd", " ", "=", " ", 
          RowBox[{"{", 
           RowBox[{
           "CassetteEnd3", ",", " ", "CassetteEnd2", ",", " ", 
            "CassetteEnd1"}], "}"}]}], ";"}]}], "\[IndentingNewLine]", "]"}], 
      ";", "\[IndentingNewLine]", "\[IndentingNewLine]", 
      RowBox[{"(*", "Core", "*)"}], "\[IndentingNewLine]", 
      RowBox[{"CassetteCore", " ", "=", " ", 
       RowBox[{"{", "}"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"For", " ", "[", 
       RowBox[{
        RowBox[{"i", "=", 
         RowBox[{"(", 
          RowBox[{"NrTermBlocks", "+", "1"}], ")"}]}], ",", " ", 
        RowBox[{"i", "\[LessEqual]", " ", 
         RowBox[{"NrBlocks", " ", "-", " ", "NrTermBlocks"}]}], ",", " ", 
        RowBox[{"i", "++"}], ",", "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"AppendTo", "[", 
          RowBox[{"CassetteCore", ",", " ", 
           RowBox[{"radObjRecMag", "[", 
            RowBox[{
             RowBox[{"{", 
              RowBox[{
               RowBox[{
                RowBox[{"CenterBC", "[", 
                 RowBox[{"[", "1", "]"}], "]"}], "+", " ", 
                RowBox[{"Eh", "[", 
                 RowBox[{"[", "i", "]"}], "]"}]}], ",", 
               RowBox[{
                RowBox[{"Pos", "[", 
                 RowBox[{"[", "i", "]"}], "]"}], "+", " ", "\[Delta]"}], ",", 
               
               RowBox[{
                RowBox[{"CenterBC", "[", 
                 RowBox[{"[", "2", "]"}], "]"}], "+", 
                RowBox[{"Ev", "[", 
                 RowBox[{"[", "i", "]"}], "]"}]}]}], "}"}], ",", 
             RowBox[{"{", 
              RowBox[{"Lx", ",", "Ly", ",", "Lz"}], "}"}], ",", 
             RowBox[{
              RowBox[{"Mag", "[", "i", "]"}], " ", "+", " ", 
              RowBox[{"Em", "[", 
               RowBox[{"[", "i", "]"}], "]"}]}]}], "]"}]}], "]"}], ";"}]}], 
       "\[IndentingNewLine]", "]"}], ";", "\[IndentingNewLine]", 
      "\[IndentingNewLine]", 
      RowBox[{"Cassette", "   ", "=", "  ", 
       RowBox[{"radObjCnt", "[", 
        RowBox[{"Flatten", "[", 
         RowBox[{"{", 
          RowBox[{
          "CassetteBeg", ",", " ", "CassetteCore", ",", "CassetteEnd"}], 
          "}"}], "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
      "\[IndentingNewLine]", 
      RowBox[{"(*", 
       RowBox[{"Shift", " ", "the", " ", "cassette"}], "*)"}], 
      "\[IndentingNewLine]", 
      RowBox[{"Shift", "=", 
       RowBox[{
        RowBox[{"-", 
         RowBox[{"(", 
          RowBox[{
           RowBox[{"Pos", "[", 
            RowBox[{"[", "1", "]"}], "]"}], "+", " ", 
           RowBox[{"Pos", "[", 
            RowBox[{"[", 
             RowBox[{"-", "1"}], "]"}], "]"}]}], ")"}]}], "/", "2"}]}], " ", 
      ";", "\[IndentingNewLine]", 
      RowBox[{"Cassette", " ", "=", " ", 
       RowBox[{"radTrfOrnt", "[", 
        RowBox[{"Cassette", ",", 
         RowBox[{"radTrfTrsl", "[", 
          RowBox[{"{", 
           RowBox[{"0", ",", "Shift", ",", "0"}], "}"}], "]"}]}], "]"}]}], 
      ";", "\[IndentingNewLine]", "\[IndentingNewLine]", 
      RowBox[{"Print", "[", 
       RowBox[{"\"\<Cassette number of blocks: \>\"", ",", " ", "NrBlocks"}], 
       "]"}], ";", "\[IndentingNewLine]", 
      RowBox[{"Return", "[", "Cassette", "]"}], ";"}]}], 
    "\[IndentingNewLine]", "]"}]}], ";"}]], "Input",
 CellChangeTimes->{{3.766243718829591*^9, 3.766243779478277*^9}, {
   3.76624382902905*^9, 3.7662439102073035`*^9}, {3.766244089174488*^9, 
   3.766244295694003*^9}, {3.7662443296497974`*^9, 3.766244340947559*^9}, {
   3.7662444013273144`*^9, 3.766244453631114*^9}, {3.766244497107057*^9, 
   3.7662448737333684`*^9}, {3.7662449074078903`*^9, 
   3.7662450693434334`*^9}, {3.7662451124092927`*^9, 3.766245131957735*^9}, {
   3.766245868638597*^9, 3.7662458743577986`*^9}, {3.766245974928212*^9, 
   3.766245993507789*^9}, {3.766246043074186*^9, 3.766246043839871*^9}, {
   3.766246194763377*^9, 3.7662462278909435`*^9}, {3.76624640259688*^9, 
   3.766246441365553*^9}, {3.7662465324867954`*^9, 3.7662465926165223`*^9}, {
   3.7662469387869835`*^9, 3.7662469607574563`*^9}, {3.766247008886225*^9, 
   3.7662476929434385`*^9}, {3.766247731212063*^9, 3.7662477600424557`*^9}, {
   3.7662477903417044`*^9, 3.766247871785615*^9}, {3.7662479383377295`*^9, 
   3.766248018437769*^9}, {3.7662480714888144`*^9, 3.76624813630641*^9}, {
   3.766248207471078*^9, 3.766248255865499*^9}, 3.7662482910870175`*^9, {
   3.766248347716467*^9, 3.7662484129069743`*^9}, {3.7662485083519773`*^9, 
   3.766248521774911*^9}, {3.76624909174685*^9, 3.766249097934831*^9}, {
   3.7662491516734314`*^9, 3.7662492758706937`*^9}, {3.7662493083263693`*^9, 
   3.7662493436728964`*^9}, {3.766249388770192*^9, 3.7662496699038515`*^9}, {
   3.766249726939577*^9, 3.7662499403626137`*^9}, {3.766249985866188*^9, 
   3.766249994227906*^9}, {3.7662500307932806`*^9, 3.7662500865499487`*^9}, {
   3.7662502097158747`*^9, 3.7662503766977572`*^9}, {3.766316051587922*^9, 
   3.766316219022967*^9}, {3.766316345876687*^9, 3.766316371128661*^9}, {
   3.7663164238749037`*^9, 3.766316500575057*^9}, {3.7663167725791545`*^9, 
   3.766316783689754*^9}, {3.766316847353033*^9, 3.766316907052276*^9}, {
   3.766316948185661*^9, 3.7663173000394955`*^9}, {3.7663173319646964`*^9, 
   3.766317400739541*^9}, {3.7663174334238605`*^9, 3.7663174395617437`*^9}, {
   3.7663180704996176`*^9, 3.7663180779427524`*^9}, {3.7663181106207285`*^9, 
   3.766318174394848*^9}, {3.766318591600424*^9, 3.766318702876196*^9}, {
   3.7663187520082746`*^9, 3.7663188200861464`*^9}, {3.7663188521524987`*^9, 
   3.7663189774105005`*^9}, {3.7663190326304226`*^9, 
   3.7663190463684626`*^9}, {3.766319117298094*^9, 3.7663191296404314`*^9}, {
   3.7663192990942144`*^9, 3.766319554424048*^9}, {3.766322035959817*^9, 
   3.766322040770423*^9}, {3.7663220864346685`*^9, 3.7663220873030567`*^9}, 
   3.7663221393397045`*^9, 3.766322309119455*^9, {3.7663245324608808`*^9, 
   3.766324950352014*^9}, {3.7663254128993073`*^9, 3.7663254228518534`*^9}, {
   3.7663254749557905`*^9, 3.7663258045306063`*^9}, {3.766326002856687*^9, 
   3.7663261678125534`*^9}, 3.7663262051793633`*^9, {3.766327704212877*^9, 
   3.7663277318359194`*^9}, {3.766327818722603*^9, 3.7663278264570208`*^9}, {
   3.7663279068410535`*^9, 3.7663279993046093`*^9}, {3.7663285297503333`*^9, 
   3.766328610969166*^9}, {3.7663286645565195`*^9, 3.7663286765600224`*^9}, {
   3.7663287201227684`*^9, 3.7663287258152285`*^9}, {3.7663288383270597`*^9, 
   3.766328843736231*^9}, {3.766328897010292*^9, 3.7663288983645983`*^9}, {
   3.7663313952572737`*^9, 3.7663314140342484`*^9}, {3.766331451238925*^9, 
   3.7663315788832307`*^9}, {3.766331774430154*^9, 3.7663320259702587`*^9}, {
   3.766332077414858*^9, 3.7663320830202103`*^9}, {3.7663321438344903`*^9, 
   3.7663324217698455`*^9}, {3.766332466640847*^9, 3.7663325421442056`*^9}, {
   3.7663325988625603`*^9, 3.7663329394319396`*^9}, {3.766333106258661*^9, 
   3.7663331161364346`*^9}, {3.7663331503110228`*^9, 
   3.7663332307804213`*^9}, {3.766333316280321*^9, 3.766333385691845*^9}, {
   3.7663334946482573`*^9, 3.7663334972367396`*^9}, {3.7663335616674833`*^9, 
   3.7663336123560295`*^9}, {3.766333652150201*^9, 3.7663336873739266`*^9}, {
   3.766390873367257*^9, 3.766390926712381*^9}, {3.7663911487431583`*^9, 
   3.766391317317707*^9}, {3.7663914744950686`*^9, 3.7663914880842743`*^9}, {
   3.766391609751011*^9, 3.7663916141532307`*^9}, {3.7663917168306303`*^9, 
   3.766391863113818*^9}, 3.7663919718470216`*^9, {3.76639276138066*^9, 
   3.7663927668749256`*^9}, {3.7663931758168297`*^9, 
   3.7663931851848073`*^9}, {3.7663933106060543`*^9, 3.766393394909848*^9}, {
   3.766393441517521*^9, 3.766393552901265*^9}, {3.7663937582300377`*^9, 
   3.766393765517025*^9}, {3.76639508526488*^9, 3.766395092461779*^9}, {
   3.7663960017960835`*^9, 3.7663960104774113`*^9}, {3.766396060389243*^9, 
   3.7663960691586466`*^9}, {3.7663961066525784`*^9, 3.76639610694986*^9}, {
   3.7663961914478407`*^9, 3.766396196485669*^9}, {3.766396252648486*^9, 
   3.7663962992251287`*^9}, {3.7663963451781673`*^9, 3.766396358117569*^9}, {
   3.766396389723858*^9, 3.766396584512522*^9}, {3.7663966612060285`*^9, 
   3.766396661418231*^9}, {3.766396695056461*^9, 3.7663967210824113`*^9}, {
   3.766396779189096*^9, 3.766396910883297*^9}, {3.7663970371222844`*^9, 
   3.766397037289442*^9}, {3.766397105577878*^9, 3.766397110405511*^9}, {
   3.7663977314676876`*^9, 3.7663977450777445`*^9}, {3.766397865046716*^9, 
   3.766397865565184*^9}, {3.7663979015717106`*^9, 3.7663979278919334`*^9}, {
   3.766397961791427*^9, 3.76639796202164*^9}, {3.766398009416066*^9, 
   3.7663980649572954`*^9}, {3.7663981014873037`*^9, 
   3.7663981263541265`*^9}, {3.766754185146368*^9, 3.7667542264621134`*^9}, {
   3.7667546834348087`*^9, 3.766754739173565*^9}, 3.766754772457431*^9, {
   3.766756536650386*^9, 3.7667565742002125`*^9}, {3.7674456126981835`*^9, 
   3.7674456486072474`*^9}, 3.7674492971460943`*^9},
 Background->RGBColor[0.87, 0.94, 1]]
}, Closed]],

Cell[CellGroupData[{

Cell["auxIDNumberToString", "Subsection",
 CellChangeTimes->{3.7667546801064196`*^9, 3.7667549456130934`*^9}],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"auxIDNumberToString", "[", "num_", "]"}], " ", ":=", " ", 
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", "sf", "}"}], ",", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"sf", " ", "=", " ", 
       RowBox[{"ScientificForm", "[", 
        RowBox[{
         RowBox[{"N", "[", "num", "]"}], ",", 
         RowBox[{"NumberFormat", "\[Rule]", 
          RowBox[{"(", 
           RowBox[{
            RowBox[{"Row", "[", 
             RowBox[{"{", 
              RowBox[{"#1", ",", "\"\<e\>\"", ",", "#3"}], "}"}], "]"}], 
            "&"}], ")"}]}], ",", " ", 
         RowBox[{"ExponentFunction", "->", 
          RowBox[{"(", 
           RowBox[{
            RowBox[{"If", "[", 
             RowBox[{
              RowBox[{
               RowBox[{"-", "5"}], "<", "#", "<", "5"}], ",", "Null", ",", 
              "#"}], "]"}], "&"}], ")"}]}]}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"If", "[", 
       RowBox[{
        RowBox[{"StringEndsQ", "[", 
         RowBox[{
          RowBox[{"ToString", "[", "sf", "]"}], ",", " ", "\"\<e\>\""}], 
         "]"}], ",", 
        RowBox[{"Return", "[", 
         RowBox[{"ToString", "[", 
          RowBox[{"N", "[", "num", "]"}], "]"}], "]"}], ",", 
        RowBox[{"Return", "[", 
         RowBox[{"ToString", "[", "sf", "]"}], "]"}]}], "]"}], ";"}]}], 
    "\[IndentingNewLine]", "]"}]}], ";"}]], "Input",
 Background->RGBColor[0.87, 0.94, 1]]
}, Closed]],

Cell[CellGroupData[{

Cell["auxIDNewtonLorentzEquation", "Subsection",
 CellChangeTimes->{3.7667546801064196`*^9, 3.7667549456130934`*^9, 
  3.766755008805561*^9}],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"auxIDNewtonLorentzEquation", "[", 
    RowBox[{"a_", ",", "r_", ",", "b_"}], "]"}], ":=", 
   RowBox[{"Module", "[", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"{", "drds", "}"}], ",", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"drds", " ", "=", " ", 
       RowBox[{"{", 
        RowBox[{"0", ",", "0", ",", "0", ",", "0", ",", "0", ",", "0"}], 
        "}"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"drds", "[", 
        RowBox[{"[", "1", "]"}], "]"}], "=", 
       RowBox[{"r", "[", 
        RowBox[{"[", "4", "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"drds", "[", 
        RowBox[{"[", "2", "]"}], "]"}], "=", 
       RowBox[{"r", "[", 
        RowBox[{"[", "5", "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"drds", "[", 
        RowBox[{"[", "3", "]"}], "]"}], "=", 
       RowBox[{"r", "[", 
        RowBox[{"[", "6", "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"drds", "[", 
        RowBox[{"[", "4", "]"}], "]"}], "=", 
       RowBox[{
        RowBox[{"-", "a"}], "*", 
        RowBox[{"(", 
         RowBox[{
          RowBox[{
           RowBox[{"r", "[", 
            RowBox[{"[", "5", "]"}], "]"}], "*", 
           RowBox[{"b", "[", 
            RowBox[{"[", "3", "]"}], "]"}]}], "-", 
          RowBox[{
           RowBox[{"r", "[", 
            RowBox[{"[", "6", "]"}], "]"}], "*", 
           RowBox[{"b", "[", 
            RowBox[{"[", "2", "]"}], "]"}]}]}], ")"}]}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"drds", "[", 
        RowBox[{"[", "5", "]"}], "]"}], "=", 
       RowBox[{
        RowBox[{"-", "a"}], "*", 
        RowBox[{"(", 
         RowBox[{
          RowBox[{
           RowBox[{"r", "[", 
            RowBox[{"[", "6", "]"}], "]"}], "*", 
           RowBox[{"b", "[", 
            RowBox[{"[", "1", "]"}], "]"}]}], "-", 
          RowBox[{
           RowBox[{"r", "[", 
            RowBox[{"[", "4", "]"}], "]"}], "*", 
           RowBox[{"b", "[", 
            RowBox[{"[", "2", "]"}], "]"}]}]}], ")"}]}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"drds", "[", 
        RowBox[{"[", "6", "]"}], "]"}], "=", 
       RowBox[{
        RowBox[{"-", "a"}], "*", 
        RowBox[{"(", 
         RowBox[{
          RowBox[{
           RowBox[{"r", "[", 
            RowBox[{"[", "4", "]"}], "]"}], "*", 
           RowBox[{"b", "[", 
            RowBox[{"[", "2", "]"}], "]"}]}], "-", 
          RowBox[{
           RowBox[{"r", "[", 
            RowBox[{"[", "5", "]"}], "]"}], "*", 
           RowBox[{"b", "[", 
            RowBox[{"[", "1", "]"}], "]"}]}]}], ")"}]}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"Return", "[", "drds", "]"}], ";"}]}], "\[IndentingNewLine]", 
    "]"}]}], ";"}]], "Input",
 Background->RGBColor[0.87, 0.94, 1]]
}, Closed]],

Cell[CellGroupData[{

Cell["auxIDBlockArrow", "Subsection",
 CellChangeTimes->{3.766754730782276*^9}],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"auxIDBlockArrow", "[", 
    RowBox[{"BlockCenter_", ",", " ", "BlockMag_", ",", " ", "ArrowSize_"}], 
    "]"}], ":=", " ", 
   RowBox[{"Module", "[", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"MagArrow", ",", " ", "MagDirection"}], "}"}], ",", 
     "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"MagDirection", " ", "=", " ", 
       RowBox[{"Normalize", "[", "BlockMag", "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"MagArrow", " ", "=", " ", 
       RowBox[{"Arrow", "[", 
        RowBox[{"{", 
         RowBox[{
          RowBox[{"BlockCenter", " ", "-", " ", 
           RowBox[{"MagDirection", " ", "*", 
            RowBox[{"ArrowSize", "/", "2"}]}]}], ",", " ", 
          RowBox[{"BlockCenter", " ", "+", " ", 
           RowBox[{"MagDirection", " ", "*", 
            RowBox[{"ArrowSize", "/", "2"}]}]}]}], "}"}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"Return", "[", "MagArrow", "]"}], ";"}]}], 
    "\[IndentingNewLine]", "]"}]}], ";"}]], "Input",
 Background->RGBColor[0.87, 0.94, 1]],

Cell[BoxData[""], "Input",
 CellChangeTimes->{{3.7675304464461155`*^9, 3.767530447519116*^9}}]
}, Closed]]
}, Open  ]]
}, Open  ]],

Cell[CellGroupData[{

Cell["Usage Example", "Chapter",
 CellChangeTimes->{{3.7674438344800587`*^9, 3.7674438499344044`*^9}, 
   3.7675169813486843`*^9, {3.7675201199194317`*^9, 3.7675201258864985`*^9}}],

Cell[CellGroupData[{

Cell["Parameters", "Section",
 CellChangeTimes->{{3.767446931482267*^9, 3.767446944295766*^9}, {
  3.7675201610378647`*^9, 3.7675201948197856`*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{"(*", 
   RowBox[{"ID", " ", "parameters"}], "*)"}], "\[IndentingNewLine]", 
  RowBox[{
   RowBox[{
    RowBox[{"\[Lambda]u", " ", "=", " ", "22"}], ";"}], " ", 
   RowBox[{"(*", 
    RowBox[{"Period", " ", "[", "mm", "]"}], "*)"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"Np", " ", "=", " ", "1"}], ";"}], " ", 
   RowBox[{"(*", 
    RowBox[{"Number", " ", "of", " ", "periods", " ", 
     RowBox[{"(", 
      RowBox[{"not", " ", "including", " ", "terminations"}], ")"}]}], "*)"}],
    "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"Br", " ", "=", " ", "1.28"}], ";"}], " ", 
   RowBox[{"(*", 
    RowBox[{"Remanent", " ", 
     RowBox[{"magnetization", " ", "[", "T", "]"}]}], "*)"}], 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"Gap", " ", "=", " ", "8"}], ";"}], " ", 
   RowBox[{"(*", 
    RowBox[{"Minimum", " ", "ID", " ", 
     RowBox[{"gap", " ", "[", "mm", "]"}]}], "*)"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"BlockGap", " ", "=", " ", "0.1"}], ";"}], " ", 
   RowBox[{"(*", 
    RowBox[{"Longitudinal", " ", "gap", " ", "between", " ", 
     RowBox[{"blocks", " ", "[", "mm", "]"}]}], "*)"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"Termination", " ", "=", " ", "\"\<ThreeBlocksAntiSym\>\""}], 
    ";"}], " ", "\[IndentingNewLine]", "\[IndentingNewLine]", 
   RowBox[{"(*", 
    RowBox[{"Longitudinal", " ", 
     RowBox[{"range", " ", "[", "mm", "]"}]}], "*)"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"Lstep", " ", "=", " ", "0.1"}], ";"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"Li", " ", "=", " ", 
     RowBox[{
      RowBox[{"-", 
       RowBox[{"(", 
        RowBox[{"Np", "+", "2"}], ")"}]}], "*", "\[Lambda]u"}]}], ";"}], 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"Lf", " ", "=", " ", 
     RowBox[{
      RowBox[{"(", 
       RowBox[{"Np", "+", "2"}], ")"}], "*", "\[Lambda]u"}]}], ";"}], 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"Lnpts", " ", "=", 
     RowBox[{
      RowBox[{"Round", "[", 
       RowBox[{
        RowBox[{"(", 
         RowBox[{"Lf", " ", "-", " ", "Li"}], ")"}], "/", "Lstep"}], " ", 
       "]"}], "+", " ", "1"}]}], ";"}], " ", "\[IndentingNewLine]", 
   "\[IndentingNewLine]", 
   RowBox[{"(*", 
    RowBox[{"Horizontal", " ", 
     RowBox[{"range", " ", "[", "mm", "]"}]}], "*)"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"Hstep", " ", "=", "1"}], ";"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"Hi", " ", "=", " ", 
     RowBox[{"-", "12"}]}], ";"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"Hf", " ", "=", " ", "12"}], ";"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"Hnpts", " ", "=", " ", 
     RowBox[{
      RowBox[{"Round", "[", 
       RowBox[{
        RowBox[{"(", 
         RowBox[{"Hf", " ", "-", " ", "Hi"}], ")"}], "/", "Hstep"}], " ", 
       "]"}], "+", " ", "1"}]}], ";"}], " ", "\[IndentingNewLine]", 
   "\[IndentingNewLine]", 
   RowBox[{"(*", 
    RowBox[{"Vertical", " ", 
     RowBox[{"range", " ", "[", "mm", "]"}]}], "*)"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"Vstep", " ", "=", "1"}], ";"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"Vi", " ", "=", " ", 
     RowBox[{"-", "4"}]}], ";"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"Vf", " ", "=", " ", "4"}], ";"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"Vnpts", " ", "=", " ", 
     RowBox[{
      RowBox[{"Round", "[", 
       RowBox[{
        RowBox[{"(", 
         RowBox[{"Vf", " ", "-", " ", "Vi"}], ")"}], "/", "Vstep"}], " ", 
       "]"}], "+", " ", "1"}]}], ";"}], " ", "\[IndentingNewLine]", 
   "\[IndentingNewLine]", 
   RowBox[{"(*", 
    RowBox[{"Particle", " ", 
     RowBox[{"energy", " ", "[", "GeV", "]"}]}], "*)"}], 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"Energy", " ", "=", " ", "3"}], ";"}], "\[IndentingNewLine]", 
   "\[IndentingNewLine]", 
   RowBox[{"(*", 
    RowBox[{"Radia", " ", 
     StyleBox[
      RowBox[{"r", 
       StyleBox["andomization", "MSG"]}]], 
     StyleBox[" ", "MSG"], 
     StyleBox["magnitudes", "MSG"]}], "*)"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"radFldLenTol", "[", 
     RowBox[{
      RowBox[{"10", "^", 
       RowBox[{"-", "12"}]}], ",", 
      RowBox[{"10", "^", 
       RowBox[{"-", "12"}]}]}], " ", "]"}], ";"}]}]}]], "Input",
 CellChangeTimes->{{3.7656403729095173`*^9, 3.7656403994897485`*^9}, {
   3.7656404481046095`*^9, 3.765640563051221*^9}, {3.765640599022822*^9, 
   3.7656405994291115`*^9}, 3.765640637072713*^9, {3.7656406822626762`*^9, 
   3.7656406824033012`*^9}, {3.7657887059296885`*^9, 
   3.7657887060728197`*^9}, {3.7657887533484225`*^9, 3.765788753895337*^9}, {
   3.765798699342943*^9, 3.765798703671403*^9}, {3.7658019501798463`*^9, 
   3.7658019557321663`*^9}, {3.767443897391265*^9, 3.767443898297575*^9}, {
   3.7674439730682216`*^9, 3.7674439867099514`*^9}, {3.7674440461677446`*^9, 
   3.7674440464490232`*^9}, {3.7674443532862883`*^9, 3.767444353708232*^9}, {
   3.767444403334466*^9, 3.767444403600116*^9}, {3.7674453440027413`*^9, 
   3.7674453510970187`*^9}, {3.767445574070154*^9, 3.7674455765546913`*^9}, {
   3.767446170509075*^9, 3.767446171352891*^9}, {3.767446231559949*^9, 
   3.767446258312086*^9}, 3.7674462917678413`*^9, {3.767446358198086*^9, 
   3.767446576621519*^9}, {3.767446645109845*^9, 3.7674467052395678`*^9}, {
   3.767446781776543*^9, 3.767446782042187*^9}, {3.767446836300102*^9, 
   3.767446836675136*^9}, {3.767446869865245*^9, 3.7674469020552797`*^9}, {
   3.7674491351114006`*^9, 3.7674491682546234`*^9}, {3.767449203307313*^9, 
   3.76744920933905*^9}, {3.7674502441479373`*^9, 3.767450289512718*^9}, {
   3.7675201428649397`*^9, 3.7675201438958683`*^9}, {3.767520303348179*^9, 
   3.767520304410176*^9}, {3.7675208694649277`*^9, 3.767520913934552*^9}, {
   3.7675212103361716`*^9, 3.7675212115579453`*^9}},
 Background->RGBColor[0.87, 0.94, 1]]
}, Open  ]],

Cell[CellGroupData[{

Cell["Model", "Section",
 CellChangeTimes->{{3.767446931482267*^9, 3.767446944295766*^9}, {
  3.7675201610378647`*^9, 3.767520162893174*^9}, {3.7675201974036894`*^9, 
  3.767520197715667*^9}}],

Cell[BoxData[{
 RowBox[{
  RowBox[{"Device", "=", " ", 
   RowBox[{"IDAPU", "[", 
    RowBox[{
    "\[Lambda]u", ",", " ", "Np", ",", " ", "Br", ",", " ", "Gap", ",", " ", 
     RowBox[{"\"\<BlockGap\>\"", "\[Rule]", "  ", "BlockGap"}], ",", " ", 
     RowBox[{"\"\<Termination\>\"", "\[Rule]", "Termination"}]}], "]"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{"IDShow", "[", "Device", "]"}], "\[IndentingNewLine]", 
 RowBox[{"IDShow", "[", 
  RowBox[{"Device", ",", " ", 
   RowBox[{"\"\<MagDirection\>\"", "\[Rule]", " ", "True"}], ",", " ", 
   RowBox[{"\"\<ArrowSize\>\"", "\[Rule]", " ", "5"}]}], 
  "]"}], "\[IndentingNewLine]", 
 RowBox[{"IDPlotFields", "[", 
  RowBox[{"Device", ",", " ", "\"\<y\>\"", ",", " ", 
   RowBox[{"{", 
    RowBox[{"Li", ",", " ", "Lf"}], "}"}]}], "]"}]}], "Input",
 CellChangeTimes->{{3.7674440656223984`*^9, 3.7674441734256926`*^9}, {
   3.7674442461345696`*^9, 3.7674442764990425`*^9}, 3.767444322862057*^9, {
   3.767444385192424*^9, 3.767444394318159*^9}, 3.7674453668951707`*^9, {
   3.767445417307767*^9, 3.7674454491383944`*^9}, {3.767445508471183*^9, 
   3.767445513987235*^9}, {3.7674461603989067`*^9, 3.767446193181965*^9}, {
   3.7674466770185995`*^9, 3.7674466795812674`*^9}, {3.76744671069313*^9, 
   3.7674467176624107`*^9}, {3.7674469925339193`*^9, 
   3.7674470147700768`*^9}, {3.76744710035493*^9, 3.7674471309042025`*^9}, {
   3.7674473291326084`*^9, 3.767447337789538*^9}, {3.767512871385285*^9, 
   3.7675128920320716`*^9}, {3.7675129283759007`*^9, 
   3.7675129384945984`*^9}, {3.7675164125588818`*^9, 
   3.7675164127600746`*^9}, {3.7675166641905713`*^9, 3.76751668312772*^9}, {
   3.767519489021409*^9, 3.7675194900423107`*^9}, {3.7675202783535748`*^9, 
   3.767520299970541*^9}, {3.7675206735582247`*^9, 3.767520757517961*^9}, {
   3.7675209412092533`*^9, 3.7675209481437798`*^9}, 3.767535190614373*^9, {
   3.7675368955204487`*^9, 3.767536896020481*^9}},
 Background->RGBColor[0.87, 0.94, 1]]
}, Open  ]],

Cell[CellGroupData[{

Cell["Field Integrals", "Section",
 CellChangeTimes->{{3.767449573967226*^9, 3.7674495829366703`*^9}, {
  3.767449636787404*^9, 3.7674496398188963`*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{"IDFieldIntegrals", "[", 
   RowBox[{"Device", ",", " ", "\"\<by\>\"", ",", " ", 
    RowBox[{"{", 
     RowBox[{"Li", ",", " ", "Lf"}], "}"}], ",", " ", "Lnpts"}], "]"}], 
  ";"}]], "Input",
 CellChangeTimes->{{3.7675202577859135`*^9, 3.767520261034621*^9}, {
  3.7675209517503552`*^9, 3.767520952149508*^9}},
 Background->RGBColor[0.87, 0.94, 1]]
}, Open  ]],

Cell[CellGroupData[{

Cell["Trajectory", "Section",
 CellChangeTimes->{{3.767449573967226*^9, 3.7674495829366703`*^9}}],

Cell[BoxData[{
 RowBox[{
  RowBox[{"Trajectory", " ", "=", " ", 
   RowBox[{"radFldPtcTrj", "[", 
    RowBox[{"Device", ",", " ", "Energy", ",", " ", 
     RowBox[{"{", 
      RowBox[{"0", ",", " ", "0", ",", " ", "0", ",", " ", "0"}], "}"}], ",", 
     " ", 
     RowBox[{"{", 
      RowBox[{"Li", ",", " ", "Lf"}], "}"}], ",", " ", "Lnpts"}], "]"}]}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{"IDPlotRadFldPtcTrj", "[", "Trajectory", "]"}]}], "Input",
 CellChangeTimes->{{3.7674495898591013`*^9, 3.7674496089727197`*^9}, {
  3.7674496909322963`*^9, 3.7674497265444355`*^9}, {3.7674502260371437`*^9, 
  3.7674502263184237`*^9}, {3.7675202470995517`*^9, 3.767520250866393*^9}, {
  3.7675204693348403`*^9, 3.7675204709805307`*^9}, {3.7675209554873433`*^9, 
  3.767520962614017*^9}},
 Background->RGBColor[0.87, 0.94, 1]]
}, Open  ]],

Cell[CellGroupData[{

Cell["Field Map", "Section",
 CellChangeTimes->{{3.767449573967226*^9, 3.7674495829366703`*^9}, {
  3.7674498116324224`*^9, 3.767449813257551*^9}, {3.7675208178660126`*^9, 
  3.7675208198806715`*^9}}],

Cell[BoxData[{
 RowBox[{
  RowBox[{"FieldMapFilename", " ", "=", " ", "\"\<device_fieldmap.txt\>\""}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"IDFieldMap", "[", 
   RowBox[{"FieldMapFilename", ",", " ", "Device", ",", " ", 
    RowBox[{"{", 
     RowBox[{"Hi", ",", " ", "Hf"}], "}"}], ",", " ", 
    RowBox[{"{", 
     RowBox[{"Li", ",", " ", "Lf"}], "}"}], ",", " ", 
    RowBox[{"{", 
     RowBox[{"0", ",", " ", "0"}], "}"}], ",", " ", "Hnpts", ",", " ", 
    "Lnpts", ",", " ", "1"}], "]"}], ";"}]}], "Input",
 CellChangeTimes->{{3.7674495898591013`*^9, 3.7674496089727197`*^9}, {
   3.7674496909322963`*^9, 3.7674497265444355`*^9}, {3.7674498215550523`*^9, 
   3.767449825977299*^9}, {3.767449994901431*^9, 3.767449995588992*^9}, {
   3.7674503486498995`*^9, 3.7674504641121325`*^9}, 3.7674504986013436`*^9, {
   3.7675202329556756`*^9, 3.7675202395410986`*^9}, {3.767520321866596*^9, 
   3.7675203232735853`*^9}, {3.7675204649831924`*^9, 
   3.7675204668607163`*^9}, {3.7675209666228304`*^9, 3.7675209942607455`*^9}},
 
 Background->RGBColor[0.87, 0.94, 1]]
}, Open  ]],

Cell[CellGroupData[{

Cell["Kick Map", "Section",
 CellChangeTimes->{{3.767449573967226*^9, 3.7674495829366703`*^9}, {
  3.7674498116324224`*^9, 3.767449813257551*^9}, {3.7675208134740334`*^9, 
  3.7675208209051533`*^9}}],

Cell[BoxData[{
 RowBox[{
  RowBox[{"KickMapFilename", " ", "=", " ", "\"\<device_kickmap.txt\>\""}], 
  ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"KickMap", "=", " ", 
   RowBox[{"radFldFocKick", "[", 
    RowBox[{"Device", ",", 
     RowBox[{"{", 
      RowBox[{"0.0", ",", "Li", ",", "0.0"}], "}"}], ",", 
     RowBox[{"{", 
      RowBox[{"0", ",", "1", ",", "0"}], "}"}], ",", 
     RowBox[{"{", 
      RowBox[{"(", 
       RowBox[{"Lf", "-", "Li"}], ")"}], "}"}], ",", "Lnpts", ",", 
     RowBox[{"{", 
      RowBox[{"1", ",", "0", ",", "0"}], "}"}], ",", 
     RowBox[{"(", 
      RowBox[{"Hf", "-", "Hi"}], ")"}], ",", "Hnpts", ",", 
     RowBox[{"(", 
      RowBox[{"Vf", "-", "Vi"}], ")"}], ",", "Vnpts", ",", "\"\<\>\"", ",", 
     RowBox[{"{", 
      RowBox[{"0", ",", "0"}], "}"}]}], "]"}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"Export", "[", 
   RowBox[{"KickMapFilename", ",", " ", 
    RowBox[{"KickMap", "[", 
     RowBox[{"[", "4", "]"}], "]"}]}], "]"}], ";"}]}], "Input",
 CellChangeTimes->{{3.7675208263383083`*^9, 3.7675208610172462`*^9}, {
  3.7675209302395105`*^9, 3.767520930719039*^9}, {3.7675209815489807`*^9, 
  3.767521022635622*^9}, {3.7675210760197935`*^9, 3.7675210960110126`*^9}},
 Background->RGBColor[0.87, 0.94, 1]]
}, Open  ]]
}, Closed]]
},
WindowSize->{1920, 997},
WindowMargins->{{-8, Automatic}, {Automatic, -8}},
FrontEndVersion->"11.0 for Microsoft Windows (64-bit) (September 21, 2016)",
StyleDefinitions->"Default.nb"
]
(* End of Notebook Content *)

(* Internal cache information *)
(*CellTagsOutline
CellTagsIndex->{}
*)
(*CellTagsIndex
CellTagsIndex->{}
*)
(*NotebookFileOutline
Notebook[{
Cell[CellGroupData[{
Cell[580, 22, 171, 2, 72, "Chapter"],
Cell[754, 26, 261, 6, 66, "Input"]
}, Open  ]],
Cell[CellGroupData[{
Cell[1052, 37, 242, 3, 72, "Chapter"],
Cell[1297, 42, 173, 5, 46, "Input"]
}, Open  ]],
Cell[CellGroupData[{
Cell[1507, 52, 1279, 17, 72, "Chapter"],
Cell[CellGroupData[{
Cell[2811, 73, 88, 1, 70, "Section"],
Cell[CellGroupData[{
Cell[2924, 78, 97, 1, 49, "Subsection"],
Cell[3024, 81, 12258, 266, 1054, "Input"]
}, Closed]],
Cell[CellGroupData[{
Cell[15319, 352, 136, 2, 41, "Subsection"],
Cell[15458, 356, 11755, 253, 1168, "Input"]
}, Closed]]
}, Open  ]],
Cell[CellGroupData[{
Cell[27262, 615, 94, 1, 70, "Section"],
Cell[CellGroupData[{
Cell[27381, 620, 249, 3, 49, "Subsection"],
Cell[27633, 625, 2344, 36, 256, "Input"]
}, Closed]],
Cell[CellGroupData[{
Cell[30014, 666, 148, 2, 41, "Subsection"],
Cell[30165, 670, 23714, 510, 1681, "Input"]
}, Closed]],
Cell[CellGroupData[{
Cell[53916, 1185, 146, 2, 41, "Subsection"],
Cell[54065, 1189, 24503, 532, 1719, "Input"]
}, Closed]],
Cell[CellGroupData[{
Cell[78605, 1726, 110, 1, 41, "Subsection"],
Cell[78718, 1729, 26135, 590, 1719, "Input"]
}, Closed]],
Cell[CellGroupData[{
Cell[104890, 2324, 130, 2, 41, "Subsection"],
Cell[105023, 2328, 33324, 764, 2137, "Input"]
}, Closed]],
Cell[CellGroupData[{
Cell[138384, 3097, 185, 3, 41, "Subsection"],
Cell[138572, 3102, 26191, 584, 1928, "Input"]
}, Closed]]
}, Open  ]],
Cell[CellGroupData[{
Cell[164812, 3692, 88, 1, 70, "Section"],
Cell[CellGroupData[{
Cell[164925, 3697, 106, 1, 49, "Subsection"],
Cell[165034, 3700, 16289, 347, 1453, "Input"]
}, Closed]]
}, Open  ]],
Cell[CellGroupData[{
Cell[181372, 4053, 149, 2, 70, "Section"],
Cell[CellGroupData[{
Cell[181546, 4059, 70, 1, 49, "Subsection"],
Cell[181619, 4062, 4389, 97, 465, "Input"]
}, Closed]],
Cell[CellGroupData[{
Cell[186045, 4164, 144, 2, 41, "Subsection"],
Cell[186192, 4168, 4579, 105, 446, "Input"]
}, Closed]],
Cell[CellGroupData[{
Cell[190808, 4278, 78, 1, 41, "Subsection"],
Cell[190889, 4281, 12178, 278, 541, "Input"]
}, Closed]],
Cell[CellGroupData[{
Cell[203104, 4564, 82, 1, 41, "Subsection"],
Cell[203189, 4567, 5938, 139, 579, "Input"]
}, Closed]],
Cell[CellGroupData[{
Cell[209164, 4711, 100, 1, 41, "Subsection"],
Cell[209267, 4714, 9392, 207, 921, "Input"]
}, Closed]],
Cell[CellGroupData[{
Cell[218696, 4926, 133, 2, 41, "Subsection"],
Cell[218832, 4930, 8771, 189, 883, "Input"]
}, Closed]],
Cell[CellGroupData[{
Cell[227640, 5124, 135, 2, 41, "Subsection"],
Cell[227778, 5128, 12114, 292, 1168, "Input"]
}, Closed]],
Cell[CellGroupData[{
Cell[239929, 5425, 187, 2, 41, "Subsection"],
Cell[240119, 5429, 7794, 181, 541, "Input"]
}, Closed]],
Cell[CellGroupData[{
Cell[247950, 5615, 207, 3, 41, "Subsection"],
Cell[248160, 5620, 7763, 180, 541, "Input"]
}, Closed]],
Cell[CellGroupData[{
Cell[255960, 5805, 280, 4, 41, "Subsection"],
Cell[256243, 5811, 15271, 392, 807, "Input"]
}, Closed]]
}, Open  ]],
Cell[CellGroupData[{
Cell[271563, 6209, 95, 1, 70, "Section"],
Cell[CellGroupData[{
Cell[271683, 6214, 103, 1, 49, "Subsection"],
Cell[271789, 6217, 29020, 677, 2441, "Input"]
}, Closed]],
Cell[CellGroupData[{
Cell[300846, 6899, 112, 1, 41, "Subsection"],
Cell[300961, 6902, 33730, 746, 2175, "Input"]
}, Closed]],
Cell[CellGroupData[{
Cell[334728, 7653, 109, 1, 41, "Subsection"],
Cell[334840, 7656, 1470, 40, 104, "Input"]
}, Closed]],
Cell[CellGroupData[{
Cell[336347, 7701, 141, 2, 41, "Subsection"],
Cell[336491, 7705, 2916, 84, 237, "Input"]
}, Closed]],
Cell[CellGroupData[{
Cell[339444, 7794, 79, 1, 41, "Subsection"],
Cell[339526, 7797, 1113, 28, 142, "Input"],
Cell[340642, 7827, 94, 1, 30, "Input"]
}, Closed]]
}, Open  ]]
}, Open  ]],
Cell[CellGroupData[{
Cell[340797, 7835, 180, 2, 72, "Chapter"],
Cell[CellGroupData[{
Cell[341002, 7841, 148, 2, 70, "Section"],
Cell[341153, 7845, 5892, 142, 617, "Input"]
}, Open  ]],
Cell[CellGroupData[{
Cell[347082, 7992, 192, 3, 70, "Section"],
Cell[347277, 7997, 1958, 35, 104, "Input"]
}, Open  ]],
Cell[CellGroupData[{
Cell[349272, 8037, 153, 2, 70, "Section"],
Cell[349428, 8041, 382, 9, 46, "Input"]
}, Open  ]],
Cell[CellGroupData[{
Cell[349847, 8055, 97, 1, 70, "Section"],
Cell[349947, 8058, 821, 17, 66, "Input"]
}, Open  ]],
Cell[CellGroupData[{
Cell[350805, 8080, 200, 3, 70, "Section"],
Cell[351008, 8085, 1079, 22, 66, "Input"]
}, Open  ]],
Cell[CellGroupData[{
Cell[352124, 8112, 199, 3, 70, "Section"],
Cell[352326, 8117, 1273, 31, 85, "Input"]
}, Open  ]]
}, Closed]]
}
]
*)

