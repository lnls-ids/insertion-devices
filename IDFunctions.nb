(* Content-type: application/vnd.wolfram.mathematica *)

(*** Wolfram Notebook File ***)
(* http://www.wolfram.com/nb *)

(* CreatedBy='Mathematica 10.1' *)

(*CacheID: 234*)
(* Internal cache information:
NotebookFileLineBreakTest
NotebookFileLineBreakTest
NotebookDataPosition[       158,          7]
NotebookDataLength[    295520,       6621]
NotebookOptionsPosition[    289443,       6503]
NotebookOutlinePosition[    289785,       6518]
CellTagsIndexPosition[    289742,       6515]
WindowFrame->Normal*)

(* Beginning of Notebook Content *)
Notebook[{

Cell[CellGroupData[{
Cell["Insertion Device Functions (last update: 10/12/19)", "Chapter",
 CellChangeTimes->{{3.681300194179221*^9, 3.6813002033832407`*^9}, {
   3.681305983976405*^9, 3.6813059853359213`*^9}, {3.6813176225703306`*^9, 
   3.6813176235079107`*^9}, {3.6813177175941257`*^9, 3.68131771915676*^9}, {
   3.708272177122472*^9, 3.708272189394394*^9}, {3.708272239370994*^9, 
   3.708272253185425*^9}, {3.7247626663439655`*^9, 3.724762668594143*^9}, 
   3.724763762181196*^9, {3.725974849294973*^9, 3.725974857279992*^9}, {
   3.7316800228814087`*^9, 3.7316800249126425`*^9}, {3.731761928333893*^9, 
   3.731761928740137*^9}, {3.7377345647344294`*^9, 3.7377345664687967`*^9}, {
   3.737994165253688*^9, 3.7379941653786864`*^9}, {3.7489625392900763`*^9, 
   3.7489625531505637`*^9}, {3.749318816981333*^9, 3.749318817559469*^9}, {
   3.7656382216793394`*^9, 3.7656382261328287`*^9}, {3.7662401432029853`*^9, 
   3.766240154985159*^9}, {3.7663282678653297`*^9, 3.766328270484855*^9}, {
   3.766331146283388*^9, 3.7663311568355923`*^9}, {3.7663982782306576`*^9, 
   3.7663982795028768`*^9}, {3.7664037488989267`*^9, 
   3.7664037535714073`*^9}, {3.76675425955847*^9, 3.766754260902328*^9}, {
   3.767446029232342*^9, 3.7674460297011285`*^9}, {3.7675176217294626`*^9, 
   3.767517621841589*^9}, {3.7685471006341314`*^9, 3.7685471031625986`*^9}, {
   3.782651674525923*^9, 3.7826516762290554`*^9}, {3.7827472341594315`*^9, 
   3.7827472344406757`*^9}, {3.7845390971377993`*^9, 
   3.7845390993098416`*^9}, {3.7846213628789454`*^9, 
   3.7846213635508842`*^9}, {3.784971285415371*^9, 
   3.784971285852929*^9}},ExpressionUUID->"5f7ce718-2a29-4a8a-8eb1-\
683f55eff3b5"],

Cell[CellGroupData[{

Cell["Load Radia", "Section",
 CellChangeTimes->{{3.766397988602113*^9, 3.766398000439457*^9}, {
  3.784905891255539*^9, 
  3.7849058937557244`*^9}},ExpressionUUID->"95156af7-5dd8-45da-a415-\
0a31d84b95f3"],

Cell[CellGroupData[{

Cell[BoxData[{
 RowBox[{
  RowBox[{"<<", "Radia`"}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"RadPlot3DOptions", "[", "]"}], ";"}]}], "Input",
 CellChangeTimes->{{3.6818148953014574`*^9, 3.6818148962234063`*^9}},
 Background->RGBColor[0.87, 0.94, 1],
 CellLabel->"In[44]:=",ExpressionUUID->"16d50c27-748f-4147-8860-75bd600bf2c6"],

Cell[CellGroupData[{

Cell[BoxData[
 InterpretationBox[
  RowBox[{"\<\"Radia Version: \"\>", "\[InvisibleSpace]", "4.31`", 
   "\[InvisibleSpace]", "\<\" is loaded\"\>"}],
  SequenceForm["Radia Version: ", 4.31, " is loaded"],
  Editable->False]], "Print",
 CellChangeTimes->{3.7849720143550973`*^9, 3.784972153825938*^9, 
  3.7849727578753653`*^9, 3.784974794460477*^9, 3.7849751016751738`*^9},
 CellLabel->
  "During evaluation of \
In[44]:=",ExpressionUUID->"35c65ebd-b6e7-4209-9327-772ac11f2e02"],

Cell[BoxData["\<\"Radia is copyright ESRF, France.\"\>"], "Print",
 CellChangeTimes->{3.7849720143550973`*^9, 3.784972153825938*^9, 
  3.7849727578753653`*^9, 3.784974794460477*^9, 3.784975101690772*^9},
 CellLabel->
  "During evaluation of \
In[44]:=",ExpressionUUID->"cdfd8909-f355-4078-bf56-d61b542368ed"],

Cell[BoxData["\<\"Portions copyright Synchrotron SOLEIL, France.\"\>"], \
"Print",
 CellChangeTimes->{3.7849720143550973`*^9, 3.784972153825938*^9, 
  3.7849727578753653`*^9, 3.784974794460477*^9, 3.784975101690772*^9},
 CellLabel->
  "During evaluation of \
In[44]:=",ExpressionUUID->"35bbad5b-ea5f-485e-a5c0-fc6d2ba0665b"],

Cell[BoxData["\<\"Portions copyright Wolfram Research, Inc.\"\>"], "Print",
 CellChangeTimes->{3.7849720143550973`*^9, 3.784972153825938*^9, 
  3.7849727578753653`*^9, 3.784974794460477*^9, 3.784975101690772*^9},
 CellLabel->
  "During evaluation of \
In[44]:=",ExpressionUUID->"c1f6254b-798a-4ba2-a70a-663bfafe01a9"]
}, Open  ]]
}, Open  ]]
}, Open  ]],

Cell[CellGroupData[{

Cell["APU", "Section",
 CellChangeTimes->{{3.766397988602113*^9, 
  3.766398000439457*^9}},ExpressionUUID->"91a6e679-8d6a-434c-841a-\
c91067c369b8"],

Cell[CellGroupData[{

Cell["IDAPU", "Subsection",
 CellChangeTimes->{{3.7667543560660515`*^9, 
  3.7667543696296263`*^9}},ExpressionUUID->"6e533fa5-e911-4ccd-b297-\
49b6526dc497"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"IDAPU", "::", "usage"}], "=", 
    "\"\<IDAPU[\[Lambda]u, Np, Br, Gap, \\\"\[Delta]P\\\":0, \
\\\"BlockGap\\\":0, \\\"Termination\\\":\\\"None\\\", \\\"PosMagErrorsB\\\"\
\[Rule] {}, \\\"PosMagErrorsU\\\"\[Rule] {}]: Returns the ID model. \
\\n\\nArgs: \\n\[Lambda]u [mm] is the ID period, \\nNp is the number of \
periods, \\nBr[T] is the remanent magnetization of the permanent magnet \
blocks, \\nGap [mm] is the length of the minimum gap between the cassettes. \
\\n\\nOptional args: \\n\[Delta]P [mm] is the phase adjustement, \\nBlockGap \
[mm] is the longitudinal gap between the blocks, \\nTermination is the \
termination type (one of the following: None, OneBlockSym, OneBlockAntiSym, \
ThreeBlocksSym, ThreeBlocksAntiSym), \\nPosMagErrorsB is a list of positions \
and magnetization errors for the cassette B, \\nPosMagErrorsU is a list of \
positions and magnetization errors for the cassette U. \\n\\nPosition and \
magnetization errors: \\nThe list of position and magnetization errors must \
be empty or have a number of elements igual to the number of blocks on each \
cassette. Each element is a list with position and magnetization errors in \
the following format: \\n{{horizontal position error[mm], vertical position \
error[mm], longitudinal position error[mm]}, {horizontal magnetization \
error[T], vertical magnetization error[T], longitudinal magnetization \
error[T]}}. \\nThe errors will be add to the default values of position and \
magnetization of the blocks.\>\""}], ";"}], 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"IDAPU", "[", 
    RowBox[{
    "\[Lambda]u_", ",", " ", "Np_", ",", " ", "Br_", ",", " ", "Gap_", ",", 
     " ", 
     RowBox[{"OptionsPattern", "[", 
      RowBox[{"{", 
       RowBox[{
        RowBox[{"\"\<\[Delta]P\>\"", "\[Rule]", " ", "0"}], ",", " ", 
        RowBox[{"\"\<BlockGap\>\"", "->", "0"}], ",", " ", 
        RowBox[{"\"\<Termination\>\"", "\[Rule]", " ", "\"\<None\>\""}], ",", 
        "  ", 
        RowBox[{"\"\<PosMagErrorsB\>\"", "\[Rule]", " ", 
         RowBox[{"{", "}"}]}], ",", " ", 
        RowBox[{"\"\<PosMagErrorsU\>\"", "\[Rule]", " ", 
         RowBox[{"{", "}"}]}], ",", "  ", 
        RowBox[{"\"\<BlockScale\>\"", "\[Rule]", " ", "1"}]}], "}"}], "]"}]}],
     "]"}], " ", ":=", " ", 
   RowBox[{"Module", "[", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
      "f", ",", " ", "bg", ",", "  ", "BBlockShape", ",", "UBlockShape", ",", 
       " ", "BlockGap", ",", "BlockScale", ",", "Blocks", ",", " ", 
       "\[Delta]P", ",", " ", "Termination", ",", " ", "PosMagErrorsB", " ", 
       ",", " ", "PosMagErrorsU", ",", " ", "\[Delta]B", ",", " ", "B", ",", 
       " ", "\[Delta]U", ",", " ", "U", ",", " ", "Device", ",", " ", "t0", 
       ",", " ", "t1"}], "}"}], ",", "\[IndentingNewLine]", 
     "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"t0", "=", 
       RowBox[{"AbsoluteTime", "[", "]"}]}], ";", "\[IndentingNewLine]", 
      "\[IndentingNewLine]", 
      RowBox[{"(*", 
       RowBox[{"Delete", " ", "previous", " ", "Radia", " ", "objects"}], 
       "*)"}], "\[IndentingNewLine]", 
      RowBox[{"radUtiDelAll", "[", "]"}], ";", "\[IndentingNewLine]", 
      "\[IndentingNewLine]", 
      RowBox[{"(*", 
       RowBox[{"Check", " ", "arguments"}], "*)"}], "\[IndentingNewLine]", 
      RowBox[{"If", " ", "[", 
       RowBox[{
        RowBox[{"\[Lambda]u", " ", "\[LessEqual]", " ", "0"}], ",", " ", 
        RowBox[{"Return", "[", "]"}]}], "]"}], ";", "\[IndentingNewLine]", 
      RowBox[{"If", " ", "[", 
       RowBox[{
        RowBox[{"Np", " ", "\[LessEqual]", " ", "0"}], ",", " ", 
        RowBox[{"Return", "[", "]"}]}], "]"}], ";", "\[IndentingNewLine]", 
      RowBox[{"If", " ", "[", 
       RowBox[{
        RowBox[{"Br", " ", "\[LessEqual]", " ", "0"}], ",", " ", 
        RowBox[{"Return", "[", "]"}]}], "]"}], ";", "\[IndentingNewLine]", 
      RowBox[{"If", " ", "[", 
       RowBox[{
        RowBox[{"Gap", " ", "\[LessEqual]", " ", "0"}], ",", " ", 
        RowBox[{"Return", "[", "]"}]}], "]"}], ";", "\[IndentingNewLine]", 
      "\[IndentingNewLine]", 
      RowBox[{"(*", 
       RowBox[{"Gap", " ", "between", " ", "blocks"}], "*)"}], 
      "\[IndentingNewLine]", 
      RowBox[{"BlockGap", " ", "=", "  ", 
       RowBox[{"OptionValue", "[", "\"\<BlockGap\>\"", "]"}]}], ";", 
      "\[IndentingNewLine]", "\[IndentingNewLine]", 
      RowBox[{"(*", 
       RowBox[{"Cassettes", " ", "longitudinal", " ", 
        RowBox[{"displacement", " ", "[", "mm", "]"}]}], "*)"}], 
      "\[IndentingNewLine]", 
      RowBox[{"\[Delta]P", " ", "=", " ", 
       RowBox[{"OptionValue", "[", "\"\<\[Delta]P\>\"", "]"}]}], ";", " ", 
      RowBox[{"(*", 
       RowBox[{"Phase", " ", "adjustment"}], "*)"}], "\[IndentingNewLine]", 
      "\[IndentingNewLine]", 
      RowBox[{"(*", 
       RowBox[{"Termination", " ", "Type"}], "*)"}], "\[IndentingNewLine]", 
      RowBox[{"Termination", " ", "=", " ", 
       RowBox[{"OptionValue", "[", "\"\<Termination\>\"", "]"}]}], ";", 
      "\[IndentingNewLine]", "\[IndentingNewLine]", 
      RowBox[{"(*", 
       RowBox[{"Position", " ", "and", " ", "magnetization", " ", "errors"}], 
       "*)"}], "\[IndentingNewLine]", 
      RowBox[{"PosMagErrorsU", " ", "=", " ", 
       RowBox[{"OptionValue", "[", "\"\<PosMagErrorsU\>\"", "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"PosMagErrorsB", " ", "=", " ", 
       RowBox[{"OptionValue", "[", "\"\<PosMagErrorsB\>\"", "]"}]}], ";", 
      "\[IndentingNewLine]", "\[IndentingNewLine]", 
      RowBox[{"(*", 
       RowBox[{"Block", " ", "vertices"}], "*)"}], "\[IndentingNewLine]", 
      RowBox[{"BlockScale", " ", "=", " ", 
       RowBox[{"OptionValue", "[", "\"\<BlockScale\>\"", "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"Blocks", " ", "=", " ", 
       RowBox[{"BlockScale", "*", 
        RowBox[{"{", 
         RowBox[{"{", 
          RowBox[{
           RowBox[{"{", " ", 
            RowBox[{"15", ",", "0"}], "}"}], ",", 
           RowBox[{"{", 
            RowBox[{"18", ",", " ", "3"}], "}"}], ",", 
           RowBox[{"{", " ", 
            RowBox[{"18", ",", " ", "17"}], "}"}], ",", 
           RowBox[{"{", 
            RowBox[{"15", ",", "20"}], "}"}], ",", " ", 
           RowBox[{"{", 
            RowBox[{
             RowBox[{"-", "15"}], ",", "  ", "20"}], "}"}], ",", " ", 
           RowBox[{"{", 
            RowBox[{
             RowBox[{"-", "18"}], ",", "  ", "17"}], "}"}], ",", " ", 
           RowBox[{"{", 
            RowBox[{
             RowBox[{"-", "18"}], ",", "  ", "3"}], "}"}], ",", " ", 
           RowBox[{"{", 
            RowBox[{
             RowBox[{"-", "15"}], ",", " ", "0"}], " ", "}"}]}], "}"}], 
         "}"}]}]}], ";", "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"Blocks", " ", "[", 
        RowBox[{"[", 
         RowBox[{"All", ",", " ", "All", ",", " ", "2"}], "]"}], "]"}], "=", 
       " ", 
       RowBox[{
        RowBox[{"Blocks", " ", "[", 
         RowBox[{"[", 
          RowBox[{"All", ",", " ", "All", ",", " ", "2"}], "]"}], "]"}], "+", 
        " ", 
        RowBox[{"Gap", "/", "2"}]}]}], ";", "\[IndentingNewLine]", 
      "\[IndentingNewLine]", 
      RowBox[{"(*", 
       RowBox[{
       "Block", " ", "vertices", " ", "for", " ", "each", " ", "cassette", 
        " ", 
        RowBox[{"(", 
         RowBox[{
         "cross", " ", "section", " ", "in", " ", "the", " ", "xy", " ", 
          "plane"}], ")"}]}], "*)"}], "\[IndentingNewLine]", 
      RowBox[{"BBlockShape", "=", "Blocks"}], ";", "\[IndentingNewLine]", 
      RowBox[{"UBlockShape", "=", 
       RowBox[{
        RowBox[{
         RowBox[{
          RowBox[{
           RowBox[{"Dot", "[", 
            RowBox[{
             RowBox[{"RotationMatrix", "[", "\[Pi]", "]"}], ",", "#"}], "]"}],
            "&"}], "/@", "#"}], "&"}], "/@", "BBlockShape"}]}], ";", 
      "\[IndentingNewLine]", "\[IndentingNewLine]", 
      RowBox[{"(*", "Cassettes", "*)"}], "\[IndentingNewLine]", 
      RowBox[{"\[Delta]U", " ", "=", " ", "0"}], ";", "\[IndentingNewLine]", 
      RowBox[{"U", "=", " ", 
       RowBox[{"auxIDCassette", "[", 
        RowBox[{
        "\[Lambda]u", ",", " ", "Np", ",", " ", "Br", ",", "\[Delta]U", ",", 
         " ", "UBlockShape", ",", " ", 
         RowBox[{"\"\<BlockGap\>\"", "\[Rule]", " ", "BlockGap"}], ",", " ", 
         RowBox[{"\"\<Termination\>\"", "\[Rule]", " ", "Termination"}], ",", 
         " ", 
         RowBox[{"\"\<PointingUp\>\"", "\[Rule]", " ", "True"}], ",", "  ", 
         RowBox[{"\"\<FirstBlock\>\"", "\[Rule]", " ", "\"\<Down\>\""}], ",", 
         "  ", 
         RowBox[{"\"\<PosMagErrors\>\"", "\[Rule]", " ", "PosMagErrorsU"}]}], 
        "]"}]}], ";", "\[IndentingNewLine]", "\[IndentingNewLine]", 
      RowBox[{"\[Delta]B", " ", "=", "\[Delta]P"}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"B", " ", "=", " ", 
       RowBox[{"auxIDCassette", "[", 
        RowBox[{
        "\[Lambda]u", ",", " ", "Np", ",", " ", "Br", ",", "\[Delta]B", ",", 
         " ", "BBlockShape", ",", " ", 
         RowBox[{"\"\<BlockGap\>\"", "\[Rule]", " ", "BlockGap"}], ",", " ", 
         RowBox[{"\"\<Termination\>\"", "\[Rule]", " ", "Termination"}], ",", 
         "  ", 
         RowBox[{"\"\<PointingUp\>\"", "\[Rule]", " ", "False"}], ",", "  ", 
         RowBox[{"\"\<FirstBlock\>\"", "\[Rule]", " ", "\"\<Down\>\""}], ",", 
         " ", 
         RowBox[{"\"\<PosMagErrors\>\"", "\[Rule]", " ", "PosMagErrorsB"}]}], 
        "]"}]}], " ", ";", "\[IndentingNewLine]", "\[IndentingNewLine]", 
      RowBox[{"(*", 
       RowBox[{"Insertion", " ", "device"}], "*)"}], "\[IndentingNewLine]", 
      RowBox[{"Device", "=", " ", 
       RowBox[{"radObjCnt", "[", 
        RowBox[{"{", 
         RowBox[{"B", ",", " ", "U"}], "}"}], "]"}]}], ";", 
      "\[IndentingNewLine]", "\[IndentingNewLine]", 
      RowBox[{"t1", "=", 
       RowBox[{"AbsoluteTime", "[", "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"Print", "[", 
       RowBox[{"\"\<IDAPU: elapsed time = \>\"", ",", 
        RowBox[{"(", 
         RowBox[{"t1", "-", "t0"}], ")"}], ",", "\"\< s\>\""}], "]"}], ";", 
      "\[IndentingNewLine]", "\[IndentingNewLine]", 
      RowBox[{"Return", "[", "Device", "]"}], ";"}]}], "\[IndentingNewLine]", 
    "]"}]}], ";"}]}], "Input",
 CellChangeTimes->{{3.7663983120600963`*^9, 3.76639855854331*^9}, {
   3.766398611686247*^9, 3.7663990369387765`*^9}, {3.766399079212285*^9, 
   3.766399172321517*^9}, {3.766399309380847*^9, 3.7663993210570555`*^9}, {
   3.76640186623358*^9, 3.7664019074883833`*^9}, {3.766401991325385*^9, 
   3.7664020438052173`*^9}, {3.7664021236634097`*^9, 3.766402213899864*^9}, {
   3.7667537638923035`*^9, 3.766753965004061*^9}, {3.7667540021007276`*^9, 
   3.7667540157424326`*^9}, {3.7667540532922564`*^9, 
   3.7667540546204815`*^9}, {3.766754108859125*^9, 3.766754117625434*^9}, 
   3.7667541489091444`*^9, {3.7667544150238113`*^9, 3.7667544162426586`*^9}, {
   3.766755230010453*^9, 3.7667552349795885`*^9}, {3.76675674188527*^9, 
   3.7667568130783677`*^9}, {3.76675820960935*^9, 3.766758213328399*^9}, {
   3.7674431338586464`*^9, 3.76744316257965*^9}, {3.767443201442074*^9, 
   3.767443327889514*^9}, {3.767445672062233*^9, 3.767445685000744*^9}, {
   3.7674457212223516`*^9, 3.767445756789692*^9}, {3.767447936616846*^9, 
   3.767447957524736*^9}, {3.7675160835712852`*^9, 3.767516153160976*^9}, {
   3.767516304349866*^9, 3.767516309590888*^9}, {3.78264220436425*^9, 
   3.782642241837118*^9}, {3.782642314383713*^9, 3.782642316289955*^9}, {
   3.7826452169866014`*^9, 3.782645238714652*^9}, {3.782645273734026*^9, 
   3.7826452782183876`*^9}, 3.782652706141059*^9, {3.782659220133415*^9, 
   3.782659230477151*^9}, {3.7826594737633142`*^9, 3.7826594755914297`*^9}, {
   3.7827262145252175`*^9, 3.782726374684173*^9}, {3.7827264766712418`*^9, 
   3.782726480110671*^9}, {3.7849730501051702`*^9, 3.784973152951706*^9}, {
   3.78497328315753*^9, 3.784973284376378*^9}},
 Background->RGBColor[0.87, 0.94, 1],
 CellLabel->"In[46]:=",ExpressionUUID->"144b0752-c4a0-4150-8f34-feee4c82e808"]
}, Closed]],

Cell[CellGroupData[{

Cell["IDRectangularAPU", "Subsection",
 CellChangeTimes->{{3.7667543560660515`*^9, 3.7667543696296263`*^9}, 
   3.7667544088670793`*^9},ExpressionUUID->"158f9399-c099-49b7-8fa9-\
6c24cc88be6c"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"IDRectangularAPU", "::", "usage"}], "=", 
    "\"\<IDRectangularAPU[\[Lambda]u, Np, Br, Gap, \\\"\[Delta]P\\\":0, \
\\\"BlockGap\\\":0, \\\"BlockWidth\\\":gap, \\\"BlockHeight\\\":gap, \
\\\"Termination\\\":\\\"None\\\", \\\"PosMagErrorsB\\\"\[Rule] {}, \
\\\"PosMagErrorsU\\\"\[Rule] {}]: Returns the ID model. \\n\\nArgs: \\n\
\[Lambda]u [mm] is the ID period, \\nNp is the number of periods, \\nBr [T] \
is the remanent magnetization of the permanent magnet blocks, \\nGap [mm] is \
the length of the minimum gap between the cassettes. \\n\\nOptional args: \\n\
\[Delta]P [mm] is the phase adjustement, \\nBlockGap [mm] is the longitudinal \
gap between the blocks, \\nBlockWidth [mm] is the block width, \\nBlockHeight \
[mm] is the block height, \\nTermination is the termination type (one of the \
following: None, OneBlockSym, OneBlockAntiSym, ThreeBlocksSym, \
ThreeBlocksAntiSym), \\nPosMagErrorsB is a list of positions and \
magnetization errors for the cassette B, \\nPosMagErrorsU is a list of \
positions and magnetization errors for the cassette U. \\n\\nPosition and \
magnetization errors: \\nThe list of position and magnetization errors must \
be empty or have a number of elements igual to the number of blocks on each \
cassette. Each element is a list with position and magnetization errors in \
the following format: \\n{{horizontal position error[mm], vertical position \
error[mm], longitudinal position error[mm]}, {horizontal magnetization \
error[T], vertical magnetization error[T], longitudinal magnetization \
error[T]}}. \\nThe errors will be add to the default values of position and \
magnetization of the blocks.\>\""}], ";"}], 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"IDRectangularAPU", "[", 
    RowBox[{
    "\[Lambda]u_", ",", " ", "Np_", ",", " ", "Br_", ",", " ", "Gap_", ",", 
     " ", 
     RowBox[{"OptionsPattern", "[", 
      RowBox[{"{", 
       RowBox[{
        RowBox[{"\"\<\[Delta]P\>\"", "\[Rule]", " ", "0"}], ",", " ", 
        RowBox[{"\"\<BlockGap\>\"", "->", "0"}], ",", " ", 
        RowBox[{"\"\<BlockWidth\>\"", "\[Rule]", " ", "\"\<default\>\""}], 
        ",", " ", 
        RowBox[{"\"\<BlockHeight\>\"", "\[Rule]", " ", "\"\<default\>\""}], 
        ",", " ", 
        RowBox[{"\"\<Termination\>\"", "\[Rule]", " ", "\"\<None\>\""}], ",", 
        " ", 
        RowBox[{"\"\<PosMagErrorsB\>\"", "\[Rule]", " ", 
         RowBox[{"{", "}"}]}], ",", " ", 
        RowBox[{"\"\<PosMagErrorsU\>\"", "\[Rule]", " ", 
         RowBox[{"{", "}"}]}]}], "}"}], "]"}]}], "]"}], " ", ":=", " ", 
   RowBox[{"Module", "[", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
      "Width", ",", "Height", ",", " ", "BBlockShape", ",", "UBlockShape", 
       ",", " ", "BlockGap", ",", "\[Delta]P", ",", " ", "Termination", ",", 
       "PosMagErrorsB", " ", ",", " ", "PosMagErrorsU", ",", " ", "\[Delta]B",
        ",", " ", "B", ",", " ", "\[Delta]U", ",", " ", "U", ",", " ", 
       "Device", " ", ",", " ", "t0", ",", " ", "t1"}], "}"}], ",", 
     "\[IndentingNewLine]", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"t0", "=", 
       RowBox[{"AbsoluteTime", "[", "]"}]}], ";", "\[IndentingNewLine]", 
      "\[IndentingNewLine]", 
      RowBox[{"(*", 
       RowBox[{"Delete", " ", "previous", " ", "Radia", " ", "objects"}], 
       "*)"}], "\[IndentingNewLine]", 
      RowBox[{"radUtiDelAll", "[", "]"}], ";", "\[IndentingNewLine]", 
      "\[IndentingNewLine]", 
      RowBox[{"(*", 
       RowBox[{"Check", " ", "arguments"}], "*)"}], "\[IndentingNewLine]", 
      RowBox[{"If", " ", "[", 
       RowBox[{
        RowBox[{"\[Lambda]u", " ", "\[LessEqual]", " ", "0"}], ",", " ", 
        RowBox[{"Return", "[", "]"}]}], "]"}], ";", "\[IndentingNewLine]", 
      RowBox[{"If", " ", "[", 
       RowBox[{
        RowBox[{"Np", " ", "\[LessEqual]", " ", "0"}], ",", " ", 
        RowBox[{"Return", "[", "]"}]}], "]"}], ";", "\[IndentingNewLine]", 
      RowBox[{"If", " ", "[", 
       RowBox[{
        RowBox[{"Br", " ", "\[LessEqual]", " ", "0"}], ",", " ", 
        RowBox[{"Return", "[", "]"}]}], "]"}], ";", "\[IndentingNewLine]", 
      RowBox[{"If", " ", "[", 
       RowBox[{
        RowBox[{"Gap", " ", "\[LessEqual]", " ", "0"}], ",", " ", 
        RowBox[{"Return", "[", "]"}]}], "]"}], ";", "\[IndentingNewLine]", 
      "\[IndentingNewLine]", 
      RowBox[{"(*", 
       RowBox[{"Gap", " ", "between", " ", "blocks"}], "*)"}], 
      "\[IndentingNewLine]", 
      RowBox[{"BlockGap", " ", "=", "  ", 
       RowBox[{"OptionValue", "[", "\"\<BlockGap\>\"", "]"}]}], ";", 
      "\[IndentingNewLine]", "\[IndentingNewLine]", 
      RowBox[{"(*", 
       RowBox[{"Block", " ", "size"}], "*)"}], "\[IndentingNewLine]", 
      RowBox[{"Height", " ", "=", 
       RowBox[{"If", "[", 
        RowBox[{
         RowBox[{
          RowBox[{"OptionValue", "[", "\"\<BlockHeight\>\"", "]"}], " ", 
          "\[Equal]", " ", "\"\<default\>\""}], ",", " ", "Gap", ",", 
         RowBox[{"OptionValue", "[", "\"\<BlockHeight\>\"", "]"}]}], " ", 
        "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"Width", " ", "=", "  ", 
       RowBox[{"If", "[", 
        RowBox[{
         RowBox[{
          RowBox[{"OptionValue", "[", "\"\<BlockWidth\>\"", "]"}], 
          "\[Equal]", "\"\<default\>\""}], ",", " ", "Gap", ",", 
         RowBox[{"OptionValue", "[", "\"\<BlockWidth\>\"", "]"}]}], "]"}]}], 
      " ", ";", "\[IndentingNewLine]", 
      RowBox[{"If", "[", 
       RowBox[{
        RowBox[{
         RowBox[{"Height", "\[LessEqual]", "0"}], " ", "||", " ", 
         RowBox[{"Width", " ", "\[LessEqual]", "0"}]}], ",", " ", 
        RowBox[{"Return", "[", "]"}]}], "]"}], ";", "\[IndentingNewLine]", 
      "\[IndentingNewLine]", 
      RowBox[{"(*", 
       RowBox[{"Cassettes", " ", "longitudinal", " ", 
        RowBox[{"displacement", " ", "[", "mm", "]"}]}], "*)"}], 
      "\[IndentingNewLine]", 
      RowBox[{"\[Delta]P", " ", "=", " ", 
       RowBox[{"OptionValue", "[", "\"\<\[Delta]P\>\"", "]"}]}], ";", " ", 
      RowBox[{"(*", 
       RowBox[{"Phase", " ", "adjustment"}], "*)"}], "\[IndentingNewLine]", 
      "\[IndentingNewLine]", 
      RowBox[{"(*", 
       RowBox[{"Termination", " ", "Type"}], "*)"}], "\[IndentingNewLine]", 
      RowBox[{"Termination", " ", "=", " ", 
       RowBox[{"OptionValue", "[", "\"\<Termination\>\"", "]"}]}], ";", 
      "\[IndentingNewLine]", "\[IndentingNewLine]", 
      RowBox[{"(*", 
       RowBox[{"Position", " ", "and", " ", "magnetization", " ", "errors"}], 
       "*)"}], "\[IndentingNewLine]", 
      RowBox[{"PosMagErrorsB", " ", "=", " ", 
       RowBox[{"OptionValue", "[", "\"\<PosMagErrorsB\>\"", "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"PosMagErrorsU", " ", "=", " ", 
       RowBox[{"OptionValue", "[", "\"\<PosMagErrorsU\>\"", "]"}]}], ";", 
      "\[IndentingNewLine]", "\[IndentingNewLine]", 
      RowBox[{"(*", 
       RowBox[{
       "Block", " ", "vertices", " ", "for", " ", "each", " ", "cassette", 
        " ", 
        RowBox[{"(", 
         RowBox[{
         "cross", " ", "section", " ", "in", " ", "the", " ", "xy", " ", 
          "plane"}], ")"}]}], "*)"}], "\[IndentingNewLine]", 
      RowBox[{"BBlockShape", "=", 
       RowBox[{"{", 
        RowBox[{
         RowBox[{"{", " ", 
          RowBox[{
           RowBox[{
            RowBox[{"-", "Width"}], "/", "2"}], ",", " ", 
           RowBox[{"Gap", "/", "2"}]}], "}"}], ",", 
         RowBox[{"{", 
          RowBox[{
           RowBox[{
            RowBox[{"-", "Width"}], "/", "2"}], ",", " ", 
           RowBox[{
            RowBox[{"Gap", "/", "2"}], " ", "+", "Height"}]}], "}"}], ",", 
         RowBox[{"{", " ", 
          RowBox[{
           RowBox[{"Width", "/", "2"}], ",", " ", 
           RowBox[{
            RowBox[{"Gap", "/", "2"}], "+", "Height"}]}], "}"}], ",", 
         RowBox[{"{", " ", 
          RowBox[{
           RowBox[{"Width", "/", "2"}], ",", 
           RowBox[{"Gap", "/", "2"}]}], "}"}]}], "}"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"UBlockShape", "=", 
       RowBox[{"{", 
        RowBox[{
         RowBox[{"{", " ", 
          RowBox[{
           RowBox[{"Width", "/", "2"}], ",", 
           RowBox[{
            RowBox[{"-", "Gap"}], "/", "2"}]}], "}"}], ",", 
         RowBox[{"{", 
          RowBox[{
           RowBox[{"Width", "/", "2"}], ",", 
           RowBox[{
            RowBox[{
             RowBox[{"-", "Gap"}], "/", "2"}], " ", "-", "Height"}]}], "}"}], 
         ",", 
         RowBox[{"{", 
          RowBox[{
           RowBox[{
            RowBox[{"-", "Width"}], "/", "2"}], ",", 
           RowBox[{
            RowBox[{
             RowBox[{"-", "Gap"}], "/", "2"}], "-", "Height"}]}], "}"}], ",", 
         RowBox[{"{", 
          RowBox[{
           RowBox[{
            RowBox[{"-", "Width"}], "/", "2"}], ",", 
           RowBox[{
            RowBox[{"-", "Gap"}], "/", "2"}]}], "}"}]}], "}"}]}], ";", 
      "\[IndentingNewLine]", "\[IndentingNewLine]", 
      RowBox[{"(*", "Cassettes", "*)"}], "\[IndentingNewLine]", 
      RowBox[{"\[Delta]U", " ", "=", " ", "0"}], ";", "\[IndentingNewLine]", 
      RowBox[{"U", " ", "=", " ", 
       RowBox[{"auxIDCassette", "[", 
        RowBox[{
        "\[Lambda]u", ",", " ", "Np", ",", "Br", ",", "\[Delta]U", ",", " ", 
         "UBlockShape", ",", 
         RowBox[{"\"\<Rectangular\>\"", "\[Rule]", " ", "True"}], ",", " ", 
         RowBox[{"\"\<BlockGap\>\"", "\[Rule]", " ", "BlockGap"}], ",", " ", 
         RowBox[{"\"\<Termination\>\"", "\[Rule]", " ", "Termination"}], ",", 
         " ", 
         RowBox[{"\"\<PointingUp\>\"", "\[Rule]", " ", "True"}], ",", "   ", 
         RowBox[{"\"\<FirstBlock\>\"", "\[Rule]", " ", "\"\<Down\>\""}], ",", 
         "  ", 
         RowBox[{"\"\<PosMagErrors\>\"", "\[Rule]", " ", "PosMagErrorsU"}]}], 
        "]"}]}], ";", "\[IndentingNewLine]", "\[IndentingNewLine]", 
      RowBox[{"\[Delta]B", " ", "=", "\[Delta]P"}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"B", " ", "=", " ", 
       RowBox[{"auxIDCassette", "[", 
        RowBox[{
        "\[Lambda]u", ",", " ", "Np", ",", "Br", ",", "\[Delta]B", ",", " ", 
         "BBlockShape", ",", 
         RowBox[{"\"\<Rectangular\>\"", "\[Rule]", " ", "True"}], ",", " ", 
         RowBox[{"\"\<BlockGap\>\"", "\[Rule]", " ", "BlockGap"}], ",", " ", 
         RowBox[{"\"\<Termination\>\"", "\[Rule]", " ", "Termination"}], ",", 
         RowBox[{"\"\<PointingUp\>\"", "\[Rule]", "False"}], ",", "  ", 
         RowBox[{"\"\<FirstBlock\>\"", "\[Rule]", " ", "\"\<Down\>\""}], ",", 
         " ", 
         RowBox[{"\"\<PosMagErrors\>\"", "\[Rule]", " ", "PosMagErrorsB"}]}], 
        "]"}]}], ";", "\[IndentingNewLine]", "\[IndentingNewLine]", 
      RowBox[{"(*", 
       RowBox[{"Insertion", " ", "device"}], "*)"}], "\[IndentingNewLine]", 
      RowBox[{"Device", "=", " ", 
       RowBox[{"radObjCnt", "[", 
        RowBox[{"{", 
         RowBox[{"B", ",", " ", "U"}], "}"}], "]"}]}], ";", 
      "\[IndentingNewLine]", "\[IndentingNewLine]", 
      RowBox[{"t1", "=", 
       RowBox[{"AbsoluteTime", "[", "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"Print", "[", 
       RowBox[{"\"\<IDRectangularAPU: elapsed time = \>\"", ",", 
        RowBox[{"(", 
         RowBox[{"t1", "-", "t0"}], ")"}], ",", "\"\< s\>\""}], "]"}], ";", 
      "\[IndentingNewLine]", "\[IndentingNewLine]", 
      RowBox[{"Return", "[", "Device", "]"}], ";"}]}], "\[IndentingNewLine]", 
    "]"}]}], ";"}]}], "Input",
 CellChangeTimes->{{3.766755241589485*^9, 3.7667552459335747`*^9}, {
   3.76675682573561*^9, 3.7667569075389185`*^9}, {3.7667582055777817`*^9, 
   3.7667582558178897`*^9}, {3.767445863079317*^9, 3.7674458937866373`*^9}, {
   3.7674479659941387`*^9, 3.767447992431658*^9}, {3.767516329005494*^9, 
   3.7675163349141564`*^9}, {3.7826424521956673`*^9, 3.782642485633035*^9}, {
   3.782642526148491*^9, 3.7826426422438354`*^9}, {3.7826431669902844`*^9, 
   3.7826431841327906`*^9}, {3.7826448909030795`*^9, 3.782644915546153*^9}, {
   3.7826452488552136`*^9, 3.7826452657945814`*^9}, {3.7826526937661037`*^9, 
   3.782652694406726*^9}, {3.7826592433364515`*^9, 3.782659247633306*^9}, 
   3.784974882863183*^9},
 Background->RGBColor[0.87, 0.94, 1],
 CellLabel->"In[48]:=",ExpressionUUID->"c3685a3f-e1ee-4d8d-97bf-8f7c6784ba2a"]
}, Closed]]
}, Open  ]],

Cell[CellGroupData[{

Cell["Delta", "Section",
 CellChangeTimes->{{3.7663980194296393`*^9, 
  3.7663980316884046`*^9}},ExpressionUUID->"121e9b26-030a-41f4-86a3-\
ee4a843ad47b"],

Cell[CellGroupData[{

Cell["IDDelta", "Subsection",
 CellChangeTimes->{{3.766754518453103*^9, 3.766754525359883*^9}, {
  3.767534951344644*^9, 3.767534995136586*^9}, {3.7826516660103407`*^9, 
  3.7826516661978397`*^9}},ExpressionUUID->"a1038eec-a59a-42b3-a2a7-\
f9281ff8e165"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"IDDelta", "::", "usage"}], "=", 
    "\"\<IDDelta[\[Lambda]u, Np, Br, Gap, \\\"\[Delta]P\\\":0, \\\"\[Delta]GV\
\\\":0, \\\"\[Delta]GH\\\":0, \\\"\[Delta]CP\\\":0, \\\"BlockGap\\\":0, \
\\\"Termination\\\":\\\"None\\\", \\\"PosMagErrorsBRC\\\"\[Rule] {}, \
\\\"PosMagErrorsBLC\\\"\[Rule] {}, \\\"PosMagErrorsULC\\\"\[Rule] {}, \
\\\"PosMagErrorsURC\\\"\[Rule] {}, \\\"BlockVersion\\\"\[Rule] \
\\\"Delta22.0\\\", \\\"BlockScale\\\"\[Rule] 1]: Returns the ID model. \
\\n\\nArgs: \\n\[Lambda]u [mm] is the ID period, \\nNp is the number of \
periods, \\nBr [T] is the remanent magnetization of the permanent magnet \
blocks, \\nGap [mm] is the length of the minimum gap between the cassettes. \
\\n\\nOptional args: \\n\[Delta]P [mm], \[Delta]GV [mm], \[Delta]GH [mm] and \
\[Delta]CP [mm] are four types of longitudinal movements between the \
cassettes, \[Delta]P is the phase adjustement, \[Delta]GV and \[Delta]GH \
control the amplitude of the longitudinal field component and \[Delta]CP is \
the inclined-polarization adjustment, \\nBlockGap [mm] is the longitudinal \
gap between the blocks, \\nTermination is the termination type (one of the \
following: None, OneBlockSym, OneBlockAntiSym, ThreeBlocksSym, \
ThreeBlocksAntiSym), \\nBlockVersion is related with the shape of the blocks \
(one of the following: Prototype, V1, V2, Delta22.0 or Delta52.5), \
\\nPosMagErrorsBRC is a list of positions and magnetization errors for the BR \
cassette, \\nPosMagErrorsBLC is a list of positions and magnetization errors \
for the BL cassette, \\nPosMagErrorsULC is a list of positions and \
magnetization errors for the UL cassette, \\nPosMagErrorsURC is a list of \
positions and magnetization errors for the UR cassette. \\n\\nPosition and \
magnetization errors: \\nThe list of position and magnetization errors must \
be empty or have a number of elements igual to the number of blocks on each \
cassette. Each element is a list with position and magnetization errors in \
the following format: \\n{{horizontal position error[mm], vertical position \
error[mm], longitudinal position error[mm]}, {horizontal magnetization \
error[T], vertical magnetization error[T], longitudinal magnetization \
error[T]}}. \\nThe errors will be add to the default values of position and \
magnetization of the blocks.\>\""}], ";"}], 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"IDDelta", "[", 
    RowBox[{
    "\[Lambda]u_", ",", " ", "Np_", ",", " ", "Br_", ",", " ", "Gap_", ",", 
     " ", 
     RowBox[{"OptionsPattern", "[", 
      RowBox[{"{", 
       RowBox[{
        RowBox[{"\"\<\[Delta]P\>\"", "\[Rule]", " ", "0"}], ",", " ", 
        RowBox[{"\"\<\[Delta]GV\>\"", "\[Rule]", " ", "0"}], ",", " ", 
        RowBox[{"\"\<\[Delta]GH\>\"", "\[Rule]", " ", "0"}], ",", " ", 
        RowBox[{"\"\<\[Delta]CP\>\"", "\[Rule]", " ", "0"}], ",", " ", 
        RowBox[{"\"\<BlockGap\>\"", "->", "0"}], ",", "  ", 
        RowBox[{"\"\<Termination\>\"", "\[Rule]", " ", "\"\<None\>\""}], ",", 
        " ", 
        RowBox[{"\"\<PosMagErrorsBRC\>\"", "\[Rule]", " ", 
         RowBox[{"{", "}"}]}], ",", " ", 
        RowBox[{"\"\<PosMagErrorsBLC\>\"", "\[Rule]", " ", 
         RowBox[{"{", "}"}]}], ",", " ", 
        RowBox[{"\"\<PosMagErrorsULC\>\"", "\[Rule]", " ", 
         RowBox[{"{", "}"}]}], ",", " ", 
        RowBox[{"\"\<PosMagErrorsURC\>\"", "\[Rule]", " ", 
         RowBox[{"{", "}"}]}], ",", " ", 
        RowBox[{"\"\<BlockVersion\>\"", "\[Rule]", " ", "\"\<Delta22.0\>\""}],
         ",", " ", 
        RowBox[{"\"\<BlockScale\>\"", "\[Rule]", " ", "1"}]}], "}"}], "]"}]}],
     "]"}], " ", ":=", " ", 
   RowBox[{"Module", "[", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
      "f", ",", " ", "Blocka", " ", ",", " ", "Blockb", ",", "Blocks", ",", 
       "BlockVersion", " ", ",", "BlockScale", ",", "\[IndentingNewLine]", 
       "BRCBlockShape", ",", " ", "BLCBlockShape", ",", " ", "ULCBlockShape", 
       ",", " ", "URCBlockShape", ",", " ", "\[IndentingNewLine]", 
       "PosMagErrorsBRC", " ", ",", " ", "PosMagErrorsBLC", ",", " ", 
       "PosMagErrorsULC", " ", ",", " ", "PosMagErrorsURC", ",", 
       "\[IndentingNewLine]", "\[Delta]P", ",", " ", "\[Delta]GV", ",", " ", 
       "\[Delta]GH", ",", " ", "\[Delta]CP", ",", " ", "Termination", ",", 
       "\[IndentingNewLine]", " ", "BlockGap", ",", " ", "\[Delta]BRC", ",", 
       " ", "BRC", ",", " ", "\[Delta]BLC", ",", " ", "BLC", ",", " ", 
       "\[Delta]ULC", ",", " ", "ULC", ",", " ", "\[Delta]URC", ",", " ", 
       "URC", ",", "Device", ",", " ", "t0", ",", " ", "t1"}], "}"}], ",", 
     "\[IndentingNewLine]", 
     RowBox[{"(*", 
      RowBox[{
       RowBox[{
       "The", " ", "insertion", " ", "device", " ", "is", " ", "created", " ",
         "rotated", " ", "by", " ", 
        RowBox[{"\[Pi]", "/", "4"}], " ", "about", " ", "the", " ", "y"}], 
       "-", 
       RowBox[{
       "axis", " ", "to", " ", "simplified", " ", "the", " ", "magnetization",
         " ", 
        RowBox[{"functions", ".", " ", "The"}], " ", "entire", " ", "device", 
        " ", "is", " ", "rotated", " ", "to", " ", "the", " ", "correct", " ",
         "position", " ", "at", " ", "the", " ", "end", " ", "of", " ", "the",
         " ", 
        RowBox[{"function", "."}]}]}], "*)"}], "\[IndentingNewLine]", 
     "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"t0", "=", 
       RowBox[{"AbsoluteTime", "[", "]"}]}], ";", "\[IndentingNewLine]", 
      "\[IndentingNewLine]", 
      RowBox[{"(*", 
       RowBox[{"Delete", " ", "previous", " ", "Radia", " ", "objects"}], 
       "*)"}], "\[IndentingNewLine]", 
      RowBox[{"radUtiDelAll", "[", "]"}], ";", "\[IndentingNewLine]", 
      "\[IndentingNewLine]", 
      RowBox[{"(*", 
       RowBox[{"Check", " ", "arguments"}], "*)"}], "\[IndentingNewLine]", 
      RowBox[{"If", " ", "[", 
       RowBox[{
        RowBox[{"\[Lambda]u", " ", "\[LessEqual]", " ", "0"}], ",", " ", 
        RowBox[{"Return", "[", "]"}]}], "]"}], ";", "\[IndentingNewLine]", 
      RowBox[{"If", " ", "[", 
       RowBox[{
        RowBox[{"Np", " ", "\[LessEqual]", " ", "0"}], ",", " ", 
        RowBox[{"Return", "[", "]"}]}], "]"}], ";", "\[IndentingNewLine]", 
      RowBox[{"If", " ", "[", 
       RowBox[{
        RowBox[{"Br", " ", "\[LessEqual]", " ", "0"}], ",", " ", 
        RowBox[{"Return", "[", "]"}]}], "]"}], ";", "\[IndentingNewLine]", 
      RowBox[{"If", " ", "[", 
       RowBox[{
        RowBox[{"Gap", " ", "\[LessEqual]", " ", "0"}], ",", " ", 
        RowBox[{"Return", "[", "]"}]}], "]"}], ";", "\[IndentingNewLine]", 
      "\[IndentingNewLine]", 
      RowBox[{"(*", 
       RowBox[{"Gap", " ", "between", " ", "blocks"}], "*)"}], 
      "\[IndentingNewLine]", " ", 
      RowBox[{"BlockGap", " ", "=", " ", 
       RowBox[{"OptionValue", "[", "\"\<BlockGap\>\"", "]"}]}], ";", 
      "\[IndentingNewLine]", "\[IndentingNewLine]", 
      RowBox[{"(*", 
       RowBox[{"Cassettes", " ", "longitudinal", " ", 
        RowBox[{"displacement", " ", "[", "mm", "]"}]}], "*)"}], 
      "\[IndentingNewLine]", 
      RowBox[{"\[Delta]P", " ", "=", " ", 
       RowBox[{"OptionValue", "[", "\"\<\[Delta]P\>\"", "]"}]}], ";", " ", 
      RowBox[{"(*", 
       RowBox[{"Phase", " ", "adjustment"}], "*)"}], "\[IndentingNewLine]", 
      RowBox[{"\[Delta]GV", " ", "=", " ", 
       RowBox[{"OptionValue", "[", "\"\<\[Delta]GV\>\"", "]"}]}], ";", " ", 
      RowBox[{"(*", 
       RowBox[{
        RowBox[{
        "Vertical", " ", "field", " ", "amplitude", " ", "to", " ", 
         "longitudinal", " ", "field", " ", "amplitude"}], ",", " ", 
        RowBox[{
        "also", " ", "decreases", " ", "horizontal", " ", "field", " ", 
         "amplitude"}]}], "*)"}], "\[IndentingNewLine]", 
      RowBox[{"\[Delta]GH", " ", "=", " ", 
       RowBox[{"OptionValue", "[", "\"\<\[Delta]GH\>\"", "]"}]}], ";", 
      RowBox[{"(*", 
       RowBox[{
        RowBox[{
        "Horizontal", " ", "field", " ", "amplitude", " ", "to", " ", 
         "longitudinal", " ", "field", " ", "amplitude"}], ",", " ", 
        RowBox[{
        "also", " ", "decreases", " ", "vertical", " ", "field", " ", 
         "amplitude"}]}], "*)"}], "\[IndentingNewLine]", 
      RowBox[{"\[Delta]CP", " ", "=", " ", 
       RowBox[{"OptionValue", "[", "\"\<\[Delta]CP\>\"", "]"}]}], ";", 
      RowBox[{"(*", 
       RowBox[{"Inclined", " ", "polarization", " ", "adjustment"}], "*)"}], 
      "\[IndentingNewLine]", "\[IndentingNewLine]", 
      RowBox[{"(*", 
       RowBox[{"Termination", " ", "Type"}], "*)"}], "\[IndentingNewLine]", 
      RowBox[{"Termination", " ", "=", " ", 
       RowBox[{"OptionValue", "[", "\"\<Termination\>\"", "]"}]}], ";", 
      "\[IndentingNewLine]", "\[IndentingNewLine]", 
      RowBox[{"(*", 
       RowBox[{"Position", " ", "and", " ", "magnetization", " ", "errors"}], 
       "*)"}], "\[IndentingNewLine]", 
      RowBox[{"PosMagErrorsBRC", " ", "=", " ", 
       RowBox[{"OptionValue", "[", "\"\<PosMagErrorsBRC\>\"", "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"PosMagErrorsBLC", " ", "=", " ", 
       RowBox[{"OptionValue", "[", "\"\<PosMagErrorsBLC\>\"", "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"PosMagErrorsULC", " ", "=", " ", 
       RowBox[{"OptionValue", "[", "\"\<PosMagErrorsULC\>\"", "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"PosMagErrorsURC", " ", "=", " ", 
       RowBox[{"OptionValue", "[", "\"\<PosMagErrorsURC\>\"", "]"}]}], ";", 
      "\[IndentingNewLine]", "\[IndentingNewLine]", 
      RowBox[{"(*", 
       RowBox[{
        RowBox[{
        "Counterclockwise", " ", "rotation", " ", "of", " ", "errors", " ", 
         "by", " ", 
         RowBox[{"\[Pi]", "/", "4"}], " ", "around", " ", "the", " ", "z"}], 
        "-", "axis"}], "*)"}], "\[IndentingNewLine]", 
      RowBox[{"PosMagErrorsBRC", " ", "=", " ", 
       RowBox[{
        RowBox[{
         RowBox[{"{", 
          RowBox[{
           RowBox[{"Dot", "[", 
            RowBox[{
             RowBox[{"RotationMatrix", "[", 
              RowBox[{
               RowBox[{"\[Pi]", "/", "4"}], ",", " ", 
               RowBox[{"{", 
                RowBox[{"0", ",", " ", "0", ",", " ", "1"}], "}"}]}], "]"}], 
             ",", 
             RowBox[{"#", "[", 
              RowBox[{"[", "1", "]"}], "]"}]}], "]"}], ",", 
           RowBox[{"Dot", "[", 
            RowBox[{
             RowBox[{"RotationMatrix", "[", 
              RowBox[{
               RowBox[{"\[Pi]", "/", "4"}], ",", " ", 
               RowBox[{"{", 
                RowBox[{"0", ",", " ", "0", ",", " ", "1"}], "}"}]}], "]"}], 
             ",", 
             RowBox[{"#", "[", 
              RowBox[{"[", "2", "]"}], "]"}]}], "]"}]}], "}"}], "&"}], "/@", 
        " ", " ", "PosMagErrorsBRC"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"PosMagErrorsBLC", " ", "=", " ", 
       RowBox[{
        RowBox[{
         RowBox[{"{", 
          RowBox[{
           RowBox[{"Dot", "[", 
            RowBox[{
             RowBox[{"RotationMatrix", "[", 
              RowBox[{
               RowBox[{"\[Pi]", "/", "4"}], ",", " ", 
               RowBox[{"{", 
                RowBox[{"0", ",", " ", "0", ",", " ", "1"}], "}"}]}], "]"}], 
             ",", 
             RowBox[{"#", "[", 
              RowBox[{"[", "1", "]"}], "]"}]}], "]"}], ",", 
           RowBox[{"Dot", "[", 
            RowBox[{
             RowBox[{"RotationMatrix", "[", 
              RowBox[{
               RowBox[{"\[Pi]", "/", "4"}], ",", " ", 
               RowBox[{"{", 
                RowBox[{"0", ",", " ", "0", ",", " ", "1"}], "}"}]}], "]"}], 
             ",", 
             RowBox[{"#", "[", 
              RowBox[{"[", "2", "]"}], "]"}]}], "]"}]}], "}"}], "&"}], "/@", 
        " ", " ", "PosMagErrorsBLC"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"PosMagErrorsULC", " ", "=", " ", 
       RowBox[{
        RowBox[{
         RowBox[{"{", 
          RowBox[{
           RowBox[{"Dot", "[", 
            RowBox[{
             RowBox[{"RotationMatrix", "[", 
              RowBox[{
               RowBox[{"\[Pi]", "/", "4"}], ",", " ", 
               RowBox[{"{", 
                RowBox[{"0", ",", " ", "0", ",", " ", "1"}], "}"}]}], "]"}], 
             ",", 
             RowBox[{"#", "[", 
              RowBox[{"[", "1", "]"}], "]"}]}], "]"}], ",", 
           RowBox[{"Dot", "[", 
            RowBox[{
             RowBox[{"RotationMatrix", "[", 
              RowBox[{
               RowBox[{"\[Pi]", "/", "4"}], ",", " ", 
               RowBox[{"{", 
                RowBox[{"0", ",", " ", "0", ",", " ", "1"}], "}"}]}], "]"}], 
             ",", 
             RowBox[{"#", "[", 
              RowBox[{"[", "2", "]"}], "]"}]}], "]"}]}], "}"}], "&"}], "/@", 
        " ", " ", "PosMagErrorsULC"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"PosMagErrorsURC", " ", "=", " ", 
       RowBox[{
        RowBox[{
         RowBox[{"{", 
          RowBox[{
           RowBox[{"Dot", "[", 
            RowBox[{
             RowBox[{"RotationMatrix", "[", 
              RowBox[{
               RowBox[{"\[Pi]", "/", "4"}], ",", " ", 
               RowBox[{"{", 
                RowBox[{"0", ",", " ", "0", ",", " ", "1"}], "}"}]}], "]"}], 
             ",", 
             RowBox[{"#", "[", 
              RowBox[{"[", "1", "]"}], "]"}]}], "]"}], ",", 
           RowBox[{"Dot", "[", 
            RowBox[{
             RowBox[{"RotationMatrix", "[", 
              RowBox[{
               RowBox[{"\[Pi]", "/", "4"}], ",", " ", 
               RowBox[{"{", 
                RowBox[{"0", ",", " ", "0", ",", " ", "1"}], "}"}]}], "]"}], 
             ",", 
             RowBox[{"#", "[", 
              RowBox[{"[", "2", "]"}], "]"}]}], "]"}]}], "}"}], "&"}], "/@", 
        "  ", "PosMagErrorsURC"}]}], ";", "\[IndentingNewLine]", 
      "\[IndentingNewLine]", 
      RowBox[{"(*", 
       RowBox[{"Block", " ", "vertices"}], "*)"}], "\[IndentingNewLine]", 
      RowBox[{"BlockVersion", " ", "=", "  ", 
       RowBox[{"OptionValue", "[", "\"\<BlockVersion\>\"", "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"BlockScale", " ", "=", " ", 
       RowBox[{"OptionValue", "[", "\"\<BlockScale\>\"", "]"}]}], ";", 
      "\[IndentingNewLine]", "\[IndentingNewLine]", 
      RowBox[{"Which", "[", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"BlockVersion", " ", "\[Equal]", " ", "\"\<Prototype\>\""}], 
        ",", "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"Blocka", " ", "=", " ", 
          RowBox[{"BlockScale", "*", 
           RowBox[{"{", 
            RowBox[{
             RowBox[{"{", 
              RowBox[{
               RowBox[{"-", "2.75"}], ",", " ", "0"}], "}"}], ",", " ", 
             RowBox[{"{", 
              RowBox[{
               RowBox[{"-", "11.2662"}], ",", "8.9645"}], "}"}], ",", " ", 
             RowBox[{"{", 
              RowBox[{
               RowBox[{"-", "7.73071"}], ",", "12.5"}], "}"}], ",", 
             RowBox[{"{", 
              RowBox[{"7.73071", ",", " ", "12.5"}], "}"}], ",", " ", 
             RowBox[{"{", 
              RowBox[{"11.2662", ",", " ", "8.9645"}], "}"}], ",", " ", 
             RowBox[{"{", 
              RowBox[{"2.75", ",", "0"}], "}"}]}], "}"}]}]}], ";", 
         "\[IndentingNewLine]", 
         RowBox[{"Blockb", " ", "=", " ", 
          RowBox[{"BlockScale", "*", 
           RowBox[{"{", " ", 
            RowBox[{
             RowBox[{"{", 
              RowBox[{
               RowBox[{"-", "7.73071"}], ",", "12.5"}], "}"}], ",", 
             RowBox[{"{", 
              RowBox[{
               RowBox[{"-", "11.2662"}], ",", " ", "16.0355"}], "}"}], ",", 
             RowBox[{"{", 
              RowBox[{
               RowBox[{"-", "2.75"}], ",", "25"}], "}"}], ",", " ", 
             RowBox[{"{", 
              RowBox[{"2.75", ",", "25"}], "}"}], ",", " ", 
             RowBox[{"{", 
              RowBox[{"11.2662", ",", "16.0355"}], "}"}], ",", " ", 
             RowBox[{"{", 
              RowBox[{"7.73071", ",", " ", "12.5"}], "}"}]}], "}"}]}]}], ";", 
         "\[IndentingNewLine]", 
         RowBox[{"Blocks", " ", "=", " ", 
          RowBox[{"{", 
           RowBox[{"Blocka", ",", " ", "Blockb"}], "}"}]}]}], ",", 
        "\[IndentingNewLine]", "\[IndentingNewLine]", 
        RowBox[{"BlockVersion", " ", "\[Equal]", " ", "\"\<V1\>\""}], ",", 
        "\[IndentingNewLine]", 
        RowBox[{"Blocks", " ", "=", " ", 
         RowBox[{"BlockScale", "*", 
          RowBox[{"{", 
           RowBox[{"{", 
            RowBox[{
             RowBox[{"{", 
              RowBox[{
               RowBox[{"-", "2.25"}], ",", "  ", "0"}], "}"}], ",", " ", 
             RowBox[{"{", 
              RowBox[{
               RowBox[{"-", "11.25"}], ",", "  ", "9.5"}], "}"}], ",", " ", 
             RowBox[{"{", 
              RowBox[{
               RowBox[{"-", "11.25"}], ",", "  ", "25"}], "}"}], ",", 
             RowBox[{"{", 
              RowBox[{"11.25", ",", "25"}], "}"}], ",", " ", 
             RowBox[{"{", 
              RowBox[{"11.25", ",", " ", "9.5"}], "}"}], ",", " ", 
             RowBox[{"{", 
              RowBox[{"2.25", ",", "  ", "0"}], "}"}]}], "}"}], "}"}]}]}], 
        ",", "\[IndentingNewLine]", "\[IndentingNewLine]", 
        RowBox[{"BlockVersion", " ", "\[Equal]", " ", "\"\<V2\>\""}], ",", 
        "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"Blocka", " ", "=", " ", 
          RowBox[{"BlockScale", "*", 
           RowBox[{"{", 
            RowBox[{
             RowBox[{"{", 
              RowBox[{
               RowBox[{"-", "2.75"}], ",", "0"}], "}"}], ",", " ", 
             RowBox[{"{", 
              RowBox[{
               RowBox[{"-", "11.25"}], ",", " ", "9.5"}], "}"}], ",", " ", 
             RowBox[{"{", 
              RowBox[{
               RowBox[{"-", "11.25"}], ",", "15.75"}], "}"}], ",", 
             RowBox[{"{", 
              RowBox[{
               RowBox[{"-", "8.5"}], ",", " ", "18.5"}], "}"}], ",", 
             RowBox[{"{", 
              RowBox[{"8.5", ",", " ", "18.5"}], "}"}], ",", " ", 
             RowBox[{"{", 
              RowBox[{"11.25", ",", "  ", "15.75"}], "}"}], ",", " ", 
             RowBox[{"{", 
              RowBox[{"11.25", ",", "9.5"}], "}"}], ",", 
             RowBox[{"{", 
              RowBox[{"2.75", ",", "0"}], "}"}]}], "}"}]}]}], ";", 
         "\[IndentingNewLine]", 
         RowBox[{"Blockb", " ", "=", " ", 
          RowBox[{"BlockScale", "*", 
           RowBox[{"{", " ", 
            RowBox[{
             RowBox[{"{", 
              RowBox[{
               RowBox[{"-", "8.5"}], ",", "18.5"}], "}"}], ",", 
             RowBox[{"{", 
              RowBox[{
               RowBox[{"-", "11.25"}], ",", " ", "21.25"}], "}"}], ",", 
             RowBox[{"{", 
              RowBox[{
               RowBox[{"-", "11.25"}], ",", "25"}], "}"}], ",", " ", 
             RowBox[{"{", 
              RowBox[{"11.25", ",", "25"}], "}"}], ",", " ", 
             RowBox[{"{", 
              RowBox[{"11.25", ",", "21.25"}], "}"}], ",", " ", 
             RowBox[{"{", 
              RowBox[{"8.5", ",", " ", "18.5"}], "}"}]}], "}"}]}]}], ";", 
         "\[IndentingNewLine]", 
         RowBox[{"Blocks", " ", "=", " ", 
          RowBox[{"{", 
           RowBox[{"Blocka", ",", " ", "Blockb"}], "}"}]}]}], ",", 
        "\[IndentingNewLine]", "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"BlockVersion", " ", "\[Equal]", " ", "\"\<V3\>\""}], "  ", "||",
          " ", 
         RowBox[{"BlockVersion", " ", "\[Equal]", " ", "\"\<Delta22\>\""}], 
         " ", "||", " ", 
         RowBox[{
         "BlockVersion", " ", "\[Equal]", " ", "\"\<Delta22.0\>\""}]}], ",", 
        "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"Blocka", " ", "=", " ", 
          RowBox[{"BlockScale", "*", 
           RowBox[{"{", 
            RowBox[{
             RowBox[{"{", 
              RowBox[{
               RowBox[{"-", "2.75"}], ",", "0"}], "}"}], ",", " ", 
             RowBox[{"{", 
              RowBox[{
               RowBox[{"-", "11.25"}], ",", " ", "9.5"}], "}"}], ",", " ", 
             RowBox[{"{", 
              RowBox[{
               RowBox[{"-", "11.25"}], ",", "10.5"}], "}"}], ",", 
             RowBox[{"{", 
              RowBox[{
               RowBox[{"-", "8.5"}], ",", " ", "13.5"}], "}"}], ",", 
             RowBox[{"{", 
              RowBox[{"8.5", ",", " ", "13.5"}], "}"}], ",", " ", 
             RowBox[{"{", 
              RowBox[{"11.25", ",", "  ", "10.5"}], "}"}], ",", " ", 
             RowBox[{"{", 
              RowBox[{"11.25", ",", "9.5"}], "}"}], ",", 
             RowBox[{"{", 
              RowBox[{"2.75", ",", "0"}], "}"}]}], "}"}]}]}], ";", 
         "\[IndentingNewLine]", 
         RowBox[{"Blockb", " ", "=", " ", 
          RowBox[{"BlockScale", "*", 
           RowBox[{"{", " ", 
            RowBox[{
             RowBox[{"{", 
              RowBox[{
               RowBox[{"-", "8.5"}], ",", "13.5"}], "}"}], ",", 
             RowBox[{"{", 
              RowBox[{
               RowBox[{"-", "11.25"}], ",", " ", "16.5"}], "}"}], ",", 
             RowBox[{"{", 
              RowBox[{
               RowBox[{"-", "11.25"}], ",", "24.5"}], "}"}], ",", 
             RowBox[{"{", 
              RowBox[{
               RowBox[{"-", "10.75"}], ",", "25"}], "}"}], ",", 
             RowBox[{"{", 
              RowBox[{"10.75", ",", "25"}], "}"}], ",", " ", 
             RowBox[{"{", 
              RowBox[{"11.25", ",", "24.5"}], "}"}], ",", " ", 
             RowBox[{"{", 
              RowBox[{"11.25", ",", "16.5"}], "}"}], ",", " ", 
             RowBox[{"{", 
              RowBox[{"8.5", ",", " ", "13.5"}], "}"}]}], "}"}]}]}], ";", 
         "\[IndentingNewLine]", 
         RowBox[{"Blocks", " ", "=", " ", 
          RowBox[{"{", 
           RowBox[{"Blocka", ",", " ", "Blockb"}], "}"}]}]}], ",", 
        "\[IndentingNewLine]", "\[IndentingNewLine]", 
        RowBox[{"BlockVersion", " ", "\[Equal]", " ", "\"\<Delta52.5\>\""}], 
        " ", ",", "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"Blocka", " ", "=", " ", 
          RowBox[{"BlockScale", "*", 
           RowBox[{"{", 
            RowBox[{
             RowBox[{"{", 
              RowBox[{
               RowBox[{"-", "5.5"}], ",", "0"}], "}"}], ",", 
             RowBox[{"{", 
              RowBox[{
               RowBox[{"-", "22.5"}], ",", "19"}], "}"}], ",", 
             RowBox[{"{", 
              RowBox[{
               RowBox[{"-", "22.5"}], ",", " ", "24"}], "}"}], ",", 
             RowBox[{"{", 
              RowBox[{
               RowBox[{"-", "16.5"}], ",", "30"}], "}"}], ",", 
             RowBox[{"{", 
              RowBox[{"16.5", ",", "30"}], "}"}], ",", 
             RowBox[{"{", 
              RowBox[{"22.5", ",", "24"}], "}"}], ",", 
             RowBox[{"{", 
              RowBox[{"22.5", ",", "19"}], "}"}], ",", 
             RowBox[{"{", 
              RowBox[{"5.5", ",", "0"}], "}"}]}], "}"}]}]}], ";", 
         "\[IndentingNewLine]", 
         RowBox[{"Blockb", " ", "=", " ", 
          RowBox[{"BlockScale", "*", 
           RowBox[{"{", 
            RowBox[{
             RowBox[{"{", 
              RowBox[{
               RowBox[{"-", "16.5"}], ",", "30"}], "}"}], ",", 
             RowBox[{"{", 
              RowBox[{
               RowBox[{"-", "22.5"}], ",", "36"}], "}"}], ",", 
             RowBox[{"{", 
              RowBox[{
               RowBox[{"-", "22.5"}], ",", "49"}], "}"}], ",", 
             RowBox[{"{", 
              RowBox[{
               RowBox[{"-", "21.5"}], ",", "50"}], "}"}], ",", 
             RowBox[{"{", 
              RowBox[{"21.5", ",", "50"}], "}"}], ",", 
             RowBox[{"{", 
              RowBox[{"22.5", ",", "49"}], "}"}], ",", 
             RowBox[{"{", 
              RowBox[{"22.5", ",", "36"}], "}"}], ",", 
             RowBox[{"{", 
              RowBox[{"16.5", ",", "30"}], "}"}]}], "}"}]}]}], ";", 
         "\[IndentingNewLine]", 
         RowBox[{"Blocks", " ", "=", " ", 
          RowBox[{"{", 
           RowBox[{"Blocka", ",", " ", "Blockb"}], "}"}]}], ";"}]}], 
       "\[IndentingNewLine]", "]"}], ";", "\[IndentingNewLine]", 
      "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"Blocks", " ", "[", 
        RowBox[{"[", 
         RowBox[{"All", ",", " ", "All", ",", " ", "2"}], "]"}], "]"}], "=", 
       " ", 
       RowBox[{
        RowBox[{"Blocks", " ", "[", 
         RowBox[{"[", 
          RowBox[{"All", ",", " ", "All", ",", " ", "2"}], "]"}], "]"}], "+", 
        " ", 
        RowBox[{"Gap", "/", "2"}]}]}], ";", "\[IndentingNewLine]", 
      "\[IndentingNewLine]", 
      RowBox[{"(*", 
       RowBox[{
       "Block", " ", "vertices", " ", "for", " ", "each", " ", "cassette", 
        " ", 
        RowBox[{"(", 
         RowBox[{
         "cross", " ", "section", " ", "in", " ", "the", " ", "xy", " ", 
          "plane"}], ")"}]}], "*)"}], "\[IndentingNewLine]", 
      RowBox[{"URCBlockShape", " ", "=", "Blocks"}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"ULCBlockShape", " ", "=", " ", 
       RowBox[{
        RowBox[{
         RowBox[{
          RowBox[{
           RowBox[{"Dot", "[", 
            RowBox[{
             RowBox[{"RotationMatrix", "[", 
              RowBox[{"\[Pi]", "/", "2"}], "]"}], ",", "#"}], "]"}], "&"}], "/@",
           "#"}], "&"}], "/@", "URCBlockShape"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"BLCBlockShape", " ", "=", " ", 
       RowBox[{
        RowBox[{
         RowBox[{
          RowBox[{
           RowBox[{"Dot", "[", 
            RowBox[{
             RowBox[{"RotationMatrix", "[", 
              RowBox[{"\[Pi]", "/", "2"}], "]"}], ",", "#"}], "]"}], "&"}], "/@",
           "#"}], "&"}], "/@", "ULCBlockShape"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"BRCBlockShape", " ", "=", " ", 
       RowBox[{
        RowBox[{
         RowBox[{
          RowBox[{
           RowBox[{"Dot", "[", 
            RowBox[{
             RowBox[{"RotationMatrix", "[", 
              RowBox[{"\[Pi]", "/", "2"}], "]"}], ",", "#"}], "]"}], "&"}], "/@",
           "#"}], "&"}], "/@", "BLCBlockShape"}]}], ";", 
      "\[IndentingNewLine]", "\[IndentingNewLine]", 
      RowBox[{"(*", "Cassettes", "*)"}], "\[IndentingNewLine]", 
      RowBox[{"\[Delta]URC", " ", "=", "\[Delta]GV"}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"URC", " ", "=", " ", 
       RowBox[{"auxIDCassette", "[", 
        RowBox[{
        "\[Lambda]u", ",", " ", "Np", ",", " ", "Br", ",", "\[Delta]URC", ",",
          " ", "URCBlockShape", ",", 
         RowBox[{"\"\<BlockGap\>\"", "\[Rule]", " ", "BlockGap"}], ",", " ", 
         RowBox[{"\"\<Termination\>\"", "\[Rule]", " ", "Termination"}], ",", 
         " ", " ", 
         RowBox[{"\"\<PointingUp\>\"", "\[Rule]", " ", "False"}], ",", 
         RowBox[{"\"\<FirstBlock\>\"", "\[Rule]", " ", "\"\<Up\>\""}], ",", 
         RowBox[{
         "\"\<FieldDirection\>\"", "\[Rule]", " ", "\"\<Vertical\>\""}], ",", 
         RowBox[{
         "\"\<PosMagErrors\>\"", "\[Rule]", " ", "PosMagErrorsURC"}]}], 
        "]"}]}], ";", "\[IndentingNewLine]", "\[IndentingNewLine]", 
      RowBox[{"\[Delta]ULC", " ", "=", " ", 
       RowBox[{
       "\[Delta]GV", "+", " ", "\[Delta]GH", "+", " ", "\[Delta]P", "+", 
        "\[Delta]CP"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"ULC", " ", "=", " ", 
       RowBox[{"auxIDCassette", "[", 
        RowBox[{
        "\[Lambda]u", ",", " ", "Np", ",", " ", "Br", ",", "\[Delta]ULC", ",",
          " ", "ULCBlockShape", ",", " ", 
         RowBox[{"\"\<BlockGap\>\"", "\[Rule]", " ", "BlockGap"}], ",", " ", 
         RowBox[{"\"\<Termination\>\"", "\[Rule]", " ", "Termination"}], ",", 
         " ", " ", 
         RowBox[{"\"\<PointingUp\>\"", "\[Rule]", " ", "True"}], ",", 
         RowBox[{"\"\<FirstBlock\>\"", "\[Rule]", " ", "\"\<Down\>\""}], ",", 
         " ", 
         RowBox[{
         "\"\<FieldDirection\>\"", "\[Rule]", " ", "\"\<Horizontal\>\""}], 
         ",", 
         RowBox[{
         "\"\<PosMagErrors\>\"", "\[Rule]", " ", "PosMagErrorsULC"}]}], 
        "]"}]}], ";", "\[IndentingNewLine]", "\[IndentingNewLine]", 
      RowBox[{"\[Delta]BLC", " ", "=", "\[Delta]GH"}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"BLC", " ", "=", " ", 
       RowBox[{"auxIDCassette", "[", 
        RowBox[{
        "\[Lambda]u", ",", " ", "Np", ",", " ", "Br", ",", "\[Delta]BLC", ",",
          " ", "BLCBlockShape", ",", " ", 
         RowBox[{"\"\<BlockGap\>\"", "\[Rule]", " ", "BlockGap"}], ",", " ", 
         RowBox[{"\"\<Termination\>\"", "\[Rule]", " ", "Termination"}], ",", 
         " ", " ", 
         RowBox[{"\"\<PointingUp\>\"", "\[Rule]", " ", "True"}], ",", 
         RowBox[{"\"\<FirstBlock\>\"", "\[Rule]", " ", "\"\<Up\>\""}], ",", 
         " ", 
         RowBox[{
         "\"\<FieldDirection\>\"", "\[Rule]", " ", "\"\<Vertical\>\""}], ",", 
         " ", 
         RowBox[{
         "\"\<PosMagErrors\>\"", "\[Rule]", " ", "PosMagErrorsBLC"}]}], 
        "]"}]}], ";", "\[IndentingNewLine]", "\[IndentingNewLine]", 
      RowBox[{"\[Delta]BRC", " ", "=", 
       RowBox[{"\[Delta]P", "-", "\[Delta]CP"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"BRC", " ", "=", 
       RowBox[{"auxIDCassette", "[", 
        RowBox[{
        "\[Lambda]u", ",", " ", "Np", ",", " ", "Br", ",", " ", "\[Delta]BRC",
          ",", "BRCBlockShape", ",", 
         RowBox[{"\"\<BlockGap\>\"", "\[Rule]", " ", "BlockGap"}], ",", " ", 
         RowBox[{"\"\<Termination\>\"", "\[Rule]", " ", "Termination"}], ",", 
         " ", " ", 
         RowBox[{"\"\<PointingUp\>\"", "\[Rule]", "False"}], ",", " ", 
         RowBox[{"\"\<FirstBlock\>\"", "\[Rule]", " ", "\"\<Down\>\""}], ",", 
         " ", 
         RowBox[{
         "\"\<FieldDirection\>\"", "\[Rule]", " ", "\"\<Horizontal\>\""}], 
         ",", 
         RowBox[{
         "\"\<PosMagErrors\>\"", "\[Rule]", " ", "PosMagErrorsBRC"}]}], 
        "]"}]}], ";", "\[IndentingNewLine]", "\[IndentingNewLine]", 
      RowBox[{"(*", 
       RowBox[{"Insertion", " ", "device"}], "*)"}], "\[IndentingNewLine]", 
      RowBox[{"Device", " ", "=", " ", 
       RowBox[{"radObjCnt", "[", 
        RowBox[{"{", 
         RowBox[{"BRC", ",", " ", "BLC", ",", " ", "ULC", ",", " ", "URC"}], 
         "}"}], "]"}]}], ";", "\[IndentingNewLine]", "\[IndentingNewLine]", 
      RowBox[{"(*", 
       RowBox[{
        RowBox[{
        "Counterclockwise", " ", "rotation", " ", "of", " ", "insertion", " ",
          "device", " ", "by"}], " ", "-", 
        RowBox[{
         RowBox[{"\[Pi]", "/", "4"}], " ", "around", " ", "the", " ", "z"}], 
        "-", "axis"}], "*)"}], "\[IndentingNewLine]", 
      RowBox[{"Device", "=", " ", 
       RowBox[{"radTrfOrnt", "[", 
        RowBox[{"Device", ",", 
         RowBox[{"radTrfRot", "[", 
          RowBox[{
           RowBox[{"{", 
            RowBox[{"0", ",", "0", ",", "0"}], "}"}], ",", 
           RowBox[{"{", 
            RowBox[{"0", ",", "0", ",", "1"}], "}"}], ",", 
           RowBox[{
            RowBox[{"-", "\[Pi]"}], "/", "4"}]}], "]"}]}], "]"}]}], ";", 
      "\[IndentingNewLine]", "\[IndentingNewLine]", 
      RowBox[{"t1", "=", 
       RowBox[{"AbsoluteTime", "[", "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"Print", "[", 
       RowBox[{"\"\<IDDelta: elapsed time = \>\"", ",", 
        RowBox[{"(", 
         RowBox[{"t1", "-", "t0"}], ")"}], ",", "\"\< s\>\""}], "]"}], ";", 
      "\[IndentingNewLine]", "\[IndentingNewLine]", 
      RowBox[{"Return", "[", "Device", "]"}], ";"}]}], "\[IndentingNewLine]", 
    "]"}]}], ";"}]}], "Input",
 CellChangeTimes->{{3.7667551788345585`*^9, 3.766755219697137*^9}, {
   3.7667552608722496`*^9, 3.766755336956355*^9}, {3.7667553842569494`*^9, 
   3.766755392727988*^9}, {3.7667554904075484`*^9, 3.7667554958142147`*^9}, {
   3.766755533035892*^9, 3.766755536817438*^9}, {3.7667555822585154`*^9, 
   3.766755653420355*^9}, {3.766756597123891*^9, 3.7667567178365045`*^9}, {
   3.766758273756778*^9, 3.7667582858827343`*^9}, {3.766758881931342*^9, 
   3.766758895901193*^9}, {3.7667589294194484`*^9, 3.766759099497465*^9}, {
   3.7667594411382713`*^9, 3.766759474594048*^9}, 3.766759676703664*^9, {
   3.7667597589931507`*^9, 3.7667597604151382`*^9}, {3.767445913038151*^9, 
   3.7674459154914675`*^9}, {3.7674480119644413`*^9, 3.767448037403933*^9}, {
   3.767517216023782*^9, 3.76751735632812*^9}, {3.767517388002474*^9, 
   3.7675175908758945`*^9}, {3.767517710921748*^9, 3.7675177169357166`*^9}, {
   3.7675352221793385`*^9, 3.7675352299784536`*^9}, {3.7826507708075814`*^9, 
   3.7826508410104322`*^9}, {3.7826509152630415`*^9, 
   3.7826509534060044`*^9}, {3.7826509875464926`*^9, 
   3.7826513618482885`*^9}, {3.7826514197543125`*^9, 
   3.7826514691465225`*^9}, {3.782651516571157*^9, 3.7826516281644516`*^9}, {
   3.782651791808872*^9, 3.782651794105769*^9}, {3.782651877699188*^9, 
   3.7826519147927847`*^9}, {3.7826519494332795`*^9, 3.782652148716467*^9}, {
   3.78265266546935*^9, 3.782652666719343*^9}, {3.782659005138482*^9, 
   3.7826590070603485`*^9}, {3.7826592858206563`*^9, 3.78265929694561*^9}, {
   3.7826604221508827`*^9, 3.7826604311977215`*^9}, {3.782660660486992*^9, 
   3.7826607614709654`*^9}, {3.782660802567483*^9, 3.7826608417392*^9}, {
   3.782660872520325*^9, 3.7826610165052404`*^9}, {3.7826610636786795`*^9, 
   3.7826610639755516`*^9}, {3.782723152329569*^9, 3.782723364147324*^9}, {
   3.7827251626917877`*^9, 3.7827253028474708`*^9}, {3.782726489766873*^9, 
   3.782726501032457*^9}, {3.7827273648822813`*^9, 3.7827274629720583`*^9}, {
   3.7827276445539565`*^9, 3.7827276448195767`*^9}, {3.782727745825308*^9, 
   3.7827277459503107`*^9}, 3.7834343693375583`*^9, {3.7834360989694023`*^9, 
   3.783436118125576*^9}, {3.7849708241210814`*^9, 3.7849708397628965`*^9}, {
   3.784970923135537*^9, 3.7849709525780067`*^9}, {3.7849709861275373`*^9, 
   3.7849710402907534`*^9}, {3.78497114577227*^9, 3.784971236235998*^9}, {
   3.7849718913198776`*^9, 3.7849718949763823`*^9}, 3.7849748915670214`*^9, {
   3.784974976765699*^9, 3.7849750359324846`*^9}},
 Background->RGBColor[0.87, 0.94, 1],
 CellLabel->"In[50]:=",ExpressionUUID->"1e75eb67-b503-4278-910c-2a23ca9f65f1"]
}, Closed]],

Cell[CellGroupData[{

Cell["IDRectangularDelta", "Subsection",
 CellChangeTimes->{{3.7667545315791187`*^9, 
  3.7667545397047553`*^9}},ExpressionUUID->"70955073-b7ff-4a22-ba12-\
0c44081801b1"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"IDRectangularDelta", "::", "usage"}], "=", 
    "\"\<IDRectangularDelta[\[Lambda]u, Np, Br, Gap, \\\"\[Delta]P\\\":0, \
\\\"\[Delta]GV\\\":0, \\\"\[Delta]GH\\\":0, \\\"\[Delta]CP\\\":0, \
\\\"BlockGap\\\":0, \\\"BlockWidth\\\":gap, \\\"BlockHeight\\\":gap, \
\\\"Termination\\\":\\\"None\\\", \\\"PosMagErrorsBRC\\\"\[Rule] {}, \
\\\"PosMagErrorsBLC\\\"\[Rule] {}, \\\"PosMagErrorsULC\\\"\[Rule] {}, \
\\\"PosMagErrorsURC\\\"\[Rule] {}]: Returns the ID model. \\n\\nArgs: \\n\
\[Lambda]u [mm] is the ID period, \\nNp is the number of periods, \\nBr [T] \
is the remanent magnetization of the permanent magnet blocks, \\nGap [mm] is \
the length of the minimum gap between the cassettes. \\n\\nOptional args: \\n\
\[Delta]P [mm], \[Delta]GV [mm], \[Delta]GH [mm] and \[Delta]CP [mm] are four \
types of longitudinal movements between the cassettes, \[Delta]P is the phase \
adjustement, \[Delta]GV and \[Delta]GH control the amplitude of the \
longitudinal field component and \[Delta]CP is the inclined-polarization \
adjustment, \\nBlockGap [mm] is the longitudinal gap between the blocks, \
\\nBlockWidth [mm] is the block width, \\nBlockHeight [mm] is the block \
height, \\nTermination is the termination type (one of the following: None, \
OneBlockSym, OneBlockAntiSym, ThreeBlocksSym, ThreeBlocksAntiSym), \
\\nPosMagErrorsBRC is a list of positions and magnetization errors for the BR \
cassette, \\nPosMagErrorsBLC is a list of positions and magnetization errors \
for the BL cassette, \\nPosMagErrorsULC is a list of positions and \
magnetization errors for the UL cassette, \\nPosMagErrorsURC is a list of \
positions and magnetization errors for the UR cassette. \\n\\nPosition and \
magnetization errors: \\nThe list of position and magnetization errors must \
be empty or have a number of elements igual to the number of blocks on each \
cassette. Each element is a list with position and magnetization errors in \
the following format: \\n{{horizontal position error[mm], vertical position \
error[mm], longitudinal position error[mm]}, {horizontal magnetization \
error[T], vertical magnetization error[T], longitudinal magnetization \
error[T]}}. \\nThe errors will be add to the default values of position and \
magnetization of the blocks.\>\""}], ";"}], 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"IDRectangularDelta", "[", 
    RowBox[{
    "\[Lambda]u_", ",", " ", "Np_", ",", " ", "Br_", ",", " ", "Gap_", ",", 
     " ", 
     RowBox[{"OptionsPattern", "[", 
      RowBox[{"{", 
       RowBox[{
        RowBox[{"\"\<\[Delta]P\>\"", "\[Rule]", " ", "0"}], ",", " ", 
        RowBox[{"\"\<\[Delta]GV\>\"", "\[Rule]", " ", "0"}], ",", " ", 
        RowBox[{"\"\<\[Delta]GH\>\"", "\[Rule]", " ", "0"}], ",", " ", 
        RowBox[{"\"\<\[Delta]CP\>\"", "\[Rule]", " ", "0"}], ",", " ", 
        RowBox[{"\"\<BlockGap\>\"", "->", "0"}], ",", " ", 
        RowBox[{"\"\<BlockWidth\>\"", "\[Rule]", " ", "\"\<default\>\""}], 
        ",", " ", 
        RowBox[{"\"\<BlockHeight\>\"", "\[Rule]", " ", "\"\<default\>\""}], 
        ",", 
        RowBox[{"\"\<Termination\>\"", "\[Rule]", " ", "\"\<None\>\""}], ",", 
        " ", 
        RowBox[{"\"\<PosMagErrorsBRC\>\"", "\[Rule]", " ", 
         RowBox[{"{", "}"}]}], ",", " ", 
        RowBox[{"\"\<PosMagErrorsBLC\>\"", "\[Rule]", " ", 
         RowBox[{"{", "}"}]}], ",", " ", 
        RowBox[{"\"\<PosMagErrorsULC\>\"", "\[Rule]", " ", 
         RowBox[{"{", "}"}]}], ",", " ", 
        RowBox[{"\"\<PosMagErrorsURC\>\"", "\[Rule]", " ", 
         RowBox[{"{", "}"}]}]}], "}"}], "]"}]}], "]"}], " ", ":=", " ", 
   RowBox[{"Module", "[", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"{", " ", 
      RowBox[{
      "BRCBlockShape", ",", " ", "BLCBlockShape", ",", " ", "ULCBlockShape", 
       ",", " ", "URCBlockShape", ",", "  ", "Height", ",", " ", "Width", ",",
        "\[IndentingNewLine]", "PosMagErrorsBRC", " ", ",", " ", 
       "PosMagErrorsBLC", ",", " ", "PosMagErrorsULC", " ", ",", " ", 
       "PosMagErrorsURC", ",", "\[IndentingNewLine]", "\[Delta]P", ",", " ", 
       "\[Delta]GV", ",", " ", "\[Delta]GH", ",", " ", "\[Delta]CP", ",", " ",
        "Termination", ",", "\[IndentingNewLine]", " ", "BlockGap", ",", " ", 
       "\[Delta]BRC", ",", " ", "BRC", ",", " ", "\[Delta]BLC", ",", " ", 
       "BLC", ",", " ", "\[Delta]ULC", ",", " ", "ULC", ",", " ", 
       "\[Delta]URC", ",", " ", "URC", ",", "Device", ",", " ", "t0", ",", 
       " ", "t1"}], "}"}], ",", "\[IndentingNewLine]", 
     RowBox[{"(*", 
      RowBox[{
       RowBox[{
       "The", " ", "insertion", " ", "device", " ", "is", " ", "created", " ",
         "rotated", " ", "by", " ", 
        RowBox[{"\[Pi]", "/", "4"}], " ", "about", " ", "the", " ", "y"}], 
       "-", 
       RowBox[{
       "axis", " ", "to", " ", "simplified", " ", "the", " ", "magnetization",
         " ", 
        RowBox[{"functions", ".", " ", "The"}], " ", "entire", " ", "device", 
        " ", "is", " ", "rotated", " ", "to", " ", "the", " ", "correct", " ",
         "position", " ", "at", " ", "the", " ", "end", " ", "of", " ", "the",
         " ", 
        RowBox[{"function", "."}]}]}], "*)"}], "\[IndentingNewLine]", 
     "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"t0", "=", 
       RowBox[{"AbsoluteTime", "[", "]"}]}], ";", "\[IndentingNewLine]", 
      "\[IndentingNewLine]", 
      RowBox[{"(*", 
       RowBox[{"Delete", " ", "previous", " ", "Radia", " ", "objects"}], 
       "*)"}], "\[IndentingNewLine]", 
      RowBox[{"radUtiDelAll", "[", "]"}], ";", "\[IndentingNewLine]", 
      "\[IndentingNewLine]", 
      RowBox[{"(*", 
       RowBox[{"Check", " ", "arguments"}], "*)"}], "\[IndentingNewLine]", 
      RowBox[{"If", " ", "[", 
       RowBox[{
        RowBox[{"\[Lambda]u", " ", "\[LessEqual]", " ", "0"}], ",", " ", 
        RowBox[{"Return", "[", "]"}]}], "]"}], ";", "\[IndentingNewLine]", 
      RowBox[{"If", " ", "[", 
       RowBox[{
        RowBox[{"Np", " ", "\[LessEqual]", " ", "0"}], ",", " ", 
        RowBox[{"Return", "[", "]"}]}], "]"}], ";", "\[IndentingNewLine]", 
      RowBox[{"If", " ", "[", 
       RowBox[{
        RowBox[{"Br", " ", "\[LessEqual]", " ", "0"}], ",", " ", 
        RowBox[{"Return", "[", "]"}]}], "]"}], ";", "\[IndentingNewLine]", 
      RowBox[{"If", " ", "[", 
       RowBox[{
        RowBox[{"Gap", " ", "\[LessEqual]", " ", "0"}], ",", " ", 
        RowBox[{"Return", "[", "]"}]}], "]"}], ";", "\[IndentingNewLine]", 
      "\[IndentingNewLine]", 
      RowBox[{"(*", 
       RowBox[{"Gap", " ", "between", " ", "blocks"}], "*)"}], 
      "\[IndentingNewLine]", " ", 
      RowBox[{"BlockGap", " ", "=", " ", 
       RowBox[{"OptionValue", "[", "\"\<BlockGap\>\"", "]"}]}], ";", 
      "\[IndentingNewLine]", "\[IndentingNewLine]", 
      RowBox[{"(*", 
       RowBox[{"Block", " ", "size"}], "*)"}], "\[IndentingNewLine]", 
      RowBox[{"Height", " ", "=", 
       RowBox[{"If", "[", 
        RowBox[{
         RowBox[{
          RowBox[{"OptionValue", "[", "\"\<BlockHeight\>\"", "]"}], " ", 
          "\[Equal]", " ", "\"\<default\>\""}], ",", "Gap", ",", 
         RowBox[{"OptionValue", "[", "\"\<BlockHeight\>\"", "]"}]}], " ", 
        "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"Width", " ", "=", "  ", 
       RowBox[{"If", "[", 
        RowBox[{
         RowBox[{
          RowBox[{"OptionValue", "[", "\"\<BlockWidth\>\"", "]"}], 
          "\[Equal]", "\"\<default\>\""}], ",", " ", "Gap", ",", 
         RowBox[{"OptionValue", "[", "\"\<BlockWidth\>\"", "]"}]}], "]"}]}], 
      " ", ";", "\[IndentingNewLine]", 
      RowBox[{"If", "[", 
       RowBox[{
        RowBox[{
         RowBox[{"Height", "\[LessEqual]", "0"}], " ", "||", " ", 
         RowBox[{"Width", " ", "\[LessEqual]", "0"}]}], ",", " ", 
        RowBox[{"Return", "[", "]"}]}], "]"}], ";", "\[IndentingNewLine]", 
      "\[IndentingNewLine]", 
      RowBox[{"(*", 
       RowBox[{"Cassettes", " ", "longitudinal", " ", 
        RowBox[{"displacement", " ", "[", "mm", "]"}]}], "*)"}], 
      "\[IndentingNewLine]", 
      RowBox[{"\[Delta]P", " ", "=", " ", 
       RowBox[{"OptionValue", "[", "\"\<\[Delta]P\>\"", "]"}]}], ";", " ", 
      RowBox[{"(*", 
       RowBox[{"Phase", " ", "adjustment"}], "*)"}], "\[IndentingNewLine]", 
      RowBox[{"\[Delta]GV", " ", "=", " ", 
       RowBox[{"OptionValue", "[", "\"\<\[Delta]GV\>\"", "]"}]}], ";", " ", 
      RowBox[{"(*", 
       RowBox[{
        RowBox[{
        "Vertical", " ", "field", " ", "amplitude", " ", "to", " ", 
         "longitudinal", " ", "field", " ", "amplitude"}], ",", " ", 
        RowBox[{
        "also", " ", "decreases", " ", "horizontal", " ", "field", " ", 
         "amplitude"}]}], "*)"}], "\[IndentingNewLine]", 
      RowBox[{"\[Delta]GH", " ", "=", " ", 
       RowBox[{"OptionValue", "[", "\"\<\[Delta]GH\>\"", "]"}]}], ";", 
      RowBox[{"(*", 
       RowBox[{
        RowBox[{
        "Horizontal", " ", "field", " ", "amplitude", " ", "to", " ", 
         "longitudinal", " ", "field", " ", "amplitude"}], ",", " ", 
        RowBox[{
        "also", " ", "decreases", " ", "vertical", " ", "field", " ", 
         "amplitude"}]}], "*)"}], "\[IndentingNewLine]", 
      RowBox[{"\[Delta]CP", " ", "=", " ", 
       RowBox[{"OptionValue", "[", "\"\<\[Delta]CP\>\"", "]"}]}], ";", 
      RowBox[{"(*", 
       RowBox[{"Inclined", " ", "polarization", " ", "adjustment"}], "*)"}], 
      "\[IndentingNewLine]", "\[IndentingNewLine]", 
      RowBox[{"(*", 
       RowBox[{"Termination", " ", "Type"}], "*)"}], "\[IndentingNewLine]", 
      RowBox[{"Termination", " ", "=", " ", 
       RowBox[{"OptionValue", "[", "\"\<Termination\>\"", "]"}]}], ";", 
      "\[IndentingNewLine]", "\[IndentingNewLine]", 
      RowBox[{"(*", 
       RowBox[{"Position", " ", "and", " ", "magnetization", " ", "errors"}], 
       "*)"}], "\[IndentingNewLine]", 
      RowBox[{"PosMagErrorsBRC", " ", "=", " ", 
       RowBox[{"OptionValue", "[", "\"\<PosMagErrorsBRC\>\"", "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"PosMagErrorsBLC", " ", "=", " ", 
       RowBox[{"OptionValue", "[", "\"\<PosMagErrorsBLC\>\"", "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"PosMagErrorsULC", " ", "=", " ", 
       RowBox[{"OptionValue", "[", "\"\<PosMagErrorsULC\>\"", "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"PosMagErrorsURC", " ", "=", " ", 
       RowBox[{"OptionValue", "[", "\"\<PosMagErrorsURC\>\"", "]"}]}], ";", 
      "\[IndentingNewLine]", "\[IndentingNewLine]", 
      RowBox[{"(*", 
       RowBox[{
        RowBox[{
        "Counterclockwise", " ", "rotation", " ", "of", " ", "errors", " ", 
         "by", " ", 
         RowBox[{"\[Pi]", "/", "4"}], " ", "around", " ", "the", " ", "z"}], 
        "-", "axis"}], "*)"}], "\[IndentingNewLine]", 
      RowBox[{"PosMagErrorsBRC", " ", "=", " ", 
       RowBox[{
        RowBox[{
         RowBox[{"{", 
          RowBox[{
           RowBox[{"Dot", "[", 
            RowBox[{
             RowBox[{"RotationMatrix", "[", 
              RowBox[{
               RowBox[{"\[Pi]", "/", "4"}], ",", " ", 
               RowBox[{"{", 
                RowBox[{"0", ",", " ", "0", ",", " ", "1"}], "}"}]}], "]"}], 
             ",", 
             RowBox[{"#", "[", 
              RowBox[{"[", "1", "]"}], "]"}]}], "]"}], ",", 
           RowBox[{"Dot", "[", 
            RowBox[{
             RowBox[{"RotationMatrix", "[", 
              RowBox[{
               RowBox[{"\[Pi]", "/", "4"}], ",", " ", 
               RowBox[{"{", 
                RowBox[{"0", ",", " ", "0", ",", " ", "1"}], "}"}]}], "]"}], 
             ",", 
             RowBox[{"#", "[", 
              RowBox[{"[", "2", "]"}], "]"}]}], "]"}]}], "}"}], "&"}], "/@", 
        " ", " ", "PosMagErrorsBRC"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"PosMagErrorsBLC", " ", "=", " ", 
       RowBox[{
        RowBox[{
         RowBox[{"{", 
          RowBox[{
           RowBox[{"Dot", "[", 
            RowBox[{
             RowBox[{"RotationMatrix", "[", 
              RowBox[{
               RowBox[{"\[Pi]", "/", "4"}], ",", " ", 
               RowBox[{"{", 
                RowBox[{"0", ",", " ", "0", ",", " ", "1"}], "}"}]}], "]"}], 
             ",", 
             RowBox[{"#", "[", 
              RowBox[{"[", "1", "]"}], "]"}]}], "]"}], ",", 
           RowBox[{"Dot", "[", 
            RowBox[{
             RowBox[{"RotationMatrix", "[", 
              RowBox[{
               RowBox[{"\[Pi]", "/", "4"}], ",", " ", 
               RowBox[{"{", 
                RowBox[{"0", ",", " ", "0", ",", " ", "1"}], "}"}]}], "]"}], 
             ",", 
             RowBox[{"#", "[", 
              RowBox[{"[", "2", "]"}], "]"}]}], "]"}]}], "}"}], "&"}], "/@", 
        " ", " ", "PosMagErrorsBLC"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"PosMagErrorsULC", " ", "=", " ", 
       RowBox[{
        RowBox[{
         RowBox[{"{", 
          RowBox[{
           RowBox[{"Dot", "[", 
            RowBox[{
             RowBox[{"RotationMatrix", "[", 
              RowBox[{
               RowBox[{"\[Pi]", "/", "4"}], ",", " ", 
               RowBox[{"{", 
                RowBox[{"0", ",", " ", "0", ",", " ", "1"}], "}"}]}], "]"}], 
             ",", 
             RowBox[{"#", "[", 
              RowBox[{"[", "1", "]"}], "]"}]}], "]"}], ",", 
           RowBox[{"Dot", "[", 
            RowBox[{
             RowBox[{"RotationMatrix", "[", 
              RowBox[{
               RowBox[{"\[Pi]", "/", "4"}], ",", " ", 
               RowBox[{"{", 
                RowBox[{"0", ",", " ", "0", ",", " ", "1"}], "}"}]}], "]"}], 
             ",", 
             RowBox[{"#", "[", 
              RowBox[{"[", "2", "]"}], "]"}]}], "]"}]}], "}"}], "&"}], "/@", 
        " ", " ", "PosMagErrorsULC"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"PosMagErrorsURC", " ", "=", " ", 
       RowBox[{
        RowBox[{
         RowBox[{"{", 
          RowBox[{
           RowBox[{"Dot", "[", 
            RowBox[{
             RowBox[{"RotationMatrix", "[", 
              RowBox[{
               RowBox[{"\[Pi]", "/", "4"}], ",", " ", 
               RowBox[{"{", 
                RowBox[{"0", ",", " ", "0", ",", " ", "1"}], "}"}]}], "]"}], 
             ",", 
             RowBox[{"#", "[", 
              RowBox[{"[", "1", "]"}], "]"}]}], "]"}], ",", 
           RowBox[{"Dot", "[", 
            RowBox[{
             RowBox[{"RotationMatrix", "[", 
              RowBox[{
               RowBox[{"\[Pi]", "/", "4"}], ",", " ", 
               RowBox[{"{", 
                RowBox[{"0", ",", " ", "0", ",", " ", "1"}], "}"}]}], "]"}], 
             ",", 
             RowBox[{"#", "[", 
              RowBox[{"[", "2", "]"}], "]"}]}], "]"}]}], "}"}], "&"}], "/@", 
        "  ", "PosMagErrorsURC"}]}], ";", "\[IndentingNewLine]", 
      "\[IndentingNewLine]", 
      RowBox[{"(*", 
       RowBox[{
       "Block", " ", "vertices", " ", "for", " ", "each", " ", "cassette", 
        " ", 
        RowBox[{"(", 
         RowBox[{
         "cross", " ", "section", " ", "in", " ", "the", " ", "xy", " ", 
          "plane"}], ")"}]}], "*)"}], "\[IndentingNewLine]", 
      RowBox[{"URCBlockShape", "=", 
       RowBox[{"{", 
        RowBox[{
         RowBox[{"{", 
          RowBox[{
           RowBox[{"Width", "/", "2"}], " ", ",", " ", 
           RowBox[{"Gap", "/", "2"}]}], "}"}], ",", 
         RowBox[{"{", 
          RowBox[{
           RowBox[{"Width", "/", "2"}], ",", " ", 
           RowBox[{
            RowBox[{"Gap", "/", "2"}], "+", "Height"}]}], "}"}], ",", 
         RowBox[{"{", 
          RowBox[{
           RowBox[{
            RowBox[{"-", "Width"}], "/", "2"}], " ", ",", 
           RowBox[{
            RowBox[{"Gap", "/", "2"}], "+", "Height"}]}], "}"}], ",", 
         RowBox[{"{", 
          RowBox[{
           RowBox[{
            RowBox[{"-", "Width"}], "/", "2"}], ",", 
           RowBox[{"Gap", "/", "2"}]}], "}"}]}], "}"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"ULCBlockShape", "=", 
       RowBox[{"{", 
        RowBox[{
         RowBox[{"{", 
          RowBox[{
           RowBox[{
            RowBox[{"-", "Width"}], "/", "2"}], " ", ",", " ", 
           RowBox[{
            RowBox[{"-", "Gap"}], "/", "2"}]}], "}"}], ",", 
         RowBox[{"{", 
          RowBox[{
           RowBox[{
            RowBox[{"-", "Width"}], "/", "2"}], ",", " ", 
           RowBox[{
            RowBox[{
             RowBox[{"-", "Gap"}], "/", "2"}], "-", "Height"}]}], "}"}], ",", 
         RowBox[{"{", 
          RowBox[{
           RowBox[{"Width", "/", "2"}], " ", ",", 
           RowBox[{
            RowBox[{
             RowBox[{"-", "Gap"}], "/", "2"}], "-", "Height"}]}], "}"}], ",", 
         RowBox[{"{", 
          RowBox[{
           RowBox[{"Width", "/", "2"}], ",", 
           RowBox[{
            RowBox[{"-", "Gap"}], "/", "2"}]}], "}"}]}], "}"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"BLCBlockShape", "=", 
       RowBox[{"{", 
        RowBox[{
         RowBox[{"{", 
          RowBox[{
           RowBox[{
            RowBox[{"-", "Gap"}], "/", "2"}], ",", " ", 
           RowBox[{"Width", "/", "2"}]}], "}"}], ",", 
         RowBox[{"{", 
          RowBox[{
           RowBox[{
            RowBox[{
             RowBox[{"-", "Gap"}], "/", "2"}], "-", "Height"}], ",", " ", 
           RowBox[{"Width", "/", "2"}]}], "}"}], ",", 
         RowBox[{"{", 
          RowBox[{
           RowBox[{
            RowBox[{
             RowBox[{"-", "Gap"}], "/", "2"}], "-", "Height"}], ",", 
           RowBox[{
            RowBox[{"-", "Width"}], "/", "2"}]}], "}"}], ",", 
         RowBox[{"{", 
          RowBox[{
           RowBox[{
            RowBox[{"-", "Gap"}], "/", "2"}], ",", 
           RowBox[{
            RowBox[{"-", " ", "Width"}], "/", "2"}]}], "}"}]}], "}"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"BRCBlockShape", "=", 
       RowBox[{"{", 
        RowBox[{
         RowBox[{"{", 
          RowBox[{
           RowBox[{"Gap", "/", "2"}], ",", " ", 
           RowBox[{"Width", "/", "2"}]}], "}"}], ",", 
         RowBox[{"{", 
          RowBox[{
           RowBox[{
            RowBox[{"Gap", "/", "2"}], "+", "Height"}], ",", " ", 
           RowBox[{"Width", "/", "2"}]}], "}"}], ",", 
         RowBox[{"{", 
          RowBox[{
           RowBox[{
            RowBox[{"Gap", "/", "2"}], "+", "Height"}], ",", 
           RowBox[{
            RowBox[{"-", " ", "Width"}], "/", "2"}]}], "}"}], ",", 
         RowBox[{"{", 
          RowBox[{
           RowBox[{"Gap", "/", "2"}], ",", 
           RowBox[{
            RowBox[{"-", " ", "Width"}], "/", "2"}]}], "}"}]}], "}"}]}], ";", 
      "\[IndentingNewLine]", "\[IndentingNewLine]", 
      RowBox[{"(*", "Cassettes", "*)"}], "\[IndentingNewLine]", 
      RowBox[{"\[Delta]URC", " ", "=", "\[Delta]GV"}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"URC", " ", "=", " ", 
       RowBox[{"auxIDCassette", "[", 
        RowBox[{
        "\[Lambda]u", ",", " ", "Np", ",", " ", "Br", ",", " ", "\[Delta]URC",
          ",", " ", "URCBlockShape", ",", 
         RowBox[{"\"\<Rectangular\>\"", "\[Rule]", " ", "True"}], ",", " ", 
         RowBox[{"\"\<BlockGap\>\"", "\[Rule]", " ", "BlockGap"}], ",", " ", 
         RowBox[{"\"\<Termination\>\"", "\[Rule]", " ", "Termination"}], ",", 
         " ", 
         RowBox[{"\"\<PointingUp\>\"", "\[Rule]", "False"}], ",", 
         RowBox[{"\"\<FirstBlock\>\"", "\[Rule]", " ", "\"\<Up\>\""}], ",", 
         " ", 
         RowBox[{
         "\"\<FieldDirection\>\"", "\[Rule]", " ", "\"\<Vertical\>\""}], ",", 
         " ", 
         RowBox[{
         "\"\<PosMagErrors\>\"", "\[Rule]", " ", "PosMagErrorsURC"}]}], 
        "]"}]}], " ", ";", "\[IndentingNewLine]", "\[IndentingNewLine]", 
      RowBox[{"\[Delta]ULC", " ", "=", " ", 
       RowBox[{
       "\[Delta]GV", "+", " ", "\[Delta]GH", "+", " ", "\[Delta]P", "+", 
        "\[Delta]CP"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"ULC", " ", "=", " ", 
       RowBox[{"auxIDCassette", "[", 
        RowBox[{
        "\[Lambda]u", ",", " ", "Np", ",", "Br", ",", " ", "\[Delta]ULC", ",",
          " ", "ULCBlockShape", ",", " ", 
         RowBox[{"\"\<Rectangular\>\"", "\[Rule]", " ", "True"}], ",", " ", 
         RowBox[{"\"\<BlockGap\>\"", "\[Rule]", " ", "BlockGap"}], ",", " ", 
         RowBox[{"\"\<Termination\>\"", "\[Rule]", " ", "Termination"}], ",", 
         " ", 
         RowBox[{"\"\<PointingUp\>\"", "\[Rule]", "True"}], ",", " ", 
         RowBox[{"\"\<FirstBlock\>\"", "\[Rule]", " ", "\"\<Down\>\""}], ",", 
         " ", 
         RowBox[{
         "\"\<FieldDirection\>\"", "\[Rule]", " ", "\"\<Horizontal\>\""}], 
         ",", 
         RowBox[{
         "\"\<PosMagErrors\>\"", "\[Rule]", " ", "PosMagErrorsULC"}]}], 
        "]"}]}], " ", ";", "\[IndentingNewLine]", "\[IndentingNewLine]", 
      RowBox[{"\[Delta]BLC", " ", "=", "\[Delta]GH"}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"BLC", " ", "=", " ", 
       RowBox[{"auxIDCassette", "[", 
        RowBox[{
        "\[Lambda]u", ",", " ", "Np", ",", "Br", ",", " ", "\[Delta]BLC", ",",
          " ", "BLCBlockShape", ",", 
         RowBox[{"\"\<Rectangular\>\"", "\[Rule]", " ", "True"}], ",", " ", 
         RowBox[{"\"\<BlockGap\>\"", "\[Rule]", " ", "BlockGap"}], ",", " ", 
         RowBox[{"\"\<Termination\>\"", "\[Rule]", " ", "Termination"}], ",", 
         RowBox[{"\"\<PointingUp\>\"", "\[Rule]", " ", "True"}], ",", 
         RowBox[{"\"\<FirstBlock\>\"", "\[Rule]", " ", "\"\<Up\>\""}], ",", 
         " ", 
         RowBox[{
         "\"\<FieldDirection\>\"", "\[Rule]", " ", "\"\<Vertical\>\""}], ",", 
         " ", 
         RowBox[{
         "\"\<PosMagErrors\>\"", "\[Rule]", " ", "PosMagErrorsBLC"}]}], 
        "]"}]}], " ", ";", "\[IndentingNewLine]", "\[IndentingNewLine]", 
      RowBox[{"\[Delta]BRC", " ", "=", 
       RowBox[{"\[Delta]P", "-", "\[Delta]CP"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"BRC", " ", "=", 
       RowBox[{"auxIDCassette", "[", 
        RowBox[{
        "\[Lambda]u", ",", " ", "Np", ",", "Br", ",", " ", "\[Delta]BRC", ",",
          " ", "BRCBlockShape", ",", 
         RowBox[{"\"\<Rectangular\>\"", "\[Rule]", " ", "True"}], ",", " ", 
         RowBox[{"\"\<BlockGap\>\"", "\[Rule]", " ", "BlockGap"}], ",", " ", 
         RowBox[{"\"\<Termination\>\"", "\[Rule]", " ", "Termination"}], ",", 
         "  ", 
         RowBox[{"\"\<PointingUp\>\"", "\[Rule]", " ", "False"}], ",", 
         RowBox[{"\"\<FirstBlock\>\"", "\[Rule]", " ", "\"\<Down\>\""}], ",", 
         " ", 
         RowBox[{
         "\"\<FieldDirection\>\"", "\[Rule]", " ", "\"\<Horizontal\>\""}], 
         ",", "  ", 
         RowBox[{
         "\"\<PosMagErrors\>\"", "\[Rule]", " ", "PosMagErrorsBRC"}]}], 
        "]"}]}], " ", ";", "\[IndentingNewLine]", "\[IndentingNewLine]", 
      RowBox[{"(*", 
       RowBox[{"Insertion", " ", "device"}], "*)"}], "\[IndentingNewLine]", 
      RowBox[{"Device", " ", "=", " ", 
       RowBox[{"radObjCnt", "[", 
        RowBox[{"{", 
         RowBox[{"BRC", ",", " ", "BLC", ",", " ", "ULC", ",", " ", "URC"}], 
         "}"}], "]"}]}], ";", "\[IndentingNewLine]", "\[IndentingNewLine]", 
      RowBox[{"(*", 
       RowBox[{
        RowBox[{
        "Counterclockwise", " ", "rotation", " ", "of", " ", "insertion", " ",
          "device", " ", "by"}], " ", "-", 
        RowBox[{
         RowBox[{"\[Pi]", "/", "4"}], " ", "around", " ", "the", " ", "z"}], 
        "-", "axis"}], "*)"}], "\[IndentingNewLine]", 
      RowBox[{"Device", "=", " ", 
       RowBox[{"radTrfOrnt", "[", 
        RowBox[{"Device", ",", 
         RowBox[{"radTrfRot", "[", 
          RowBox[{
           RowBox[{"{", 
            RowBox[{"0", ",", "0", ",", "0"}], "}"}], ",", 
           RowBox[{"{", 
            RowBox[{"0", ",", "0", ",", "1"}], "}"}], ",", 
           RowBox[{
            RowBox[{"-", "\[Pi]"}], "/", "4"}]}], "]"}]}], "]"}]}], ";", 
      "\[IndentingNewLine]", "\[IndentingNewLine]", 
      RowBox[{"t1", "=", 
       RowBox[{"AbsoluteTime", "[", "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"Print", "[", 
       RowBox[{"\"\<IDRectangularDelta: elapsed time = \>\"", ",", 
        RowBox[{"(", 
         RowBox[{"t1", "-", "t0"}], ")"}], ",", "\"\< s\>\""}], "]"}], ";", 
      "\[IndentingNewLine]", "\[IndentingNewLine]", 
      RowBox[{"Return", "[", "Device", "]"}], ";"}]}], "\[IndentingNewLine]", 
    "]"}]}], ";"}]}], "Input",
 CellChangeTimes->{
  3.766754554596554*^9, {3.7667569552301683`*^9, 3.7667570056560073`*^9}, {
   3.76675829285203*^9, 3.76675835334116*^9}, {3.766760093224132*^9, 
   3.766760094099189*^9}, {3.7674459380401154`*^9, 3.7674459453688154`*^9}, {
   3.7674480555147233`*^9, 3.7674480792197313`*^9}, {3.7675182788140783`*^9, 
   3.7675184830330715`*^9}, {3.767519394743863*^9, 3.767519406832663*^9}, {
   3.7826454930193405`*^9, 3.782645602522913*^9}, {3.782652226622411*^9, 
   3.782652233763005*^9}, {3.7826523789997063`*^9, 3.7826525907196145`*^9}, {
   3.78265264051632*^9, 3.7826526413600607`*^9}, {3.7826527241722326`*^9, 
   3.7826527243441153`*^9}, {3.782652767703318*^9, 3.782652767812686*^9}, {
   3.782657575679986*^9, 3.782657584883047*^9}, {3.7826593150574493`*^9, 
   3.7826593289011416`*^9}, 3.7834343844624987`*^9, 3.783436130359903*^9, 
   3.784974902741043*^9},
 Background->RGBColor[0.87, 0.94, 1],
 CellLabel->"In[52]:=",ExpressionUUID->"f1693d8c-7532-4c23-bd64-0408f02d9e9e"]
}, Closed]],

Cell[CellGroupData[{

Cell["IDRoundGapDelta", "Subsection",
 CellChangeTimes->{
  3.7667545696914883`*^9, {3.767518951766947*^9, 
   3.767518953066939*^9}},ExpressionUUID->"73a1d5b6-cacd-4ffc-b545-\
f8ad48c322c3"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"IDRoundGapDelta", "::", "usage"}], "=", 
    "\"\<IDRoundGapDelta[\[Lambda]u, Np, Br, Gap, \\\"\[Delta]P\\\":0, \\\"\
\[Delta]GV\\\":0, \\\"\[Delta]GH\\\":0, \\\"\[Delta]CP\\\":0, \
\\\"BlockGap\\\":0, \\\"Termination\\\":\\\"None\\\", \\\"PosMagErrorsBRC\\\"\
\[Rule] {}, \\\"PosMagErrorsBLC\\\"\[Rule] {}, \\\"PosMagErrorsULC\\\"\[Rule] \
{}, \\\"PosMagErrorsURC\\\"\[Rule] {}]: Returns the ID model. \\n\\nArgs: \\n\
\[Lambda]u [mm] is the ID period, \\nNp is the number of periods, \\nBr [T] \
is the remanent magnetization of the permanent magnet blocks, \\nGap [mm] is \
the length of the minimum gap between the cassettes. \\n\\nOptional args: \\n\
\[Delta]P [mm], \[Delta]GV [mm], \[Delta]GH [mm] and \[Delta]CP [mm] are four \
types of longitudinal movements between the cassettes, \[Delta]P is the phase \
adjustement, \[Delta]GV and \[Delta]GH control the amplitude of the \
longitudinal field component and \[Delta]CP is the inclined-polarization \
adjustment, \\nBlockGap [mm] is the longitudinal gap between the blocks, \
\\nTermination is the termination type (one of the following: None, \
OneBlockSym, OneBlockAntiSym, ThreeBlocksSym, ThreeBlocksAntiSym), \
\\nPosMagErrorsBRC is a list of positions and magnetization errors for the BR \
cassette, \\nPosMagErrorsBLC is a list of positions and magnetization errors \
for the BL cassette, \\nPosMagErrorsULC is a list of positions and \
magnetization errors for the UL cassette, \\nPosMagErrorsURC is a list of \
positions and magnetization errors for the UR cassette. \\n\\nPosition and \
magnetization errors: \\nThe list of position and magnetization errors must \
be empty or have a number of elements igual to the number of blocks on each \
cassette. Each element is a list with position and magnetization errors in \
the following format: \\n{{horizontal position error[mm], vertical position \
error[mm], longitudinal position error[mm]}, {horizontal magnetization \
error[T], vertical magnetization error[T], longitudinal magnetization \
error[T]}}. \\nThe errors will be add to the default values of position and \
magnetization of the blocks.\>\""}], ";"}], 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"IDRoundGapDelta", "[", 
    RowBox[{
    "\[Lambda]u_", ",", " ", "Np_", ",", " ", "Br_", ",", " ", "Gap_", ",", 
     " ", 
     RowBox[{"OptionsPattern", "[", 
      RowBox[{"{", 
       RowBox[{
        RowBox[{"\"\<\[Delta]P\>\"", "\[Rule]", " ", "0"}], ",", " ", 
        RowBox[{"\"\<\[Delta]GV\>\"", "\[Rule]", " ", "0"}], ",", " ", 
        RowBox[{"\"\<\[Delta]GH\>\"", "\[Rule]", " ", "0"}], ",", " ", 
        RowBox[{"\"\<\[Delta]CP\>\"", "\[Rule]", " ", "0"}], ",", " ", 
        RowBox[{"\"\<BlockGap\>\"", "->", "0"}], ",", " ", 
        RowBox[{"\"\<Termination\>\"", "\[Rule]", " ", "\"\<None\>\""}], ",", 
        " ", 
        RowBox[{"\"\<PosMagErrorsBRC\>\"", "\[Rule]", " ", 
         RowBox[{"{", "}"}]}], ",", " ", 
        RowBox[{"\"\<PosMagErrorsBLC\>\"", "\[Rule]", " ", 
         RowBox[{"{", "}"}]}], ",", " ", 
        RowBox[{"\"\<PosMagErrorsULC\>\"", "\[Rule]", " ", 
         RowBox[{"{", "}"}]}], ",", " ", 
        RowBox[{"\"\<PosMagErrorsURC\>\"", "\[Rule]", " ", 
         RowBox[{"{", "}"}]}]}], "}"}], "]"}]}], "]"}], " ", ":=", " ", 
   RowBox[{"Module", "[", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
      "r", ",", " ", "\[Theta]i", ",", " ", "\[Theta]", ",", " ", "n\[Theta]",
        ",", " ", "f", ",", " ", "b1", ",", " ", "b2", ",", " ", "b3", ",", 
       " ", "b4", ",", " ", "Blocks", ",", " ", "pneg", ",", " ", "ppos", ",",
        "bpos", ",", " ", "bneg", ",", "i", ",", "BRCBlockShape", ",", " ", 
       "BLCBlockShape", ",", " ", "ULCBlockShape", ",", " ", "URCBlockShape", 
       ",", " ", "\[IndentingNewLine]", "PosMagErrorsBRC", " ", ",", " ", 
       "PosMagErrorsBLC", ",", " ", "PosMagErrorsULC", " ", ",", " ", 
       "PosMagErrorsURC", ",", "\[IndentingNewLine]", "\[Delta]P", ",", " ", 
       "\[Delta]GV", ",", " ", "\[Delta]GH", ",", " ", "\[Delta]CP", ",", " ",
        "Termination", ",", "\[IndentingNewLine]", " ", "BlockGap", ",", " ", 
       "\[Delta]BRC", ",", " ", "BRC", ",", " ", "\[Delta]BLC", ",", " ", 
       "BLC", ",", " ", "\[Delta]ULC", ",", " ", "ULC", ",", " ", 
       "\[Delta]URC", ",", " ", "URC", ",", " ", "Device", ",", " ", "t0", 
       ",", " ", "t1"}], "}"}], ",", "\[IndentingNewLine]", 
     RowBox[{"(*", 
      RowBox[{
       RowBox[{
       "The", " ", "insertion", " ", "device", " ", "is", " ", "created", " ",
         "rotated", " ", "by", " ", 
        RowBox[{"\[Pi]", "/", "4"}], " ", "about", " ", "the", " ", "y"}], 
       "-", 
       RowBox[{
       "axis", " ", "to", " ", "simplified", " ", "the", " ", "magnetization",
         " ", 
        RowBox[{"functions", ".", " ", "The"}], " ", "entire", " ", "device", 
        " ", "is", " ", "rotated", " ", "to", " ", "the", " ", "correct", " ",
         "position", " ", "at", " ", "the", " ", "end", " ", "of", " ", "the",
         " ", 
        RowBox[{"function", "."}]}]}], "*)"}], "\[IndentingNewLine]", 
     "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"t0", "=", 
       RowBox[{"AbsoluteTime", "[", "]"}]}], ";", "\[IndentingNewLine]", 
      "\[IndentingNewLine]", 
      RowBox[{"(*", 
       RowBox[{"Delete", " ", "previous", " ", "Radia", " ", "objects"}], 
       "*)"}], "\[IndentingNewLine]", 
      RowBox[{"radUtiDelAll", "[", "]"}], ";", "\[IndentingNewLine]", 
      "\[IndentingNewLine]", 
      RowBox[{"(*", 
       RowBox[{"Check", " ", "arguments"}], "*)"}], "\[IndentingNewLine]", 
      RowBox[{"If", " ", "[", 
       RowBox[{
        RowBox[{"\[Lambda]u", " ", "\[LessEqual]", " ", "0"}], ",", " ", 
        RowBox[{"Return", "[", "]"}]}], "]"}], ";", "\[IndentingNewLine]", 
      RowBox[{"If", " ", "[", 
       RowBox[{
        RowBox[{"Np", " ", "\[LessEqual]", " ", "0"}], ",", " ", 
        RowBox[{"Return", "[", "]"}]}], "]"}], ";", "\[IndentingNewLine]", 
      RowBox[{"If", " ", "[", 
       RowBox[{
        RowBox[{"Br", " ", "\[LessEqual]", " ", "0"}], ",", " ", 
        RowBox[{"Return", "[", "]"}]}], "]"}], ";", "\[IndentingNewLine]", 
      RowBox[{"If", " ", "[", 
       RowBox[{
        RowBox[{"Gap", " ", "\[LessEqual]", " ", "0"}], ",", " ", 
        RowBox[{"Return", "[", "]"}]}], "]"}], ";", "\[IndentingNewLine]", 
      "\[IndentingNewLine]", 
      RowBox[{"(*", 
       RowBox[{"Gap", " ", "between", " ", "blocks"}], "*)"}], 
      "\[IndentingNewLine]", " ", 
      RowBox[{"BlockGap", " ", "=", " ", 
       RowBox[{"OptionValue", "[", "\"\<BlockGap\>\"", "]"}]}], ";", 
      "\[IndentingNewLine]", "\[IndentingNewLine]", 
      RowBox[{"(*", 
       RowBox[{"Cassettes", " ", "longitudinal", " ", 
        RowBox[{"displacement", " ", "[", "mm", "]"}]}], "*)"}], 
      "\[IndentingNewLine]", 
      RowBox[{"\[Delta]P", " ", "=", " ", 
       RowBox[{"OptionValue", "[", "\"\<\[Delta]P\>\"", "]"}]}], ";", " ", 
      RowBox[{"(*", 
       RowBox[{"Phase", " ", "adjustment"}], "*)"}], "\[IndentingNewLine]", 
      RowBox[{"\[Delta]GV", " ", "=", " ", 
       RowBox[{"OptionValue", "[", "\"\<\[Delta]GV\>\"", "]"}]}], ";", " ", 
      RowBox[{"(*", 
       RowBox[{
        RowBox[{
        "Vertical", " ", "field", " ", "amplitude", " ", "to", " ", 
         "longitudinal", " ", "field", " ", "amplitude"}], ",", " ", 
        RowBox[{
        "also", " ", "decreases", " ", "horizontal", " ", "field", " ", 
         "amplitude"}]}], "*)"}], "\[IndentingNewLine]", 
      RowBox[{"\[Delta]GH", " ", "=", " ", 
       RowBox[{"OptionValue", "[", "\"\<\[Delta]GH\>\"", "]"}]}], ";", 
      RowBox[{"(*", 
       RowBox[{
        RowBox[{
        "Horizontal", " ", "field", " ", "amplitude", " ", "to", " ", 
         "longitudinal", " ", "field", " ", "amplitude"}], ",", " ", 
        RowBox[{
        "also", " ", "decreases", " ", "vertical", " ", "field", " ", 
         "amplitude"}]}], "*)"}], "\[IndentingNewLine]", 
      RowBox[{"\[Delta]CP", " ", "=", " ", 
       RowBox[{"OptionValue", "[", "\"\<\[Delta]CP\>\"", "]"}]}], ";", 
      RowBox[{"(*", 
       RowBox[{"Inclined", " ", "polarization", " ", "adjustment"}], "*)"}], 
      "\[IndentingNewLine]", "\[IndentingNewLine]", 
      RowBox[{"(*", 
       RowBox[{"Termination", " ", "Type"}], "*)"}], "\[IndentingNewLine]", 
      RowBox[{"Termination", " ", "=", " ", 
       RowBox[{"OptionValue", "[", "\"\<Termination\>\"", "]"}]}], ";", 
      "\[IndentingNewLine]", "\[IndentingNewLine]", 
      RowBox[{"(*", 
       RowBox[{"Position", " ", "and", " ", "magnetization", " ", "errors"}], 
       "*)"}], "\[IndentingNewLine]", 
      RowBox[{"PosMagErrorsBRC", " ", "=", " ", 
       RowBox[{"OptionValue", "[", "\"\<PosMagErrorsBRC\>\"", "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"PosMagErrorsBLC", " ", "=", " ", 
       RowBox[{"OptionValue", "[", "\"\<PosMagErrorsBLC\>\"", "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"PosMagErrorsULC", " ", "=", " ", 
       RowBox[{"OptionValue", "[", "\"\<PosMagErrorsULC\>\"", "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"PosMagErrorsURC", " ", "=", " ", 
       RowBox[{"OptionValue", "[", "\"\<PosMagErrorsURC\>\"", "]"}]}], ";", 
      "\[IndentingNewLine]", "\[IndentingNewLine]", 
      RowBox[{"(*", 
       RowBox[{
        RowBox[{
        "Counterclockwise", " ", "rotation", " ", "of", " ", "errors", " ", 
         "by", " ", 
         RowBox[{"\[Pi]", "/", "4"}], " ", "around", " ", "the", " ", "z"}], 
        "-", "axis"}], "*)"}], "\[IndentingNewLine]", 
      RowBox[{"PosMagErrorsBRC", " ", "=", " ", 
       RowBox[{
        RowBox[{
         RowBox[{"{", 
          RowBox[{
           RowBox[{"Dot", "[", 
            RowBox[{
             RowBox[{"RotationMatrix", "[", 
              RowBox[{
               RowBox[{"\[Pi]", "/", "4"}], ",", " ", 
               RowBox[{"{", 
                RowBox[{"0", ",", " ", "0", ",", " ", "1"}], "}"}]}], "]"}], 
             ",", 
             RowBox[{"#", "[", 
              RowBox[{"[", "1", "]"}], "]"}]}], "]"}], ",", 
           RowBox[{"Dot", "[", 
            RowBox[{
             RowBox[{"RotationMatrix", "[", 
              RowBox[{
               RowBox[{"\[Pi]", "/", "4"}], ",", " ", 
               RowBox[{"{", 
                RowBox[{"0", ",", " ", "0", ",", " ", "1"}], "}"}]}], "]"}], 
             ",", 
             RowBox[{"#", "[", 
              RowBox[{"[", "2", "]"}], "]"}]}], "]"}]}], "}"}], "&"}], "/@", 
        " ", " ", "PosMagErrorsBRC"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"PosMagErrorsBLC", " ", "=", " ", 
       RowBox[{
        RowBox[{
         RowBox[{"{", 
          RowBox[{
           RowBox[{"Dot", "[", 
            RowBox[{
             RowBox[{"RotationMatrix", "[", 
              RowBox[{
               RowBox[{"\[Pi]", "/", "4"}], ",", " ", 
               RowBox[{"{", 
                RowBox[{"0", ",", " ", "0", ",", " ", "1"}], "}"}]}], "]"}], 
             ",", 
             RowBox[{"#", "[", 
              RowBox[{"[", "1", "]"}], "]"}]}], "]"}], ",", 
           RowBox[{"Dot", "[", 
            RowBox[{
             RowBox[{"RotationMatrix", "[", 
              RowBox[{
               RowBox[{"\[Pi]", "/", "4"}], ",", " ", 
               RowBox[{"{", 
                RowBox[{"0", ",", " ", "0", ",", " ", "1"}], "}"}]}], "]"}], 
             ",", 
             RowBox[{"#", "[", 
              RowBox[{"[", "2", "]"}], "]"}]}], "]"}]}], "}"}], "&"}], "/@", 
        " ", " ", "PosMagErrorsBLC"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"PosMagErrorsULC", " ", "=", " ", 
       RowBox[{
        RowBox[{
         RowBox[{"{", 
          RowBox[{
           RowBox[{"Dot", "[", 
            RowBox[{
             RowBox[{"RotationMatrix", "[", 
              RowBox[{
               RowBox[{"\[Pi]", "/", "4"}], ",", " ", 
               RowBox[{"{", 
                RowBox[{"0", ",", " ", "0", ",", " ", "1"}], "}"}]}], "]"}], 
             ",", 
             RowBox[{"#", "[", 
              RowBox[{"[", "1", "]"}], "]"}]}], "]"}], ",", 
           RowBox[{"Dot", "[", 
            RowBox[{
             RowBox[{"RotationMatrix", "[", 
              RowBox[{
               RowBox[{"\[Pi]", "/", "4"}], ",", " ", 
               RowBox[{"{", 
                RowBox[{"0", ",", " ", "0", ",", " ", "1"}], "}"}]}], "]"}], 
             ",", 
             RowBox[{"#", "[", 
              RowBox[{"[", "2", "]"}], "]"}]}], "]"}]}], "}"}], "&"}], "/@", 
        " ", " ", "PosMagErrorsULC"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"PosMagErrorsURC", " ", "=", " ", 
       RowBox[{
        RowBox[{
         RowBox[{"{", 
          RowBox[{
           RowBox[{"Dot", "[", 
            RowBox[{
             RowBox[{"RotationMatrix", "[", 
              RowBox[{
               RowBox[{"\[Pi]", "/", "4"}], ",", " ", 
               RowBox[{"{", 
                RowBox[{"0", ",", " ", "0", ",", " ", "1"}], "}"}]}], "]"}], 
             ",", 
             RowBox[{"#", "[", 
              RowBox[{"[", "1", "]"}], "]"}]}], "]"}], ",", 
           RowBox[{"Dot", "[", 
            RowBox[{
             RowBox[{"RotationMatrix", "[", 
              RowBox[{
               RowBox[{"\[Pi]", "/", "4"}], ",", " ", 
               RowBox[{"{", 
                RowBox[{"0", ",", " ", "0", ",", " ", "1"}], "}"}]}], "]"}], 
             ",", 
             RowBox[{"#", "[", 
              RowBox[{"[", "2", "]"}], "]"}]}], "]"}]}], "}"}], "&"}], "/@", 
        "  ", "PosMagErrorsURC"}]}], ";", "\[IndentingNewLine]", 
      "\[IndentingNewLine]", 
      RowBox[{"(*", 
       RowBox[{"Block", " ", "vertices"}], "*)"}], "\[IndentingNewLine]", 
      RowBox[{"r", " ", "=", " ", 
       RowBox[{"Sqrt", "[", 
        RowBox[{
         RowBox[{"2.75", "^", "2"}], " ", "+", " ", 
         RowBox[{"3.46", "^", "2"}]}], "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"\[Theta]i", " ", "=", " ", 
       RowBox[{"ArcTan", "[", 
        RowBox[{"3.46", "/", "2.75"}], "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"f", " ", "=", " ", 
       RowBox[{"Gap", "/", 
        RowBox[{"(", 
         RowBox[{"2", "*", "r"}], ")"}]}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"b1", " ", "=", 
       RowBox[{"f", "*", 
        RowBox[{"{", 
         RowBox[{
          RowBox[{"{", 
           RowBox[{
            RowBox[{
             RowBox[{"-", "2.75"}], " ", "-", " ", "r", "+", "3.46"}], ",", 
            " ", "r"}], "}"}], ",", " ", 
          RowBox[{"{", 
           RowBox[{
            RowBox[{"-", "11.2662"}], ",", " ", "12.4245"}], "}"}], ",", " ", 
          RowBox[{"{", 
           RowBox[{
            RowBox[{"-", "7.73071"}], ",", "15.96"}], "}"}], ",", 
          RowBox[{"{", 
           RowBox[{"7.73071", ",", "15.96"}], "}"}], ",", " ", 
          RowBox[{"{", 
           RowBox[{"11.2662", ",", " ", "12.4245"}], "}"}], ",", " ", 
          RowBox[{"{", 
           RowBox[{
            RowBox[{"2.75", " ", "+", " ", "r", "-", " ", "3.46"}], ",", " ", 
            "r"}], "}"}]}], "}"}]}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"b2", " ", "=", " ", 
       RowBox[{"f", "*", 
        RowBox[{"{", " ", 
         RowBox[{
          RowBox[{"{", 
           RowBox[{
            RowBox[{"-", "7.73071"}], ",", "15.96"}], "}"}], ",", 
          RowBox[{"{", 
           RowBox[{
            RowBox[{"-", "11.2662"}], ",", " ", "19.4955"}], "}"}], ",", 
          RowBox[{"{", 
           RowBox[{
            RowBox[{"-", "2.75"}], ",", "28.46"}], "}"}], ",", " ", 
          RowBox[{"{", 
           RowBox[{"2.75", ",", "28.46"}], "}"}], ",", " ", 
          RowBox[{"{", 
           RowBox[{"11.2662", ",", " ", "19.4955"}], "}"}], ",", " ", 
          RowBox[{"{", 
           RowBox[{"7.73071", ",", "15.96"}], "}"}]}], "}"}]}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"b3", " ", "=", " ", 
       RowBox[{"f", "*", 
        RowBox[{"{", 
         RowBox[{
          RowBox[{"{", 
           RowBox[{"2.75", ",", " ", "3.46"}], "}"}], ",", " ", 
          RowBox[{"{", 
           RowBox[{"2.75", ",", " ", "r"}], "}"}], ",", " ", 
          RowBox[{"{", 
           RowBox[{
            RowBox[{"2.75", " ", "+", " ", "r", "-", " ", "3.46"}], ",", " ", 
            "r"}], "}"}]}], "}"}]}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"b4", " ", "=", " ", 
       RowBox[{"f", "*", 
        RowBox[{"{", 
         RowBox[{
          RowBox[{"{", 
           RowBox[{
            RowBox[{"-", "2.75"}], ",", " ", "3.46"}], "}"}], ",", " ", 
          RowBox[{"{", 
           RowBox[{
            RowBox[{"-", "2.75"}], ",", " ", "r"}], "}"}], ",", " ", 
          RowBox[{"{", 
           RowBox[{
            RowBox[{
             RowBox[{"-", "2.75"}], " ", "-", " ", "r", "+", " ", "3.46"}], 
            ",", " ", "r"}], "}"}]}], "}"}]}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"Blocks", " ", "=", " ", 
       RowBox[{"{", 
        RowBox[{"b1", ",", "b2", ",", " ", "b3", ",", " ", "b4"}], "}"}]}], 
      ";", "\[IndentingNewLine]", "\[IndentingNewLine]", 
      RowBox[{"n\[Theta]", " ", "=", " ", "10"}], ";", "\[IndentingNewLine]", 
      RowBox[{"\[Theta]", " ", "=", " ", 
       RowBox[{"Range", "[", 
        RowBox[{
         RowBox[{"\[Pi]", "/", "2"}], ",", " ", "\[Theta]i", ",", "  ", 
         RowBox[{
          RowBox[{"-", 
           RowBox[{"(", 
            RowBox[{
             RowBox[{"\[Pi]", "/", "2"}], "-", " ", "\[Theta]i"}], ")"}]}], 
          "/", 
          RowBox[{"(", 
           RowBox[{"n\[Theta]", "-", "1"}], ")"}]}]}], "]"}]}], ";", 
      "\[IndentingNewLine]", "\[IndentingNewLine]", 
      RowBox[{"AppendTo", "[", 
       RowBox[{"Blocks", ",", " ", 
        RowBox[{"f", "*", 
         RowBox[{"{", 
          RowBox[{
           RowBox[{"{", 
            RowBox[{"0", ",", " ", "r"}], "}"}], ",", " ", 
           RowBox[{"{", 
            RowBox[{
             RowBox[{"r", "*", 
              RowBox[{"Cos", "[", 
               RowBox[{"\[Pi]", "-", 
                RowBox[{"\[Theta]", "[", 
                 RowBox[{"[", "2", "]"}], "]"}]}], "]"}]}], ",", " ", 
             RowBox[{"r", "*", 
              RowBox[{"Sin", "[", 
               RowBox[{"\[Pi]", "-", 
                RowBox[{"\[Theta]", "[", 
                 RowBox[{"[", "2", "]"}], "]"}]}], "]"}]}]}], "}"}], ",", " ", 
           RowBox[{"{", 
            RowBox[{
             RowBox[{"r", "*", 
              RowBox[{"Cos", "[", 
               RowBox[{"\[Pi]", "-", 
                RowBox[{"\[Theta]", "[", 
                 RowBox[{"[", "2", "]"}], "]"}]}], "]"}]}], ",", " ", "r"}], 
            "}"}]}], "}"}]}]}], "]"}], ";", "\[IndentingNewLine]", 
      RowBox[{"pneg", " ", "=", " ", 
       RowBox[{"{", 
        RowBox[{
         RowBox[{"r", "*", 
          RowBox[{"Cos", "[", 
           RowBox[{"\[Pi]", "-", 
            RowBox[{"\[Theta]", "[", 
             RowBox[{"[", "2", "]"}], "]"}]}], "]"}]}], ",", " ", "r"}], 
        "}"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"AppendTo", "[", 
       RowBox[{"Blocks", ",", " ", 
        RowBox[{"f", "*", 
         RowBox[{"{", 
          RowBox[{
           RowBox[{"{", 
            RowBox[{"0", ",", " ", "r"}], "}"}], ",", " ", 
           RowBox[{"{", 
            RowBox[{
             RowBox[{"r", "*", 
              RowBox[{"Cos", "[", 
               RowBox[{"\[Theta]", "[", 
                RowBox[{"[", "2", "]"}], "]"}], "]"}]}], ",", " ", 
             RowBox[{"r", "*", 
              RowBox[{"Sin", "[", 
               RowBox[{"\[Theta]", "[", 
                RowBox[{"[", "2", "]"}], "]"}], "]"}]}]}], "}"}], ",", " ", 
           RowBox[{"{", 
            RowBox[{
             RowBox[{"r", "*", 
              RowBox[{"Cos", "[", 
               RowBox[{"\[Theta]", "[", 
                RowBox[{"[", "2", "]"}], "]"}], "]"}]}], ",", " ", "r"}], 
            "}"}]}], "}"}]}]}], "]"}], ";", "\[IndentingNewLine]", 
      RowBox[{"ppos", " ", "=", 
       RowBox[{"{", 
        RowBox[{
         RowBox[{"r", "*", 
          RowBox[{"Cos", "[", 
           RowBox[{"\[Theta]", "[", 
            RowBox[{"[", "2", "]"}], "]"}], "]"}]}], ",", " ", "r"}], "}"}]}],
       ";", " ", "\[IndentingNewLine]", "\[IndentingNewLine]", 
      RowBox[{"For", " ", "[", 
       RowBox[{
        RowBox[{"i", "=", "3"}], ",", " ", 
        RowBox[{"i", "\[LessEqual]", 
         RowBox[{"Length", "[", "\[Theta]", "]"}]}], ",", " ", 
        RowBox[{"i", "++"}], ",", " ", "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"bpos", " ", "=", " ", 
          RowBox[{"f", "*", 
           RowBox[{"{", 
            RowBox[{"ppos", ",", " ", 
             RowBox[{"{", 
              RowBox[{
               RowBox[{"r", "*", 
                RowBox[{"Cos", "[", 
                 RowBox[{"\[Theta]", "[", 
                  RowBox[{"[", 
                   RowBox[{"i", "-", "1"}], "]"}], "]"}], "]"}]}], ",", " ", 
               RowBox[{"r", "*", 
                RowBox[{"Sin", "[", 
                 RowBox[{"\[Theta]", "[", 
                  RowBox[{"[", 
                   RowBox[{"i", "-", "1"}], "]"}], "]"}], "]"}]}]}], "}"}], 
             ",", " ", 
             RowBox[{"{", 
              RowBox[{
               RowBox[{"r", "*", 
                RowBox[{"Cos", "[", 
                 RowBox[{"\[Theta]", "[", 
                  RowBox[{"[", "i", "]"}], "]"}], "]"}]}], ",", " ", 
               RowBox[{"r", "*", 
                RowBox[{"Sin", "[", 
                 RowBox[{"\[Theta]", "[", 
                  RowBox[{"[", "i", "]"}], "]"}], "]"}]}]}], "}"}], ",", " ", 
             RowBox[{"{", 
              RowBox[{
               RowBox[{"r", "*", 
                RowBox[{"Cos", "[", 
                 RowBox[{"\[Theta]", "[", 
                  RowBox[{"[", "i", "]"}], "]"}], "]"}]}], ",", " ", "r"}], 
              "}"}]}], "}"}]}]}], ";", "\[IndentingNewLine]", 
         RowBox[{"ppos", " ", "=", " ", 
          RowBox[{"{", 
           RowBox[{
            RowBox[{"r", "*", 
             RowBox[{"Cos", "[", 
              RowBox[{"\[Theta]", "[", 
               RowBox[{"[", "i", "]"}], "]"}], "]"}]}], ",", " ", "r"}], 
           "}"}]}], ";", "\[IndentingNewLine]", 
         RowBox[{"AppendTo", "[", 
          RowBox[{"Blocks", ",", "bpos"}], "]"}], ";", "\[IndentingNewLine]", 
         RowBox[{"bneg", " ", "=", " ", 
          RowBox[{"f", "*", 
           RowBox[{"{", 
            RowBox[{"pneg", ",", " ", 
             RowBox[{"{", 
              RowBox[{
               RowBox[{"r", "*", 
                RowBox[{"Cos", "[", 
                 RowBox[{"\[Pi]", "-", 
                  RowBox[{"\[Theta]", "[", 
                   RowBox[{"[", 
                    RowBox[{"i", "-", "1"}], "]"}], "]"}]}], "]"}]}], ",", 
               " ", 
               RowBox[{"r", "*", 
                RowBox[{"Sin", "[", 
                 RowBox[{"\[Pi]", "-", 
                  RowBox[{"\[Theta]", "[", 
                   RowBox[{"[", 
                    RowBox[{"i", "-", "1"}], "]"}], "]"}]}], "]"}]}]}], "}"}],
              ",", " ", 
             RowBox[{"{", 
              RowBox[{
               RowBox[{"r", "*", 
                RowBox[{"Cos", "[", 
                 RowBox[{"\[Pi]", "-", 
                  RowBox[{"\[Theta]", "[", 
                   RowBox[{"[", "i", "]"}], "]"}]}], "]"}]}], ",", " ", 
               RowBox[{"r", "*", 
                RowBox[{"Sin", "[", 
                 RowBox[{"\[Pi]", "-", 
                  RowBox[{"\[Theta]", "[", 
                   RowBox[{"[", "i", "]"}], "]"}]}], "]"}]}]}], "}"}], ",", 
             " ", 
             RowBox[{"{", 
              RowBox[{
               RowBox[{"r", "*", 
                RowBox[{"Cos", "[", 
                 RowBox[{"\[Pi]", "-", 
                  RowBox[{"\[Theta]", "[", 
                   RowBox[{"[", "i", "]"}], "]"}]}], "]"}]}], ",", " ", "r"}],
               "}"}]}], "}"}]}]}], ";", "\[IndentingNewLine]", 
         RowBox[{"pneg", " ", "=", 
          RowBox[{"{", 
           RowBox[{
            RowBox[{"r", "*", 
             RowBox[{"Cos", "[", 
              RowBox[{"\[Pi]", "-", 
               RowBox[{"\[Theta]", "[", 
                RowBox[{"[", "i", "]"}], "]"}]}], "]"}]}], ",", " ", "r"}], 
           "}"}]}], ";", "\[IndentingNewLine]", 
         RowBox[{"AppendTo", "[", 
          RowBox[{"Blocks", ",", " ", "bneg"}], "]"}], ";"}]}], 
       "\[IndentingNewLine]", "]"}], ";", "\[IndentingNewLine]", 
      "\[IndentingNewLine]", 
      RowBox[{"(*", 
       RowBox[{
       "Block", " ", "vertices", " ", "for", " ", "each", " ", "cassette", 
        " ", 
        RowBox[{"(", 
         RowBox[{
         "cross", " ", "section", " ", "in", " ", "the", " ", "xy", " ", 
          "plane"}], ")"}]}], "*)"}], "\[IndentingNewLine]", 
      RowBox[{"URCBlockShape", " ", "=", "Blocks"}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"ULCBlockShape", " ", "=", " ", 
       RowBox[{
        RowBox[{
         RowBox[{
          RowBox[{
           RowBox[{"Dot", "[", 
            RowBox[{
             RowBox[{"RotationMatrix", "[", 
              RowBox[{"\[Pi]", "/", "2"}], "]"}], ",", "#"}], "]"}], "&"}], "/@",
           "#"}], "&"}], "/@", "URCBlockShape"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"BLCBlockShape", " ", "=", " ", 
       RowBox[{
        RowBox[{
         RowBox[{
          RowBox[{
           RowBox[{"Dot", "[", 
            RowBox[{
             RowBox[{"RotationMatrix", "[", 
              RowBox[{"\[Pi]", "/", "2"}], "]"}], ",", "#"}], "]"}], "&"}], "/@",
           "#"}], "&"}], "/@", "ULCBlockShape"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"BRCBlockShape", " ", "=", " ", 
       RowBox[{
        RowBox[{
         RowBox[{
          RowBox[{
           RowBox[{"Dot", "[", 
            RowBox[{
             RowBox[{"RotationMatrix", "[", 
              RowBox[{"\[Pi]", "/", "2"}], "]"}], ",", "#"}], "]"}], "&"}], "/@",
           "#"}], "&"}], "/@", "BLCBlockShape"}]}], ";", 
      "\[IndentingNewLine]", "\[IndentingNewLine]", 
      RowBox[{"(*", "Cassettes", "*)"}], "\[IndentingNewLine]", 
      RowBox[{"\[Delta]URC", " ", "=", "\[Delta]GV"}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"URC", " ", "=", " ", 
       RowBox[{"auxIDCassette", "[", 
        RowBox[{
        "\[Lambda]u", ",", " ", "Np", ",", " ", "Br", ",", "\[Delta]URC", ",",
          " ", "URCBlockShape", ",", 
         RowBox[{"\"\<BlockGap\>\"", "\[Rule]", " ", "BlockGap"}], ",", " ", 
         RowBox[{"\"\<Termination\>\"", "\[Rule]", " ", "Termination"}], ",", 
         " ", " ", 
         RowBox[{"\"\<PointingUp\>\"", "\[Rule]", " ", "False"}], ",", 
         RowBox[{"\"\<FirstBlock\>\"", "\[Rule]", " ", "\"\<Up\>\""}], ",", 
         RowBox[{
         "\"\<FieldDirection\>\"", "\[Rule]", " ", "\"\<Vertical\>\""}], ",", 
         RowBox[{
         "\"\<PosMagErrors\>\"", "\[Rule]", " ", "PosMagErrorsURC"}]}], 
        "]"}]}], ";", "\[IndentingNewLine]", "\[IndentingNewLine]", 
      RowBox[{"\[Delta]ULC", " ", "=", " ", 
       RowBox[{
       "\[Delta]GV", "+", " ", "\[Delta]GH", "+", " ", "\[Delta]P", "+", 
        "\[Delta]CP"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"ULC", " ", "=", " ", 
       RowBox[{"auxIDCassette", "[", 
        RowBox[{
        "\[Lambda]u", ",", " ", "Np", ",", " ", "Br", ",", "\[Delta]ULC", ",",
          " ", "ULCBlockShape", ",", " ", 
         RowBox[{"\"\<BlockGap\>\"", "\[Rule]", " ", "BlockGap"}], ",", " ", 
         RowBox[{"\"\<Termination\>\"", "\[Rule]", " ", "Termination"}], ",", 
         " ", " ", 
         RowBox[{"\"\<PointingUp\>\"", "\[Rule]", " ", "True"}], ",", 
         RowBox[{"\"\<FirstBlock\>\"", "\[Rule]", " ", "\"\<Down\>\""}], ",", 
         " ", 
         RowBox[{
         "\"\<FieldDirection\>\"", "\[Rule]", " ", "\"\<Horizontal\>\""}], 
         ",", 
         RowBox[{
         "\"\<PosMagErrors\>\"", "\[Rule]", " ", "PosMagErrorsULC"}]}], 
        "]"}]}], ";", "\[IndentingNewLine]", "\[IndentingNewLine]", 
      RowBox[{"\[Delta]BLC", " ", "=", "\[Delta]GH"}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"BLC", " ", "=", " ", 
       RowBox[{"auxIDCassette", "[", 
        RowBox[{
        "\[Lambda]u", ",", " ", "Np", ",", " ", "Br", ",", "\[Delta]BLC", ",",
          " ", "BLCBlockShape", ",", " ", 
         RowBox[{"\"\<BlockGap\>\"", "\[Rule]", " ", "BlockGap"}], ",", " ", 
         RowBox[{"\"\<Termination\>\"", "\[Rule]", " ", "Termination"}], ",", 
         " ", " ", 
         RowBox[{"\"\<PointingUp\>\"", "\[Rule]", " ", "True"}], ",", 
         RowBox[{"\"\<FirstBlock\>\"", "\[Rule]", " ", "\"\<Up\>\""}], ",", 
         " ", 
         RowBox[{
         "\"\<FieldDirection\>\"", "\[Rule]", " ", "\"\<Vertical\>\""}], ",", 
         " ", 
         RowBox[{
         "\"\<PosMagErrors\>\"", "\[Rule]", " ", "PosMagErrorsBLC"}]}], 
        "]"}]}], ";", "\[IndentingNewLine]", "\[IndentingNewLine]", 
      RowBox[{"\[Delta]BRC", " ", "=", 
       RowBox[{"\[Delta]P", "-", "\[Delta]CP"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"BRC", " ", "=", 
       RowBox[{"auxIDCassette", "[", 
        RowBox[{
        "\[Lambda]u", ",", " ", "Np", ",", " ", "Br", ",", " ", "\[Delta]BRC",
          ",", "BRCBlockShape", ",", 
         RowBox[{"\"\<BlockGap\>\"", "\[Rule]", " ", "BlockGap"}], ",", " ", 
         RowBox[{"\"\<Termination\>\"", "\[Rule]", " ", "Termination"}], ",", 
         " ", " ", 
         RowBox[{"\"\<PointingUp\>\"", "\[Rule]", "False"}], ",", " ", 
         RowBox[{"\"\<FirstBlock\>\"", "\[Rule]", " ", "\"\<Down\>\""}], ",", 
         " ", 
         RowBox[{
         "\"\<FieldDirection\>\"", "\[Rule]", " ", "\"\<Horizontal\>\""}], 
         ",", 
         RowBox[{
         "\"\<PosMagErrors\>\"", "\[Rule]", " ", "PosMagErrorsBRC"}]}], 
        "]"}]}], ";", "\[IndentingNewLine]", "\[IndentingNewLine]", 
      RowBox[{"(*", 
       RowBox[{"Insertion", " ", "device"}], "*)"}], "\[IndentingNewLine]", 
      RowBox[{"Device", " ", "=", " ", 
       RowBox[{"radObjCnt", "[", 
        RowBox[{"{", 
         RowBox[{"BRC", ",", " ", "BLC", ",", " ", "ULC", ",", " ", "URC"}], 
         "}"}], "]"}]}], ";", "\[IndentingNewLine]", "\[IndentingNewLine]", 
      RowBox[{"(*", 
       RowBox[{
        RowBox[{
        "Counterclockwise", " ", "rotation", " ", "of", " ", "insertion", " ",
          "device", " ", "by"}], " ", "-", 
        RowBox[{
         RowBox[{"\[Pi]", "/", "4"}], " ", "around", " ", "the", " ", "z"}], 
        "-", "axis"}], "*)"}], "\[IndentingNewLine]", 
      RowBox[{"Device", "=", " ", 
       RowBox[{"radTrfOrnt", "[", 
        RowBox[{"Device", ",", 
         RowBox[{"radTrfRot", "[", 
          RowBox[{
           RowBox[{"{", 
            RowBox[{"0", ",", "0", ",", "0"}], "}"}], ",", 
           RowBox[{"{", 
            RowBox[{"0", ",", "0", ",", "1"}], "}"}], ",", 
           RowBox[{
            RowBox[{"-", "\[Pi]"}], "/", "4"}]}], "]"}]}], "]"}]}], ";", 
      "\[IndentingNewLine]", "\[IndentingNewLine]", 
      RowBox[{"t1", "=", 
       RowBox[{"AbsoluteTime", "[", "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"Print", "[", 
       RowBox[{"\"\<IDDeltaRoundGap: elapsed time = \>\"", ",", 
        RowBox[{"(", 
         RowBox[{"t1", "-", "t0"}], ")"}], ",", "\"\< s\>\""}], "]"}], ";", 
      "\[IndentingNewLine]", "\[IndentingNewLine]", 
      RowBox[{"Return", "[", "Device", "]"}], ";"}]}], "\[IndentingNewLine]", 
    "]"}]}], ";"}], "\[IndentingNewLine]"}], "Input",
 CellChangeTimes->{{3.7667570196414795`*^9, 3.76675705883206*^9}, {
   3.7667583636544714`*^9, 3.766758382374689*^9}, {3.7667601105067225`*^9, 
   3.7667601111473975`*^9}, {3.7674459577447896`*^9, 
   3.7674459679643497`*^9}, {3.767448092345765*^9, 3.767448121113639*^9}, {
   3.767518533236807*^9, 3.7675185941188755`*^9}, 3.767518630053323*^9, {
   3.767518961797905*^9, 3.7675189732208247`*^9}, {3.7826456689601593`*^9, 
   3.782645752492673*^9}, {3.7826527463440275`*^9, 3.7826527878126044`*^9}, {
   3.782659342309136*^9, 3.782659354185662*^9}, 3.7834343918062215`*^9, 
   3.7834361427348537`*^9, 3.7849749105087204`*^9},
 Background->RGBColor[0.87, 0.94, 1],
 CellLabel->"In[54]:=",ExpressionUUID->"3e6fcdfa-c357-4e8d-b759-a932dcaec928"]
}, Closed]],

Cell[CellGroupData[{

Cell["IDCornellDelta", "Subsection",
 CellChangeTimes->{
  3.7667545696914883`*^9, {3.766754603772298*^9, 3.7667546054286704`*^9}, {
   3.7675189550426054`*^9, 
   3.7675189567222004`*^9}},ExpressionUUID->"aae754c9-41c2-4b9e-aa24-\
f0eb792b9e32"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"IDCornellDelta", "::", "usage"}], "=", 
    "\"\<IDCornellDelta[\[Lambda]u, Np, Br, Gap, \\\"\[Delta]P\\\":0, \\\"\
\[Delta]GV\\\":0, \\\"\[Delta]GH\\\":0, \\\"\[Delta]CP\\\":0, \
\\\"BlockGap\\\":0, \\\"Termination\\\":\\\"None\\\", \\\"PosMagErrorsBRC\\\"\
\[Rule] {}, \\\"PosMagErrorsBLC\\\"\[Rule] {}, \\\"PosMagErrorsULC\\\"\[Rule] \
{}, \\\"PosMagErrorsURC\\\"\[Rule] {}]: Returns the ID model. \\n\\nArgs: \\n\
\[Lambda]u [mm] is the ID period, \\nNp is the number of periods, \\nBr [T] \
is the remanent magnetization of the permanent magnet blocks, \\nGap [mm] is \
the length of the minimum gap between the cassettes. \\n\\nOptional args: \\n\
\[Delta]P [mm], \[Delta]GV [mm], \[Delta]GH [mm] and \[Delta]CP [mm] are four \
types of longitudinal movements between the cassettes, \[Delta]P is the phase \
adjustement, \[Delta]GV and \[Delta]GH control the amplitude of the \
longitudinal field component and \[Delta]CP is the inclined-polarization \
adjustment, \\nBlockGap [mm] is the longitudinal gap between the blocks, \
\\nTermination is the termination type (one of the following: None, \
OneBlockSym, OneBlockAntiSym, ThreeBlocksSym, ThreeBlocksAntiSym), \
\\nPosMagErrorsBRC is a list of positions and magnetization errors for the BR \
cassette, \\nPosMagErrorsBLC is a list of positions and magnetization errors \
for the BL cassette, \\nPosMagErrorsULC is a list of positions and \
magnetization errors for the UL cassette, \\nPosMagErrorsURC is a list of \
positions and magnetization errors for the UR cassette. \\n\\nPosition and \
magnetization errors: \\nThe list of position and magnetization errors must \
be empty or have a number of elements igual to the number of blocks on each \
cassette. Each element is a list with position and magnetization errors in \
the following format: \\n{{horizontal position error[mm], vertical position \
error[mm], longitudinal position error[mm]}, {horizontal magnetization \
error[T], vertical magnetization error[T], longitudinal magnetization \
error[T]}}. \\nThe errors will be add to the default values of position and \
magnetization of the blocks.\>\""}], ";"}], 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"IDCornellDelta", "[", 
    RowBox[{
    "\[Lambda]u_", ",", " ", "Np_", ",", " ", "Br_", ",", " ", "Gap_", ",", 
     " ", 
     RowBox[{"OptionsPattern", "[", 
      RowBox[{"{", 
       RowBox[{
        RowBox[{"\"\<\[Delta]P\>\"", "\[Rule]", " ", "0"}], ",", " ", 
        RowBox[{"\"\<\[Delta]GV\>\"", "\[Rule]", " ", "0"}], ",", " ", 
        RowBox[{"\"\<\[Delta]GH\>\"", "\[Rule]", " ", "0"}], ",", " ", 
        RowBox[{"\"\<\[Delta]CP\>\"", "\[Rule]", " ", "0"}], ",", " ", 
        RowBox[{"\"\<BlockGap\>\"", "->", "0"}], ",", "  ", 
        RowBox[{"\"\<Termination\>\"", "\[Rule]", " ", "\"\<None\>\""}], ",", 
        " ", 
        RowBox[{"\"\<PosMagErrorsBRC\>\"", "\[Rule]", " ", 
         RowBox[{"{", "}"}]}], ",", " ", 
        RowBox[{"\"\<PosMagErrorsBLC\>\"", "\[Rule]", " ", 
         RowBox[{"{", "}"}]}], ",", " ", 
        RowBox[{"\"\<PosMagErrorsULC\>\"", "\[Rule]", " ", 
         RowBox[{"{", "}"}]}], ",", " ", 
        RowBox[{"\"\<PosMagErrorsURC\>\"", "\[Rule]", " ", 
         RowBox[{"{", "}"}]}]}], "}"}], "]"}]}], "]"}], " ", ":=", " ", 
   RowBox[{"Module", "[", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
      "r", ",", " ", "\[Theta]i", ",", " ", "\[Theta]", ",", " ", "n\[Theta]",
        ",", " ", "dr", ",", " ", "rc", ",", " ", "f", ",", " ", "b1", ",", 
       " ", "b2", ",", " ", "b3", ",", " ", "b4", ",", " ", "Blocks", ",", 
       " ", "pneg", ",", " ", "ppos", ",", "bpos", ",", " ", "bneg", ",", "i",
        ",", " ", "BRCBlockShape", ",", " ", "BLCBlockShape", ",", " ", 
       "ULCBlockShape", ",", " ", "URCBlockShape", ",", " ", 
       "\[IndentingNewLine]", "PosMagErrorsBRC", " ", ",", " ", 
       "PosMagErrorsBLC", ",", " ", "PosMagErrorsULC", " ", ",", " ", 
       "PosMagErrorsURC", ",", "\[IndentingNewLine]", "\[Delta]P", ",", " ", 
       "\[Delta]GV", ",", " ", "\[Delta]GH", ",", " ", "\[Delta]CP", ",", 
       "Termination", ",", "\[IndentingNewLine]", " ", "BlockGap", ",", " ", 
       "\[Delta]BRC", ",", " ", "BRC", ",", " ", "\[Delta]BLC", ",", " ", 
       "BLC", ",", " ", "\[Delta]ULC", ",", " ", "ULC", ",", " ", 
       "\[Delta]URC", ",", " ", "URC", ",", " ", "Device", ",", " ", "t0", 
       ",", " ", "t1"}], "}"}], ",", "\[IndentingNewLine]", 
     "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"t0", "=", 
       RowBox[{"AbsoluteTime", "[", "]"}]}], ";", "\[IndentingNewLine]", 
      "\[IndentingNewLine]", 
      RowBox[{"(*", 
       RowBox[{"Delete", " ", "previous", " ", "Radia", " ", "objects"}], 
       "*)"}], "\[IndentingNewLine]", 
      RowBox[{"radUtiDelAll", "[", "]"}], ";", "\[IndentingNewLine]", 
      "\[IndentingNewLine]", 
      RowBox[{"(*", 
       RowBox[{"Check", " ", "arguments"}], "*)"}], "\[IndentingNewLine]", 
      RowBox[{"If", " ", "[", 
       RowBox[{
        RowBox[{"\[Lambda]u", " ", "\[LessEqual]", " ", "0"}], ",", " ", 
        RowBox[{"Return", "[", "]"}]}], "]"}], ";", "\[IndentingNewLine]", 
      RowBox[{"If", " ", "[", 
       RowBox[{
        RowBox[{"Np", " ", "\[LessEqual]", " ", "0"}], ",", " ", 
        RowBox[{"Return", "[", "]"}]}], "]"}], ";", "\[IndentingNewLine]", 
      RowBox[{"If", " ", "[", 
       RowBox[{
        RowBox[{"Br", " ", "\[LessEqual]", " ", "0"}], ",", " ", 
        RowBox[{"Return", "[", "]"}]}], "]"}], ";", "\[IndentingNewLine]", 
      RowBox[{"If", " ", "[", 
       RowBox[{
        RowBox[{"Gap", " ", "\[LessEqual]", " ", "0"}], ",", " ", 
        RowBox[{"Return", "[", "]"}]}], "]"}], ";", "\[IndentingNewLine]", 
      "\[IndentingNewLine]", 
      RowBox[{"(*", 
       RowBox[{"Gap", " ", "between", " ", "blocks"}], "*)"}], 
      "\[IndentingNewLine]", " ", 
      RowBox[{"BlockGap", " ", "=", " ", 
       RowBox[{"OptionValue", "[", "\"\<BlockGap\>\"", "]"}]}], ";", 
      "\[IndentingNewLine]", "\[IndentingNewLine]", 
      RowBox[{"(*", 
       RowBox[{"Cassettes", " ", "longitudinal", " ", 
        RowBox[{"displacement", " ", "[", "mm", "]"}]}], "*)"}], 
      "\[IndentingNewLine]", 
      RowBox[{"\[Delta]P", " ", "=", " ", 
       RowBox[{"OptionValue", "[", "\"\<\[Delta]P\>\"", "]"}]}], ";", " ", 
      RowBox[{"(*", 
       RowBox[{"Phase", " ", "adjustment"}], "*)"}], "\[IndentingNewLine]", 
      RowBox[{"\[Delta]GV", " ", "=", " ", 
       RowBox[{"OptionValue", "[", "\"\<\[Delta]GV\>\"", "]"}]}], ";", " ", 
      RowBox[{"(*", 
       RowBox[{
        RowBox[{
        "Vertical", " ", "field", " ", "amplitude", " ", "to", " ", 
         "longitudinal", " ", "field", " ", "amplitude"}], ",", " ", 
        RowBox[{
        "also", " ", "decreases", " ", "horizontal", " ", "field", " ", 
         "amplitude"}]}], "*)"}], "\[IndentingNewLine]", 
      RowBox[{"\[Delta]GH", " ", "=", " ", 
       RowBox[{"OptionValue", "[", "\"\<\[Delta]GH\>\"", "]"}]}], ";", 
      RowBox[{"(*", 
       RowBox[{
        RowBox[{
        "Horizontal", " ", "field", " ", "amplitude", " ", "to", " ", 
         "longitudinal", " ", "field", " ", "amplitude"}], ",", " ", 
        RowBox[{
        "also", " ", "decreases", " ", "vertical", " ", "field", " ", 
         "amplitude"}]}], "*)"}], "\[IndentingNewLine]", 
      RowBox[{"\[Delta]CP", " ", "=", " ", 
       RowBox[{"OptionValue", "[", "\"\<\[Delta]CP\>\"", "]"}]}], ";", 
      RowBox[{"(*", 
       RowBox[{"Inclined", " ", "polarization", " ", "adjustment"}], "*)"}], 
      "\[IndentingNewLine]", "\[IndentingNewLine]", 
      RowBox[{"(*", 
       RowBox[{"Termination", " ", "Type"}], "*)"}], "\[IndentingNewLine]", 
      RowBox[{"Termination", " ", "=", " ", 
       RowBox[{"OptionValue", "[", "\"\<Termination\>\"", "]"}]}], ";", 
      "\[IndentingNewLine]", "\[IndentingNewLine]", 
      RowBox[{"(*", 
       RowBox[{"Position", " ", "and", " ", "magnetization", " ", "errors"}], 
       "*)"}], "\[IndentingNewLine]", 
      RowBox[{"PosMagErrorsBRC", " ", "=", " ", 
       RowBox[{"OptionValue", "[", "\"\<PosMagErrorsBRC\>\"", "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"PosMagErrorsBLC", " ", "=", " ", 
       RowBox[{"OptionValue", "[", "\"\<PosMagErrorsBLC\>\"", "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"PosMagErrorsULC", " ", "=", " ", 
       RowBox[{"OptionValue", "[", "\"\<PosMagErrorsULC\>\"", "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"PosMagErrorsURC", " ", "=", " ", 
       RowBox[{"OptionValue", "[", "\"\<PosMagErrorsURC\>\"", "]"}]}], ";", 
      "\[IndentingNewLine]", "\[IndentingNewLine]", 
      RowBox[{"(*", 
       RowBox[{"Block", " ", "vertices"}], "*)"}], "\[IndentingNewLine]", 
      RowBox[{"r", " ", "=", " ", "2.5"}], ";", "\[IndentingNewLine]", 
      RowBox[{"f", " ", "=", " ", 
       RowBox[{"Gap", "/", 
        RowBox[{"(", 
         RowBox[{"2", "*", "r"}], ")"}]}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"dr", " ", "=", " ", "0.35"}], ";", "\[IndentingNewLine]", 
      RowBox[{"rc", " ", "=", " ", 
       RowBox[{"r", "-", "dr"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"b1", "=", " ", 
       RowBox[{"f", "*", 
        RowBox[{"{", 
         RowBox[{
          RowBox[{"{", 
           RowBox[{
            RowBox[{"-", "12.7"}], ",", " ", "15.20"}], "}"}], ",", " ", 
          RowBox[{"{", 
           RowBox[{"12.7", ",", " ", "15.20"}], "}"}], ",", " ", 
          RowBox[{"{", 
           RowBox[{"12.7", ",", "13.05"}], "}"}], ",", " ", 
          RowBox[{"{", 
           RowBox[{"rc", ",", " ", "r"}], "}"}], ",", " ", 
          RowBox[{"{", 
           RowBox[{
            RowBox[{"-", "rc"}], ",", " ", "r"}], "}"}], ",", " ", 
          RowBox[{"{", 
           RowBox[{
            RowBox[{"-", "12.7"}], ",", " ", "13.05"}], "}"}]}], "}"}]}]}], 
      ";", "\[IndentingNewLine]", 
      RowBox[{"b2", " ", "=", " ", 
       RowBox[{"f", "*", 
        RowBox[{"{", 
         RowBox[{
          RowBox[{"{", "  ", 
           RowBox[{"rc", ",", " ", "r"}], " ", "}"}], ",", " ", 
          RowBox[{"{", "   ", 
           RowBox[{
            RowBox[{"rc", "*", 
             RowBox[{"Sin", "[", 
              RowBox[{"\[Pi]", "/", "4"}], "]"}]}], ",", " ", "r"}], "}"}], 
          ",", " ", 
          RowBox[{"{", "   ", 
           RowBox[{
            RowBox[{"rc", "*", 
             RowBox[{"Sin", "[", 
              RowBox[{"\[Pi]", "/", "4"}], "]"}]}], ",", " ", 
            RowBox[{
             RowBox[{"rc", "*", 
              RowBox[{"Cos", "[", 
               RowBox[{"\[Pi]", "/", "4"}], "]"}]}], "+", "dr"}]}], " ", 
           "}"}]}], "}"}]}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"b3", " ", "=", " ", 
       RowBox[{"f", "*", 
        RowBox[{"{", 
         RowBox[{
          RowBox[{"{", 
           RowBox[{
            RowBox[{"-", "rc"}], ",", " ", "r"}], " ", "}"}], ",", " ", 
          RowBox[{"{", 
           RowBox[{
            RowBox[{
             RowBox[{"-", "rc"}], "*", 
             RowBox[{"Sin", "[", 
              RowBox[{"\[Pi]", "/", "4"}], "]"}]}], ",", " ", "r"}], "}"}], 
          ",", " ", 
          RowBox[{"{", 
           RowBox[{
            RowBox[{
             RowBox[{"-", "rc"}], "*", 
             RowBox[{"Sin", "[", 
              RowBox[{"\[Pi]", "/", "4"}], "]"}]}], ",", "  ", 
            RowBox[{
             RowBox[{"rc", "*", 
              RowBox[{"Cos", "[", 
               RowBox[{"\[Pi]", "/", "4"}], "]"}]}], "+", "dr"}]}], " ", 
           "}"}]}], "}"}]}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"Blocks", " ", "=", 
       RowBox[{"{", 
        RowBox[{"b1", ",", " ", "b2", ",", " ", "b3"}], "}"}]}], ";", 
      "\[IndentingNewLine]", "\[IndentingNewLine]", 
      RowBox[{"n\[Theta]", " ", "=", " ", "10"}], ";", "\[IndentingNewLine]", 
      RowBox[{"\[Theta]", " ", "=", " ", 
       RowBox[{"Range", "[", 
        RowBox[{
         RowBox[{"\[Pi]", "/", "2"}], ",", " ", 
         RowBox[{"\[Pi]", "/", "4"}], ",", "  ", 
         RowBox[{
          RowBox[{"-", 
           RowBox[{"(", 
            RowBox[{"\[Pi]", "/", "4"}], ")"}]}], "/", 
          RowBox[{"(", 
           RowBox[{"n\[Theta]", "-", "1"}], ")"}]}]}], "]"}]}], ";", 
      "\[IndentingNewLine]", "\[IndentingNewLine]", 
      RowBox[{"AppendTo", "[", 
       RowBox[{"Blocks", ",", " ", 
        RowBox[{"f", "*", 
         RowBox[{"{", 
          RowBox[{
           RowBox[{"{", 
            RowBox[{"0", ",", " ", "r"}], "}"}], ",", " ", 
           RowBox[{"{", 
            RowBox[{
             RowBox[{"rc", "*", 
              RowBox[{"Cos", "[", 
               RowBox[{"\[Pi]", "-", 
                RowBox[{"\[Theta]", "[", 
                 RowBox[{"[", "2", "]"}], "]"}]}], "]"}]}], ",", " ", 
             RowBox[{
              RowBox[{"rc", "*", 
               RowBox[{"Sin", "[", 
                RowBox[{"\[Pi]", "-", 
                 RowBox[{"\[Theta]", "[", 
                  RowBox[{"[", "2", "]"}], "]"}]}], "]"}]}], "+", "dr"}]}], 
            "}"}], ",", " ", 
           RowBox[{"{", 
            RowBox[{
             RowBox[{"rc", "*", 
              RowBox[{"Cos", "[", 
               RowBox[{"\[Pi]", "-", 
                RowBox[{"\[Theta]", "[", 
                 RowBox[{"[", "2", "]"}], "]"}]}], "]"}]}], ",", " ", "r"}], 
            "}"}]}], "}"}]}]}], "]"}], ";", "\[IndentingNewLine]", 
      RowBox[{"pneg", " ", "=", " ", 
       RowBox[{"{", 
        RowBox[{
         RowBox[{"rc", "*", 
          RowBox[{"Cos", "[", 
           RowBox[{"\[Pi]", "-", 
            RowBox[{"\[Theta]", "[", 
             RowBox[{"[", "2", "]"}], "]"}]}], "]"}]}], ",", " ", "r"}], 
        "}"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"AppendTo", "[", 
       RowBox[{"Blocks", ",", " ", 
        RowBox[{"f", "*", 
         RowBox[{"{", 
          RowBox[{
           RowBox[{"{", 
            RowBox[{"0", ",", " ", "r"}], "}"}], ",", " ", 
           RowBox[{"{", 
            RowBox[{
             RowBox[{"rc", "*", 
              RowBox[{"Cos", "[", 
               RowBox[{"\[Theta]", "[", 
                RowBox[{"[", "2", "]"}], "]"}], "]"}]}], ",", " ", 
             RowBox[{
              RowBox[{"rc", "*", 
               RowBox[{"Sin", "[", 
                RowBox[{"\[Theta]", "[", 
                 RowBox[{"[", "2", "]"}], "]"}], "]"}]}], "+", " ", "dr"}]}], 
            "}"}], ",", " ", 
           RowBox[{"{", 
            RowBox[{
             RowBox[{"rc", "*", 
              RowBox[{"Cos", "[", 
               RowBox[{"\[Theta]", "[", 
                RowBox[{"[", "2", "]"}], "]"}], "]"}]}], ",", " ", "r"}], 
            "}"}]}], "}"}]}]}], "]"}], ";", "\[IndentingNewLine]", 
      RowBox[{"ppos", " ", "=", 
       RowBox[{"{", 
        RowBox[{
         RowBox[{"rc", "*", 
          RowBox[{"Cos", "[", 
           RowBox[{"\[Theta]", "[", 
            RowBox[{"[", "2", "]"}], "]"}], "]"}]}], ",", " ", "r"}], "}"}]}],
       ";", " ", "\[IndentingNewLine]", "\[IndentingNewLine]", 
      RowBox[{"For", " ", "[", 
       RowBox[{
        RowBox[{"i", "=", "3"}], ",", " ", 
        RowBox[{"i", "\[LessEqual]", 
         RowBox[{"Length", "[", "\[Theta]", "]"}]}], ",", " ", 
        RowBox[{"i", "++"}], ",", " ", "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"bpos", " ", "=", " ", 
          RowBox[{"f", "*", 
           RowBox[{"{", 
            RowBox[{"ppos", ",", " ", 
             RowBox[{"{", 
              RowBox[{
               RowBox[{"rc", "*", 
                RowBox[{"Cos", "[", 
                 RowBox[{"\[Theta]", "[", 
                  RowBox[{"[", 
                   RowBox[{"i", "-", "1"}], "]"}], "]"}], "]"}]}], ",", " ", 
               RowBox[{
                RowBox[{"rc", "*", 
                 RowBox[{"Sin", "[", 
                  RowBox[{"\[Theta]", "[", 
                   RowBox[{"[", 
                    RowBox[{"i", "-", "1"}], "]"}], "]"}], "]"}]}], "+", 
                "dr"}]}], "}"}], ",", " ", 
             RowBox[{"{", 
              RowBox[{
               RowBox[{"rc", "*", 
                RowBox[{"Cos", "[", 
                 RowBox[{"\[Theta]", "[", 
                  RowBox[{"[", "i", "]"}], "]"}], "]"}]}], ",", " ", 
               RowBox[{
                RowBox[{"rc", "*", 
                 RowBox[{"Sin", "[", 
                  RowBox[{"\[Theta]", "[", 
                   RowBox[{"[", "i", "]"}], "]"}], "]"}]}], "+", "dr"}]}], 
              "}"}], ",", " ", 
             RowBox[{"{", 
              RowBox[{
               RowBox[{"rc", "*", 
                RowBox[{"Cos", "[", 
                 RowBox[{"\[Theta]", "[", 
                  RowBox[{"[", "i", "]"}], "]"}], "]"}]}], ",", " ", "r"}], 
              "}"}]}], "}"}]}]}], ";", "\[IndentingNewLine]", 
         RowBox[{"ppos", " ", "=", " ", 
          RowBox[{"{", 
           RowBox[{
            RowBox[{"rc", "*", 
             RowBox[{"Cos", "[", 
              RowBox[{"\[Theta]", "[", 
               RowBox[{"[", "i", "]"}], "]"}], "]"}]}], ",", " ", "r"}], 
           "}"}]}], ";", "\[IndentingNewLine]", 
         RowBox[{"AppendTo", "[", 
          RowBox[{"Blocks", ",", "bpos"}], "]"}], ";", "\[IndentingNewLine]", 
         RowBox[{"bneg", " ", "=", " ", 
          RowBox[{"f", "*", 
           RowBox[{"{", 
            RowBox[{"pneg", ",", " ", 
             RowBox[{"{", 
              RowBox[{
               RowBox[{"rc", "*", 
                RowBox[{"Cos", "[", 
                 RowBox[{"\[Pi]", "-", 
                  RowBox[{"\[Theta]", "[", 
                   RowBox[{"[", 
                    RowBox[{"i", "-", "1"}], "]"}], "]"}]}], "]"}]}], ",", 
               " ", 
               RowBox[{
                RowBox[{"rc", "*", 
                 RowBox[{"Sin", "[", 
                  RowBox[{"\[Pi]", "-", 
                   RowBox[{"\[Theta]", "[", 
                    RowBox[{"[", 
                    RowBox[{"i", "-", "1"}], "]"}], "]"}]}], "]"}]}], "+", 
                "dr"}]}], "}"}], ",", " ", 
             RowBox[{"{", 
              RowBox[{
               RowBox[{"rc", "*", 
                RowBox[{"Cos", "[", 
                 RowBox[{"\[Pi]", "-", 
                  RowBox[{"\[Theta]", "[", 
                   RowBox[{"[", "i", "]"}], "]"}]}], "]"}]}], ",", " ", 
               RowBox[{
                RowBox[{"rc", "*", 
                 RowBox[{"Sin", "[", 
                  RowBox[{"\[Pi]", "-", 
                   RowBox[{"\[Theta]", "[", 
                    RowBox[{"[", "i", "]"}], "]"}]}], "]"}]}], "+", "dr"}]}], 
              "}"}], ",", " ", 
             RowBox[{"{", 
              RowBox[{
               RowBox[{"rc", "*", 
                RowBox[{"Cos", "[", 
                 RowBox[{"\[Pi]", "-", 
                  RowBox[{"\[Theta]", "[", 
                   RowBox[{"[", "i", "]"}], "]"}]}], "]"}]}], ",", " ", "r"}],
               "}"}]}], "}"}]}]}], ";", "\[IndentingNewLine]", 
         RowBox[{"pneg", " ", "=", 
          RowBox[{"{", 
           RowBox[{
            RowBox[{"rc", "*", 
             RowBox[{"Cos", "[", 
              RowBox[{"\[Pi]", "-", 
               RowBox[{"\[Theta]", "[", 
                RowBox[{"[", "i", "]"}], "]"}]}], "]"}]}], ",", " ", "r"}], 
           "}"}]}], ";", "\[IndentingNewLine]", 
         RowBox[{"AppendTo", "[", 
          RowBox[{"Blocks", ",", " ", "bneg"}], "]"}], ";"}]}], 
       "\[IndentingNewLine]", "]"}], ";", "\[IndentingNewLine]", 
      "\[IndentingNewLine]", 
      RowBox[{"(*", 
       RowBox[{
       "Block", " ", "vertices", " ", "for", " ", "each", " ", "cassette", 
        " ", 
        RowBox[{"(", 
         RowBox[{
         "cross", " ", "section", " ", "in", " ", "the", " ", "xy", " ", 
          "plane"}], ")"}]}], "*)"}], "\[IndentingNewLine]", 
      RowBox[{"URCBlockShape", " ", "=", "Blocks"}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"ULCBlockShape", " ", "=", " ", 
       RowBox[{
        RowBox[{
         RowBox[{
          RowBox[{
           RowBox[{"Dot", "[", 
            RowBox[{
             RowBox[{"RotationMatrix", "[", 
              RowBox[{"\[Pi]", "/", "2"}], "]"}], ",", "#"}], "]"}], "&"}], "/@",
           "#"}], "&"}], "/@", "URCBlockShape"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"BLCBlockShape", " ", "=", " ", 
       RowBox[{
        RowBox[{
         RowBox[{
          RowBox[{
           RowBox[{"Dot", "[", 
            RowBox[{
             RowBox[{"RotationMatrix", "[", 
              RowBox[{"\[Pi]", "/", "2"}], "]"}], ",", "#"}], "]"}], "&"}], "/@",
           "#"}], "&"}], "/@", "ULCBlockShape"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"BRCBlockShape", " ", "=", " ", 
       RowBox[{
        RowBox[{
         RowBox[{
          RowBox[{
           RowBox[{"Dot", "[", 
            RowBox[{
             RowBox[{"RotationMatrix", "[", 
              RowBox[{"\[Pi]", "/", "2"}], "]"}], ",", "#"}], "]"}], "&"}], "/@",
           "#"}], "&"}], "/@", "BLCBlockShape"}]}], ";", 
      "\[IndentingNewLine]", "\[IndentingNewLine]", 
      RowBox[{"(*", "Cassettes", "*)"}], "\[IndentingNewLine]", 
      RowBox[{"\[Delta]URC", " ", "=", "\[Delta]GV"}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"URC", " ", "=", " ", 
       RowBox[{"auxIDCassette", "[", 
        RowBox[{
        "\[Lambda]u", ",", " ", "Np", ",", " ", "Br", ",", "\[Delta]URC", ",",
          " ", "URCBlockShape", ",", 
         RowBox[{"\"\<BlockGap\>\"", "\[Rule]", " ", "BlockGap"}], ",", " ", 
         RowBox[{"\"\<Termination\>\"", "\[Rule]", " ", "Termination"}], ",", 
         " ", " ", 
         RowBox[{"\"\<PointingUp\>\"", "\[Rule]", " ", "False"}], ",", 
         RowBox[{"\"\<FirstBlock\>\"", "\[Rule]", " ", "\"\<Up\>\""}], ",", 
         RowBox[{
         "\"\<FieldDirection\>\"", "\[Rule]", " ", "\"\<Vertical\>\""}], ",", 
         RowBox[{
         "\"\<PosMagErrors\>\"", "\[Rule]", " ", "PosMagErrorsURC"}]}], 
        "]"}]}], ";", "\[IndentingNewLine]", "\[IndentingNewLine]", 
      RowBox[{"\[Delta]ULC", " ", "=", " ", 
       RowBox[{
       "\[Delta]GV", "+", " ", "\[Delta]GH", "+", " ", "\[Delta]P", "+", 
        "\[Delta]CP"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"ULC", " ", "=", " ", 
       RowBox[{"auxIDCassette", "[", 
        RowBox[{
        "\[Lambda]u", ",", " ", "Np", ",", " ", "Br", ",", "\[Delta]ULC", ",",
          " ", "ULCBlockShape", ",", " ", 
         RowBox[{"\"\<BlockGap\>\"", "\[Rule]", " ", "BlockGap"}], ",", " ", 
         RowBox[{"\"\<Termination\>\"", "\[Rule]", " ", "Termination"}], ",", 
         " ", " ", 
         RowBox[{"\"\<PointingUp\>\"", "\[Rule]", " ", "True"}], ",", 
         RowBox[{"\"\<FirstBlock\>\"", "\[Rule]", " ", "\"\<Down\>\""}], ",", 
         " ", 
         RowBox[{
         "\"\<FieldDirection\>\"", "\[Rule]", " ", "\"\<Horizontal\>\""}], 
         ",", 
         RowBox[{
         "\"\<PosMagErrors\>\"", "\[Rule]", " ", "PosMagErrorsULC"}]}], 
        "]"}]}], ";", "\[IndentingNewLine]", "\[IndentingNewLine]", 
      RowBox[{"\[Delta]BLC", " ", "=", "\[Delta]GH"}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"BLC", " ", "=", " ", 
       RowBox[{"auxIDCassette", "[", 
        RowBox[{
        "\[Lambda]u", ",", " ", "Np", ",", " ", "Br", ",", "\[Delta]BLC", ",",
          " ", "BLCBlockShape", ",", " ", 
         RowBox[{"\"\<BlockGap\>\"", "\[Rule]", " ", "BlockGap"}], ",", " ", 
         RowBox[{"\"\<Termination\>\"", "\[Rule]", " ", "Termination"}], ",", 
         " ", " ", 
         RowBox[{"\"\<PointingUp\>\"", "\[Rule]", " ", "True"}], ",", 
         RowBox[{"\"\<FirstBlock\>\"", "\[Rule]", " ", "\"\<Up\>\""}], ",", 
         " ", 
         RowBox[{
         "\"\<FieldDirection\>\"", "\[Rule]", " ", "\"\<Vertical\>\""}], ",", 
         " ", 
         RowBox[{
         "\"\<PosMagErrors\>\"", "\[Rule]", " ", "PosMagErrorsBLC"}]}], 
        "]"}]}], ";", "\[IndentingNewLine]", "\[IndentingNewLine]", 
      RowBox[{"\[Delta]BRC", " ", "=", 
       RowBox[{"\[Delta]P", "-", "\[Delta]CP"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"BRC", " ", "=", 
       RowBox[{"auxIDCassette", "[", 
        RowBox[{
        "\[Lambda]u", ",", " ", "Np", ",", " ", "Br", ",", " ", "\[Delta]BRC",
          ",", "BRCBlockShape", ",", 
         RowBox[{"\"\<BlockGap\>\"", "\[Rule]", " ", "BlockGap"}], ",", " ", 
         RowBox[{"\"\<Termination\>\"", "\[Rule]", " ", "Termination"}], ",", 
         " ", " ", 
         RowBox[{"\"\<PointingUp\>\"", "\[Rule]", "False"}], ",", " ", 
         RowBox[{"\"\<FirstBlock\>\"", "\[Rule]", " ", "\"\<Down\>\""}], ",", 
         " ", 
         RowBox[{
         "\"\<FieldDirection\>\"", "\[Rule]", " ", "\"\<Horizontal\>\""}], 
         ",", 
         RowBox[{
         "\"\<PosMagErrors\>\"", "\[Rule]", " ", "PosMagErrorsBRC"}]}], 
        "]"}]}], ";", "\[IndentingNewLine]", "\[IndentingNewLine]", 
      RowBox[{"(*", 
       RowBox[{"Insertion", " ", "device"}], "*)"}], "\[IndentingNewLine]", 
      RowBox[{"Device", " ", "=", " ", 
       RowBox[{"radObjCnt", "[", 
        RowBox[{"{", 
         RowBox[{"BRC", ",", " ", "BLC", ",", " ", "ULC", ",", " ", "URC"}], 
         "}"}], "]"}]}], ";", "\[IndentingNewLine]", "\[IndentingNewLine]", 
      RowBox[{"t1", "=", 
       RowBox[{"AbsoluteTime", "[", "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"Print", "[", 
       RowBox[{"\"\<IDDeltaCornell: elapsed time = \>\"", ",", 
        RowBox[{"(", 
         RowBox[{"t1", "-", "t0"}], ")"}], ",", "\"\< s\>\""}], "]"}], ";", 
      "\[IndentingNewLine]", "\[IndentingNewLine]", 
      RowBox[{"Return", "[", "Device", "]"}], ";"}]}], "\[IndentingNewLine]", 
    "]"}]}], ";"}]}], "Input",
 CellChangeTimes->{{3.766402099935676*^9, 3.766402100922615*^9}, {
   3.766402258253394*^9, 3.766402468375741*^9}, {3.766402720530408*^9, 
   3.766402907050172*^9}, {3.7664029812222176`*^9, 3.766403182172817*^9}, {
   3.7667545058427196`*^9, 3.7667545075459843`*^9}, {3.766754544736413*^9, 
   3.766754588427339*^9}, {3.766757067645253*^9, 3.766757103507449*^9}, {
   3.766758395016309*^9, 3.76675840983173*^9}, {3.767445985793868*^9, 
   3.767445990278596*^9}, {3.767448133520872*^9, 3.7674481585853477`*^9}, {
   3.76751864301694*^9, 3.767518729052259*^9}, {3.767518981823285*^9, 
   3.767518993524044*^9}, {3.7826505770239964`*^9, 3.7826506586643*^9}, {
   3.7826528284062023`*^9, 3.78265283187493*^9}, {3.7826593620918827`*^9, 
   3.78265936863873*^9}, 3.7849749189469023`*^9},
 Background->RGBColor[0.87, 0.94, 1],
 CellLabel->"In[56]:=",ExpressionUUID->"778bb8a1-ed2a-40f7-a5ff-9f56a387487c"]
}, Closed]]
}, Open  ]],

Cell[CellGroupData[{

Cell["EPU", "Section",
 CellChangeTimes->{{3.7663980882406*^9, 
  3.7663980966536646`*^9}},ExpressionUUID->"a1f33211-caca-4b56-88a4-\
df9d67c4649f"],

Cell[CellGroupData[{

Cell["IDRectangularEPU", "Subsection",
 CellChangeTimes->{{3.766754657792163*^9, 
  3.7667546656521573`*^9}},ExpressionUUID->"a29e33d6-c9ef-4dfa-b3b6-\
7a8ca89eed73"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"IDRectangularEPU", "::", "usage"}], "=", 
    "\"\<IDRectangularEPU[\[Lambda]u, Np, Br, Gap, \\\"\[Delta]P\\\":0, \\\"\
\[Delta]CP\\\":0, \\\"BlockGap\\\":0, \\\"BlockWidth\\\":gap, \\\"BlockHeight\
\\\":gap, \\\"Termination\\\":\\\"None\\\", \\\"PosMagErrorsBRC\\\"\[Rule] \
{}, \\\"PosMagErrorsBLC\\\"\[Rule] {}, \\\"PosMagErrorsULC\\\"\[Rule] {}, \
\\\"PosMagErrorsURC\\\"\[Rule] {}]: Returns the ID model. \\n\\nArgs: \\n\
\[Lambda]u [mm] is the ID period, \\nNp is the number of periods, \\nBr [T] \
is the remanent magnetization of the permanent magnet blocks, \\nGap [mm] is \
the length of the minimum gap between the cassettes. \\n\\nOptional args: \\n\
\[Delta]P [mm] is the phase adjustement and \[Delta]CP [mm] is the \
inclined-polarization adjustment, \\nBlockGap [mm] is the longitudinal gap \
between the blocks, \\nBlockWidth [mm] is the block width, \\nBlockHeight \
[mm] is the block height, \\nTermination is the termination type (one of the \
following: None, OneBlockSym, OneBlockAntiSym, ThreeBlocksSym, \
ThreeBlocksAntiSym), \\nPosMagErrorsBRC is a list of positions and \
magnetization errors for the BR cassette, \\nPosMagErrorsBLC is a list of \
positions and magnetization errors for the BL cassette, \\nPosMagErrorsULC is \
a list of positions and magnetization errors for the UL cassette, \
\\nPosMagErrorsURC is a list of positions and magnetization errors for the UR \
cassette. \\n\\nPosition and magnetization errors: \\nThe list of position \
and magnetization errors must be empty or have a number of elements igual to \
the number of blocks on each cassette. Each element is a list with position \
and magnetization errors in the following format: \\n{{horizontal position \
error[mm], vertical position error[mm], longitudinal position error[mm]}, \
{horizontal magnetization error[T], vertical magnetization error[T], \
longitudinal magnetization error[T]}}. \\nThe errors will be add to the \
default values of position and magnetization of the blocks.\>\""}], ";"}], 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"IDRectangularEPU", "[", 
    RowBox[{
    "\[Lambda]u_", ",", " ", "Np_", ",", " ", "Br_", ",", " ", "Gap_", ",", 
     " ", 
     RowBox[{"OptionsPattern", "[", 
      RowBox[{"{", 
       RowBox[{
        RowBox[{"\"\<\[Delta]P\>\"", "\[Rule]", " ", "0"}], ",", 
        RowBox[{"\"\<\[Delta]CP\>\"", "\[Rule]", " ", "0"}], ",", " ", 
        RowBox[{"\"\<BlockGap\>\"", "->", "0"}], ",", " ", 
        RowBox[{"\"\<BlockWidth\>\"", "\[Rule]", " ", "\"\<default\>\""}], 
        ",", " ", 
        RowBox[{"\"\<BlockHeight\>\"", "\[Rule]", " ", "\"\<default\>\""}], 
        ",", " ", 
        RowBox[{"\"\<Termination\>\"", "\[Rule]", " ", "\"\<None\>\""}], ",", 
        " ", 
        RowBox[{"\"\<PosMagErrorsBRC\>\"", "\[Rule]", " ", 
         RowBox[{"{", "}"}]}], ",", " ", 
        RowBox[{"\"\<PosMagErrorsBLC\>\"", "\[Rule]", " ", 
         RowBox[{"{", "}"}]}], ",", " ", 
        RowBox[{"\"\<PosMagErrorsULC\>\"", "\[Rule]", " ", 
         RowBox[{"{", "}"}]}], ",", " ", 
        RowBox[{"\"\<PosMagErrorsURC\>\"", "\[Rule]", " ", 
         RowBox[{"{", "}"}]}]}], "}"}], "]"}]}], "]"}], " ", ":=", " ", 
   RowBox[{"Module", "[", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
      "Termination", ",", " ", "Width", ",", "Height", ",", " ", 
       "BRCBlockShape", ",", " ", "BLCBlockShape", ",", " ", "ULCBlockShape", 
       ",", " ", "URCBlockShape", ",", "\[IndentingNewLine]", 
       "PosMagErrorsBRC", " ", ",", " ", "PosMagErrorsBLC", ",", " ", 
       "PosMagErrorsULC", " ", ",", " ", "PosMagErrorsURC", ",", 
       "\[IndentingNewLine]", "BlockGap", ",", "\[Delta]P", ",", " ", 
       "\[Delta]CP", ",", " ", "\[Delta]BRC", ",", " ", "BRC", ",", " ", 
       "\[Delta]BLC", ",", " ", "BLC", ",", " ", "\[Delta]ULC", ",", " ", 
       "ULC", ",", " ", "\[Delta]URC", ",", " ", "URC", ",", " ", "Device", 
       ",", " ", "t0", ",", " ", "t1"}], "}"}], ",", "\[IndentingNewLine]", 
     "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"t0", "=", 
       RowBox[{"AbsoluteTime", "[", "]"}]}], ";", "\[IndentingNewLine]", 
      "\[IndentingNewLine]", 
      RowBox[{"(*", 
       RowBox[{"Delete", " ", "previous", " ", "Radia", " ", "objects"}], 
       "*)"}], "\[IndentingNewLine]", 
      RowBox[{"radUtiDelAll", "[", "]"}], ";", "\[IndentingNewLine]", 
      "\[IndentingNewLine]", 
      RowBox[{"(*", 
       RowBox[{"Check", " ", "arguments"}], "*)"}], "\[IndentingNewLine]", 
      RowBox[{"If", " ", "[", 
       RowBox[{
        RowBox[{"\[Lambda]u", " ", "\[LessEqual]", " ", "0"}], ",", " ", 
        RowBox[{"Return", "[", "]"}]}], "]"}], ";", "\[IndentingNewLine]", 
      RowBox[{"If", " ", "[", 
       RowBox[{
        RowBox[{"Np", " ", "\[LessEqual]", " ", "0"}], ",", " ", 
        RowBox[{"Return", "[", "]"}]}], "]"}], ";", "\[IndentingNewLine]", 
      RowBox[{"If", " ", "[", 
       RowBox[{
        RowBox[{"Br", " ", "\[LessEqual]", " ", "0"}], ",", " ", 
        RowBox[{"Return", "[", "]"}]}], "]"}], ";", "\[IndentingNewLine]", 
      RowBox[{"If", " ", "[", 
       RowBox[{
        RowBox[{"Gap", " ", "\[LessEqual]", " ", "0"}], ",", " ", 
        RowBox[{"Return", "[", "]"}]}], "]"}], ";", "\[IndentingNewLine]", 
      "\[IndentingNewLine]", 
      RowBox[{"(*", 
       RowBox[{"Gap", " ", "between", " ", "blocks"}], "*)"}], 
      "\[IndentingNewLine]", 
      RowBox[{"BlockGap", " ", "=", "  ", 
       RowBox[{"OptionValue", "[", "\"\<BlockGap\>\"", "]"}]}], ";", 
      "\[IndentingNewLine]", "\[IndentingNewLine]", 
      RowBox[{"(*", 
       RowBox[{"Block", " ", "size"}], "*)"}], "\[IndentingNewLine]", 
      RowBox[{"Height", " ", "=", 
       RowBox[{"If", "[", 
        RowBox[{
         RowBox[{
          RowBox[{"OptionValue", "[", "\"\<BlockHeight\>\"", "]"}], " ", 
          "\[Equal]", " ", "\"\<default\>\""}], ",", " ", "Gap", ",", 
         RowBox[{"OptionValue", "[", "\"\<BlockHeight\>\"", "]"}]}], " ", 
        "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"Width", " ", "=", "  ", 
       RowBox[{"If", "[", 
        RowBox[{
         RowBox[{
          RowBox[{"OptionValue", "[", "\"\<BlockWidth\>\"", "]"}], 
          "\[Equal]", "\"\<default\>\""}], ",", " ", "Gap", ",", 
         RowBox[{"OptionValue", "[", "\"\<BlockWidth\>\"", "]"}]}], "]"}]}], 
      " ", ";", "\[IndentingNewLine]", 
      RowBox[{"If", "[", 
       RowBox[{
        RowBox[{
         RowBox[{"Height", "\[LessEqual]", "0"}], " ", "||", " ", 
         RowBox[{"Width", " ", "\[LessEqual]", "0"}]}], ",", " ", 
        RowBox[{"Return", "[", "]"}]}], "]"}], ";", "\[IndentingNewLine]", 
      "\[IndentingNewLine]", 
      RowBox[{"(*", 
       RowBox[{"Cassettes", " ", "longitudinal", " ", 
        RowBox[{"displacement", " ", "[", "mm", "]"}]}], "*)"}], 
      "\[IndentingNewLine]", 
      RowBox[{"\[Delta]P", " ", "=", " ", 
       RowBox[{"OptionValue", "[", "\"\<\[Delta]P\>\"", "]"}]}], ";", " ", 
      RowBox[{"(*", 
       RowBox[{"Phase", " ", "adjustment"}], "*)"}], "\[IndentingNewLine]", 
      RowBox[{"\[Delta]CP", " ", "=", " ", 
       RowBox[{"OptionValue", "[", "\"\<\[Delta]CP\>\"", "]"}]}], ";", 
      RowBox[{"(*", 
       RowBox[{"Inclined", " ", "polarization", " ", "adjustment"}], "*)"}], 
      "\[IndentingNewLine]", "\[IndentingNewLine]", 
      RowBox[{"(*", 
       RowBox[{"Termination", " ", "Type"}], "*)"}], "\[IndentingNewLine]", 
      RowBox[{"Termination", " ", "=", " ", 
       RowBox[{"OptionValue", "[", "\"\<Termination\>\"", "]"}]}], ";", 
      "\[IndentingNewLine]", "\[IndentingNewLine]", 
      RowBox[{"(*", 
       RowBox[{"Position", " ", "and", " ", "magnetization", " ", "errors"}], 
       "*)"}], "\[IndentingNewLine]", 
      RowBox[{"PosMagErrorsBRC", " ", "=", " ", 
       RowBox[{"OptionValue", "[", "\"\<PosMagErrorsBRC\>\"", "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"PosMagErrorsBLC", " ", "=", " ", 
       RowBox[{"OptionValue", "[", "\"\<PosMagErrorsBLC\>\"", "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"PosMagErrorsULC", " ", "=", " ", 
       RowBox[{"OptionValue", "[", "\"\<PosMagErrorsULC\>\"", "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"PosMagErrorsURC", " ", "=", " ", 
       RowBox[{"OptionValue", "[", "\"\<PosMagErrorsURC\>\"", "]"}]}], ";", 
      "\[IndentingNewLine]", "\[IndentingNewLine]", 
      RowBox[{"(*", 
       RowBox[{
       "Block", " ", "vertices", " ", "for", " ", "each", " ", "cassette", 
        " ", 
        RowBox[{"(", 
         RowBox[{
         "cross", " ", "section", " ", "in", " ", "the", " ", "xz", " ", 
          "plane"}], ")"}]}], "*)"}], "\[IndentingNewLine]", 
      RowBox[{"URCBlockShape", "=", 
       RowBox[{"{", 
        RowBox[{
         RowBox[{"{", " ", 
          RowBox[{"0", ",", " ", 
           RowBox[{"Gap", "/", "2"}]}], "}"}], ",", 
         RowBox[{"{", 
          RowBox[{"0", ",", " ", 
           RowBox[{
            RowBox[{"Gap", "/", "2"}], " ", "+", "Height"}]}], "}"}], ",", 
         RowBox[{"{", " ", 
          RowBox[{"Width", ",", " ", 
           RowBox[{
            RowBox[{"Gap", "/", "2"}], "+", "Height"}]}], "}"}], ",", 
         RowBox[{"{", " ", 
          RowBox[{"Width", ",", 
           RowBox[{"Gap", "/", "2"}]}], "}"}]}], "}"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"ULCBlockShape", "=", 
       RowBox[{"{", 
        RowBox[{
         RowBox[{"{", " ", 
          RowBox[{"0", ",", " ", 
           RowBox[{"Gap", "/", "2"}]}], "}"}], ",", 
         RowBox[{"{", 
          RowBox[{"0", ",", " ", 
           RowBox[{
            RowBox[{"Gap", "/", "2"}], " ", "+", "Height"}]}], "}"}], ",", 
         RowBox[{"{", 
          RowBox[{
           RowBox[{"-", "Width"}], ",", " ", 
           RowBox[{
            RowBox[{"Gap", "/", "2"}], "+", "Height"}]}], "}"}], ",", 
         RowBox[{"{", 
          RowBox[{
           RowBox[{"-", "Width"}], ",", 
           RowBox[{"Gap", "/", "2"}]}], "}"}]}], "}"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"BLCBlockShape", "=", 
       RowBox[{"{", 
        RowBox[{
         RowBox[{"{", " ", 
          RowBox[{"0", ",", 
           RowBox[{
            RowBox[{"-", "Gap"}], "/", "2"}]}], "}"}], ",", 
         RowBox[{"{", 
          RowBox[{"0", ",", 
           RowBox[{
            RowBox[{
             RowBox[{"-", "Gap"}], "/", "2"}], " ", "-", "Height"}]}], "}"}], 
         ",", 
         RowBox[{"{", 
          RowBox[{
           RowBox[{"-", "Width"}], ",", 
           RowBox[{
            RowBox[{
             RowBox[{"-", "Gap"}], "/", "2"}], "-", "Height"}]}], "}"}], ",", 
         RowBox[{"{", 
          RowBox[{
           RowBox[{"-", "Width"}], ",", 
           RowBox[{
            RowBox[{"-", "Gap"}], "/", "2"}]}], "}"}]}], "}"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"BRCBlockShape", "=", 
       RowBox[{"{", 
        RowBox[{
         RowBox[{"{", " ", 
          RowBox[{"0", ",", 
           RowBox[{
            RowBox[{"-", "Gap"}], "/", "2"}]}], "}"}], ",", 
         RowBox[{"{", 
          RowBox[{"0", ",", 
           RowBox[{
            RowBox[{
             RowBox[{"-", "Gap"}], "/", "2"}], " ", "-", "Height"}]}], "}"}], 
         ",", 
         RowBox[{"{", " ", 
          RowBox[{"Width", ",", 
           RowBox[{
            RowBox[{
             RowBox[{"-", "Gap"}], "/", "2"}], "-", "Height"}]}], "}"}], ",", 
         RowBox[{"{", " ", 
          RowBox[{"Width", ",", 
           RowBox[{
            RowBox[{"-", "Gap"}], "/", "2"}]}], "}"}]}], "}"}]}], ";", 
      "\[IndentingNewLine]", "\[IndentingNewLine]", 
      RowBox[{"(*", "Cassettes", "*)"}], "\[IndentingNewLine]", 
      RowBox[{"\[Delta]URC", "=", " ", "0.0"}], ";", "\[IndentingNewLine]", 
      RowBox[{"URC", " ", "=", " ", 
       RowBox[{"auxIDCassette", "[", 
        RowBox[{
        "\[Lambda]u", ",", " ", "Np", ",", "Br", ",", " ", "\[Delta]URC", ",",
          " ", "URCBlockShape", ",", 
         RowBox[{"\"\<Rectangular\>\"", "\[Rule]", " ", "True"}], ",", " ", 
         RowBox[{"\"\<BlockGap\>\"", "\[Rule]", " ", "BlockGap"}], ",", " ", 
         RowBox[{"\"\<Termination\>\"", "\[Rule]", " ", "Termination"}], ",", 
         RowBox[{"\"\<PointingUp\>\"", "\[Rule]", " ", "False"}], ",", " ", 
         RowBox[{"\"\<FirstBlock\>\"", "\[Rule]", " ", "\"\<Up\>\""}], ",", 
         RowBox[{
         "\"\<PosMagErrors\>\"", "\[Rule]", " ", "PosMagErrorsBRC"}]}], 
        "]"}]}], " ", ";", "\[IndentingNewLine]", "\[IndentingNewLine]", 
      RowBox[{"\[Delta]ULC", " ", "=", " ", 
       RowBox[{"\[Delta]P", "+", "\[Delta]CP"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"ULC", " ", "=", " ", 
       RowBox[{"auxIDCassette", "[", 
        RowBox[{
        "\[Lambda]u", ",", " ", "Np", ",", "Br", ",", " ", "\[Delta]ULC", ",",
          " ", "ULCBlockShape", ",", 
         RowBox[{"\"\<Rectangular\>\"", "\[Rule]", " ", "True"}], ",", " ", 
         RowBox[{"\"\<BlockGap\>\"", "\[Rule]", " ", "BlockGap"}], ",", " ", 
         RowBox[{"\"\<Termination\>\"", "\[Rule]", " ", "Termination"}], ",", 
         " ", 
         RowBox[{"\"\<PointingUp\>\"", "\[Rule]", " ", "False"}], ",", " ", 
         RowBox[{"\"\<FirstBlock\>\"", "\[Rule]", " ", "\"\<Up\>\""}], ",", 
         RowBox[{
         "\"\<PosMagErrors\>\"", "\[Rule]", " ", "PosMagErrorsBLC"}]}], 
        "]"}]}], " ", ";", "\[IndentingNewLine]", "\[IndentingNewLine]", 
      RowBox[{"\[Delta]BLC", " ", "=", " ", "0"}], ";", "\[IndentingNewLine]", 
      RowBox[{"BLC", " ", "=", " ", 
       RowBox[{"auxIDCassette", "[", 
        RowBox[{
        "\[Lambda]u", ",", " ", "Np", ",", "Br", ",", " ", "\[Delta]BLC", ",",
          " ", "BLCBlockShape", ",", " ", 
         RowBox[{"\"\<Rectangular\>\"", "\[Rule]", " ", "True"}], ",", " ", 
         RowBox[{"\"\<BlockGap\>\"", "\[Rule]", " ", "BlockGap"}], ",", " ", 
         RowBox[{"\"\<Termination\>\"", "\[Rule]", " ", "Termination"}], ",", 
         " ", 
         RowBox[{"\"\<PointingUp\>\"", "\[Rule]", "True"}], ",", 
         RowBox[{"\"\<FirstBlock\>\"", "\[Rule]", " ", "\"\<Up\>\""}], ",", 
         " ", 
         RowBox[{
         "\"\<PosMagErrors\>\"", "\[Rule]", " ", "PosMagErrorsULC"}]}], 
        "]"}]}], " ", ";", "\[IndentingNewLine]", "\[IndentingNewLine]", 
      RowBox[{"\[Delta]BRC", " ", "=", 
       RowBox[{"\[Delta]P", " ", "-", " ", "\[Delta]CP"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"BRC", " ", "=", 
       RowBox[{"auxIDCassette", "[", 
        RowBox[{
        "\[Lambda]u", ",", " ", "Np", ",", "Br", ",", " ", "\[Delta]BRC", ",",
          " ", "BRCBlockShape", ",", 
         RowBox[{"\"\<Rectangular\>\"", "\[Rule]", " ", "True"}], ",", " ", 
         RowBox[{"\"\<BlockGap\>\"", "\[Rule]", " ", "BlockGap"}], ",", " ", 
         RowBox[{"\"\<Termination\>\"", "\[Rule]", " ", "Termination"}], ",", 
         "  ", 
         RowBox[{"\"\<PointingUp\>\"", "\[Rule]", " ", "True"}], ",", 
         RowBox[{"\"\<FirstBlock\>\"", "\[Rule]", " ", "\"\<Up\>\""}], ",", 
         " ", 
         RowBox[{
         "\"\<PosMagErrors\>\"", "\[Rule]", " ", "PosMagErrorsURC"}]}], 
        "]"}]}], " ", ";", "\[IndentingNewLine]", "\[IndentingNewLine]", 
      RowBox[{"(*", 
       RowBox[{"Insertion", " ", "device"}], "*)"}], "\[IndentingNewLine]", 
      RowBox[{"Device", " ", "=", " ", 
       RowBox[{"radObjCnt", "[", 
        RowBox[{"{", 
         RowBox[{"BRC", ",", " ", "BLC", ",", " ", "ULC", ",", " ", "URC"}], 
         "}"}], "]"}]}], ";", "\[IndentingNewLine]", "\[IndentingNewLine]", 
      RowBox[{"t1", "=", 
       RowBox[{"AbsoluteTime", "[", "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"Print", "[", 
       RowBox[{"\"\<IDRectangularEPU: elapsed time = \>\"", ",", 
        RowBox[{"(", 
         RowBox[{"t1", "-", "t0"}], ")"}], ",", "\"\< s\>\""}], "]"}], ";", 
      "\[IndentingNewLine]", "\[IndentingNewLine]", 
      RowBox[{"Return", "[", "Device", "]"}], ";"}]}], "\[IndentingNewLine]", 
    "]"}]}], ";"}]}], "Input",
 CellChangeTimes->{{3.766403272085984*^9, 3.7664033578521757`*^9}, {
   3.7667571136176224`*^9, 3.7667571709189963`*^9}, {3.7667584177386036`*^9, 
   3.766758466117406*^9}, {3.767445998138589*^9, 3.7674460044647546`*^9}, {
   3.7674481732114954`*^9, 3.767448197291478*^9}, {3.7675190261227913`*^9, 
   3.7675192663618317`*^9}, {3.7675192966658735`*^9, 3.767519297637305*^9}, {
   3.7675193763480625`*^9, 3.767519383231429*^9}, {3.7675195926494403`*^9, 
   3.767519605315816*^9}, {3.7826453308452415`*^9, 3.7826454369570646`*^9}, {
   3.782652869546651*^9, 3.7826528706872773`*^9}, {3.782652980643033*^9, 
   3.7826529849398637`*^9}, {3.7826530603770914`*^9, 
   3.7826533783553457`*^9}, {3.7826576107736015`*^9, 3.782657619101695*^9}, {
   3.782659385201162*^9, 3.7826594163104153`*^9}, 3.784974930088399*^9},
 Background->RGBColor[0.87, 0.94, 1],
 CellLabel->"In[58]:=",ExpressionUUID->"bf44cc81-2978-4d34-b03f-0dc653e61041"]
}, Closed]]
}, Open  ]],

Cell[CellGroupData[{

Cell["Utilities", "Section",
 CellChangeTimes->{{3.7663982103876667`*^9, 3.7663982168978977`*^9}, {
  3.7663982623594646`*^9, 
  3.766398265542498*^9}},ExpressionUUID->"43f13067-53af-4acd-aa9d-\
ce1b427c583b"],

Cell[CellGroupData[{

Cell["IDShow", "Subsection",
 CellChangeTimes->{
  3.766754821368951*^9},ExpressionUUID->"e7c07ade-b8cf-4aa4-b070-\
2bb761f25e1b"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"IDShow", "::", "usage"}], " ", "=", " ", 
    "\"\<IDShow[ID, \\\"MagDirection\\\"\[Rule] False, \\\"ArrowSize\\\"\
\[Rule] 10, \\\"ArrowHeadSize\\\"\[Rule] Medium]: Show the ID model.\>\""}], 
   ";"}], " ", "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"IDShow", "[", 
    RowBox[{"ID_", ",", " ", 
     RowBox[{"OptionsPattern", "[", 
      RowBox[{"{", 
       RowBox[{
        RowBox[{"\"\<MagDirection\>\"", "\[Rule]", " ", "False"}], ",", "  ", 
        RowBox[{"\"\<ArrowSize\>\"", "\[Rule]", " ", "10"}], ",", " ", 
        RowBox[{"\"\<ArrowHeadSize\>\"", "\[Rule]", "Medium"}]}], "}"}], 
      "]"}]}], "]"}], " ", ":=", " ", 
   RowBox[{"Module", "[", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
      "MagDirection", ",", " ", "ArrowSize", " ", ",", " ", "ArrowHeadSize", 
       " ", ",", " ", "ObjM", " ", ",", " ", "ArrowList", ",", " ", "t0", ",",
        " ", "t1"}], "}"}], ",", "\[IndentingNewLine]", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"t0", "=", 
       RowBox[{"AbsoluteTime", "[", "]"}]}], ";", "\[IndentingNewLine]", 
      "\[IndentingNewLine]", 
      RowBox[{"RadPlot3DOptions", "[", "]"}], ";", "\[IndentingNewLine]", 
      "\[IndentingNewLine]", 
      RowBox[{"MagDirection", " ", "=", " ", 
       RowBox[{"OptionValue", "[", "\"\<MagDirection\>\"", "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"ArrowSize", " ", "=", " ", 
       RowBox[{"OptionValue", "[", "\"\<ArrowSize\>\"", "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"ArrowHeadSize", " ", "=", " ", 
       RowBox[{"OptionValue", "[", "\"\<ArrowHeadSize\>\"", "]"}]}], ";", 
      "\[IndentingNewLine]", "\[IndentingNewLine]", 
      RowBox[{"If", "[", 
       RowBox[{"MagDirection", ",", "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"ObjM", " ", "=", " ", 
          RowBox[{"radObjM", "[", "ID", "]"}]}], ";", "\[IndentingNewLine]", 
         RowBox[{"ArrowList", " ", "=", " ", 
          RowBox[{
           RowBox[{
            RowBox[{"auxIDBlockArrow", "[", 
             RowBox[{
              RowBox[{"#", "[", 
               RowBox[{"[", "1", "]"}], "]"}], ",", " ", 
              RowBox[{"#", "[", 
               RowBox[{"[", "2", "]"}], "]"}], ",", " ", "ArrowSize"}], "]"}],
             "&"}], "/@", "ObjM"}]}], ";", "\[IndentingNewLine]", 
         RowBox[{"Print", "[", 
          RowBox[{"Graphics3D", "[", 
           RowBox[{
            RowBox[{"{", 
             RowBox[{
              RowBox[{"Opacity", "[", "0.5", "]"}], ",", " ", 
              RowBox[{"radObjDrw", "[", "ID", "]"}], ",", 
              RowBox[{"Opacity", "[", "1", "]"}], ",", 
              RowBox[{"Arrowheads", "[", "ArrowHeadSize", "]"}], ",", 
              "ArrowList"}], "}"}], ",", " ", 
            RowBox[{"BaseStyle", " ", "\[Rule]", " ", 
             RowBox[{"{", 
              RowBox[{"12", ",", " ", 
               RowBox[{
               "FontFamily", " ", "\[Rule]", " ", "\"\<Calibri\>\""}]}], 
              "}"}]}]}], "]"}], "]"}], ";"}], ",", "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"Print", "[", 
          RowBox[{"Graphics3D", "[", 
           RowBox[{
            RowBox[{"radObjDrw", "[", "ID", "]"}], ",", 
            RowBox[{"BaseStyle", " ", "\[Rule]", " ", 
             RowBox[{"{", 
              RowBox[{"12", ",", " ", 
               RowBox[{
               "FontFamily", " ", "\[Rule]", " ", "\"\<Calibri\>\""}]}], 
              "}"}]}]}], "]"}], "]"}], ";"}]}], "\[IndentingNewLine]", "]"}], 
      ";", "\[IndentingNewLine]", "\[IndentingNewLine]", 
      RowBox[{"t1", "=", 
       RowBox[{"AbsoluteTime", "[", "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"Print", "[", 
       RowBox[{"\"\<IDShow: elapsed time = \>\"", ",", 
        RowBox[{"(", 
         RowBox[{"t1", "-", "t0"}], ")"}], ",", "\"\< s\>\""}], "]"}], 
      ";"}]}], "\[IndentingNewLine]", "]"}]}], ";"}]}], "Input",
 CellChangeTimes->{{3.7667558489826016`*^9, 3.766755892642285*^9}, {
   3.76675595766302*^9, 3.7667561689633245`*^9}, {3.7667562043411093`*^9, 
   3.766756256829613*^9}, 3.7667563179437857`*^9, 3.766757279583788*^9, {
   3.7674475847961235`*^9, 3.7674476020787315`*^9}, {3.767447784535589*^9, 
   3.767447797099101*^9}},
 Background->RGBColor[0.87, 0.94, 1],
 CellLabel->"In[60]:=",ExpressionUUID->"a71e6324-e0e7-47bb-866e-8423542cebb7"]
}, Closed]],

Cell[CellGroupData[{

Cell["IDInfo", "Subsection",
 CellChangeTimes->{{3.766754821368951*^9, 3.766754837401464*^9}, {
  3.76744992179731*^9, 
  3.7674499282822175`*^9}},ExpressionUUID->"c4c1f807-da65-47c5-9540-\
4750a7a81ac9"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"IDInfo", "::", "usage"}], " ", "=", " ", 
    "\"\<IDInfo[ID, \[Lambda]u]: Print the field amplitudes and K values of \
the ID.\>\""}], ";"}], "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"IDInfo", "[", 
    RowBox[{"ID_", ",", " ", "\[Lambda]u_"}], "]"}], " ", ":=", " ", 
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
      "Bv", ",", " ", "Bh", ",", " ", "Bs", ",", " ", "Kh", ",", " ", "Kv", 
       ",", " ", "t0", ",", " ", "t1"}], "}"}], ",", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"t0", "=", 
       RowBox[{"AbsoluteTime", "[", "]"}]}], ";", "\[IndentingNewLine]", 
      "\[IndentingNewLine]", 
      RowBox[{"Bh", " ", "=", 
       RowBox[{"Max", "[", 
        RowBox[{"radFldLst", "[", 
         RowBox[{"ID", ",", " ", "\"\<Bx\>\"", ",", " ", 
          RowBox[{"{", " ", 
           RowBox[{"0", ",", "0", ",", " ", 
            RowBox[{"-", "\[Lambda]u"}]}], "}"}], ",", " ", 
          RowBox[{"{", 
           RowBox[{"0", ",", "0", ",", "\[Lambda]u"}], "}"}], ",", " ", "100",
           ",", " ", "\"\<noarg\>\"", ",", " ", 
          RowBox[{"-", "\[Lambda]u"}]}], "]"}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"Bv", " ", "=", 
       RowBox[{"Max", "[", 
        RowBox[{"radFldLst", "[", 
         RowBox[{"ID", ",", " ", "\"\<By\>\"", ",", " ", 
          RowBox[{"{", " ", 
           RowBox[{"0", ",", "0", ",", 
            RowBox[{"-", "\[Lambda]u"}]}], "}"}], ",", " ", 
          RowBox[{"{", 
           RowBox[{"0", ",", "0", ",", "\[Lambda]u"}], "}"}], ",", " ", "100",
           ",", " ", "\"\<noarg\>\"", ",", " ", 
          RowBox[{"-", "\[Lambda]u"}]}], "]"}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"Bs", " ", "=", 
       RowBox[{"Max", "[", 
        RowBox[{"radFldLst", "[", 
         RowBox[{"ID", ",", " ", "\"\<Bz\>\"", ",", " ", 
          RowBox[{"{", " ", 
           RowBox[{"0", ",", "0", ",", 
            RowBox[{"-", "\[Lambda]u"}]}], "}"}], ",", " ", 
          RowBox[{"{", 
           RowBox[{"0", ",", "0", ",", "\[Lambda]u"}], "}"}], ",", " ", "100",
           ",", " ", "\"\<noarg\>\"", ",", " ", 
          RowBox[{"-", "\[Lambda]u"}]}], "]"}], "]"}]}], ";", 
      "\[IndentingNewLine]", "\[IndentingNewLine]", 
      RowBox[{"Print", "[", 
       RowBox[{
       "\"\<\\nHorizontal field amplitude:    \>\"", ",", " ", "Bh", ",", 
        "  ", "\"\< [T]\>\""}], "]"}], ";", "\[IndentingNewLine]", 
      RowBox[{"Print", "[", 
       RowBox[{
       "\"\<Vertical field amplitude:      \>\"", ",", " ", "Bv", ",", " ", 
        "\"\< [T]\>\""}], "]"}], ";", "\[IndentingNewLine]", 
      RowBox[{"Print", "[", 
       RowBox[{
       "\"\<Longitudinal field amplitude:  \>\"", ",", " ", "Bs", ",", "  ", 
        "\"\< [T]\>\""}], "]"}], ";", "\[IndentingNewLine]", 
      "\[IndentingNewLine]", 
      RowBox[{"Kh", " ", "=", " ", 
       RowBox[{"0.934", "*", "Bv", "*", 
        RowBox[{"(", 
         RowBox[{"\[Lambda]u", "/", "10"}], ")"}]}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"Kv", " ", "=", " ", 
       RowBox[{"0.934", "*", "Bh", "*", 
        RowBox[{"(", 
         RowBox[{"\[Lambda]u", "/", "10"}], ")"}]}]}], ";", 
      "\[IndentingNewLine]", "\[IndentingNewLine]", 
      RowBox[{"Print", "[", 
       RowBox[{"\"\<\\nHorizontal K: \>\"", ",", " ", "Kh"}], "]"}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"Print", "[", 
       RowBox[{"\"\<Vertical K:   \>\"", ",", " ", "Kv"}], "]"}], ";", 
      "\[IndentingNewLine]", "\[IndentingNewLine]", 
      RowBox[{"t1", "=", 
       RowBox[{"AbsoluteTime", "[", "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"Print", "[", 
       RowBox[{"\"\<IDInfo: elapsed time = \>\"", ",", 
        RowBox[{"(", 
         RowBox[{"t1", "-", "t0"}], ")"}], ",", "\"\< s\>\""}], "]"}], 
      ";"}]}], "\[IndentingNewLine]", "]"}]}], ";"}]}], "Input",
 CellChangeTimes->{{3.7674474456397743`*^9, 3.7674474806295147`*^9}, {
  3.7674475680916853`*^9, 3.7674475684823327`*^9}, {3.767447806856612*^9, 
  3.767447814544712*^9}, {3.76744993168874*^9, 3.76744994276999*^9}, {
  3.7826552143586717`*^9, 3.7826552578428774`*^9}, {3.782655290186495*^9, 
  3.782655300623965*^9}, {3.7844725656385136`*^9, 3.7844725686856365`*^9}, {
  3.7845390869807477`*^9, 3.784539088824651*^9}},
 Background->RGBColor[0.87, 0.94, 1],
 CellLabel->"In[62]:=",ExpressionUUID->"27982d56-6c61-45fb-bc76-87f64bf851ac"]
}, Closed]],

Cell[CellGroupData[{

Cell["IDPlotFields", "Subsection",
 CellChangeTimes->{
  3.7667548496524267`*^9},ExpressionUUID->"b4b5252e-ff40-4d6d-b00e-\
e9710f7f4bd0"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"IDPlotFields", "::", "usage"}], " ", "=", " ", 
    "\"\<IDPlotFields[ID, p, pRange, BRange:{All, All}, p2:0, p3:0]: Plot the \
ID magnetic field versus the coordinate p ('x', 'y' or 'z').\>\""}], ";"}], 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"IDPlotFields", "[", 
    RowBox[{"ID_", ",", " ", "p_", ",", "pRange_", ",", " ", 
     RowBox[{"BRange_:", 
      RowBox[{"{", 
       RowBox[{"All", ",", " ", "All"}], "}"}]}], " ", ",", 
     RowBox[{"p2_:", "0"}], ",", " ", 
     RowBox[{"p3_:", "0"}]}], "]"}], " ", ":=", " ", 
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"plots", ",", " ", "t0", ",", " ", "t1"}], "}"}], ",", 
     "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"t0", "=", 
       RowBox[{"AbsoluteTime", "[", "]"}]}], ";", "\[IndentingNewLine]", 
      "\[IndentingNewLine]", 
      RowBox[{"plots", " ", "=", " ", 
       RowBox[{"{", "}"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"If", "[", 
       RowBox[{
        RowBox[{"p", " ", "\[Equal]", " ", "\"\<x\>\""}], ",", 
        "\[IndentingNewLine]", 
        RowBox[{"(", 
         RowBox[{
          RowBox[{"AppendTo", "[", 
           RowBox[{"plots", ",", 
            RowBox[{"Plot", "[", 
             RowBox[{
              RowBox[{"{", 
               RowBox[{"radFld", "[", 
                RowBox[{"ID", ",", "\"\<Bx\>\"", ",", 
                 RowBox[{"{", 
                  RowBox[{"x", ",", "p2", ",", "p3"}], "}"}]}], "]"}], "}"}], 
              ",", 
              RowBox[{"{", 
               RowBox[{"x", ",", 
                RowBox[{"pRange", "[", 
                 RowBox[{"[", "1", "]"}], "]"}], ",", 
                RowBox[{"pRange", "[", 
                 RowBox[{"[", "2", "]"}], "]"}]}], "}"}], ",", 
              RowBox[{"PlotRange", "\[Rule]", " ", 
               RowBox[{"{", 
                RowBox[{"pRange", ",", " ", "BRange"}], "}"}]}], ",", 
              RowBox[{"PlotTheme", "\[Rule]", "\"\<Detailed\>\""}], ",", 
              RowBox[{"FrameLabel", "\[Rule]", 
               RowBox[{"{", 
                RowBox[{"\"\<x [mm]\>\"", ",", "\"\<Bx[T]\>\""}], "}"}]}], 
              ",", " ", 
              RowBox[{"PlotStyle", "\[Rule]", "Red"}], ",", "  ", 
              RowBox[{"PlotLegends", "\[Rule]", " ", 
               RowBox[{"{", "\"\<Bx\>\"", "}"}]}]}], "]"}]}], "]"}], ";", 
          "\[IndentingNewLine]", 
          RowBox[{"AppendTo", "[", 
           RowBox[{"plots", ",", 
            RowBox[{"Plot", "[", 
             RowBox[{
              RowBox[{"{", 
               RowBox[{"radFld", "[", 
                RowBox[{"ID", ",", "\"\<By\>\"", ",", 
                 RowBox[{"{", 
                  RowBox[{"x", ",", "p2", ",", "p3"}], "}"}]}], "]"}], "}"}], 
              ",", 
              RowBox[{"{", 
               RowBox[{"x", ",", 
                RowBox[{"pRange", "[", 
                 RowBox[{"[", "1", "]"}], "]"}], ",", 
                RowBox[{"pRange", "[", 
                 RowBox[{"[", "2", "]"}], "]"}]}], "}"}], ",", 
              RowBox[{"PlotRange", "\[Rule]", " ", 
               RowBox[{"{", 
                RowBox[{"pRange", ",", "  ", "BRange"}], "}"}]}], ",", 
              RowBox[{"PlotTheme", "\[Rule]", "\"\<Detailed\>\""}], ",", 
              RowBox[{"FrameLabel", "\[Rule]", 
               RowBox[{"{", 
                RowBox[{"\"\<x [mm]\>\"", ",", "\"\<By[T]\>\""}], "}"}]}], 
              ",", " ", 
              RowBox[{"PlotStyle", "\[Rule]", "Green"}], ",", "  ", 
              RowBox[{"PlotLegends", "\[Rule]", " ", 
               RowBox[{"{", "\"\<By\>\"", "}"}]}]}], "]"}]}], "]"}], ";", 
          "\[IndentingNewLine]", 
          RowBox[{"AppendTo", "[", 
           RowBox[{"plots", ",", 
            RowBox[{"Plot", "[", 
             RowBox[{
              RowBox[{"{", 
               RowBox[{"radFld", "[", 
                RowBox[{"ID", ",", "\"\<Bz\>\"", ",", 
                 RowBox[{"{", 
                  RowBox[{"x", ",", "p2", ",", "p3"}], "}"}]}], "]"}], "}"}], 
              ",", 
              RowBox[{"{", 
               RowBox[{"x", ",", 
                RowBox[{"pRange", "[", 
                 RowBox[{"[", "1", "]"}], "]"}], ",", 
                RowBox[{"pRange", "[", 
                 RowBox[{"[", "2", "]"}], "]"}]}], "}"}], ",", 
              RowBox[{"PlotRange", "\[Rule]", " ", 
               RowBox[{"{", 
                RowBox[{"pRange", ",", " ", "BRange"}], "}"}]}], ",", 
              RowBox[{"PlotTheme", "\[Rule]", "\"\<Detailed\>\""}], ",", 
              RowBox[{"FrameLabel", "\[Rule]", 
               RowBox[{"{", 
                RowBox[{"\"\<x [mm]\>\"", ",", "\"\<Bz[T]\>\""}], "}"}]}], 
              ",", " ", 
              RowBox[{"PlotStyle", "\[Rule]", "Blue"}], ",", "  ", 
              RowBox[{"PlotLegends", "\[Rule]", " ", 
               RowBox[{"{", "\"\<Bz\>\"", "}"}]}]}], "]"}]}], "]"}], ";"}], 
         ")"}]}], "\[IndentingNewLine]", "]"}], ";", "\[IndentingNewLine]", 
      RowBox[{"If", "[", 
       RowBox[{
        RowBox[{"p", " ", "\[Equal]", " ", "\"\<y\>\""}], ",", 
        "\[IndentingNewLine]", 
        RowBox[{"(", 
         RowBox[{
          RowBox[{"AppendTo", "[", 
           RowBox[{"plots", ",", 
            RowBox[{"Plot", "[", 
             RowBox[{
              RowBox[{"{", 
               RowBox[{"radFld", "[", 
                RowBox[{"ID", ",", "\"\<Bx\>\"", ",", 
                 RowBox[{"{", 
                  RowBox[{"p2", ",", "y", ",", "p3"}], "}"}]}], "]"}], "}"}], 
              ",", 
              RowBox[{"{", 
               RowBox[{"y", ",", 
                RowBox[{"pRange", "[", 
                 RowBox[{"[", "1", "]"}], "]"}], ",", 
                RowBox[{"pRange", "[", 
                 RowBox[{"[", "2", "]"}], "]"}]}], "}"}], ",", 
              RowBox[{"PlotRange", "\[Rule]", " ", 
               RowBox[{"{", 
                RowBox[{"pRange", ",", " ", "BRange"}], "}"}]}], ",", 
              RowBox[{"PlotTheme", "\[Rule]", "\"\<Detailed\>\""}], ",", 
              RowBox[{"FrameLabel", "\[Rule]", 
               RowBox[{"{", 
                RowBox[{"\"\<y [mm]\>\"", ",", "\"\<Bx[T]\>\""}], "}"}]}], 
              ",", " ", 
              RowBox[{"PlotStyle", "\[Rule]", "Red"}], ",", "  ", 
              RowBox[{"PlotLegends", "\[Rule]", " ", 
               RowBox[{"{", "\"\<Bx\>\"", "}"}]}]}], "]"}]}], "]"}], ";", 
          "\[IndentingNewLine]", 
          RowBox[{"AppendTo", "[", 
           RowBox[{"plots", ",", 
            RowBox[{"Plot", "[", 
             RowBox[{
              RowBox[{"{", 
               RowBox[{"radFld", "[", 
                RowBox[{"ID", ",", "\"\<By\>\"", ",", 
                 RowBox[{"{", 
                  RowBox[{"p2", ",", "y", ",", "p3"}], "}"}]}], "]"}], "}"}], 
              ",", 
              RowBox[{"{", 
               RowBox[{"y", ",", 
                RowBox[{"pRange", "[", 
                 RowBox[{"[", "1", "]"}], "]"}], ",", 
                RowBox[{"pRange", "[", 
                 RowBox[{"[", "2", "]"}], "]"}]}], "}"}], ",", 
              RowBox[{"PlotRange", "\[Rule]", " ", 
               RowBox[{"{", 
                RowBox[{"pRange", ",", "  ", "BRange"}], "}"}]}], ",", 
              RowBox[{"PlotTheme", "\[Rule]", "\"\<Detailed\>\""}], ",", 
              RowBox[{"FrameLabel", "\[Rule]", 
               RowBox[{"{", 
                RowBox[{"\"\<y [mm]\>\"", ",", "\"\<By[T]\>\""}], "}"}]}], 
              ",", " ", 
              RowBox[{"PlotStyle", "\[Rule]", "Green"}], ",", "  ", 
              RowBox[{"PlotLegends", "\[Rule]", " ", 
               RowBox[{"{", "\"\<By\>\"", "}"}]}]}], "]"}]}], "]"}], ";", 
          "\[IndentingNewLine]", 
          RowBox[{"AppendTo", "[", 
           RowBox[{"plots", ",", 
            RowBox[{"Plot", "[", 
             RowBox[{
              RowBox[{"{", 
               RowBox[{"radFld", "[", 
                RowBox[{"ID", ",", "\"\<Bz\>\"", ",", 
                 RowBox[{"{", 
                  RowBox[{"p2", ",", "y", ",", "p3"}], "}"}]}], "]"}], "}"}], 
              ",", 
              RowBox[{"{", 
               RowBox[{"y", ",", 
                RowBox[{"pRange", "[", 
                 RowBox[{"[", "1", "]"}], "]"}], ",", 
                RowBox[{"pRange", "[", 
                 RowBox[{"[", "2", "]"}], "]"}]}], "}"}], ",", 
              RowBox[{"PlotRange", "\[Rule]", " ", 
               RowBox[{"{", 
                RowBox[{"pRange", ",", "BRange"}], "}"}]}], ",", 
              RowBox[{"PlotTheme", "\[Rule]", "\"\<Detailed\>\""}], ",", 
              RowBox[{"FrameLabel", "\[Rule]", 
               RowBox[{"{", 
                RowBox[{"\"\<y [mm]\>\"", ",", "\"\<Bz[T]\>\""}], "}"}]}], 
              ",", " ", 
              RowBox[{"PlotStyle", "\[Rule]", "Blue"}], ",", "  ", 
              RowBox[{"PlotLegends", "\[Rule]", " ", 
               RowBox[{"{", "\"\<Bz\>\"", "}"}]}]}], "]"}]}], "]"}], ";"}], 
         ")"}]}], "\[IndentingNewLine]", "]"}], ";", "\[IndentingNewLine]", 
      RowBox[{"If", "[", 
       RowBox[{
        RowBox[{"p", " ", "\[Equal]", " ", "\"\<z\>\""}], ",", 
        "\[IndentingNewLine]", 
        RowBox[{"(", 
         RowBox[{
          RowBox[{"AppendTo", "[", 
           RowBox[{"plots", ",", 
            RowBox[{"Plot", "[", 
             RowBox[{
              RowBox[{"{", 
               RowBox[{"radFld", "[", 
                RowBox[{"ID", ",", "\"\<Bx\>\"", ",", 
                 RowBox[{"{", 
                  RowBox[{"p2", ",", "p3", ",", "z"}], "}"}]}], "]"}], "}"}], 
              ",", 
              RowBox[{"{", 
               RowBox[{"z", ",", 
                RowBox[{"pRange", "[", 
                 RowBox[{"[", "1", "]"}], "]"}], ",", 
                RowBox[{"pRange", "[", 
                 RowBox[{"[", "2", "]"}], "]"}]}], "}"}], ",", 
              RowBox[{"PlotRange", "\[Rule]", " ", 
               RowBox[{"{", 
                RowBox[{"pRange", ",", " ", "BRange"}], "}"}]}], ",", 
              RowBox[{"PlotTheme", "\[Rule]", "\"\<Detailed\>\""}], ",", 
              RowBox[{"FrameLabel", "\[Rule]", 
               RowBox[{"{", 
                RowBox[{"\"\<z [mm]\>\"", ",", "\"\<Bx[T]\>\""}], "}"}]}], 
              ",", " ", 
              RowBox[{"PlotStyle", "\[Rule]", "Red"}], ",", "  ", 
              RowBox[{"PlotLegends", "\[Rule]", " ", 
               RowBox[{"{", "\"\<Bx\>\"", "}"}]}]}], "]"}]}], "]"}], ";", 
          "\[IndentingNewLine]", 
          RowBox[{"AppendTo", "[", 
           RowBox[{"plots", ",", 
            RowBox[{"Plot", "[", 
             RowBox[{
              RowBox[{"{", 
               RowBox[{"radFld", "[", 
                RowBox[{"ID", ",", "\"\<By\>\"", ",", 
                 RowBox[{"{", 
                  RowBox[{"p2", ",", "p3", ",", "z"}], "}"}]}], "]"}], "}"}], 
              ",", 
              RowBox[{"{", 
               RowBox[{"z", ",", 
                RowBox[{"pRange", "[", 
                 RowBox[{"[", "1", "]"}], "]"}], ",", 
                RowBox[{"pRange", "[", 
                 RowBox[{"[", "2", "]"}], "]"}]}], "}"}], ",", 
              RowBox[{"PlotRange", "\[Rule]", " ", 
               RowBox[{"{", 
                RowBox[{"pRange", ",", "  ", "BRange"}], "}"}]}], ",", 
              RowBox[{"PlotTheme", "\[Rule]", "\"\<Detailed\>\""}], ",", 
              RowBox[{"FrameLabel", "\[Rule]", 
               RowBox[{"{", 
                RowBox[{"\"\<z [mm]\>\"", ",", "\"\<By[T]\>\""}], "}"}]}], 
              ",", " ", 
              RowBox[{"PlotStyle", "\[Rule]", "Green"}], ",", "  ", 
              RowBox[{"PlotLegends", "\[Rule]", " ", 
               RowBox[{"{", "\"\<By\>\"", "}"}]}]}], "]"}]}], "]"}], ";", 
          "\[IndentingNewLine]", 
          RowBox[{"AppendTo", "[", 
           RowBox[{"plots", ",", 
            RowBox[{"Plot", "[", 
             RowBox[{
              RowBox[{"{", 
               RowBox[{"radFld", "[", 
                RowBox[{"ID", ",", "\"\<Bz\>\"", ",", 
                 RowBox[{"{", 
                  RowBox[{"p2", ",", "p3", ",", "z"}], "}"}]}], "]"}], "}"}], 
              ",", 
              RowBox[{"{", 
               RowBox[{"z", ",", 
                RowBox[{"pRange", "[", 
                 RowBox[{"[", "1", "]"}], "]"}], ",", 
                RowBox[{"pRange", "[", 
                 RowBox[{"[", "2", "]"}], "]"}]}], "}"}], ",", 
              RowBox[{"PlotRange", "\[Rule]", " ", 
               RowBox[{"{", 
                RowBox[{"pRange", ",", "BRange"}], "}"}]}], ",", 
              RowBox[{"PlotTheme", "\[Rule]", "\"\<Detailed\>\""}], ",", 
              RowBox[{"FrameLabel", "\[Rule]", 
               RowBox[{"{", 
                RowBox[{"\"\<z [mm]\>\"", ",", "\"\<Bz[T]\>\""}], "}"}]}], 
              ",", " ", 
              RowBox[{"PlotStyle", "\[Rule]", "Blue"}], ",", "  ", 
              RowBox[{"PlotLegends", "\[Rule]", " ", 
               RowBox[{"{", "\"\<Bz\>\"", "}"}]}]}], "]"}]}], "]"}], ";"}], 
         ")"}]}], "\[IndentingNewLine]", "]"}], ";", "\[IndentingNewLine]", 
      "\[IndentingNewLine]", 
      RowBox[{"t1", "=", 
       RowBox[{"AbsoluteTime", "[", "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"Print", "[", 
       RowBox[{"\"\<IDPlotFields: elapsed time = \>\"", ",", 
        RowBox[{"(", 
         RowBox[{"t1", "-", "t0"}], ")"}], ",", "\"\< s\>\""}], "]"}], ";", 
      "\[IndentingNewLine]", "\[IndentingNewLine]", 
      RowBox[{"Return", "[", "plots", "]"}], ";"}]}], "\[IndentingNewLine]", 
    "]"}]}], ";"}]}], "Input",
 CellChangeTimes->{{3.7674474943805976`*^9, 3.767447507209737*^9}, 
   3.7674475635600443`*^9, {3.767447820092058*^9, 3.767447829967826*^9}, {
   3.7826561255566607`*^9, 3.7826561994021025`*^9}, {3.7826562490425296`*^9, 
   3.7826562914642067`*^9}},
 Background->RGBColor[0.87, 0.94, 1],
 CellLabel->"In[64]:=",ExpressionUUID->"010256eb-c21f-4b57-8b91-24bd4375e46a"]
}, Closed]],

Cell[CellGroupData[{

Cell["IDFieldIntegrals", "Subsection",
 CellChangeTimes->{
  3.7667548688726835`*^9},ExpressionUUID->"8ebe4764-f5dd-483a-a6e1-\
1365765adb6b"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"IDFieldIntegrals", "::", "usage"}], " ", "=", " ", 
    "\"\<IDFieldIntegrals[ID, field, yrange, ny]: Returns the first and \
second magnetic field integrals. The unit is G.cm for the first integral and \
T.cm\.b2 for the second integral.\>\""}], ";"}], " ", 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"IDFieldIntegrals", "[", 
    RowBox[{"ID_", ",", " ", "field_", ",", " ", "lrange_", ",", " ", "nl_"}],
     "]"}], " ", ":=", " ", 
   RowBox[{"Module", "[", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
      "llist", ",", " ", "firstintlist", ",", " ", "i", ",", " ", "sfl", ",", 
       " ", "firstint", ",", " ", "secondint", ",", " ", "t0", ",", " ", 
       "t1"}], "}"}], ",", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"t0", "=", 
       RowBox[{"AbsoluteTime", "[", "]"}]}], ";", "\[IndentingNewLine]", 
      "\[IndentingNewLine]", 
      RowBox[{"firstint", " ", "=", " ", 
       RowBox[{"radFldInt", "[", 
        RowBox[{"ID", ",", "\"\<fin\>\"", ",", 
         RowBox[{"StringJoin", "[", 
          RowBox[{"\"\<i\>\"", ",", " ", "field"}], "]"}], ",", 
         RowBox[{"{", 
          RowBox[{"0", ",", " ", "0", ",", "  ", 
           RowBox[{"lrange", "[", 
            RowBox[{"[", "1", "]"}], "]"}]}], "}"}], ",", 
         RowBox[{"{", 
          RowBox[{"0", ",", " ", "0", ",", " ", 
           RowBox[{"lrange", "[", 
            RowBox[{"[", "2", "]"}], "]"}]}], "}"}]}], "]"}]}], ";", 
      "\[IndentingNewLine]", "\[IndentingNewLine]", 
      RowBox[{"llist", " ", "=", " ", 
       RowBox[{"Array", "[", 
        RowBox[{
         RowBox[{"#", "&"}], ",", "nl", ",", 
         RowBox[{"{", 
          RowBox[{
           RowBox[{"lrange", "[", 
            RowBox[{"[", "1", "]"}], "]"}], ",", 
           RowBox[{"lrange", "[", 
            RowBox[{"[", "2", "]"}], "]"}]}], "}"}]}], "]"}]}], ";", 
      "\[IndentingNewLine]", "\[IndentingNewLine]", 
      RowBox[{"sfl", " ", "=", " ", "0"}], ";", "\[IndentingNewLine]", 
      RowBox[{"firstintlist", " ", "=", " ", 
       RowBox[{"{", "0", "}"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"For", " ", "[", 
       RowBox[{
        RowBox[{"i", "=", "1"}], ",", " ", 
        RowBox[{"i", "\[LessEqual]", " ", 
         RowBox[{
          RowBox[{"Length", "[", "llist", "]"}], "-", "1"}]}], ",", " ", 
        RowBox[{"i", "++"}], ",", "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"sfl", " ", "=", " ", 
          RowBox[{"sfl", " ", "+", " ", 
           RowBox[{"radFldInt", "[", 
            RowBox[{"ID", ",", "\"\<fin\>\"", ",", 
             RowBox[{"StringJoin", "[", 
              RowBox[{"\"\<i\>\"", ",", " ", "field"}], "]"}], ",", 
             RowBox[{"{", 
              RowBox[{"0", ",", "0", ",", "  ", 
               RowBox[{"llist", "[", 
                RowBox[{"[", "i", "]"}], "]"}]}], "}"}], ",", 
             RowBox[{"{", 
              RowBox[{"0", ",", "  ", "0", ",", " ", 
               RowBox[{"llist", "[", 
                RowBox[{"[", 
                 RowBox[{"i", "+", "1"}], "]"}], "]"}]}], "}"}]}], "]"}]}]}], 
         ";", "\[IndentingNewLine]", 
         RowBox[{"AppendTo", "[", 
          RowBox[{"firstintlist", ",", " ", "sfl"}], "]"}]}]}], 
       "\[IndentingNewLine]", "]"}], ";", "\[IndentingNewLine]", 
      RowBox[{"secondint", " ", "=", " ", 
       RowBox[{"Integrate", "[", 
        RowBox[{
         RowBox[{
          RowBox[{"Interpolation", "[", 
           RowBox[{
            RowBox[{"Transpose", "@", 
             RowBox[{"{", 
              RowBox[{"llist", ",", " ", "firstintlist"}], "}"}]}], ",", " ", 
            RowBox[{"InterpolationOrder", "\[Rule]", "3"}]}], "]"}], "[", "u",
           "]"}], ",", " ", 
         RowBox[{"{", 
          RowBox[{"u", ",", " ", 
           RowBox[{"lrange", "[", 
            RowBox[{"[", "1", "]"}], "]"}], ",", " ", 
           RowBox[{"lrange", "[", 
            RowBox[{"[", "2", "]"}], "]"}]}], "}"}]}], "]"}]}], ";", 
      "\[IndentingNewLine]", "\[IndentingNewLine]", 
      RowBox[{"firstint", " ", "=", " ", 
       RowBox[{"firstint", "*", "1000"}]}], " ", ";", 
      RowBox[{"(*", 
       RowBox[{
        RowBox[{"[", 
         RowBox[{"T", ".", "mm"}], "]"}], " ", "\[Rule]", " ", 
        RowBox[{"[", 
         RowBox[{"G", ".", "cm"}], "]"}]}], "*)"}], "\[IndentingNewLine]", 
      RowBox[{"secondint", " ", "=", " ", 
       RowBox[{"secondint", "/", "100"}]}], ";", " ", 
      RowBox[{"(*", 
       RowBox[{
        RowBox[{"[", 
         RowBox[{"T", ".", "mm\.b2"}], "]"}], " ", "\[Rule]", " ", 
        RowBox[{"[", 
         RowBox[{"T", ".", "cm\.b2"}], "]"}]}], "*)"}], "\[IndentingNewLine]",
       "\[IndentingNewLine]", 
      RowBox[{"Print", "[", 
       RowBox[{
       "\"\<First integral: \>\"", ",", " ", "firstint", ",", 
        "\"\< G.cm\>\""}], "]"}], ";", "\[IndentingNewLine]", 
      RowBox[{"Print", "[", 
       RowBox[{
       "\"\<Second integral: \>\"", ",", " ", "secondint", ",", 
        "\"\< T.cm\.b2\>\""}], "]"}], ";", "\[IndentingNewLine]", 
      "\[IndentingNewLine]", 
      RowBox[{"t1", "=", 
       RowBox[{"AbsoluteTime", "[", "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"Print", "[", 
       RowBox[{"\"\<IDFieldIntegrals: elapsed time = \>\"", ",", 
        RowBox[{"(", 
         RowBox[{"t1", "-", "t0"}], ")"}], ",", "\"\< s\>\""}], "]"}], ";", 
      "\[IndentingNewLine]", "\[IndentingNewLine]", 
      RowBox[{"Return", "[", 
       RowBox[{"{", 
        RowBox[{"firstint", ",", " ", "secondint"}], "}"}], "]"}], ";"}]}], 
    "\[IndentingNewLine]", "]"}]}], ";"}]}], "Input",
 CellChangeTimes->{{3.767447519038801*^9, 3.7674475570126853`*^9}, {
  3.7674478527196264`*^9, 3.767447856876173*^9}, {3.7674486002357836`*^9, 
  3.7674486471790524`*^9}, {3.782655379174*^9, 3.782655472079883*^9}, {
  3.782655523001548*^9, 3.78265553242339*^9}},
 Background->RGBColor[0.87, 0.94, 1],
 CellLabel->"In[66]:=",ExpressionUUID->"9ec81286-7834-41d8-a2cc-bafa1a239844"]
}, Closed]],

Cell[CellGroupData[{

Cell["IDFieldMap", "Subsection",
 CellChangeTimes->{{3.7667548871084976`*^9, 3.76675490671941*^9}, 
   3.767449882481743*^9, 
   3.7826556381260996`*^9},ExpressionUUID->"7d545167-b6eb-4b6f-841c-\
c3dd168be015"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"IDFieldMap", "::", "usage"}], " ", "=", " ", 
    "\"\<IDFieldMapNoTransf[fieldmapname, ID, xrange, yrange, zrange, nx, ny, \
nz]: Writes the fieldmap to file.\>\""}], ";"}], 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"IDFieldMap", "[", 
    RowBox[{
    "fieldmapname_", ",", " ", "ID_", ",", "xrange_", ",", " ", "yrange_", 
     ",", " ", "zrange_", ",", " ", "nx_", ",", " ", "ny_", ",", " ", "nz_"}],
     " ", "]"}], " ", ":=", " ", 
   RowBox[{"Module", "[", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
      "fieldmap", ",", " ", "hmin", ",", " ", "hmax", ",", " ", "vmin", ",", 
       " ", "vmax", ",", " ", "smin", ",", " ", "smax", ",", "nh", ",", " ", 
       "nv", ",", " ", "ns", ",", " ", "hstep", ",", " ", "vstep", ",", " ", 
       "sstep", ",", " ", "h", ",", " ", "v", ",", " ", "s", ",", "  ", "i", 
       ",", " ", "j", ",", " ", "k", ",", "field", ",", " ", "line", ",", " ",
        "t0", ",", " ", "t1"}], "}"}], ",", "\[IndentingNewLine]", 
     "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"t0", "=", 
       RowBox[{"AbsoluteTime", "[", "]"}]}], ";", "\[IndentingNewLine]", 
      "\[IndentingNewLine]", 
      RowBox[{"fieldmap", "=", 
       RowBox[{"OpenWrite", "[", "fieldmapname", "]"}]}], ";", 
      "\[IndentingNewLine]", "\[IndentingNewLine]", 
      RowBox[{"hmin", " ", "=", 
       RowBox[{"xrange", "[", 
        RowBox[{"[", "1", "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"hmax", " ", "=", 
       RowBox[{"xrange", "[", 
        RowBox[{"[", "2", "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"nh", " ", "=", " ", "nx"}], ";", "\[IndentingNewLine]", 
      "\[IndentingNewLine]", 
      RowBox[{"vmin", " ", "=", 
       RowBox[{"yrange", "[", 
        RowBox[{"[", "1", "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"vmax", " ", "=", 
       RowBox[{"yrange", "[", 
        RowBox[{"[", "2", "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"nv", " ", "=", " ", "ny"}], ";", "\[IndentingNewLine]", 
      "\[IndentingNewLine]", 
      RowBox[{"smin", " ", "=", 
       RowBox[{"zrange", "[", 
        RowBox[{"[", "1", "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"smax", " ", "=", 
       RowBox[{"zrange", "[", 
        RowBox[{"[", "2", "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"ns", " ", "=", "nz"}], ";", "\[IndentingNewLine]", 
      "\[IndentingNewLine]", 
      RowBox[{"If", " ", "[", 
       RowBox[{
        RowBox[{"(", 
         RowBox[{"hmin", " ", "\[NotEqual]", " ", "hmax"}], ")"}], ",", 
        RowBox[{"hstep", " ", "=", " ", 
         RowBox[{
          RowBox[{"(", 
           RowBox[{"hmax", "-", "hmin"}], ")"}], "/", 
          RowBox[{"(", 
           RowBox[{"nh", "-", "1"}], ")"}]}]}], ",", " ", 
        RowBox[{"hstep", "=", "0"}]}], " ", "]"}], ";", "\[IndentingNewLine]", 
      RowBox[{"If", " ", "[", 
       RowBox[{
        RowBox[{"(", 
         RowBox[{"vmin", " ", "\[NotEqual]", " ", "vmax"}], ")"}], ",", 
        RowBox[{"vstep", " ", "=", " ", 
         RowBox[{
          RowBox[{"(", 
           RowBox[{"vmax", "-", "vmin"}], ")"}], "/", 
          RowBox[{"(", 
           RowBox[{"nv", "-", "1"}], ")"}]}]}], ",", " ", 
        RowBox[{"vstep", "=", "0"}]}], " ", "]"}], ";", "\[IndentingNewLine]", 
      RowBox[{"If", " ", "[", 
       RowBox[{
        RowBox[{"(", 
         RowBox[{"smin", " ", "\[NotEqual]", " ", "smax"}], ")"}], ",", 
        RowBox[{"sstep", " ", "=", " ", 
         RowBox[{
          RowBox[{"(", 
           RowBox[{"smax", "-", "smin"}], ")"}], "/", 
          RowBox[{"(", 
           RowBox[{"ns", "-", "1"}], ")"}]}]}], ",", " ", 
        RowBox[{"sstep", "=", "0"}]}], " ", "]"}], ";", "\[IndentingNewLine]",
       "\[IndentingNewLine]", 
      RowBox[{"WriteString", "[", 
       RowBox[{"fieldmap", ",", " ", 
        RowBox[{
        "\"\<X[mm]\>\"", "<>", " ", "\"\<\\t\>\"", "<>", " ", "\"\<Y[mm]\>\"",
          "<>", " ", "\"\<\\t\>\"", "<>", " ", "\"\<Z[mm]\>\"", "<>", " ", 
         "\"\<\\t\>\"", "<>", " ", "\"\<Bx[T]\>\"", "<>", " ", "\"\<\\t\>\"", 
         "<>", " ", "\"\<By[T]\>\"", "<>", " ", "\"\<\\t\>\"", "<>", " ", 
         "\"\<Bz[T]\>\"", "<>", "\"\<\\n\>\""}]}], "]"}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"WriteString", "[", 
       RowBox[{
       "fieldmap", ",", 
        "\"\<-----------------------------------------------------------------\
------------------------------------------------------------------------------\
-------------------\\n\>\""}], "]"}], ";", "\[IndentingNewLine]", 
      RowBox[{"For", "[", 
       RowBox[{
        RowBox[{"k", "=", "1"}], ",", 
        RowBox[{"k", "\[LessEqual]", "ns"}], ",", 
        RowBox[{"k", "++"}], ",", "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"For", "[", 
          RowBox[{
           RowBox[{"j", "=", "1"}], ",", 
           RowBox[{"j", "\[LessEqual]", "nv"}], ",", 
           RowBox[{"j", "++"}], ",", "\[IndentingNewLine]", 
           RowBox[{
            RowBox[{"For", "[", 
             RowBox[{
              RowBox[{"i", "=", "1"}], ",", 
              RowBox[{"i", "\[LessEqual]", "nh"}], ",", 
              RowBox[{"i", "++"}], ",", "\[IndentingNewLine]", 
              RowBox[{
               RowBox[{"h", " ", "=", " ", 
                RowBox[{"hmin", "+", 
                 RowBox[{
                  RowBox[{"(", 
                   RowBox[{"i", "-", "1"}], ")"}], "*", "hstep"}]}]}], ";", 
               "\[IndentingNewLine]", 
               RowBox[{"v", " ", "=", " ", 
                RowBox[{"vmax", "+", 
                 RowBox[{
                  RowBox[{"(", 
                   RowBox[{"j", "-", "1"}], ")"}], "*", "vstep"}]}]}], ";", 
               "\[IndentingNewLine]", 
               RowBox[{"s", " ", "=", " ", 
                RowBox[{"smin", "+", 
                 RowBox[{
                  RowBox[{"(", 
                   RowBox[{"k", "-", "1"}], ")"}], "*", "sstep"}]}]}], ";", 
               "\[IndentingNewLine]", 
               RowBox[{"field", " ", "=", " ", 
                RowBox[{"radFld", "[", 
                 RowBox[{"ID", ",", "\"\<b\>\"", ",", 
                  RowBox[{"{", 
                   RowBox[{"h", ",", "v", ",", " ", "s"}], "}"}]}], "]"}]}], 
               ";", "\[IndentingNewLine]", 
               RowBox[{"line", " ", "=", 
                RowBox[{
                 RowBox[{"auxIDNumberToString", "[", "h", "]"}], "<>", " ", 
                 "\"\<\\t\>\"", " ", "<>", " ", 
                 RowBox[{"auxIDNumberToString", "[", "v", "]"}], " ", "<>", 
                 " ", "\"\<\\t\>\"", " ", "<>", " ", 
                 RowBox[{"auxIDNumberToString", "[", "s", "]"}], " ", "<>", 
                 "\"\<\\t\>\"", " ", "<>", " ", 
                 RowBox[{"auxIDNumberToString", "[", 
                  RowBox[{"field", "[", 
                   RowBox[{"[", "1", "]"}], "]"}], "]"}], " ", "<>", " ", 
                 "\"\<\\t\>\"", " ", "<>", "  ", 
                 RowBox[{"auxIDNumberToString", "[", 
                  RowBox[{"field", "[", 
                   RowBox[{"[", "2", "]"}], "]"}], "]"}], "<>", " ", 
                 "\"\<\\t\>\"", " ", "<>", "  ", 
                 RowBox[{"auxIDNumberToString", "[", 
                  RowBox[{"field", "[", 
                   RowBox[{"[", "3", "]"}], "]"}], "]"}], "<>", 
                 "\"\<\\n\>\""}]}], "  ", ";", " ", "\[IndentingNewLine]", 
               RowBox[{"WriteString", "[", 
                RowBox[{"fieldmap", ",", "line"}], "]"}], ";"}]}], 
             "\[IndentingNewLine]", "]"}], ";"}]}], "\[IndentingNewLine]", 
          "]"}], ";"}]}], "\[IndentingNewLine]", "]"}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"Close", "[", "fieldmap", "]"}], ";", "\[IndentingNewLine]", 
      RowBox[{"Print", "[", 
       RowBox[{"\"\<Fieldmap saved in file: \>\"", ",", " ", "fieldmapname"}],
        "]"}], ";", "\[IndentingNewLine]", "\[IndentingNewLine]", 
      RowBox[{"t1", "=", 
       RowBox[{"AbsoluteTime", "[", "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"Print", "[", 
       RowBox[{"\"\<IDFieldMap: elapsed time = \>\"", ",", 
        RowBox[{"(", 
         RowBox[{"t1", "-", "t0"}], ")"}], ",", "\"\< s\>\""}], "]"}], 
      ";"}]}], "\[IndentingNewLine]", "]"}]}], ";"}]}], "Input",
 CellChangeTimes->{{3.767447676712742*^9, 3.7674476901356754`*^9}, {
   3.767447877752833*^9, 3.7674478819250393`*^9}, {3.7674498877634153`*^9, 
   3.7674499000768747`*^9}, {3.782655619766797*^9, 3.7826556288292556`*^9}, {
   3.7826568647102003`*^9, 3.782656886835105*^9}, 3.784621350331092*^9},
 Background->RGBColor[0.87, 0.94, 1],
 CellLabel->"In[68]:=",ExpressionUUID->"ea732a1e-f407-493b-bc17-27be501c7f8b"]
}, Closed]],

Cell[CellGroupData[{

Cell["IDRungeKuttaTrajectory", "Subsection",
 CellChangeTimes->{{3.7667548871084976`*^9, 3.76675490671941*^9}, 
   3.7667549708182*^9},ExpressionUUID->"9d68fbda-e71c-41d3-afe4-21e002ecbb1d"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"IDRungeKuttaTrajectory", "::", "usage"}], " ", "=", " ", 
    "\"\<IDRungeKuttaTrajectory[ID, energy, r0, smax, rkstep]: Calculates the \
particle trajectory using the Runge-Kutta algorithm. The particle energy must \
be in GeV, r0 is the initial position and normalized momentum vector {x0, y0, \
z0, dx0ds, dy0ds, dz0ds}, smax and rkstep are the final longitudinal position \
and the Runge-Kutta step. All positions are in millimeters.\>\""}], ";"}], 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"IDRungeKuttaTrajectory", "[", 
    RowBox[{
    "ID_", ",", " ", "energy_", ",", "r0_", ",", "smax_", ",", "rkstep_"}], 
    "]"}], " ", ":=", " ", 
   RowBox[{"Module", "[", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
      "trajectory", ",", " ", "ElectronRestEnergy", ",", " ", "LightSpeed", 
       ",", " ", "beta", ",", " ", "brho", ",", " ", "a", ",", " ", "b", ",", 
       " ", "b1", ",", " ", "b2", ",", " ", "b3", ",", " ", "r", ",", " ", 
       "r1", ",", " ", "r2", ",", " ", "r3", ",", " ", "drds1", ",", " ", 
       "drds2", ",", " ", "drds3", ",", " ", "drds4", ",", " ", "i", ",", " ",
        "sm", ",", " ", "step", ",", " ", "t0", ",", " ", "t1"}], "}"}], ",", 
     "\n", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"t0", "=", 
       RowBox[{"AbsoluteTime", "[", "]"}]}], ";", "\[IndentingNewLine]", 
      "\[IndentingNewLine]", 
      RowBox[{"ElectronRestEnergy", "=", "510998.92811"}], ";", " ", 
      RowBox[{"(*", 
       RowBox[{"[", "eV", "]"}], "*)"}], "\[IndentingNewLine]", 
      RowBox[{"LightSpeed", "=", "299792458"}], ";", 
      RowBox[{"(*", 
       RowBox[{"[", 
        RowBox[{"m", "/", "s"}], "]"}], "*)"}], "\[IndentingNewLine]", 
      "\[IndentingNewLine]", 
      RowBox[{"r1", " ", "=", " ", 
       RowBox[{"{", 
        RowBox[{"0", ",", "0", ",", "0", ",", "0", ",", "0", ",", "0"}], 
        "}"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"r2", " ", "=", " ", 
       RowBox[{"{", 
        RowBox[{"0", ",", "0", ",", "0", ",", "0", ",", "0", ",", "0"}], 
        "}"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"r3", " ", "=", " ", 
       RowBox[{"{", 
        RowBox[{"0", ",", "0", ",", "0", ",", "0", ",", "0", ",", "0"}], 
        "}"}]}], ";", "\[IndentingNewLine]", "\[IndentingNewLine]", 
      RowBox[{"(*", 
       RowBox[{"from", " ", "GeV", " ", "to", " ", "eV"}], "*)"}], 
      "\[IndentingNewLine]", 
      RowBox[{"beta", "=", 
       RowBox[{"Sqrt", "[", 
        RowBox[{"1.0", "-", 
         RowBox[{"(", 
          RowBox[{"1.0", "/", 
           RowBox[{"(", 
            RowBox[{
             RowBox[{"(", 
              RowBox[{"energy", "*", 
               RowBox[{"1000000000", "/", "ElectronRestEnergy"}]}], ")"}], 
             "^", "2"}], ")"}]}], ")"}]}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"brho", "=", 
       RowBox[{"(", 
        RowBox[{"beta", "*", "energy", "*", 
         RowBox[{"1000000000", "/", "LightSpeed"}]}], ")"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"a", "=", 
       RowBox[{
        RowBox[{"1.0", "/", "brho"}], "/", "beta"}]}], ";", 
      "\[IndentingNewLine]", "\[IndentingNewLine]", 
      RowBox[{"r", "=", " ", "r0"}], ";", "\[IndentingNewLine]", 
      "\[IndentingNewLine]", 
      RowBox[{"(*", 
       RowBox[{"from", " ", "mm", " ", "to", " ", "m"}], "*)"}], 
      "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"r", "[", 
        RowBox[{"[", "1", "]"}], "]"}], "=", " ", 
       RowBox[{
        RowBox[{"r", "[", 
         RowBox[{"[", "1", "]"}], "]"}], "/", "1000"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"r", "[", 
        RowBox[{"[", "2", "]"}], "]"}], "=", " ", 
       RowBox[{
        RowBox[{"r", "[", 
         RowBox[{"[", "2", "]"}], "]"}], "/", "1000"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"r", "[", 
        RowBox[{"[", "3", "]"}], "]"}], "=", " ", 
       RowBox[{
        RowBox[{"r", "[", 
         RowBox[{"[", "3", "]"}], "]"}], "/", "1000"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"sm", " ", "=", " ", 
       RowBox[{"smax", "/", "1000"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"step", " ", "=", " ", 
       RowBox[{"rkstep", "/", "1000"}]}], ";", "\[IndentingNewLine]", 
      "\[IndentingNewLine]", 
      RowBox[{"trajectory", "=", 
       RowBox[{"{", "}"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"AppendTo", "[", 
       RowBox[{"trajectory", ",", " ", 
        RowBox[{"{", 
         RowBox[{
          RowBox[{
           RowBox[{"r", "[", 
            RowBox[{"[", "1", "]"}], "]"}], "*", "1000"}], ",", " ", 
          RowBox[{
           RowBox[{"r", "[", 
            RowBox[{"[", "2", "]"}], "]"}], "*", "1000"}], ",", " ", 
          RowBox[{
           RowBox[{"r", "[", 
            RowBox[{"[", "3", "]"}], "]"}], "*", "1000"}], ",", " ", 
          RowBox[{"r", "[", 
           RowBox[{"[", "4", "]"}], "]"}], ",", " ", 
          RowBox[{"r", "[", 
           RowBox[{"[", "5", "]"}], "]"}], ",", " ", 
          RowBox[{"r", "[", 
           RowBox[{"[", "6", "]"}], "]"}]}], "}"}]}], "]"}], ";", 
      "\[IndentingNewLine]", "\[IndentingNewLine]", 
      RowBox[{"While", " ", "[", 
       RowBox[{
        RowBox[{
         RowBox[{"r", "[", 
          RowBox[{"[", "3", "]"}], "]"}], "<", "sm"}], ",", 
        "\[IndentingNewLine]", "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"b", "=", 
          RowBox[{"radFld", "[", 
           RowBox[{"ID", ",", " ", "\"\<BxByBz\>\"", ",", " ", 
            RowBox[{"1000", "*", 
             RowBox[{"r", "[", 
              RowBox[{"[", 
               RowBox[{";;", "3"}], "]"}], "]"}]}]}], "]"}]}], ";", "\n", 
         "\t", 
         RowBox[{"drds1", "=", 
          RowBox[{"auxIDNewtonLorentzEquation", "[", 
           RowBox[{"a", ",", "r", ",", "b"}], "]"}]}], ";", 
         "\[IndentingNewLine]", 
         RowBox[{"For", " ", "[", 
          RowBox[{
           RowBox[{"i", "=", "1"}], ",", " ", 
           RowBox[{"i", "\[LessEqual]", "6"}], ",", " ", 
           RowBox[{"i", "++"}], ",", 
           RowBox[{
            RowBox[{"r1", "[", 
             RowBox[{"[", "i", "]"}], "]"}], "=", 
            RowBox[{
             RowBox[{"r", "[", 
              RowBox[{"[", "i", "]"}], "]"}], "+", 
             RowBox[{
              RowBox[{"(", 
               RowBox[{"step", "/", "2.0"}], ")"}], "*", 
              RowBox[{"drds1", "[", 
               RowBox[{"[", "i", "]"}], "]"}]}]}]}]}], "]"}], ";", 
         "\[IndentingNewLine]", "\[IndentingNewLine]", 
         RowBox[{"b1", "=", 
          RowBox[{"radFld", "[", 
           RowBox[{"ID", ",", " ", "\"\<BxByBz\>\"", ",", " ", 
            RowBox[{"1000", "*", 
             RowBox[{"r1", "[", 
              RowBox[{"[", 
               RowBox[{";;", "3"}], "]"}], "]"}]}]}], "]"}]}], ";", "\n", 
         "\t", 
         RowBox[{"drds2", "=", 
          RowBox[{"auxIDNewtonLorentzEquation", "[", 
           RowBox[{"a", ",", "r1", ",", "b1"}], "]"}]}], ";", 
         "\[IndentingNewLine]", 
         RowBox[{"For", "[", 
          RowBox[{
           RowBox[{"i", "=", "1"}], ",", " ", 
           RowBox[{"i", "\[LessEqual]", "6"}], ",", " ", 
           RowBox[{"i", "++"}], ",", 
           RowBox[{
            RowBox[{"r2", "[", 
             RowBox[{"[", "i", "]"}], "]"}], "=", 
            RowBox[{
             RowBox[{"r", "[", 
              RowBox[{"[", "i", "]"}], "]"}], "+", 
             RowBox[{
              RowBox[{"(", 
               RowBox[{"step", "/", "2.0"}], ")"}], "*", 
              RowBox[{"drds2", "[", 
               RowBox[{"[", "i", "]"}], "]"}]}]}]}]}], "]"}], ";", 
         "\[IndentingNewLine]", "\[IndentingNewLine]", 
         RowBox[{"b2", "=", 
          RowBox[{"radFld", "[", 
           RowBox[{"ID", ",", " ", "\"\<BxByBz\>\"", ",", " ", 
            RowBox[{"1000", "*", 
             RowBox[{"r2", "[", 
              RowBox[{"[", 
               RowBox[{";;", "3"}], "]"}], "]"}]}]}], "]"}]}], ";", 
         "\[IndentingNewLine]", 
         RowBox[{"drds3", "=", 
          RowBox[{"auxIDNewtonLorentzEquation", "[", 
           RowBox[{"a", ",", "r2", ",", "b2"}], "]"}]}], ";", 
         "\[IndentingNewLine]", 
         RowBox[{"For", "[", 
          RowBox[{
           RowBox[{"i", "=", "1"}], ",", " ", 
           RowBox[{"i", "\[LessEqual]", " ", "6"}], ",", " ", 
           RowBox[{"i", "++"}], ",", " ", 
           RowBox[{
            RowBox[{"r3", "[", 
             RowBox[{"[", "i", "]"}], "]"}], "=", 
            RowBox[{
             RowBox[{"r", "[", 
              RowBox[{"[", "i", "]"}], "]"}], "+", 
             RowBox[{"step", "*", 
              RowBox[{"drds3", "[", 
               RowBox[{"[", "i", "]"}], "]"}]}]}]}]}], "]"}], ";", 
         "\[IndentingNewLine]", "\[IndentingNewLine]", 
         RowBox[{"b3", "=", 
          RowBox[{"radFld", "[", 
           RowBox[{"ID", ",", " ", "\"\<BxByBz\>\"", ",", " ", 
            RowBox[{"1000", "*", 
             RowBox[{"r3", "[", 
              RowBox[{"[", 
               RowBox[{";;", "3"}], "]"}], "]"}]}]}], "]"}]}], ";", 
         "\[IndentingNewLine]", 
         RowBox[{"drds4", "=", 
          RowBox[{"auxIDNewtonLorentzEquation", "[", 
           RowBox[{"a", ",", "r3", ",", "b3"}], "]"}]}], ";", 
         "\[IndentingNewLine]", "\[IndentingNewLine]", 
         RowBox[{"For", " ", "[", 
          RowBox[{
           RowBox[{"i", "=", "1"}], ",", " ", 
           RowBox[{"i", "\[LessEqual]", "6"}], ",", " ", 
           RowBox[{"i", "++"}], ",", " ", 
           RowBox[{
            RowBox[{"r", "[", 
             RowBox[{"[", "i", "]"}], "]"}], "=", 
            RowBox[{
             RowBox[{"r", "[", 
              RowBox[{"[", "i", "]"}], "]"}], "+", 
             RowBox[{
              RowBox[{"(", 
               RowBox[{"step", "/", "6.0"}], ")"}], "*", 
              RowBox[{"(", 
               RowBox[{
                RowBox[{"drds1", "[", 
                 RowBox[{"[", "i", "]"}], "]"}], "+", 
                RowBox[{"2.0", "*", 
                 RowBox[{"drds2", "[", 
                  RowBox[{"[", "i", "]"}], "]"}]}], "+", 
                RowBox[{"2.0", "*", 
                 RowBox[{"drds3", "[", 
                  RowBox[{"[", "i", "]"}], "]"}]}], "+", 
                RowBox[{"drds4", "[", 
                 RowBox[{"[", "i", "]"}], "]"}]}], ")"}]}]}]}]}], "]"}], ";", 
         "\[IndentingNewLine]", "\[IndentingNewLine]", 
         RowBox[{"AppendTo", "[", 
          RowBox[{"trajectory", ",", " ", 
           RowBox[{"{", 
            RowBox[{
             RowBox[{
              RowBox[{"r", "[", 
               RowBox[{"[", "1", "]"}], "]"}], "*", "1000"}], ",", " ", 
             RowBox[{
              RowBox[{"r", "[", 
               RowBox[{"[", "2", "]"}], "]"}], "*", "1000"}], ",", " ", 
             RowBox[{
              RowBox[{"r", "[", 
               RowBox[{"[", "3", "]"}], "]"}], "*", "1000"}], ",", " ", 
             RowBox[{"r", "[", 
              RowBox[{"[", "4", "]"}], "]"}], ",", " ", 
             RowBox[{"r", "[", 
              RowBox[{"[", "5", "]"}], "]"}], ",", " ", 
             RowBox[{"r", "[", 
              RowBox[{"[", "6", "]"}], "]"}]}], "}"}]}], "]"}], ";"}]}], 
       "\[IndentingNewLine]", "]"}], ";", "\[IndentingNewLine]", 
      "\[IndentingNewLine]", 
      RowBox[{"t1", "=", 
       RowBox[{"AbsoluteTime", "[", "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"Print", "[", 
       RowBox[{"\"\<IDRungeKuttaTrajectory: elapsed time = \>\"", ",", 
        RowBox[{"(", 
         RowBox[{"t1", "-", "t0"}], ")"}], ",", "\"\< s\>\""}], "]"}], ";", 
      "\[IndentingNewLine]", "\[IndentingNewLine]", 
      RowBox[{"Return", "[", "trajectory", "]"}], ";"}]}], 
    "\[IndentingNewLine]", "]"}]}], ";"}]}], "Input",
 CellChangeTimes->{{3.76744770185725*^9, 3.767447715061404*^9}, {
  3.7674478894725156`*^9, 3.7674478930665445`*^9}, {3.782655720566373*^9, 
  3.782655720941368*^9}},
 Background->RGBColor[0.87, 0.94, 1],
 CellLabel->"In[70]:=",ExpressionUUID->"4956b7f9-1d99-4618-978c-986f58262a12"]
}, Closed]],

Cell[CellGroupData[{

Cell["IDPlotRungeKuttaTrajectory", "Subsection",
 CellChangeTimes->{{3.7667548871084976`*^9, 3.76675490671941*^9}, 
   3.7667549708182*^9, {3.766755041776903*^9, 
   3.7667550428863707`*^9}},ExpressionUUID->"ceebcc9d-48f0-4e34-9598-\
d9d20a8fc7ae"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"IDPlotRungeKuttaTrajectory", "::", "usage"}], " ", "=", " ", 
    "\"\<IDPlotRungeKuttaTrajectory[trajectory, s:\\\"y\\\"]: Plot the \
electron trajectory.\>\""}], ";"}], 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"IDPlotRungeKuttaTrajectory", "[", 
    RowBox[{"trajectory_", ",", " ", 
     RowBox[{"s_:", "\"\<z\>\""}]}], "]"}], " ", ":=", " ", 
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
      "plots", ",", " ", "x", ",", " ", "y", ",", " ", "z", ",", " ", "t0", 
       ",", " ", "t1"}], "}"}], ",", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"t0", "=", 
       RowBox[{"AbsoluteTime", "[", "]"}]}], ";", "\[IndentingNewLine]", 
      "\[IndentingNewLine]", 
      RowBox[{"plots", " ", "=", " ", 
       RowBox[{"{", "}"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"x", "=", " ", 
       RowBox[{"trajectory", "[", 
        RowBox[{"[", 
         RowBox[{"All", ",", " ", "1"}], "]"}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"y", " ", "=", " ", 
       RowBox[{"trajectory", "[", 
        RowBox[{"[", 
         RowBox[{"All", ",", " ", "2"}], "]"}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"z", " ", "=", " ", 
       RowBox[{"trajectory", "[", 
        RowBox[{"[", 
         RowBox[{"All", ",", " ", "3"}], "]"}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"If", "[", 
       RowBox[{
        RowBox[{"s", " ", "\[Equal]", " ", "\"\<x\>\""}], ",", 
        "\[IndentingNewLine]", 
        RowBox[{"(", 
         RowBox[{
          RowBox[{"AppendTo", "[", 
           RowBox[{"plots", ",", 
            RowBox[{"ListPlot", "[", 
             RowBox[{
              RowBox[{"Transpose", "@", 
               RowBox[{"{", 
                RowBox[{"x", ",", " ", 
                 RowBox[{"y", "*", "1000"}]}], "}"}]}], ",", " ", 
              RowBox[{"PlotRange", "\[Rule]", " ", 
               RowBox[{"{", 
                RowBox[{"All", ",", " ", "All"}], "}"}]}], ",", 
              RowBox[{"PlotTheme", "\[Rule]", "\"\<Detailed\>\""}], ",", " ", 
              RowBox[{"Joined", "\[Rule]", "True"}], ",", " ", 
              RowBox[{"FrameLabel", "\[Rule]", 
               RowBox[{"{", 
                RowBox[{"\"\<x [mm]\>\"", ",", "\"\<y [\[Mu]m]\>\""}], 
                "}"}]}]}], "]"}]}], "]"}], ";", "\[IndentingNewLine]", 
          RowBox[{"AppendTo", "[", 
           RowBox[{"plots", ",", 
            RowBox[{"ListPlot", "[", 
             RowBox[{
              RowBox[{"Transpose", "@", 
               RowBox[{"{", 
                RowBox[{"x", ",", " ", 
                 RowBox[{"z", "*", "1000"}]}], "}"}]}], ",", " ", 
              RowBox[{"PlotRange", "\[Rule]", " ", 
               RowBox[{"{", 
                RowBox[{"All", ",", " ", "All"}], "}"}]}], ",", 
              RowBox[{"PlotTheme", "\[Rule]", "\"\<Detailed\>\""}], ",", " ", 
              RowBox[{"Joined", "\[Rule]", "True"}], ",", " ", 
              RowBox[{"FrameLabel", "\[Rule]", 
               RowBox[{"{", 
                RowBox[{"\"\<x [mm]\>\"", ",", "\"\<z [\[Mu]m]\>\""}], 
                "}"}]}]}], "]"}]}], "]"}], ";"}], ")"}]}], 
       "\[IndentingNewLine]", "]"}], ";", "\[IndentingNewLine]", 
      RowBox[{"If", "[", 
       RowBox[{
        RowBox[{"s", " ", "\[Equal]", " ", "\"\<y\>\""}], ",", 
        "\[IndentingNewLine]", 
        RowBox[{"(", 
         RowBox[{
          RowBox[{"AppendTo", "[", 
           RowBox[{"plots", ",", 
            RowBox[{"ListPlot", "[", 
             RowBox[{
              RowBox[{"Transpose", "@", 
               RowBox[{"{", 
                RowBox[{"y", ",", " ", 
                 RowBox[{"x", "*", "1000"}]}], "}"}]}], ",", " ", 
              RowBox[{"PlotRange", "\[Rule]", " ", 
               RowBox[{"{", 
                RowBox[{"All", ",", " ", "All"}], "}"}]}], ",", 
              RowBox[{"PlotTheme", "\[Rule]", "\"\<Detailed\>\""}], ",", " ", 
              RowBox[{"Joined", "\[Rule]", "True"}], ",", " ", 
              RowBox[{"FrameLabel", "\[Rule]", 
               RowBox[{"{", 
                RowBox[{"\"\<y [mm]\>\"", ",", "\"\<x [\[Mu]m]\>\""}], 
                "}"}]}]}], "]"}]}], "]"}], ";", "\[IndentingNewLine]", 
          RowBox[{"AppendTo", "[", 
           RowBox[{"plots", ",", 
            RowBox[{"ListPlot", "[", 
             RowBox[{
              RowBox[{"Transpose", "@", 
               RowBox[{"{", 
                RowBox[{"y", ",", " ", 
                 RowBox[{"z", "*", "1000"}]}], "}"}]}], ",", " ", 
              RowBox[{"PlotRange", "\[Rule]", " ", 
               RowBox[{"{", 
                RowBox[{"All", ",", " ", "All"}], "}"}]}], ",", 
              RowBox[{"PlotTheme", "\[Rule]", "\"\<Detailed\>\""}], ",", " ", 
              RowBox[{"Joined", "\[Rule]", "True"}], ",", " ", 
              RowBox[{"FrameLabel", "\[Rule]", 
               RowBox[{"{", 
                RowBox[{"\"\<y [mm]\>\"", ",", "\"\<z [\[Mu]m]\>\""}], 
                "}"}]}]}], "]"}]}], "]"}], ";"}], ")"}]}], 
       "\[IndentingNewLine]", "]"}], ";", "\[IndentingNewLine]", 
      RowBox[{"If", "[", 
       RowBox[{
        RowBox[{"s", " ", "\[Equal]", " ", "\"\<z\>\""}], ",", 
        "\[IndentingNewLine]", 
        RowBox[{"(", 
         RowBox[{
          RowBox[{"AppendTo", "[", 
           RowBox[{"plots", ",", 
            RowBox[{"ListPlot", "[", 
             RowBox[{
              RowBox[{"Transpose", "@", 
               RowBox[{"{", 
                RowBox[{"z", ",", " ", 
                 RowBox[{"x", "*", "1000"}]}], "}"}]}], ",", " ", 
              RowBox[{"PlotRange", "\[Rule]", " ", 
               RowBox[{"{", 
                RowBox[{"All", ",", " ", "All"}], "}"}]}], ",", 
              RowBox[{"PlotTheme", "\[Rule]", "\"\<Detailed\>\""}], ",", " ", 
              RowBox[{"Joined", "\[Rule]", "True"}], ",", " ", 
              RowBox[{"FrameLabel", "\[Rule]", 
               RowBox[{"{", 
                RowBox[{"\"\<z [mm]\>\"", ",", "\"\<x [\[Mu]m]\>\""}], 
                "}"}]}]}], "]"}]}], "]"}], ";", "\[IndentingNewLine]", 
          RowBox[{"AppendTo", "[", 
           RowBox[{"plots", ",", 
            RowBox[{"ListPlot", "[", 
             RowBox[{
              RowBox[{"Transpose", "@", 
               RowBox[{"{", 
                RowBox[{"z", ",", " ", 
                 RowBox[{"y", "*", "1000"}]}], "}"}]}], ",", " ", 
              RowBox[{"PlotRange", "\[Rule]", " ", 
               RowBox[{"{", 
                RowBox[{"All", ",", " ", "All"}], "}"}]}], ",", 
              RowBox[{"PlotTheme", "\[Rule]", "\"\<Detailed\>\""}], ",", " ", 
              RowBox[{"Joined", "\[Rule]", "True"}], ",", " ", 
              RowBox[{"FrameLabel", "\[Rule]", 
               RowBox[{"{", 
                RowBox[{"\"\<z [mm]\>\"", ",", "\"\<y [\[Mu]m]\>\""}], 
                "}"}]}]}], "]"}]}], "]"}], ";"}], ")"}]}], 
       "\[IndentingNewLine]", "]"}], ";", "\[IndentingNewLine]", 
      "\[IndentingNewLine]", 
      RowBox[{"t1", "=", 
       RowBox[{"AbsoluteTime", "[", "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"Print", "[", 
       RowBox[{"\"\<IDPlotRungeKuttaTrajectory: elapsed time = \>\"", ",", 
        RowBox[{"(", 
         RowBox[{"t1", "-", "t0"}], ")"}], ",", "\"\< s\>\""}], "]"}], ";", 
      "\[IndentingNewLine]", "\[IndentingNewLine]", 
      RowBox[{"Return", "[", "plots", "]"}], ";"}]}], "\[IndentingNewLine]", 
    "]"}]}], ";"}]}], "Input",
 CellChangeTimes->{{3.767447724265257*^9, 3.7674477376412992`*^9}, {
  3.767447904067401*^9, 3.7674479092240562`*^9}, {3.782655746847508*^9, 
  3.782655747097514*^9}},
 Background->RGBColor[0.87, 0.94, 1],
 CellLabel->"In[72]:=",ExpressionUUID->"67d721d9-4859-4970-bf63-6c86a0256dc2"]
}, Closed]],

Cell[CellGroupData[{

Cell["IDDrawCassettes", "Subsection",
 CellChangeTimes->{{3.7667548871084976`*^9, 3.76675490671941*^9}, 
   3.7667549708182*^9, {3.766755041776903*^9, 3.7667550428863707`*^9}, {
   3.7667550770140467`*^9, 3.7667550886556067`*^9}, {3.767519902604745*^9, 
   3.767519902740988*^9}},ExpressionUUID->"4e6f2e10-b60f-434f-87e8-\
1c8167222e60"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"IDDrawCassettes", "::", "usage"}], " ", "=", " ", 
    "\"\<IDDrawCassettes[]: Show the delta cassettes and coordinate system \
conventions.\>\""}], ";"}], "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"IDDrawCassettes", "[", "]"}], " ", ":=", " ", 
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
      "Rn45", ",", " ", "Rp90", ",", " ", "Vertex", ",", " ", "B1", ",", " ", 
       "B2", ",", " ", "B3", ",", " ", "B4", ",", " ", "shift", ",", " ", 
       "B1Shift", ",", " ", "B2Shift", ",", " ", "B3Shift", ",", " ", 
       "B4Shift"}], "}"}], ",", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"Rn45", "=", 
       RowBox[{"RotationMatrix", "[", 
        RowBox[{
         RowBox[{"-", "\[Pi]"}], "/", "4"}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"Rp90", "=", 
       RowBox[{"RotationMatrix", "[", "  ", 
        RowBox[{"\[Pi]", "/", "2"}], "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{"Vertex", " ", "=", " ", 
       RowBox[{"{", 
        RowBox[{
         RowBox[{"{", 
          RowBox[{
           RowBox[{"-", "2.75"}], ",", " ", "3.46"}], "}"}], ",", " ", 
         RowBox[{"{", 
          RowBox[{
           RowBox[{"-", "11.2662"}], ",", " ", "12.4245"}], "}"}], ",", " ", 
         RowBox[{"{", 
          RowBox[{
           RowBox[{"-", "7.73071"}], ",", "15.96"}], "}"}], ",", 
         RowBox[{"{", 
          RowBox[{
           RowBox[{"-", "11.2662"}], ",", " ", "19.4955"}], "}"}], ",", 
         RowBox[{"{", 
          RowBox[{
           RowBox[{"-", "2.75"}], ",", "28.46"}], "}"}], ",", " ", 
         RowBox[{"{", 
          RowBox[{"2.75", ",", "28.46"}], "}"}], ",", " ", 
         RowBox[{"{", 
          RowBox[{"11.2662", ",", " ", "19.4955"}], "}"}], ",", " ", 
         RowBox[{"{", 
          RowBox[{"7.73071", ",", "15.96"}], "}"}], ",", " ", 
         RowBox[{"{", 
          RowBox[{"11.2662", ",", " ", "12.4245"}], "}"}], ",", " ", 
         RowBox[{"{", 
          RowBox[{"2.75", ",", " ", "3.46"}], "}"}]}], "}"}]}], ";", 
      "\[IndentingNewLine]", "\[IndentingNewLine]", 
      RowBox[{"B1", " ", "=", " ", 
       RowBox[{
        RowBox[{
         RowBox[{"Dot", "[", 
          RowBox[{"Rn45", ",", "#"}], "]"}], "&"}], "/@", "Vertex"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"B2", " ", "=", " ", 
       RowBox[{
        RowBox[{
         RowBox[{"Dot", "[", 
          RowBox[{"Rp90", ",", "#"}], "]"}], "&"}], "/@", "B1"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"B3", " ", "=", " ", 
       RowBox[{
        RowBox[{
         RowBox[{"Dot", "[", 
          RowBox[{"Rp90", ",", "#"}], "]"}], "&"}], "/@", "B2"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"B4", " ", "=", " ", 
       RowBox[{
        RowBox[{
         RowBox[{"Dot", "[", 
          RowBox[{"Rp90", ",", "#"}], "]"}], "&"}], "/@", "B3"}]}], ";", 
      "\[IndentingNewLine]", "\[IndentingNewLine]", 
      RowBox[{"Print", "[", 
       RowBox[{"Graphics", "[", " ", 
        RowBox[{
         RowBox[{"{", 
          RowBox[{
           RowBox[{"Arrowheads", "[", "0.02", "]"}], ",", 
           RowBox[{"{", 
            RowBox[{"Pink", ",", 
             RowBox[{
              RowBox[{
               RowBox[{"Polygon", "[", "#", "]"}], "&"}], "/@", 
              RowBox[{"{", 
               RowBox[{"B1", ",", " ", "B2", ",", " ", "B3", ",", " ", "B4"}],
                "}"}]}]}], "}"}], ",", " ", "\[IndentingNewLine]", 
           RowBox[{"Circle", "[", 
            RowBox[{
             RowBox[{"{", 
              RowBox[{"0", ",", "0"}], "}"}], ",", " ", "0.7"}], "]"}], ",", 
           RowBox[{"Disk", "[", 
            RowBox[{
             RowBox[{"{", 
              RowBox[{"0", ",", "0"}], "}"}], ",", " ", "0.3"}], "]"}], ",", 
           "  ", 
           RowBox[{"Arrow", "[", 
            RowBox[{"{", 
             RowBox[{
              RowBox[{"{", 
               RowBox[{"0", ",", "0"}], "}"}], ",", 
              RowBox[{"{", 
               RowBox[{"0", ",", "3.5"}], "}"}]}], "}"}], "]"}], ",", "  ", 
           RowBox[{"Arrow", "[", 
            RowBox[{"{", 
             RowBox[{
              RowBox[{"{", 
               RowBox[{"0", ",", "0"}], "}"}], ",", 
              RowBox[{"{", 
               RowBox[{"3.5", ",", "0"}], "}"}]}], "}"}], "]"}], ",", " ", 
           "\[IndentingNewLine]", 
           RowBox[{"Text", "[", 
            RowBox[{
             RowBox[{"Style", "[", 
              RowBox[{"\"\<x\>\"", ",", " ", "Medium"}], "]"}], ",", 
             RowBox[{"{", 
              RowBox[{"4", ",", "0"}], "}"}]}], "]"}], ",", 
           RowBox[{"Text", "[", 
            RowBox[{
             RowBox[{"Style", "[", 
              RowBox[{"\"\<y\>\"", ",", " ", "Medium"}], "]"}], ",", 
             RowBox[{"{", 
              RowBox[{"0", ",", "4"}], "}"}]}], "]"}], ",", 
           RowBox[{"Text", "[", 
            RowBox[{
             RowBox[{"Style", "[", 
              RowBox[{"\"\<z\>\"", ",", " ", "Medium"}], "]"}], ",", 
             RowBox[{"{", 
              RowBox[{
               RowBox[{"-", "1"}], ",", 
               RowBox[{"-", "1"}]}], "}"}]}], "]"}], ",", 
           "\[IndentingNewLine]", 
           RowBox[{"Text", "[", 
            RowBox[{
             RowBox[{"Style", "[", 
              RowBox[{"\"\<URC\>\"", ",", " ", "Large"}], "]"}], ",", 
             RowBox[{"{", 
              RowBox[{"10", ",", "10"}], "}"}]}], "]"}], ",", 
           "\[IndentingNewLine]", 
           RowBox[{"Text", "[", 
            RowBox[{
             RowBox[{"Style", "[", 
              RowBox[{"\"\<ULC\>\"", ",", " ", "Large"}], "]"}], ",", 
             RowBox[{"{", 
              RowBox[{
               RowBox[{"-", "10"}], ",", "10"}], "}"}]}], "]"}], ",", 
           "\[IndentingNewLine]", 
           RowBox[{"Text", "[", 
            RowBox[{
             RowBox[{"Style", "[", 
              RowBox[{"\"\<BRC\>\"", ",", " ", "Large"}], "]"}], ",", 
             RowBox[{"{", 
              RowBox[{"10", ",", 
               RowBox[{"-", "10"}]}], "}"}]}], "]"}], ",", 
           "\[IndentingNewLine]", 
           RowBox[{"Text", "[", 
            RowBox[{
             RowBox[{"Style", "[", 
              RowBox[{"\"\<BLC\>\"", ",", " ", "Large"}], "]"}], ",", 
             RowBox[{"{", 
              RowBox[{
               RowBox[{"-", "10"}], ",", 
               RowBox[{"-", "10"}]}], "}"}]}], "]"}]}], "\[IndentingNewLine]",
           "}"}], ",", " ", 
         RowBox[{"ImageSize", "\[Rule]", " ", "400"}]}], "]"}], "]"}], 
      ";"}]}], "\[IndentingNewLine]", "\[IndentingNewLine]", "]"}]}], 
  ";"}]}], "Input",
 CellChangeTimes->{{3.76675480841481*^9, 3.766754926158442*^9}, {
  3.766754977584357*^9, 3.7667549895853047`*^9}, {3.766755050871372*^9, 
  3.766755080858101*^9}, {3.76751695288941*^9, 3.7675169645125494`*^9}, {
  3.7675171280707097`*^9, 3.7675171415808496`*^9}, {3.767519930767761*^9, 
  3.767519937580052*^9}, {3.7675213654992776`*^9, 3.767521549362143*^9}, {
  3.7826558915691566`*^9, 3.78265600863525*^9}, {3.7826560461507263`*^9, 
  3.7826560470569754`*^9}},
 Background->RGBColor[0.87, 0.94, 1],
 CellLabel->"In[74]:=",ExpressionUUID->"fb9719e2-5063-4c64-8a3e-f3bd1c9f8df6"]
}, Closed]]
}, Open  ]],

Cell[CellGroupData[{

Cell["Auxiliary", "Section",
 CellChangeTimes->{{3.76639811614032*^9, 
  3.7663981237176037`*^9}},ExpressionUUID->"dd6e8fa8-413d-4adc-9e25-\
2640f7bf7520"],

Cell[CellGroupData[{

Cell["auxIDCassette", "Subsection",
 CellChangeTimes->{{3.766754730782276*^9, 
  3.7667547560811443`*^9}},ExpressionUUID->"b9a2c614-66c1-492d-b721-\
2e3926d1b212"],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"auxIDCassette", "[", 
     RowBox[{
     "\[Lambda]u_", ",", " ", "Np_", ",", " ", "Br_", ",", " ", "\[Delta]_", 
      ",", " ", "BlockShape_", ",", " ", 
      RowBox[{"OptionsPattern", "[", 
       RowBox[{"{", 
        RowBox[{
         RowBox[{"\"\<Rectangular\>\"", "\[Rule]", " ", "False"}], ",", " ", 
         RowBox[{"\"\<BlockGap\>\"", "\[Rule]", " ", "0"}], ",", " ", 
         RowBox[{"\"\<Termination\>\"", "\[Rule]", " ", "\"\<None\>\""}], ",",
          " ", 
         RowBox[{"\"\<PointingUp\>\"", "\[Rule]", " ", "True"}], ",", " ", 
         RowBox[{"\"\<FirstBlock\>\"", "\[Rule]", " ", "\"\<Up\>\""}], ",", 
         " ", 
         RowBox[{
         "\"\<FieldDirection\>\"", "\[Rule]", " ", "\"\<Vertical\>\""}], ",", 
         RowBox[{"\"\<PosMagErrors\>\"", "\[Rule]", " ", 
          RowBox[{"{", "}"}]}]}], "}"}], "]"}]}], "]"}], " ", ":=", " ", 
    RowBox[{"Module", "[", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"{", " ", 
       RowBox[{
       "Rectangular", ",", " ", "BlockGap", ",", " ", "Termination", ",", " ",
         "PointingUp", ",", " ", "FirstBlock", ",", " ", "FieldDirection", 
        " ", ",", "PosMagErrors", ",", "\[IndentingNewLine]", " ", "Shape", 
        ",", " ", "NrTermBlocks", ",", "  ", "AddCoreBlocks", ",", " ", "Wm", 
        ",", " ", "Len", ",", " ", "NrCoreBlocks", ",", "NrBlocks", ",", "  ",
         "Pos", ",", "\[IndentingNewLine]", "PointingUpList", ",", " ", 
        "PointingDownList", ",", " ", "AddIdx", ",", "Mag", ",", " ", "i", 
        ",", " ", "Shift", ",", "\[IndentingNewLine]", "ErrorH", ",", 
        "ErrorV", ",", " ", "ErrorL", ",", "ErrorMag", ",", "PosWithErrors", 
        ",", "MagWithErrors", ",", "\[IndentingNewLine]", "BlockCenter", " ", 
        ",", " ", "BlockHCenterWithErrors", ",", "  ", 
        "BlockVCenterWithErrors", ",", " ", "ShapeWithErrors", ",", 
        "RotMagWithErrors", ",", " ", "Lh", ",", " ", "Lv", ",", 
        "\[IndentingNewLine]", "CassetteBeg", ",", "CassetteBeg1", ",", " ", 
        "CassetteBeg2", ",", " ", "CassetteBeg3", ",", "\[IndentingNewLine]", 
        "CassetteEnd", ",", "CassetteEnd1", ",", " ", "CassetteEnd2", ",", 
        " ", "CassetteEnd3", ",", "\[IndentingNewLine]", "CassetteCore", ",", 
        "Cassette"}], "}"}], ",", "\[IndentingNewLine]", 
      "\[IndentingNewLine]", 
      RowBox[{"(*", 
       RowBox[{"Optional", " ", "arguments"}], "*)"}], "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"Rectangular", "=", " ", 
        RowBox[{"OptionValue", "[", "\"\<Rectangular\>\"", "]"}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"BlockGap", "=", 
        RowBox[{"OptionValue", "[", "\"\<BlockGap\>\"", "]"}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"Termination", " ", "=", " ", 
        RowBox[{"OptionValue", "[", "\"\<Termination\>\"", "]"}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"PointingUp", " ", "=", " ", 
        RowBox[{"OptionValue", "[", "\"\<PointingUp\>\"", "]"}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"FirstBlock", " ", "=", " ", 
        RowBox[{"OptionValue", "[", "\"\<FirstBlock\>\"", "]"}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"FieldDirection", " ", "=", " ", 
        RowBox[{"OptionValue", "[", "\"\<FieldDirection\>\"", "]"}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"PosMagErrors", " ", "=", " ", 
        RowBox[{"OptionValue", "[", "\"\<PosMagErrors\>\"", "]"}]}], ";", 
       "\[IndentingNewLine]", "\[IndentingNewLine]", 
       RowBox[{"(*", 
        RowBox[{"Check", " ", "arguments"}], "*)"}], "\[IndentingNewLine]", 
       RowBox[{"If", " ", "[", 
        RowBox[{
         RowBox[{"\[Lambda]u", " ", "\[LessEqual]", " ", "0"}], ",", " ", 
         RowBox[{"Return", "[", "]"}]}], "]"}], ";", "\[IndentingNewLine]", 
       RowBox[{"If", " ", "[", 
        RowBox[{
         RowBox[{"Np", " ", "\[LessEqual]", " ", "0"}], ",", " ", 
         RowBox[{"Return", "[", "]"}]}], "]"}], ";", "\[IndentingNewLine]", 
       RowBox[{"If", " ", "[", 
        RowBox[{
         RowBox[{"Br", " ", "\[LessEqual]", " ", "0"}], ",", " ", 
         RowBox[{"Return", "[", "]"}]}], "]"}], ";", "\[IndentingNewLine]", 
       RowBox[{"If", " ", "[", 
        RowBox[{
         RowBox[{
          RowBox[{"Depth", "[", "BlockShape", "]"}], "\[NotEqual]", " ", 
          "4"}], ",", "\[IndentingNewLine]", 
         RowBox[{"Shape", " ", "=", " ", 
          RowBox[{"{", "BlockShape", "}"}]}], ",", "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{"Shape", " ", "=", " ", "BlockShape"}], ";"}]}], 
        "\[IndentingNewLine]", "]"}], ";", "\[IndentingNewLine]", 
       "\[IndentingNewLine]", 
       RowBox[{"(*", 
        RowBox[{"Termination", " ", "Type"}], "*)"}], "\[IndentingNewLine]", 
       RowBox[{"NrTermBlocks", "=", " ", "0"}], ";", "\[IndentingNewLine]", 
       RowBox[{"AddCoreBlocks", " ", "=", " ", "0"}], ";", 
       "\[IndentingNewLine]", "\[IndentingNewLine]", 
       RowBox[{"If", "[", 
        RowBox[{
         RowBox[{"Termination", "\[Equal]", " ", "\"\<OneBlockSym\>\""}], ",",
          "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{"NrTermBlocks", "=", " ", "1"}], ";", "\[IndentingNewLine]", 
          RowBox[{"AddCoreBlocks", " ", "=", " ", "3"}], ";"}]}], 
        "\[IndentingNewLine]", "]"}], ";", "\[IndentingNewLine]", 
       "\[IndentingNewLine]", 
       RowBox[{"If", "[", 
        RowBox[{
         RowBox[{"Termination", "\[Equal]", " ", "\"\<OneBlockAntiSym\>\""}], 
         ",", "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{"NrTermBlocks", "=", " ", "1"}], ";", "\[IndentingNewLine]", 
          RowBox[{"AddCoreBlocks", " ", "=", " ", "1"}], ";"}]}], 
        "\[IndentingNewLine]", "]"}], ";", "\[IndentingNewLine]", 
       "\[IndentingNewLine]", 
       RowBox[{"If", "[", 
        RowBox[{
         RowBox[{"Termination", "\[Equal]", " ", "\"\<ThreeBlocksSym\>\""}], 
         ",", "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{"NrTermBlocks", "=", " ", "3"}], ";", "\[IndentingNewLine]", 
          RowBox[{"AddCoreBlocks", " ", "=", "3"}], ";"}]}], 
        "\[IndentingNewLine]", "]"}], ";", "\[IndentingNewLine]", 
       "\[IndentingNewLine]", 
       RowBox[{"If", "[", 
        RowBox[{
         RowBox[{
         "Termination", "\[Equal]", " ", "\"\<ThreeBlocksAntiSym\>\""}], ",", 
         "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{"NrTermBlocks", "=", " ", "3"}], ";", "\[IndentingNewLine]", 
          RowBox[{"AddCoreBlocks", " ", "=", "1"}], ";"}]}], 
        "\[IndentingNewLine]", "]"}], ";", "\[IndentingNewLine]", 
       "\[IndentingNewLine]", 
       RowBox[{"(*", 
        RowBox[{"Block", " ", "length"}], "*)"}], "\[IndentingNewLine]", 
       RowBox[{"Wm", "=", " ", 
        RowBox[{"\[Lambda]u", "/", "4"}]}], ";", "\[IndentingNewLine]", 
       RowBox[{"Len", " ", "=", " ", 
        RowBox[{"Wm", " ", "-", " ", "BlockGap"}]}], ";", 
       "\[IndentingNewLine]", "\[IndentingNewLine]", 
       RowBox[{"(*", 
        RowBox[{"Position", " ", "of", " ", "blocks"}], "*)"}], 
       "\[IndentingNewLine]", 
       RowBox[{"NrCoreBlocks", "=", " ", 
        RowBox[{
         RowBox[{"(", 
          RowBox[{"4", "*", "Np"}], ")"}], " ", "+", " ", "AddCoreBlocks"}]}],
        ";", "\[IndentingNewLine]", 
       RowBox[{"NrBlocks", " ", "=", " ", 
        RowBox[{"NrCoreBlocks", "+", " ", 
         RowBox[{"(", 
          RowBox[{"2", "*", "NrTermBlocks"}], ")"}]}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"Pos", " ", "=", " ", 
        RowBox[{"Wm", "*", 
         RowBox[{"Range", "[", 
          RowBox[{"0", ",", 
           RowBox[{"NrBlocks", " ", "-", " ", "1"}]}], "]"}]}]}], ";", 
       "\[IndentingNewLine]", "\[IndentingNewLine]", 
       RowBox[{"(*", 
        RowBox[{"Magnetization", " ", "direction"}], "*)"}], 
       "\[IndentingNewLine]", 
       RowBox[{"If", "[", 
        RowBox[{
         RowBox[{
         "FieldDirection", " ", "\[Equal]", " ", "\"\<Horizontal\>\""}], ",", 
         "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{"PointingUpList", " ", "=", " ", 
           RowBox[{"{", 
            RowBox[{
             RowBox[{"{", 
              RowBox[{"Br", ",", "0", ",", "0"}], "}"}], ",", " ", 
             RowBox[{"{", 
              RowBox[{"0", ",", " ", "0", ",", " ", 
               RowBox[{"-", "Br"}]}], "}"}], ",", " ", 
             RowBox[{"{", 
              RowBox[{
               RowBox[{"-", "Br"}], ",", "0", ",", "0"}], "}"}], ",", " ", 
             RowBox[{"{", 
              RowBox[{"0", ",", " ", "0", ",", "Br"}], "}"}]}], "}"}]}], ";", 
          "\[IndentingNewLine]", 
          RowBox[{"PointingDownList", " ", "=", " ", 
           RowBox[{"{", 
            RowBox[{
             RowBox[{"{", 
              RowBox[{"Br", ",", "0", ",", "0"}], "}"}], ",", " ", 
             RowBox[{"{", 
              RowBox[{"0", ",", " ", "0", ",", " ", "Br"}], "}"}], ",", " ", 
             RowBox[{"{", 
              RowBox[{
               RowBox[{"-", "Br"}], ",", "0", ",", "0"}], "}"}], ",", " ", 
             RowBox[{"{", 
              RowBox[{"0", ",", "  ", "0", ",", 
               RowBox[{"-", "Br"}]}], "}"}]}], "}"}]}], ";"}], ",", 
         "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{"PointingUpList", " ", "=", " ", 
           RowBox[{"{", 
            RowBox[{
             RowBox[{"{", 
              RowBox[{"0", ",", "Br", ",", "0"}], "}"}], ",", " ", 
             RowBox[{"{", 
              RowBox[{"0", ",", " ", "0", ",", " ", 
               RowBox[{"-", "Br"}]}], "}"}], ",", " ", 
             RowBox[{"{", 
              RowBox[{"0", ",", 
               RowBox[{"-", "Br"}], ",", " ", "0"}], "}"}], ",", " ", 
             RowBox[{"{", 
              RowBox[{"0", ",", " ", "0", ",", "Br"}], "}"}]}], "}"}]}], ";", 
          "\[IndentingNewLine]", 
          RowBox[{"PointingDownList", " ", "=", " ", 
           RowBox[{"{", 
            RowBox[{
             RowBox[{"{", 
              RowBox[{"0", ",", "Br", ",", "0"}], "}"}], ",", " ", 
             RowBox[{"{", 
              RowBox[{"0", ",", " ", "0", ",", " ", "Br"}], "}"}], ",", " ", 
             RowBox[{"{", 
              RowBox[{"0", ",", 
               RowBox[{"-", "Br"}], ",", " ", "0"}], "}"}], ",", " ", 
             RowBox[{"{", 
              RowBox[{"0", ",", " ", "0", ",", 
               RowBox[{"-", "Br"}]}], "}"}]}], "}"}]}], ";"}]}], 
        "\[IndentingNewLine]", "]"}], ";", "\[IndentingNewLine]", 
       "\[IndentingNewLine]", 
       RowBox[{"AddIdx", " ", "=", " ", "0"}], ";", "\[IndentingNewLine]", 
       RowBox[{"If", " ", "[", 
        RowBox[{
         RowBox[{"FirstBlock", " ", "\[Equal]", " ", "\"\<Up\>\""}], ",", " ", 
         RowBox[{"AddIdx", " ", "=", "0"}]}], "]"}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"If", " ", "[", 
        RowBox[{
         RowBox[{"FirstBlock", " ", "\[Equal]", " ", "\"\<Down\>\""}], ",", 
         " ", 
         RowBox[{"AddIdx", "=", "2"}]}], "]"}], ";", "\[IndentingNewLine]", 
       RowBox[{"If", " ", "[", 
        RowBox[{
         RowBox[{
          RowBox[{"FirstBlock", " ", "\[Equal]", " ", "\"\<Foward\>\""}], " ",
           "&&", " ", "PointingUp"}], ",", " ", 
         RowBox[{"AddIdx", "=", "3"}]}], "]"}], ";", "\[IndentingNewLine]", 
       RowBox[{"If", " ", "[", 
        RowBox[{
         RowBox[{
          RowBox[{"FirstBlock", " ", "\[Equal]", " ", "\"\<Foward\>\""}], " ",
           "&&", " ", 
          RowBox[{"Not", " ", "PointingUp"}]}], ",", " ", 
         RowBox[{"AddIdx", "=", "1"}]}], "]"}], ";", "\[IndentingNewLine]", 
       RowBox[{"If", " ", "[", 
        RowBox[{
         RowBox[{
          RowBox[{"FirstBlock", " ", "\[Equal]", " ", "\"\<Backward\>\""}], 
          " ", "&&", " ", "PointingUp"}], ",", " ", 
         RowBox[{"AddIdx", "=", "1"}]}], "]"}], ";", "\[IndentingNewLine]", 
       RowBox[{"If", " ", "[", 
        RowBox[{
         RowBox[{
          RowBox[{"FirstBlock", " ", "\[Equal]", " ", "\"\<Backward\>\""}], 
          " ", "&&", " ", 
          RowBox[{"Not", " ", "PointingUp"}]}], ",", " ", 
         RowBox[{"AddIdx", "=", "3"}]}], "]"}], ";", "\[IndentingNewLine]", 
       "\[IndentingNewLine]", 
       RowBox[{"If", " ", "[", 
        RowBox[{"PointingUp", ",", "  ", "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{"Mag", "[", "idx_", "]"}], " ", ":=", " ", 
          RowBox[{"PointingUpList", "[", 
           RowBox[{"[", 
            RowBox[{"If", "[", 
             RowBox[{
              RowBox[{"Divisible", "[", 
               RowBox[{
                RowBox[{"idx", " ", "+", " ", "AddIdx"}], ",", " ", "4"}], 
               "]"}], " ", ",", " ", "4", " ", ",", " ", 
              RowBox[{"Mod", "[", 
               RowBox[{
                RowBox[{"idx", "+", " ", "AddIdx"}], ",", " ", "4"}], "]"}]}],
              " ", "]"}], "]"}], "]"}]}], ",", " ", "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{"Mag", "[", "idx_", "]"}], " ", ":=", " ", 
          RowBox[{"PointingDownList", "[", 
           RowBox[{"[", 
            RowBox[{"If", "[", 
             RowBox[{
              RowBox[{"Divisible", "[", 
               RowBox[{
                RowBox[{"idx", " ", "+", " ", "AddIdx"}], ",", " ", "4"}], 
               "]"}], ",", " ", "4", " ", ",", " ", 
              RowBox[{"Mod", "[", 
               RowBox[{
                RowBox[{"idx", "+", " ", "AddIdx"}], ",", " ", "4"}], "]"}]}],
              " ", "]"}], "]"}], "]"}]}]}], "\[IndentingNewLine]", "]"}], ";",
        " ", "\[IndentingNewLine]", "\[IndentingNewLine]", 
       RowBox[{"(*", 
        RowBox[{"Position", " ", "and", " ", "magnetization", " ", "errors"}],
         "*)"}], "\[IndentingNewLine]", 
       RowBox[{"If", " ", "[", 
        RowBox[{
         RowBox[{
          RowBox[{"Length", "[", "PosMagErrors", "]"}], " ", "\[Equal]", " ", 
          "0"}], ",", " ", 
         RowBox[{"PosMagErrors", " ", "=", " ", 
          RowBox[{"Table", "[", 
           RowBox[{
            RowBox[{"{", 
             RowBox[{
              RowBox[{"{", 
               RowBox[{"0", ",", " ", "0", ",", " ", "0"}], "}"}], ",", 
              RowBox[{"{", 
               RowBox[{"0", ",", " ", "0", ",", " ", "0"}], "}"}]}], "}"}], 
            ",", " ", "NrBlocks"}], "]"}]}]}], "]"}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"If", " ", "[", 
        RowBox[{
         RowBox[{
          RowBox[{"Length", "[", "PosMagErrors", "]"}], " ", "\[NotEqual]", 
          " ", "NrBlocks"}], ",", " ", 
         RowBox[{"Return", "[", "]"}]}], "]"}], ";", "\[IndentingNewLine]", 
       RowBox[{"ErrorH", " ", "=", " ", 
        RowBox[{"PosMagErrors", "[", 
         RowBox[{"[", 
          RowBox[{"All", ",", " ", "1", ",", " ", "1"}], "]"}], "]"}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"ErrorV", " ", "=", " ", 
        RowBox[{"PosMagErrors", "[", 
         RowBox[{"[", 
          RowBox[{"All", ",", " ", "1", ",", " ", "2"}], "]"}], "]"}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"ErrorL", " ", "=", " ", 
        RowBox[{"PosMagErrors", "[", 
         RowBox[{"[", 
          RowBox[{"All", ",", " ", "1", ",", " ", "3"}], "]"}], "]"}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"ErrorMag", "=", " ", 
        RowBox[{"PosMagErrors", "[", 
         RowBox[{"[", 
          RowBox[{"All", ",", " ", "2"}], "]"}], "]"}]}], ";", 
       "\[IndentingNewLine]", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"PosWithErrors", "[", "idx_", "]"}], ":=", " ", 
        RowBox[{
         RowBox[{"Pos", "[", 
          RowBox[{"[", "idx", "]"}], "]"}], "+", 
         RowBox[{"ErrorL", "[", 
          RowBox[{"[", "idx", "]"}], "]"}]}]}], " ", ";", 
       "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"MagWithErrors", "[", "idx_", "]"}], ":=", " ", 
        RowBox[{
         RowBox[{"Mag", "[", "idx", "]"}], "+", " ", 
         RowBox[{"ErrorMag", "[", 
          RowBox[{"[", "idx", "]"}], "]"}]}]}], ";", "\[IndentingNewLine]", 
       "\[IndentingNewLine]", 
       RowBox[{"If", " ", "[", 
        RowBox[{
        "Rectangular", ",", "\[IndentingNewLine]", "\[IndentingNewLine]", 
         RowBox[{"(*", 
          RowBox[{
          "Creates", " ", "rectangular", " ", "parallelepipedic", " ", 
           "blocks", " ", "with", " ", "magnetization"}], "*)"}], 
         "\[IndentingNewLine]", "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{"BlockCenter", " ", "=", " ", 
           RowBox[{"RegionCentroid", "[", 
            RowBox[{"Polygon", "[", 
             RowBox[{"Shape", "[", 
              RowBox[{"[", "1", "]"}], "]"}], "]"}], "]"}]}], ";", 
          "\[IndentingNewLine]", 
          RowBox[{
           RowBox[{"BlockHCenterWithErrors", "[", "idx_", "]"}], " ", ":=", 
           RowBox[{
            RowBox[{"BlockCenter", "[", 
             RowBox[{"[", "1", "]"}], "]"}], "+", 
            RowBox[{"ErrorH", "[", 
             RowBox[{"[", "idx", "]"}], "]"}]}]}], ";", "\[IndentingNewLine]", 
          RowBox[{
           RowBox[{"BlockVCenterWithErrors", "[", "idx_", "]"}], " ", ":=", 
           RowBox[{
            RowBox[{"BlockCenter", "[", 
             RowBox[{"[", "2", "]"}], "]"}], "+", 
            RowBox[{"ErrorV", "[", 
             RowBox[{"[", "idx", "]"}], "]"}]}]}], ";", "\[IndentingNewLine]",
           "\[IndentingNewLine]", 
          RowBox[{"Lh", " ", "=", " ", 
           RowBox[{
            RowBox[{"Max", "[", 
             RowBox[{"Shape", "[", 
              RowBox[{"[", 
               RowBox[{"1", ",", " ", "All", ",", " ", "1"}], "]"}], "]"}], 
             "]"}], " ", "-", " ", 
            RowBox[{"Min", "[", 
             RowBox[{"Shape", "[", 
              RowBox[{"[", 
               RowBox[{"1", ",", " ", "All", ",", " ", "1"}], "]"}], "]"}], 
             "]"}]}]}], ";", "\[IndentingNewLine]", 
          RowBox[{"Lv", " ", "=", " ", 
           RowBox[{
            RowBox[{"Max", "[", 
             RowBox[{"Shape", "[", 
              RowBox[{"[", 
               RowBox[{"1", ",", " ", "All", ",", " ", "2"}], "]"}], "]"}], 
             "]"}], " ", "-", " ", 
            RowBox[{"Min", "[", 
             RowBox[{"Shape", "[", 
              RowBox[{"[", 
               RowBox[{"1", ",", " ", "All", ",", " ", "2"}], "]"}], "]"}], 
             "]"}]}]}], ";", "\[IndentingNewLine]", "\[IndentingNewLine]", 
          RowBox[{"(*", 
           RowBox[{"Termination", " ", "blocks"}], "*)"}], 
          "\[IndentingNewLine]", 
          RowBox[{"CassetteBeg", " ", "=", " ", 
           RowBox[{"{", "}"}]}], ";", "\[IndentingNewLine]", 
          RowBox[{"CassetteEnd", " ", "=", " ", 
           RowBox[{"{", "}"}]}], ";", "\[IndentingNewLine]", 
          "\[IndentingNewLine]", 
          RowBox[{"If", " ", "[", 
           RowBox[{
            RowBox[{
             RowBox[{"Termination", "\[Equal]", " ", "\"\<OneBlockSym\>\""}], 
             " ", "||", " ", 
             RowBox[{
             "Termination", "\[Equal]", " ", "\"\<OneBlockAntiSym\>\""}]}], 
            ",", "\[IndentingNewLine]", 
            RowBox[{
             RowBox[{"CassetteBeg", " ", "=", 
              RowBox[{"radObjRecMag", "[", 
               RowBox[{
                RowBox[{"{", 
                 RowBox[{
                  RowBox[{"BlockHCenterWithErrors", "[", "1", "]"}], ",", 
                  RowBox[{"BlockVCenterWithErrors", "[", "1", "]"}], ",", 
                  RowBox[{
                   RowBox[{"PosWithErrors", "[", "1", "]"}], " ", "+", " ", 
                   RowBox[{"Wm", "/", "4"}], " ", "+", " ", "\[Delta]"}]}], 
                 "}"}], ",", 
                RowBox[{"{", 
                 RowBox[{"Lh", ",", "Lv", ",", " ", 
                  RowBox[{"Len", "/", "2"}]}], "}"}], ",", 
                RowBox[{"MagWithErrors", "[", "1", "]"}]}], "]"}]}], ";", 
             "\[IndentingNewLine]", 
             RowBox[{"CassetteEnd", " ", "=", " ", 
              RowBox[{"radObjRecMag", "[", 
               RowBox[{
                RowBox[{"{", 
                 RowBox[{
                  RowBox[{"BlockHCenterWithErrors", "[", "NrBlocks", "]"}], 
                  ",", 
                  RowBox[{"BlockVCenterWithErrors", "[", "NrBlocks", "]"}], 
                  ",", 
                  RowBox[{
                   RowBox[{"PosWithErrors", "[", "NrBlocks", "]"}], "-", " ", 
                   RowBox[{"Wm", "/", "4"}], " ", "+", " ", "\[Delta]"}]}], 
                 "}"}], ",", 
                RowBox[{"{", 
                 RowBox[{"Lh", ",", "Lv", ",", 
                  RowBox[{"Len", "/", "2"}]}], "}"}], ",", 
                RowBox[{"MagWithErrors", "[", "NrBlocks", "]"}]}], "]"}]}], 
             ";"}]}], "\[IndentingNewLine]", "]"}], ";", 
          "\[IndentingNewLine]", "\[IndentingNewLine]", 
          RowBox[{"If", " ", "[", 
           RowBox[{
            RowBox[{
             RowBox[{
             "Termination", "\[Equal]", " ", "\"\<ThreeBlocksSym\>\""}], " ", 
             "||", " ", 
             RowBox[{
             "Termination", "\[Equal]", " ", "\"\<ThreeBlocksAntiSym\>\""}]}],
             ",", "\[IndentingNewLine]", 
            RowBox[{
             RowBox[{"CassetteBeg1", " ", "=", 
              RowBox[{"radObjRecMag", "[", 
               RowBox[{
                RowBox[{"{", 
                 RowBox[{
                  RowBox[{"BlockHCenterWithErrors", "[", "1", "]"}], ",", 
                  RowBox[{"BlockVCenterWithErrors", "[", "1", "]"}], ",", 
                  RowBox[{
                   RowBox[{"PosWithErrors", "[", "1", "]"}], "+", " ", 
                   RowBox[{"3", "*", 
                    RowBox[{"Wm", "/", "8"}]}], " ", "+", " ", "\[Delta]"}]}],
                  "}"}], ",", 
                RowBox[{"{", 
                 RowBox[{"Lh", ",", "Lv", ",", 
                  RowBox[{"Len", "/", "4"}]}], "}"}], ",", 
                RowBox[{"MagWithErrors", "[", "1", "]"}]}], "]"}]}], ";", 
             "\[IndentingNewLine]", 
             RowBox[{"CassetteBeg2", " ", "=", 
              RowBox[{"radObjRecMag", "[", 
               RowBox[{
                RowBox[{"{", 
                 RowBox[{
                  RowBox[{"BlockHCenterWithErrors", "[", "2", "]"}], ",", " ", 
                  RowBox[{"BlockVCenterWithErrors", "[", "2", "]"}], ",", 
                  RowBox[{
                   RowBox[{"PosWithErrors", "[", "2", "]"}], "+", "  ", 
                   RowBox[{"Wm", "/", "4"}], " ", "+", " ", "\[Delta]"}]}], 
                 "}"}], ",", 
                RowBox[{"{", 
                 RowBox[{"Lh", ",", "Lv", ",", 
                  RowBox[{"Len", "/", "2"}]}], "}"}], ",", 
                RowBox[{"MagWithErrors", "[", "2", "]"}]}], "]"}]}], ";", 
             "\[IndentingNewLine]", 
             RowBox[{"CassetteBeg3", " ", "=", 
              RowBox[{"radObjRecMag", "[", 
               RowBox[{
                RowBox[{"{", 
                 RowBox[{
                  RowBox[{"BlockHCenterWithErrors", "[", "3", "]"}], ",", 
                  RowBox[{"BlockVCenterWithErrors", "[", "3", "]"}], ",", 
                  RowBox[{
                   RowBox[{"PosWithErrors", "[", "3", "]"}], "+", "   ", 
                   RowBox[{"Wm", "/", "8"}], "+", " ", "\[Delta]"}]}], "}"}], 
                ",", 
                RowBox[{"{", 
                 RowBox[{"Lh", ",", "Lv", ",", 
                  RowBox[{"3", "*", 
                   RowBox[{"Len", "/", "4"}]}]}], "}"}], ",", 
                RowBox[{"MagWithErrors", "[", "3", "]"}]}], "]"}]}], ";", 
             "\[IndentingNewLine]", 
             RowBox[{"CassetteBeg", " ", "=", " ", 
              RowBox[{"{", 
               RowBox[{
               "CassetteBeg1", ",", " ", "CassetteBeg2", ",", " ", 
                "CassetteBeg3"}], "}"}]}], ";", "\[IndentingNewLine]", 
             "\[IndentingNewLine]", 
             RowBox[{"CassetteEnd3", " ", "=", " ", 
              RowBox[{"radObjRecMag", "[", 
               RowBox[{
                RowBox[{"{", 
                 RowBox[{
                  RowBox[{"BlockHCenterWithErrors", "[", 
                   RowBox[{"NrBlocks", "-", "2"}], "]"}], ",", 
                  RowBox[{"BlockVCenterWithErrors", "[", 
                   RowBox[{"NrBlocks", "-", "2"}], "]"}], ",", " ", 
                  RowBox[{
                   RowBox[{"PosWithErrors", "[", 
                    RowBox[{"NrBlocks", "-", "2"}], "]"}], "-", "  ", 
                   RowBox[{"Wm", "/", "8"}], "+", " ", "\[Delta]"}]}], "}"}], 
                ",", 
                RowBox[{"{", 
                 RowBox[{"Lh", ",", " ", "Lv", ",", " ", 
                  RowBox[{"3", "*", 
                   RowBox[{"Len", "/", "4"}]}]}], "}"}], ",", 
                RowBox[{"MagWithErrors", "[", 
                 RowBox[{"NrBlocks", "-", "2"}], "]"}]}], "]"}]}], ";", 
             "\[IndentingNewLine]", 
             RowBox[{"CassetteEnd2", " ", "=", " ", 
              RowBox[{"radObjRecMag", "[", 
               RowBox[{
                RowBox[{"{", 
                 RowBox[{
                  RowBox[{"BlockHCenterWithErrors", "[", 
                   RowBox[{"NrBlocks", "-", "1"}], "]"}], ",", 
                  RowBox[{"BlockVCenterWithErrors", "[", 
                   RowBox[{"NrBlocks", "-", "1"}], "]"}], ",", 
                  RowBox[{
                   RowBox[{"PosWithErrors", "[", 
                    RowBox[{"NrBlocks", "-", "1"}], "]"}], "-", "  ", 
                   RowBox[{"Wm", "/", "4"}], " ", "+", " ", "\[Delta]"}]}], 
                 "}"}], ",", 
                RowBox[{"{", 
                 RowBox[{"Lh", ",", "Lv", ",", 
                  RowBox[{"Len", "/", "2"}]}], "}"}], ",", 
                RowBox[{"MagWithErrors", "[", 
                 RowBox[{"NrBlocks", "-", "1"}], "]"}]}], "]"}]}], ";", 
             "\[IndentingNewLine]", 
             RowBox[{"CassetteEnd1", " ", "=", " ", 
              RowBox[{"radObjRecMag", "[", 
               RowBox[{
                RowBox[{"{", 
                 RowBox[{
                  RowBox[{"BlockHCenterWithErrors", "[", "NrBlocks", "]"}], 
                  ",", " ", 
                  RowBox[{"BlockVCenterWithErrors", "[", "NrBlocks", "]"}], 
                  ",", 
                  RowBox[{
                   RowBox[{"PosWithErrors", "[", "NrBlocks", "]"}], "-", " ", 
                   RowBox[{"3", "*", 
                    RowBox[{"Wm", "/", "8"}]}], " ", "+", " ", "\[Delta]"}]}],
                  "}"}], ",", 
                RowBox[{"{", 
                 RowBox[{"Lh", ",", "Lv", ",", 
                  RowBox[{"Len", "/", "4"}]}], "}"}], ",", 
                RowBox[{"MagWithErrors", "[", "NrBlocks", "]"}]}], "]"}]}], 
             ";", "\[IndentingNewLine]", 
             RowBox[{"CassetteEnd", " ", "=", " ", 
              RowBox[{"{", 
               RowBox[{
               "CassetteEnd3", ",", " ", "CassetteEnd2", ",", " ", 
                "CassetteEnd1"}], "}"}]}], ";"}]}], "\[IndentingNewLine]", 
           "]"}], ";", "\[IndentingNewLine]", "\[IndentingNewLine]", 
          RowBox[{"(*", "Core", "*)"}], "\[IndentingNewLine]", 
          RowBox[{"CassetteCore", " ", "=", " ", 
           RowBox[{"{", "}"}]}], ";", "\[IndentingNewLine]", 
          RowBox[{"For", " ", "[", 
           RowBox[{
            RowBox[{"i", "=", 
             RowBox[{"(", 
              RowBox[{"NrTermBlocks", "+", "1"}], ")"}]}], ",", " ", 
            RowBox[{"i", "\[LessEqual]", " ", 
             RowBox[{"NrBlocks", " ", "-", " ", "NrTermBlocks"}]}], ",", " ", 
            RowBox[{"i", "++"}], ",", "\[IndentingNewLine]", 
            RowBox[{
             RowBox[{"AppendTo", "[", 
              RowBox[{"CassetteCore", ",", " ", 
               RowBox[{"radObjRecMag", "[", 
                RowBox[{
                 RowBox[{"{", 
                  RowBox[{
                   RowBox[{"BlockHCenterWithErrors", "[", "i", "]"}], ",", 
                   RowBox[{"BlockVCenterWithErrors", "[", "i", "]"}], ",", 
                   RowBox[{
                    RowBox[{"PosWithErrors", "[", "i", "]"}], "+", " ", 
                    "\[Delta]"}]}], "}"}], ",", 
                 RowBox[{"{", 
                  RowBox[{"Lh", ",", "Lv", ",", "Len"}], "}"}], ",", 
                 RowBox[{"MagWithErrors", "[", "i", "]"}]}], "]"}]}], "]"}], 
             ";"}]}], "\[IndentingNewLine]", "]"}], ";", 
          "\[IndentingNewLine]", "\[IndentingNewLine]", 
          RowBox[{"Cassette", "   ", "=", "  ", 
           RowBox[{"radObjCnt", "[", 
            RowBox[{"Flatten", "[", 
             RowBox[{"{", 
              RowBox[{
              "CassetteBeg", ",", " ", "CassetteCore", ",", "CassetteEnd"}], 
              "}"}], "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
          "\[IndentingNewLine]", 
          RowBox[{"(*", 
           RowBox[{"Shift", " ", "the", " ", "cassette"}], "*)"}], 
          "\[IndentingNewLine]", 
          RowBox[{"Shift", "=", 
           RowBox[{
            RowBox[{"-", 
             RowBox[{"(", 
              RowBox[{
               RowBox[{"Pos", "[", 
                RowBox[{"[", "1", "]"}], "]"}], "+", " ", 
               RowBox[{"Pos", "[", 
                RowBox[{"[", 
                 RowBox[{"-", "1"}], "]"}], "]"}]}], ")"}]}], "/", "2"}]}], 
          " ", ";", "\[IndentingNewLine]", 
          RowBox[{"Cassette", " ", "=", " ", 
           RowBox[{"radTrfOrnt", "[", 
            RowBox[{"Cassette", ",", 
             RowBox[{"radTrfTrsl", "[", 
              RowBox[{"{", 
               RowBox[{"0", ",", "0", ",", "Shift"}], "}"}], "]"}]}], "]"}]}],
           ";"}], "\[IndentingNewLine]", "\[IndentingNewLine]", ",", 
         "\[IndentingNewLine]", "\[IndentingNewLine]", 
         RowBox[{"(*", 
          RowBox[{
           RowBox[{
           "Creates", " ", "extruded", " ", "polygon", " ", "blocks", " ", 
            "with", " ", "magnetization", "\[IndentingNewLine]", 
            "\[IndentingNewLine]", " ", "The", " ", "permanent", " ", 
            "blocks", " ", "are", " ", "created", " ", "with", " ", "a", " ", 
            "extrusion", " ", "of", " ", "the", " ", "cross", " ", "section", 
            " ", "of", " ", "the", " ", "block", " ", "and", " ", "the", " ", 
            "magnetization", " ", "vector", " ", "must", " ", "be", " ", 
            "specified", " ", "in", " ", "the", " ", "block", " ", 
            RowBox[{
            "creation", ".", " ", "\[IndentingNewLine]", "However"}]}], ",", 
           " ", 
           RowBox[{
           "the", " ", "extrusion", " ", "is", " ", "done", " ", "in", " ", 
            "the", " ", "x", " ", "direction"}], ",", " ", 
           RowBox[{
           "so", " ", "for", " ", "blocks", " ", "with", " ", "a", " ", 
            "constant", " ", "cross", " ", "section", " ", "in", " ", "the", 
            " ", "longitudinal", " ", "direction"}], ",", " ", 
           RowBox[{
           "the", " ", "objects", " ", "must", " ", "be", " ", "rotated", " ",
             "after", " ", 
            RowBox[{"creation", ".", " ", "\[IndentingNewLine]", "The"}], " ",
             "magnetization", " ", "vector", " ", "is", " ", "affected", " ", 
            "by", " ", "this", " ", "rotation"}], ",", " ", 
           RowBox[{
           "so", " ", "a", " ", "inverse", " ", "transformation", " ", "must",
             " ", "be", " ", "applied", " ", "to", " ", "the", " ", "vector", 
            " ", "before", " ", "the", " ", "block", " ", "is", " ", 
            RowBox[{"created", "."}]}]}], "*)"}], "\[IndentingNewLine]", 
         "\[IndentingNewLine]", 
         RowBox[{"(*", 
          RowBox[{"Block", " ", "shape", " ", "with", " ", "errors"}], "*)"}],
          "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{
           RowBox[{"ShapeWithErrors", "[", "idx_", "]"}], " ", ":=", " ", 
           RowBox[{
            RowBox[{
             RowBox[{
              RowBox[{
               RowBox[{"#", "+", 
                RowBox[{"{", 
                 RowBox[{
                  RowBox[{"ErrorH", "[", 
                   RowBox[{"[", "idx", "]"}], "]"}], ",", 
                  RowBox[{"ErrorV", "[", 
                   RowBox[{"[", "idx", "]"}], "]"}]}], "}"}]}], "&"}], "/@", 
              "#"}], "&"}], "/@", "Shape"}]}], ";", "\[IndentingNewLine]", 
          "\[IndentingNewLine]", 
          RowBox[{"(*", 
           RowBox[{
            RowBox[{
            "Counterclockwise", " ", "rotations", " ", "of", " ", "the", " ", 
             "magnetization", " ", "vector", " ", "by", " ", 
             RowBox[{"\[Pi]", "/", "2"}], " ", "around", " ", "the", " ", 
             "y"}], "-", 
            RowBox[{"axis", " ", "and", " ", "by", " ", 
             RowBox[{"\[Pi]", "/", "2"}], " ", "around", " ", "the", " ", 
             "x"}], "-", "axis"}], "*)"}], "\[IndentingNewLine]", 
          RowBox[{
           RowBox[{"RotMagWithErrors", "[", "idx_", "]"}], " ", ":=", " ", 
           RowBox[{"Dot", "[", 
            RowBox[{
             RowBox[{"RotationMatrix", "[", 
              RowBox[{
               RowBox[{"\[Pi]", "/", "2"}], ",", " ", 
               RowBox[{"{", 
                RowBox[{"1", ",", "0", ",", "0"}], "}"}]}], "]"}], ",", " ", 
             RowBox[{"Dot", "[", 
              RowBox[{
               RowBox[{"RotationMatrix", "[", 
                RowBox[{
                 RowBox[{"\[Pi]", "/", "2"}], ",", " ", 
                 RowBox[{"{", 
                  RowBox[{"0", ",", "1", ",", "0"}], "}"}]}], "]"}], ",", " ", 
               RowBox[{"MagWithErrors", "[", "idx", "]"}]}], "]"}]}], "]"}]}],
           " ", ";", "\[IndentingNewLine]", "\[IndentingNewLine]", 
          RowBox[{"(*", 
           RowBox[{"Termination", " ", "blocks"}], "*)"}], 
          "\[IndentingNewLine]", 
          RowBox[{"CassetteBeg", " ", "=", " ", 
           RowBox[{"{", "}"}]}], ";", "\[IndentingNewLine]", 
          RowBox[{"CassetteEnd", " ", "=", " ", 
           RowBox[{"{", "}"}]}], ";", "\[IndentingNewLine]", 
          "\[IndentingNewLine]", 
          RowBox[{"If", " ", "[", 
           RowBox[{
            RowBox[{
             RowBox[{"Termination", "\[Equal]", " ", "\"\<OneBlockSym\>\""}], 
             " ", "||", " ", 
             RowBox[{
             "Termination", "\[Equal]", " ", "\"\<OneBlockAntiSym\>\""}]}], 
            ",", "\[IndentingNewLine]", 
            RowBox[{
             RowBox[{"CassetteBeg", " ", "=", " ", 
              RowBox[{
               RowBox[{
                RowBox[{"radObjThckPgn", "[", 
                 RowBox[{
                  RowBox[{
                   RowBox[{"PosWithErrors", "[", "1", "]"}], " ", "+", " ", 
                   RowBox[{"Wm", "/", "4"}], " ", "+", " ", "\[Delta]"}], ",",
                   "   ", 
                  RowBox[{"Len", "/", "2"}], ",", "#", ",", " ", 
                  RowBox[{"RotMagWithErrors", "[", "1", "]"}]}], "]"}], "&"}],
                "/@", " ", 
               RowBox[{"ShapeWithErrors", "[", "1", "]"}]}]}], " ", ";", 
             "\[IndentingNewLine]", 
             RowBox[{"CassetteEnd", " ", "=", " ", 
              RowBox[{
               RowBox[{
                RowBox[{"radObjThckPgn", "[", 
                 RowBox[{
                  RowBox[{
                   RowBox[{"PosWithErrors", "[", "NrBlocks", "]"}], "-", "  ", 
                   RowBox[{"Wm", "/", "4"}], "+", " ", "\[Delta]"}], ",", " ", 
                  RowBox[{"Len", "/", "2"}], ",", "#", ",", " ", 
                  RowBox[{"RotMagWithErrors", "[", "NrBlocks", "]"}]}], "]"}],
                 "&"}], "/@", 
               RowBox[{"ShapeWithErrors", "[", "NrBlocks", "]"}]}]}], ";"}]}],
            "\[IndentingNewLine]", "]"}], ";", "\[IndentingNewLine]", 
          "\[IndentingNewLine]", 
          RowBox[{"If", " ", "[", 
           RowBox[{
            RowBox[{
             RowBox[{
             "Termination", "\[Equal]", " ", "\"\<ThreeBlocksSym\>\""}], " ", 
             "||", " ", 
             RowBox[{
             "Termination", "\[Equal]", " ", "\"\<ThreeBlocksAntiSym\>\""}]}],
             ",", "\[IndentingNewLine]", 
            RowBox[{
             RowBox[{"CassetteBeg1", " ", "=", " ", 
              RowBox[{
               RowBox[{
                RowBox[{"radObjThckPgn", "[", 
                 RowBox[{
                  RowBox[{
                   RowBox[{"PosWithErrors", "[", "1", "]"}], " ", "+", " ", 
                   RowBox[{"3", 
                    RowBox[{"Wm", "/", "8"}]}], " ", "+", " ", "\[Delta]"}], 
                  ",", " ", 
                  RowBox[{"Len", "/", "4"}], ",", "#", ",", " ", 
                  RowBox[{"RotMagWithErrors", "[", "1", "]"}]}], "]"}], "&"}],
                "/@", 
               RowBox[{"ShapeWithErrors", "[", "1", "]"}]}]}], ";", 
             "\[IndentingNewLine]", 
             RowBox[{"CassetteBeg2", " ", "=", " ", 
              RowBox[{
               RowBox[{
                RowBox[{"radObjThckPgn", "[", 
                 RowBox[{
                  RowBox[{
                   RowBox[{"PosWithErrors", "[", "2", "]"}], "+", " ", 
                   RowBox[{"Wm", "/", "4"}], "+", " ", "\[Delta]"}], ",", " ", 
                  RowBox[{"Len", "/", "2"}], ",", "#", ",", " ", 
                  RowBox[{"RotMagWithErrors", "[", "2", "]"}]}], "]"}], "&"}],
                "/@", 
               RowBox[{"ShapeWithErrors", "[", "2", "]"}]}]}], ";", 
             "\[IndentingNewLine]", 
             RowBox[{"CassetteBeg3", " ", "=", " ", 
              RowBox[{
               RowBox[{
                RowBox[{"radObjThckPgn", "[", 
                 RowBox[{
                  RowBox[{
                   RowBox[{"PosWithErrors", "[", "3", "]"}], " ", "+", " ", 
                   RowBox[{"Wm", "/", "8"}], "+", " ", "\[Delta]"}], ",", " ", 
                  RowBox[{"3", 
                   RowBox[{"Len", "/", "4"}]}], ",", "#", ",", " ", 
                  RowBox[{"RotMagWithErrors", "[", "3", "]"}]}], "]"}], "&"}],
                "/@", " ", 
               RowBox[{"ShapeWithErrors", "[", "3", "]"}]}]}], ";", 
             "\[IndentingNewLine]", 
             RowBox[{"CassetteBeg", " ", "=", " ", 
              RowBox[{"{", 
               RowBox[{
               "CassetteBeg1", ",", " ", "CassetteBeg2", ",", " ", 
                "CassetteBeg3"}], "}"}]}], ";", "\[IndentingNewLine]", 
             "\[IndentingNewLine]", 
             RowBox[{"CassetteEnd3", " ", "=", " ", 
              RowBox[{
               RowBox[{
                RowBox[{"radObjThckPgn", "[", 
                 RowBox[{
                  RowBox[{
                   RowBox[{"PosWithErrors", "[", 
                    RowBox[{"NrBlocks", "-", "2"}], "]"}], " ", "-", " ", 
                   RowBox[{"Wm", "/", "8"}], "+", " ", "\[Delta]"}], ",", " ", 
                  RowBox[{"3", 
                   RowBox[{"Len", "/", "4"}]}], ",", "#", ",", " ", 
                  RowBox[{"RotMagWithErrors", "[", 
                   RowBox[{"NrBlocks", "-", "2"}], "]"}]}], "]"}], "&"}], "/@", 
               RowBox[{"ShapeWithErrors", "[", 
                RowBox[{"NrBlocks", "-", "2"}], "]"}]}]}], ";", 
             "\[IndentingNewLine]", 
             RowBox[{"CassetteEnd2", " ", "=", " ", 
              RowBox[{
               RowBox[{
                RowBox[{"radObjThckPgn", "[", 
                 RowBox[{
                  RowBox[{
                   RowBox[{"PosWithErrors", "[", 
                    RowBox[{"NrBlocks", "-", "1"}], "]"}], " ", "-", " ", 
                   RowBox[{"Wm", "/", "4"}], "+", " ", "\[Delta]"}], ",", " ", 
                  RowBox[{"Len", "/", "2"}], ",", "#", ",", " ", 
                  RowBox[{"RotMagWithErrors", "[", 
                   RowBox[{"NrBlocks", "-", "1"}], "]"}]}], "]"}], "&"}], "/@", 
               RowBox[{"ShapeWithErrors", "[", 
                RowBox[{"NrBlocks", "-", "1"}], "]"}]}]}], ";", 
             "\[IndentingNewLine]", 
             RowBox[{"CassetteEnd1", " ", "=", " ", 
              RowBox[{
               RowBox[{
                RowBox[{"radObjThckPgn", "[", 
                 RowBox[{
                  RowBox[{
                   RowBox[{"PosWithErrors", "[", "NrBlocks", "]"}], " ", "-", 
                   RowBox[{"3", 
                    RowBox[{"Wm", "/", "8"}]}], "+", " ", "\[Delta]"}], ",", 
                  " ", 
                  RowBox[{"Len", "/", "4"}], ",", "#", ",", " ", 
                  RowBox[{"RotMagWithErrors", "[", "NrBlocks", "]"}]}], "]"}],
                 "&"}], "/@", 
               RowBox[{"ShapeWithErrors", "[", "NrBlocks", "]"}]}]}], ";", 
             "\[IndentingNewLine]", 
             RowBox[{"CassetteEnd", " ", "=", " ", 
              RowBox[{"{", 
               RowBox[{
               "CassetteEnd3", ",", " ", "CassetteEnd2", ",", " ", 
                "CassetteEnd1"}], "}"}]}], ";"}]}], "\[IndentingNewLine]", 
           "]"}], ";", "\[IndentingNewLine]", "\[IndentingNewLine]", 
          RowBox[{"(*", "Core", "*)"}], "\[IndentingNewLine]", 
          RowBox[{"CassetteCore", " ", "=", " ", 
           RowBox[{"{", "}"}]}], ";", "\[IndentingNewLine]", 
          RowBox[{"For", " ", "[", 
           RowBox[{
            RowBox[{"i", "=", 
             RowBox[{"(", 
              RowBox[{"NrTermBlocks", "+", "1"}], ")"}]}], ",", " ", 
            RowBox[{"i", "\[LessEqual]", " ", 
             RowBox[{"NrBlocks", " ", "-", " ", "NrTermBlocks"}]}], ",", " ", 
            RowBox[{"i", "++"}], ",", "\[IndentingNewLine]", 
            RowBox[{
             RowBox[{
              RowBox[{
               RowBox[{"AppendTo", "[", 
                RowBox[{"CassetteCore", ",", " ", 
                 RowBox[{"radObjThckPgn", "[", 
                  RowBox[{
                   RowBox[{
                    RowBox[{"PosWithErrors", "[", "i", "]"}], "+", " ", 
                    "\[Delta]"}], ",", "Len", ",", "#", ",", " ", 
                   RowBox[{"RotMagWithErrors", "[", "i", "]"}]}], "]"}]}], 
                "]"}], "&"}], "/@", 
              RowBox[{"ShapeWithErrors", "[", "i", "]"}]}], " ", ";"}]}], 
           "\[IndentingNewLine]", "]"}], ";", "\[IndentingNewLine]", 
          "\[IndentingNewLine]", 
          RowBox[{"Cassette", "   ", "=", " ", 
           RowBox[{"radObjCnt", "[", 
            RowBox[{"Flatten", "[", 
             RowBox[{"{", 
              RowBox[{
              "CassetteBeg", " ", ",", " ", "CassetteCore", ",", 
               "CassetteEnd"}], "}"}], "]"}], "]"}]}], ";", 
          "\[IndentingNewLine]", "\[IndentingNewLine]", 
          RowBox[{"(*", 
           RowBox[{"Shift", " ", "the", " ", "cassette"}], "*)"}], 
          "\[IndentingNewLine]", 
          RowBox[{"Shift", "=", 
           RowBox[{
            RowBox[{"-", 
             RowBox[{"(", 
              RowBox[{
               RowBox[{"Pos", "[", 
                RowBox[{"[", "1", "]"}], "]"}], "+", " ", 
               RowBox[{"Pos", "[", 
                RowBox[{"[", 
                 RowBox[{"-", "1"}], "]"}], "]"}]}], ")"}]}], "/", "2"}]}], 
          " ", ";", "\[IndentingNewLine]", 
          RowBox[{"Cassette", " ", "=", " ", 
           RowBox[{"radTrfOrnt", "[", 
            RowBox[{"Cassette", ",", 
             RowBox[{"radTrfTrsl", "[", 
              RowBox[{"{", 
               RowBox[{"Shift", ",", "0", ",", "0"}], "}"}], "]"}]}], "]"}]}],
           ";", "\[IndentingNewLine]", "\[IndentingNewLine]", 
          RowBox[{"(*", 
           RowBox[{
            RowBox[{
            "Counterclockwise", " ", "rotation", " ", "of", " ", "the", " ", 
             "cassette", " ", "by"}], " ", "-", 
            RowBox[{
             RowBox[{"\[Pi]", "/", "2"}], " ", "around", " ", "the", " ", 
             "x"}], "-", "axis"}], "*)"}], "\[IndentingNewLine]", 
          RowBox[{"Cassette", "=", " ", 
           RowBox[{"radTrfOrnt", "[", 
            RowBox[{"Cassette", ",", " ", 
             RowBox[{"radTrfRot", "[", 
              RowBox[{
               RowBox[{"{", 
                RowBox[{"0", ",", "0", ",", "0"}], "}"}], ",", 
               RowBox[{"{", 
                RowBox[{"1", ",", "0", ",", "0"}], "}"}], ",", 
               RowBox[{
                RowBox[{"-", "\[Pi]"}], "/", "2"}]}], "]"}]}], "]"}]}], ";", 
          "\[IndentingNewLine]", "\[IndentingNewLine]", 
          RowBox[{"(*", 
           RowBox[{
            RowBox[{
            "Counterclockwise", " ", "rotation", " ", "of", " ", "the", " ", 
             "cassette", " ", "by"}], " ", "-", 
            RowBox[{
             RowBox[{"\[Pi]", "/", "2"}], " ", "around", " ", "the", " ", 
             "y"}], "-", "axis"}], "*)"}], "\[IndentingNewLine]", 
          RowBox[{"Cassette", "=", " ", 
           RowBox[{"radTrfOrnt", "[", 
            RowBox[{"Cassette", ",", " ", 
             RowBox[{"radTrfRot", "[", 
              RowBox[{
               RowBox[{"{", 
                RowBox[{"0", ",", "0", ",", "0"}], "}"}], ",", 
               RowBox[{"{", 
                RowBox[{"0", ",", "1", ",", "0"}], "}"}], ",", 
               RowBox[{
                RowBox[{"-", "\[Pi]"}], "/", "2"}]}], "]"}]}], "]"}]}], 
          ";"}]}], "\[IndentingNewLine]", "\[IndentingNewLine]", "]"}], ";", 
       "\[IndentingNewLine]", "\[IndentingNewLine]", 
       RowBox[{"Return", "[", "Cassette", "]"}], ";"}]}], 
     "\[IndentingNewLine]", "]"}]}], ";"}], "\[IndentingNewLine]"}]], "Input",
 CellChangeTimes->{{3.7667563716198864`*^9, 3.76675637607336*^9}, {
   3.7667564210925236`*^9, 3.7667565039740367`*^9}, {3.767445221866372*^9, 
   3.7674452499623413`*^9}, 3.7674492825809617`*^9, {3.7826372836996193`*^9, 
   3.782637315936621*^9}, {3.782637359577076*^9, 3.7826374825765934`*^9}, {
   3.782637552607568*^9, 3.78263768450115*^9}, {3.782637743188423*^9, 
   3.7826378222055535`*^9}, {3.782637856189788*^9, 3.782637902285347*^9}, {
   3.782637956646202*^9, 3.7826379589118185`*^9}, {3.7826379963510313`*^9, 
   3.7826380522744694`*^9}, {3.7826380832169104`*^9, 3.782638439756551*^9}, {
   3.7826384823501635`*^9, 3.7826385761329775`*^9}, {3.782638608587835*^9, 
   3.782638715809715*^9}, {3.7826388457671947`*^9, 3.7826390394108934`*^9}, {
   3.7826391010200243`*^9, 3.782639101770018*^9}, {3.782639166051016*^9, 
   3.782639483428545*^9}, {3.782639556287635*^9, 3.782639561334486*^9}, {
   3.7826396491173325`*^9, 3.7826398286009946`*^9}, {3.7826399117901325`*^9, 
   3.7826400534547825`*^9}, {3.782640090532792*^9, 3.7826405585668488`*^9}, {
   3.782640594521858*^9, 3.782640772400242*^9}, {3.7826408291968937`*^9, 
   3.782641220744748*^9}, {3.782641266900818*^9, 3.782641439540758*^9}, {
   3.7826415380716205`*^9, 3.782641576430842*^9}, {3.7826416069325433`*^9, 
   3.782641900267953*^9}, {3.782642091536579*^9, 3.7826421241301994`*^9}, {
   3.782642159770681*^9, 3.782642183333087*^9}, {3.782642768258963*^9, 
   3.7826428182481303`*^9}, {3.7826428851853724`*^9, 
   3.7826429424839563`*^9}, {3.782642980298272*^9, 3.7826429824232635`*^9}, {
   3.7826430294252024`*^9, 3.782643045909505*^9}, {3.782643084190604*^9, 
   3.782643129690423*^9}, {3.7826432037264595`*^9, 3.7826433699932384`*^9}, {
   3.782643405307832*^9, 3.782643478420932*^9}, {3.782643611689359*^9, 
   3.7826438111124973`*^9}, {3.782644897374318*^9, 3.782644921501483*^9}, {
   3.7826450171885633`*^9, 3.782645044032238*^9}, 3.7826450852820787`*^9, {
   3.7826451379869146`*^9, 3.782645156986842*^9}, {3.7834337430222216`*^9, 
   3.7834337438503695`*^9}, {3.7834338345867214`*^9, 3.783433837758585*^9}, {
   3.7849719852731423`*^9, 3.784971987038904*^9}},
 Background->RGBColor[0.87, 0.94, 1],
 CellLabel->"In[76]:=",ExpressionUUID->"75ae6db8-56b0-42fa-be98-b01f43c14434"]
}, Closed]],

Cell[CellGroupData[{

Cell["auxIDNumberToString", "Subsection",
 CellChangeTimes->{3.7667546801064196`*^9, 
  3.7667549456130934`*^9},ExpressionUUID->"bda74fb8-2d9d-4be5-8ac6-\
57e56aa5f7c6"],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"auxIDNumberToString", "[", "num_", "]"}], " ", ":=", " ", 
   RowBox[{"Module", "[", 
    RowBox[{
     RowBox[{"{", "sf", "}"}], ",", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"sf", " ", "=", " ", 
       RowBox[{"ScientificForm", "[", 
        RowBox[{
         RowBox[{"N", "[", "num", "]"}], ",", 
         RowBox[{"NumberFormat", "\[Rule]", 
          RowBox[{"(", 
           RowBox[{
            RowBox[{"Row", "[", 
             RowBox[{"{", 
              RowBox[{"#1", ",", "\"\<e\>\"", ",", "#3"}], "}"}], "]"}], 
            "&"}], ")"}]}], ",", " ", 
         RowBox[{"ExponentFunction", "->", 
          RowBox[{"(", 
           RowBox[{
            RowBox[{"If", "[", 
             RowBox[{
              RowBox[{
               RowBox[{"-", "5"}], "<", "#", "<", "5"}], ",", "Null", ",", 
              "#"}], "]"}], "&"}], ")"}]}]}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"If", "[", 
       RowBox[{
        RowBox[{"StringEndsQ", "[", 
         RowBox[{
          RowBox[{"ToString", "[", "sf", "]"}], ",", " ", "\"\<e\>\""}], 
         "]"}], ",", 
        RowBox[{"Return", "[", 
         RowBox[{"ToString", "[", 
          RowBox[{"N", "[", "num", "]"}], "]"}], "]"}], ",", 
        RowBox[{"Return", "[", 
         RowBox[{"ToString", "[", "sf", "]"}], "]"}]}], "]"}], ";"}]}], 
    "\[IndentingNewLine]", "]"}]}], ";"}]], "Input",
 Background->RGBColor[0.87, 0.94, 1],
 CellLabel->"In[77]:=",ExpressionUUID->"610d4740-b7f3-4398-a613-e9ffa7426fea"]
}, Closed]],

Cell[CellGroupData[{

Cell["auxIDNewtonLorentzEquation", "Subsection",
 CellChangeTimes->{3.7667546801064196`*^9, 3.7667549456130934`*^9, 
  3.766755008805561*^9},ExpressionUUID->"1c96306b-11c8-413b-b595-\
dbdc6cbfbf11"],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"auxIDNewtonLorentzEquation", "[", 
    RowBox[{"a_", ",", "r_", ",", "b_"}], "]"}], ":=", 
   RowBox[{"Module", "[", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"{", "drds", "}"}], ",", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"drds", " ", "=", " ", 
       RowBox[{"{", 
        RowBox[{"0", ",", "0", ",", "0", ",", "0", ",", "0", ",", "0"}], 
        "}"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"drds", "[", 
        RowBox[{"[", "1", "]"}], "]"}], "=", 
       RowBox[{"r", "[", 
        RowBox[{"[", "4", "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"drds", "[", 
        RowBox[{"[", "2", "]"}], "]"}], "=", 
       RowBox[{"r", "[", 
        RowBox[{"[", "5", "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"drds", "[", 
        RowBox[{"[", "3", "]"}], "]"}], "=", 
       RowBox[{"r", "[", 
        RowBox[{"[", "6", "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"drds", "[", 
        RowBox[{"[", "4", "]"}], "]"}], "=", 
       RowBox[{
        RowBox[{"-", "a"}], "*", 
        RowBox[{"(", 
         RowBox[{
          RowBox[{
           RowBox[{"r", "[", 
            RowBox[{"[", "5", "]"}], "]"}], "*", 
           RowBox[{"b", "[", 
            RowBox[{"[", "3", "]"}], "]"}]}], "-", 
          RowBox[{
           RowBox[{"r", "[", 
            RowBox[{"[", "6", "]"}], "]"}], "*", 
           RowBox[{"b", "[", 
            RowBox[{"[", "2", "]"}], "]"}]}]}], ")"}]}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"drds", "[", 
        RowBox[{"[", "5", "]"}], "]"}], "=", 
       RowBox[{
        RowBox[{"-", "a"}], "*", 
        RowBox[{"(", 
         RowBox[{
          RowBox[{
           RowBox[{"r", "[", 
            RowBox[{"[", "6", "]"}], "]"}], "*", 
           RowBox[{"b", "[", 
            RowBox[{"[", "1", "]"}], "]"}]}], "-", 
          RowBox[{
           RowBox[{"r", "[", 
            RowBox[{"[", "4", "]"}], "]"}], "*", 
           RowBox[{"b", "[", 
            RowBox[{"[", "2", "]"}], "]"}]}]}], ")"}]}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"drds", "[", 
        RowBox[{"[", "6", "]"}], "]"}], "=", 
       RowBox[{
        RowBox[{"-", "a"}], "*", 
        RowBox[{"(", 
         RowBox[{
          RowBox[{
           RowBox[{"r", "[", 
            RowBox[{"[", "4", "]"}], "]"}], "*", 
           RowBox[{"b", "[", 
            RowBox[{"[", "2", "]"}], "]"}]}], "-", 
          RowBox[{
           RowBox[{"r", "[", 
            RowBox[{"[", "5", "]"}], "]"}], "*", 
           RowBox[{"b", "[", 
            RowBox[{"[", "1", "]"}], "]"}]}]}], ")"}]}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"Return", "[", "drds", "]"}], ";"}]}], "\[IndentingNewLine]", 
    "]"}]}], ";"}]], "Input",
 Background->RGBColor[0.87, 0.94, 1],
 CellLabel->"In[78]:=",ExpressionUUID->"4ec534ec-808d-4e2d-866b-5ff831333ddb"]
}, Closed]],

Cell[CellGroupData[{

Cell["auxIDBlockArrow", "Subsection",
 CellChangeTimes->{
  3.766754730782276*^9},ExpressionUUID->"0427e292-5baf-4bc9-a96f-\
bce10a7286e0"],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"auxIDBlockArrow", "[", 
    RowBox[{"BlockCenter_", ",", " ", "BlockMag_", ",", " ", "ArrowSize_"}], 
    "]"}], ":=", " ", 
   RowBox[{"Module", "[", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"MagArrow", ",", " ", "MagDirection"}], "}"}], ",", 
     "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"MagDirection", " ", "=", " ", 
       RowBox[{"Normalize", "[", "BlockMag", "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"MagArrow", " ", "=", " ", 
       RowBox[{"Arrow", "[", 
        RowBox[{"{", 
         RowBox[{
          RowBox[{"BlockCenter", " ", "-", " ", 
           RowBox[{"MagDirection", " ", "*", 
            RowBox[{"ArrowSize", "/", "2"}]}]}], ",", " ", 
          RowBox[{"BlockCenter", " ", "+", " ", 
           RowBox[{"MagDirection", " ", "*", 
            RowBox[{"ArrowSize", "/", "2"}]}]}]}], "}"}], "]"}]}], ";", 
      "\[IndentingNewLine]", 
      RowBox[{"Return", "[", "MagArrow", "]"}], ";"}]}], 
    "\[IndentingNewLine]", "]"}]}], ";"}]], "Input",
 Background->RGBColor[0.87, 0.94, 1],
 CellLabel->"In[79]:=",ExpressionUUID->"44eaab1d-a653-4798-882b-a5e373cc572f"]
}, Closed]]
}, Open  ]]
}, Open  ]]
},
WindowSize->{1571, 997},
WindowMargins->{{90, Automatic}, {Automatic, 6}},
FrontEndVersion->"12.0 for Microsoft Windows (64-bit) (April 8, 2019)",
StyleDefinitions->"Default.nb"
]
(* End of Notebook Content *)

(* Internal cache information *)
(*CellTagsOutline
CellTagsIndex->{}
*)
(*CellTagsIndex
CellTagsIndex->{}
*)
(*NotebookFileOutline
Notebook[{
Cell[CellGroupData[{
Cell[580, 22, 1650, 23, 67, "Chapter",ExpressionUUID->"5f7ce718-2a29-4a8a-8eb1-683f55eff3b5"],
Cell[CellGroupData[{
Cell[2255, 49, 206, 4, 67, "Section",ExpressionUUID->"95156af7-5dd8-45da-a415-0a31d84b95f3"],
Cell[CellGroupData[{
Cell[2486, 57, 340, 7, 64, "Input",ExpressionUUID->"16d50c27-748f-4147-8860-75bd600bf2c6"],
Cell[CellGroupData[{
Cell[2851, 68, 478, 10, 22, "Print",ExpressionUUID->"35c65ebd-b6e7-4209-9327-772ac11f2e02"],
Cell[3332, 80, 308, 5, 22, "Print",ExpressionUUID->"cdfd8909-f355-4078-bf56-d61b542368ed"],
Cell[3643, 87, 324, 6, 22, "Print",ExpressionUUID->"35bbad5b-ea5f-485e-a5c0-fc6d2ba0665b"],
Cell[3970, 95, 317, 5, 22, "Print",ExpressionUUID->"c1f6254b-798a-4ba2-a70a-663bfafe01a9"]
}, Open  ]]
}, Open  ]]
}, Open  ]],
Cell[CellGroupData[{
Cell[4348, 107, 148, 3, 67, "Section",ExpressionUUID->"91a6e679-8d6a-434c-841a-c91067c369b8"],
Cell[CellGroupData[{
Cell[4521, 114, 157, 3, 53, "Subsection",ExpressionUUID->"6e533fa5-e911-4ccd-b297-49b6526dc497"],
Cell[4681, 119, 12215, 245, 1185, "Input",ExpressionUUID->"144b0752-c4a0-4150-8f34-feee4c82e808"]
}, Closed]],
Cell[CellGroupData[{
Cell[16933, 369, 193, 3, 37, "Subsection",ExpressionUUID->"158f9399-c099-49b7-8fa9-6c24cc88be6c"],
Cell[17129, 374, 12436, 260, 1242, "Input",ExpressionUUID->"c3685a3f-e1ee-4d8d-97bf-8f7c6784ba2a"]
}, Closed]]
}, Open  ]],
Cell[CellGroupData[{
Cell[29614, 640, 154, 3, 67, "Section",ExpressionUUID->"121e9b26-030a-41f4-86a3-ee4a843ad47b"],
Cell[CellGroupData[{
Cell[29793, 647, 254, 4, 53, "Subsection",ExpressionUUID->"a1038eec-a59a-42b3-a2a7-f9281ff8e165"],
Cell[30050, 653, 34393, 753, 2382, "Input",ExpressionUUID->"1e75eb67-b503-4278-910c-2a23ca9f65f1"]
}, Closed]],
Cell[CellGroupData[{
Cell[64480, 1411, 170, 3, 37, "Subsection",ExpressionUUID->"70955073-b7ff-4a22-ba12-0c44081801b1"],
Cell[64653, 1416, 25534, 563, 1888, "Input",ExpressionUUID->"f1693d8c-7532-4c23-bd64-0408f02d9e9e"]
}, Closed]],
Cell[CellGroupData[{
Cell[90224, 1984, 191, 4, 37, "Subsection",ExpressionUUID->"73a1d5b6-cacd-4ffc-b545-f8ad48c322c3"],
Cell[90418, 1990, 32417, 732, 2306, "Input",ExpressionUUID->"3e6fcdfa-c357-4e8d-b759-a932dcaec928"]
}, Closed]],
Cell[CellGroupData[{
Cell[122872, 2727, 246, 5, 37, "Subsection",ExpressionUUID->"aae754c9-41c2-4b9e-aa24-f0eb792b9e32"],
Cell[123121, 2734, 26710, 589, 2097, "Input",ExpressionUUID->"778bb8a1-ed2a-40f7-a5ff-9f56a387487c"]
}, Closed]]
}, Open  ]],
Cell[CellGroupData[{
Cell[149880, 3329, 148, 3, 67, "Section",ExpressionUUID->"a1f33211-caca-4b56-88a4-df9d67c4649f"],
Cell[CellGroupData[{
Cell[150053, 3336, 166, 3, 53, "Subsection",ExpressionUUID->"a29e33d6-c9ef-4dfa-b3b6-7a8ca89eed73"],
Cell[150222, 3341, 17068, 352, 1622, "Input",ExpressionUUID->"bf44cc81-2978-4d34-b03f-0dc653e61041"]
}, Closed]]
}, Open  ]],
Cell[CellGroupData[{
Cell[167339, 3699, 209, 4, 67, "Section",ExpressionUUID->"43f13067-53af-4acd-aa9d-ce1b427c583b"],
Cell[CellGroupData[{
Cell[167573, 3707, 130, 3, 53, "Subsection",ExpressionUUID->"e7c07ade-b8cf-4aa4-b070-2bb761f25e1b"],
Cell[167706, 3712, 4459, 97, 465, "Input",ExpressionUUID->"a71e6324-e0e7-47bb-866e-8423542cebb7"]
}, Closed]],
Cell[CellGroupData[{
Cell[172202, 3814, 204, 4, 37, "Subsection",ExpressionUUID->"c4c1f807-da65-47c5-9540-4750a7a81ac9"],
Cell[172409, 3820, 4509, 100, 444, "Input",ExpressionUUID->"27982d56-6c61-45fb-bc76-87f64bf851ac"]
}, Closed]],
Cell[CellGroupData[{
Cell[176955, 3925, 138, 3, 37, "Subsection",ExpressionUUID->"b4b5252e-ff40-4d6d-b00e-e9710f7f4bd0"],
Cell[177096, 3930, 14008, 313, 541, "Input",ExpressionUUID->"010256eb-c21f-4b57-8b91-24bd4375e46a"]
}, Closed]],
Cell[CellGroupData[{
Cell[191141, 4248, 142, 3, 37, "Subsection",ExpressionUUID->"8ebe4764-f5dd-483a-a6e1-1365765adb6b"],
Cell[191286, 4253, 6088, 140, 579, "Input",ExpressionUUID->"9ec81286-7834-41d8-a2cc-bafa1a239844"]
}, Closed]],
Cell[CellGroupData[{
Cell[197411, 4398, 210, 4, 37, "Subsection",ExpressionUUID->"7d545167-b6eb-4b6f-841c-c3dd168be015"],
Cell[197624, 4404, 8841, 189, 881, "Input",ExpressionUUID->"ea732a1e-f407-493b-bc17-27be501c7f8b"]
}, Closed]],
Cell[CellGroupData[{
Cell[206502, 4598, 190, 2, 37, "Subsection",ExpressionUUID->"9d68fbda-e71c-41d3-afe4-21e002ecbb1d"],
Cell[206695, 4602, 12242, 294, 1168, "Input",ExpressionUUID->"4956b7f9-1d99-4618-978c-986f58262a12"]
}, Closed]],
Cell[CellGroupData[{
Cell[218974, 4901, 248, 4, 37, "Subsection",ExpressionUUID->"ceebcc9d-48f0-4e34-9598-d9d20a8fc7ae"],
Cell[219225, 4907, 7832, 177, 541, "Input",ExpressionUUID->"67d721d9-4859-4970-bf63-6c86a0256dc2"]
}, Closed]],
Cell[CellGroupData[{
Cell[227094, 5089, 337, 5, 37, "Subsection",ExpressionUUID->"4e6f2e10-b60f-434f-87e8-1c8167222e60"],
Cell[227434, 5096, 7325, 182, 446, "Input",ExpressionUUID->"fb9719e2-5063-4c64-8a3e-f3bd1c9f8df6"]
}, Closed]]
}, Open  ]],
Cell[CellGroupData[{
Cell[234808, 5284, 155, 3, 67, "Section",ExpressionUUID->"dd6e8fa8-413d-4adc-9e25-2640f7bf7520"],
Cell[CellGroupData[{
Cell[234988, 5291, 163, 3, 53, "Subsection",ExpressionUUID->"b9a2c614-66c1-492d-b721-2e3926d1b212"],
Cell[235154, 5296, 47887, 1017, 4035, "Input",ExpressionUUID->"75ae6db8-56b0-42fa-be98-b01f43c14434"]
}, Closed]],
Cell[CellGroupData[{
Cell[283078, 6318, 169, 3, 37, "Subsection",ExpressionUUID->"bda74fb8-2d9d-4be5-8ac6-57e56aa5f7c6"],
Cell[283250, 6323, 1549, 41, 104, "Input",ExpressionUUID->"610d4740-b7f3-4398-a613-e9ffa7426fea"]
}, Closed]],
Cell[CellGroupData[{
Cell[284836, 6369, 198, 3, 37, "Subsection",ExpressionUUID->"1c96306b-11c8-413b-b595-dbdc6cbfbf11"],
Cell[285037, 6374, 2995, 85, 237, "Input",ExpressionUUID->"4ec534ec-808d-4e2d-866b-5ff831333ddb"]
}, Closed]],
Cell[CellGroupData[{
Cell[288069, 6464, 139, 3, 37, "Subsection",ExpressionUUID->"0427e292-5baf-4bc9-a96f-bce10a7286e0"],
Cell[288211, 6469, 1192, 29, 140, "Input",ExpressionUUID->"44eaab1d-a653-4798-882b-a5e373cc572f"]
}, Closed]]
}, Open  ]]
}, Open  ]]
}
]
*)

